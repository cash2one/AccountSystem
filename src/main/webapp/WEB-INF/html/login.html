<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type="text/javascript" src="/js/util.js"></script>

<script type="text/javascript">
	paramArray = getHttpRequestParameters(window.location.href);
	var i = 0;
	for (i = 0; i < paramArray.length; i++) {
		alert(paramArray[i].key + ":" + paramArray[i].value);
	}
</script><title>Login</title>
</head>
<body>

<!-- <script type="text/javascript" src="/WEB-INF/js/signature.js"></script> -->
<script type="text/javascript">
	function checkstat(stat){
	    if (stat.CAS_LOGIN_STATE=="") {
	    	// not login status 
	    	// TODO 
	    	// redirect also need to contains all the params 
	        window.location.href="http://login.sdo.com/sdo/Login/LoginFrameFC.php?appId=917&appArea=1&customSecurityLevel=1&returnURL=http%3A%2F%2F58.215.173.61%2Fweb%2Fredirect";
	    } else {
	    	// alread longin 
	    	var redirect_uri = "http://58.215.173.61/api/authorize?";
	    	var queries = "";
	    	for (var i = 0; i < paramArray.length; i++) {
	    		queries = queries + paramArray[i].key + "=" + paramArray[i].value + "&";
	    	}
	    	redirect_uri += queries
	        var url = "http://cas.sdo.com/cas/login?service=" 
	        		+ encodeURIComponent(redirect_uri) 
	        		+ "&appId=201159400&appArea=0&customSecurityLevel=1";
	        document.getElementById("login_frame").src = encodeURI(url);
	        // In this redirection, we can get the ticket from sdo 
	        // take this ticket to access the next page to get the sndaId using validate interface 
	        // TODO 
	    }
	}
</script>

<iframe id="login_frame" scrolling="yes" frameborder="0" width="100%" height="100%"></iframe>
<script type="text/javascript" src="https://cas.sdo.com/cas/loginStateService?method=checkstat"></script>
</body>
</html>