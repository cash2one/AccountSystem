var Prototype={Version:"1.7",Browser:(function(){var b=navigator.userAgent;var a=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!a,Opera:a,WebKit:b.indexOf("AppleWebKit/")>-1,Gecko:b.indexOf("Gecko")>-1&&b.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(b)}})(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:(function(){var a=window.Element||window.HTMLElement;return !!(a&&a.prototype)})(),SpecificElementExtensions:(function(){if(typeof window.HTMLDivElement!=="undefined"){return true}var c=document.createElement("div"),b=document.createElement("form"),a=false;if(c.__proto__&&(c.__proto__!==b.__proto__)){a=true}c=b=null;return a})()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(a){return a}};if(Prototype.Browser.MobileSafari){Prototype.BrowserFeatures.SpecificElementExtensions=false}var Abstract={};var Try={these:function(){var c;for(var b=0,d=arguments.length;b<d;b++){var a=arguments[b];try{c=a();break}catch(f){}}return c}};var Class=(function(){var d=(function(){for(var e in {toString:1}){if(e==="toString"){return false}}return true})();function a(){}function b(){var h=null,g=$A(arguments);if(Object.isFunction(g[0])){h=g.shift()}function e(){this.initialize.apply(this,arguments)}Object.extend(e,Class.Methods);e.superclass=h;e.subclasses=[];if(h){a.prototype=h.prototype;e.prototype=new a;h.subclasses.push(e)}for(var f=0,j=g.length;f<j;f++){e.addMethods(g[f])}if(!e.prototype.initialize){e.prototype.initialize=Prototype.emptyFunction}e.prototype.constructor=e;return e}function c(l){var g=this.superclass&&this.superclass.prototype,f=Object.keys(l);if(d){if(l.toString!=Object.prototype.toString){f.push("toString")}if(l.valueOf!=Object.prototype.valueOf){f.push("valueOf")}}for(var e=0,h=f.length;e<h;e++){var k=f[e],j=l[k];if(g&&Object.isFunction(j)&&j.argumentNames()[0]=="$super"){var m=j;j=(function(n){return function(){return g[n].apply(this,arguments)}})(k).wrap(m);j.valueOf=m.valueOf.bind(m);j.toString=m.toString.bind(m)}this.prototype[k]=j}return this}return{create:b,Methods:{addMethods:c}}})();(function(){var D=Object.prototype.toString,C="Null",p="Undefined",w="Boolean",f="Number",t="String",I="Object",u="[object Function]",z="[object Boolean]",g="[object Number]",m="[object String]",h="[object Array]",y="[object Date]",j=window.JSON&&typeof JSON.stringify==="function"&&JSON.stringify(0)==="0"&&typeof JSON.stringify(Prototype.K)==="undefined";function l(K){switch(K){case null:return C;case (void 0):return p}var J=typeof K;switch(J){case"boolean":return w;case"number":return f;case"string":return t}return I}function A(J,L){for(var K in L){J[K]=L[K]}return J}function H(J){try{if(c(J)){return"undefined"}if(J===null){return"null"}return J.inspect?J.inspect():String(J)}catch(K){if(K instanceof RangeError){return"..."}throw K}}function E(J){return G("",{"":J},[])}function G(S,P,Q){var R=P[S],O=typeof R;if(l(R)===I&&typeof R.toJSON==="function"){R=R.toJSON(S)}var L=D.call(R);switch(L){case g:case z:case m:R=R.valueOf()}switch(R){case null:return"null";case true:return"true";case false:return"false"}O=typeof R;switch(O){case"string":return R.inspect(true);case"number":return isFinite(R)?String(R):"null";case"object":for(var K=0,J=Q.length;K<J;K++){if(Q[K]===R){throw new TypeError()}}Q.push(R);var N=[];if(L===h){for(var K=0,J=R.length;K<J;K++){var M=G(K,R,Q);N.push(typeof M==="undefined"?"null":M)}N="["+N.join(",")+"]"}else{var U=Object.keys(R);for(var K=0,J=U.length;K<J;K++){var S=U[K],M=G(S,R,Q);if(typeof M!=="undefined"){N.push(S.inspect(true)+":"+M)}}N="{"+N.join(",")+"}"}Q.pop();return N}}function x(J){return JSON.stringify(J)}function k(J){return $H(J).toQueryString()}function q(J){return J&&J.toHTML?J.toHTML():String.interpret(J)}function s(J){if(l(J)!==I){throw new TypeError()}var K=[];for(var L in J){if(J.hasOwnProperty(L)){K.push(L)}}return K}function d(J){var K=[];for(var L in J){K.push(J[L])}return K}function B(J){return A({},J)}function v(J){return !!(J&&J.nodeType==1)}function n(J){return D.call(J)===h}var b=(typeof Array.isArray=="function")&&Array.isArray([])&&!Array.isArray({});if(b){n=Array.isArray}function e(J){return J instanceof Hash}function a(J){return D.call(J)===u}function o(J){return D.call(J)===m}function r(J){return D.call(J)===g}function F(J){return D.call(J)===y}function c(J){return typeof J==="undefined"}A(Object,{extend:A,inspect:H,toJSON:j?x:E,toQueryString:k,toHTML:q,keys:Object.keys||s,values:d,clone:B,isElement:v,isArray:n,isHash:e,isFunction:a,isString:o,isNumber:r,isDate:F,isUndefined:c})})();Object.extend(Function.prototype,(function(){var l=Array.prototype.slice;function d(p,m){var o=p.length,n=m.length;while(n--){p[o+n]=m[n]}return p}function j(n,m){n=l.call(n,0);return d(n,m)}function g(){var m=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return m.length==1&&!m[0]?[]:m}function h(o){if(arguments.length<2&&Object.isUndefined(arguments[0])){return this}var m=this,n=l.call(arguments,1);return function(){var p=j(n,arguments);return m.apply(o,p)}}function f(o){var m=this,n=l.call(arguments,1);return function(q){var p=d([q||window.event],n);return m.apply(o,p)}}function k(){if(!arguments.length){return this}var m=this,n=l.call(arguments,0);return function(){var o=j(n,arguments);return m.apply(this,o)}}function e(o){var m=this,n=l.call(arguments,1);o=o*1000;return window.setTimeout(function(){return m.apply(m,n)},o)}function a(){var m=d([0.01],arguments);return this.delay.apply(this,m)}function c(n){var m=this;return function(){var o=d([m.bind(this)],arguments);return n.apply(this,o)}}function b(){if(this._methodized){return this._methodized}var m=this;return this._methodized=function(){var n=d([this],arguments);return m.apply(null,n)}}return{argumentNames:g,bind:h,bindAsEventListener:f,curry:k,delay:e,defer:a,wrap:c,methodize:b}})());(function(c){function b(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function a(){return this.toISOString()}if(!c.toISOString){c.toISOString=b}if(!c.toJSON){c.toJSON=a}})(Date.prototype);RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(b,a){this.callback=b;this.frequency=a;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},execute:function(){this.callback(this)},stop:function(){if(!this.timer){return}clearInterval(this.timer);this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute();this.currentlyExecuting=false}catch(a){this.currentlyExecuting=false;throw a}}}});Object.extend(String,{interpret:function(a){return a==null?"":String(a)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}});Object.extend(String.prototype,(function(){var NATIVE_JSON_PARSE_SUPPORT=window.JSON&&typeof JSON.parse==="function"&&JSON.parse('{"test": true}').test;function prepareReplacement(replacement){if(Object.isFunction(replacement)){return replacement}var template=new Template(replacement);return function(match){return template.evaluate(match)}}function gsub(pattern,replacement){var result="",source=this,match;replacement=prepareReplacement(replacement);if(Object.isString(pattern)){pattern=RegExp.escape(pattern)}if(!(pattern.length||pattern.source)){replacement=replacement("");return replacement+source.split("").join(replacement)+replacement}while(source.length>0){if(match=source.match(pattern)){result+=source.slice(0,match.index);result+=String.interpret(replacement(match));source=source.slice(match.index+match[0].length)}else{result+=source,source=""}}return result}function sub(pattern,replacement,count){replacement=prepareReplacement(replacement);count=Object.isUndefined(count)?1:count;return this.gsub(pattern,function(match){if(--count<0){return match[0]}return replacement(match)})}function scan(pattern,iterator){this.gsub(pattern,iterator);return String(this)}function truncate(length,truncation){length=length||30;truncation=Object.isUndefined(truncation)?"...":truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this)}function strip(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function extractScripts(){var matchAll=new RegExp(Prototype.ScriptFragment,"img"),matchOne=new RegExp(Prototype.ScriptFragment,"im");return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||["",""])[1]})}function evalScripts(){return this.extractScripts().map(function(script){return eval(script)})}function escapeHTML(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function unescapeHTML(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function toQueryParams(separator){var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match){return{}}return match[1].split(separator||"&").inject({},function(hash,pair){if((pair=pair.split("="))[0]){var key=decodeURIComponent(pair.shift()),value=pair.length>1?pair.join("="):pair[0];if(value!=undefined){value=decodeURIComponent(value)}if(key in hash){if(!Object.isArray(hash[key])){hash[key]=[hash[key]]}hash[key].push(value)}else{hash[key]=value}}return hash})}function toArray(){return this.split("")}function succ(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function times(count){return count<1?"":new Array(count+1).join(this)}function camelize(){return this.replace(/-+(.)?/g,function(match,chr){return chr?chr.toUpperCase():""})}function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()}function underscore(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}function dasherize(){return this.replace(/_/g,"-")}function inspect(useDoubleQuotes){var escapedString=this.replace(/[\x00-\x1f\\]/g,function(character){if(character in String.specialChar){return String.specialChar[character]}return"\\u00"+character.charCodeAt().toPaddedString(2,16)});if(useDoubleQuotes){return'"'+escapedString.replace(/"/g,'\\"')+'"'}return"'"+escapedString.replace(/'/g,"\\'")+"'"}function unfilterJSON(filter){return this.replace(filter||Prototype.JSONFilter,"$1")}function isJSON(){var str=this;if(str.blank()){return false}str=str.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@");str=str.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");str=str.replace(/(?:^|:|,)(?:\s*\[)+/g,"");return(/^[\],:{}\s]*$/).test(str)}function evalJSON(sanitize){var json=this.unfilterJSON(),cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;if(cx.test(json)){json=json.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())}function parseJSON(){var json=this.unfilterJSON();return JSON.parse(json)}function include(pattern){return this.indexOf(pattern)>-1}function startsWith(pattern){return this.lastIndexOf(pattern,0)===0}function endsWith(pattern){var d=this.length-pattern.length;return d>=0&&this.indexOf(pattern,d)===d}function empty(){return this==""}function blank(){return/^\s*$/.test(this)}function interpolate(object,pattern){return new Template(this,pattern).evaluate(object)}return{gsub:gsub,sub:sub,scan:scan,truncate:truncate,strip:String.prototype.trim||strip,stripTags:stripTags,stripScripts:stripScripts,extractScripts:extractScripts,evalScripts:evalScripts,escapeHTML:escapeHTML,unescapeHTML:unescapeHTML,toQueryParams:toQueryParams,parseQuery:toQueryParams,toArray:toArray,succ:succ,times:times,camelize:camelize,capitalize:capitalize,underscore:underscore,dasherize:dasherize,inspect:inspect,unfilterJSON:unfilterJSON,isJSON:isJSON,evalJSON:NATIVE_JSON_PARSE_SUPPORT?parseJSON:evalJSON,include:include,startsWith:startsWith,endsWith:endsWith,empty:empty,blank:blank,interpolate:interpolate}})());var Template=Class.create({initialize:function(a,b){this.template=a.toString();this.pattern=b||Template.Pattern},evaluate:function(a){if(a&&Object.isFunction(a.toTemplateReplacements)){a=a.toTemplateReplacements()}return this.template.gsub(this.pattern,function(d){if(a==null){return(d[1]+"")}var f=d[1]||"";if(f=="\\"){return d[2]}var b=a,g=d[3],e=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;d=e.exec(g);if(d==null){return f}while(d!=null){var c=d[1].startsWith("[")?d[2].replace(/\\\\]/g,"]"):d[1];b=b[c];if(null==b||""==d[3]){break}g=g.substring("["==d[3]?d[1].length:d[0].length);d=e.exec(g)}return f+String.interpret(b)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable=(function(){function c(z,y){var x=0;try{this._each(function(B){z.call(y,B,x++)})}catch(A){if(A!=$break){throw A}}return this}function s(A,z,y){var x=-A,B=[],C=this.toArray();if(A<1){return C}while((x+=A)<C.length){B.push(C.slice(x,x+A))}return B.collect(z,y)}function b(z,y){z=z||Prototype.K;var x=true;this.each(function(B,A){x=x&&!!z.call(y,B,A);if(!x){throw $break}});return x}function j(z,y){z=z||Prototype.K;var x=false;this.each(function(B,A){if(x=!!z.call(y,B,A)){throw $break}});return x}function k(z,y){z=z||Prototype.K;var x=[];this.each(function(B,A){x.push(z.call(y,B,A))});return x}function u(z,y){var x;this.each(function(B,A){if(z.call(y,B,A)){x=B;throw $break}});return x}function h(z,y){var x=[];this.each(function(B,A){if(z.call(y,B,A)){x.push(B)}});return x}function g(A,z,y){z=z||Prototype.K;var x=[];if(Object.isString(A)){A=new RegExp(RegExp.escape(A))}this.each(function(C,B){if(A.match(C)){x.push(z.call(y,C,B))}});return x}function a(x){if(Object.isFunction(this.indexOf)){if(this.indexOf(x)!=-1){return true}}var y=false;this.each(function(z){if(z==x){y=true;throw $break}});return y}function r(y,x){x=Object.isUndefined(x)?null:x;return this.eachSlice(y,function(z){while(z.length<y){z.push(x)}return z})}function m(x,z,y){this.each(function(B,A){x=z.call(y,x,B,A)});return x}function w(y){var x=$A(arguments).slice(1);return this.map(function(z){return z[y].apply(z,x)})}function q(z,y){z=z||Prototype.K;var x;this.each(function(B,A){B=z.call(y,B,A);if(x==null||B>=x){x=B}});return x}function o(z,y){z=z||Prototype.K;var x;this.each(function(B,A){B=z.call(y,B,A);if(x==null||B<x){x=B}});return x}function e(A,y){A=A||Prototype.K;var z=[],x=[];this.each(function(C,B){(A.call(y,C,B)?z:x).push(C)});return[z,x]}function f(y){var x=[];this.each(function(z){x.push(z[y])});return x}function d(z,y){var x=[];this.each(function(B,A){if(!z.call(y,B,A)){x.push(B)}});return x}function n(y,x){return this.map(function(A,z){return{value:A,criteria:y.call(x,A,z)}}).sort(function(C,B){var A=C.criteria,z=B.criteria;return A<z?-1:A>z?1:0}).pluck("value")}function p(){return this.map()}function t(){var y=Prototype.K,x=$A(arguments);if(Object.isFunction(x.last())){y=x.pop()}var z=[this].concat(x).map($A);return this.map(function(B,A){return y(z.pluck(A))})}function l(){return this.toArray().length}function v(){return"#<Enumerable:"+this.toArray().inspect()+">"}return{each:c,eachSlice:s,all:b,every:b,any:j,some:j,collect:k,map:k,detect:u,findAll:h,select:h,filter:h,grep:g,include:a,member:a,inGroupsOf:r,inject:m,invoke:w,max:q,min:o,partition:e,pluck:f,reject:d,sortBy:n,toArray:p,entries:p,zip:t,size:l,inspect:v,find:u}})();function $A(c){if(!c){return[]}if("toArray" in Object(c)){return c.toArray()}var b=c.length||0,a=new Array(b);while(b--){a[b]=c[b]}return a}function $w(a){if(!Object.isString(a)){return[]}a=a.strip();return a?a.split(/\s+/):[]}Array.from=$A;(function(){var s=Array.prototype,n=s.slice,p=s.forEach;function b(x,w){for(var v=0,y=this.length>>>0;v<y;v++){if(v in this){x.call(w,this[v],v,this)}}}if(!p){p=b}function m(){this.length=0;return this}function d(){return this[0]}function g(){return this[this.length-1]}function j(){return this.select(function(v){return v!=null})}function u(){return this.inject([],function(w,v){if(Object.isArray(v)){return w.concat(v.flatten())}w.push(v);return w})}function h(){var v=n.call(arguments,0);return this.select(function(w){return !v.include(w)})}function f(v){return(v===false?this.toArray():this)._reverse()}function l(v){return this.inject([],function(y,x,w){if(0==w||(v?y.last()!=x:!y.include(x))){y.push(x)}return y})}function q(v){return this.uniq().findAll(function(w){return v.detect(function(x){return w===x})})}function r(){return n.call(this,0)}function k(){return this.length}function t(){return"["+this.map(Object.inspect).join(", ")+"]"}function a(x,v){v||(v=0);var w=this.length;if(v<0){v=w+v}for(;v<w;v++){if(this[v]===x){return v}}return -1}function o(w,v){v=isNaN(v)?this.length:(v<0?this.length+v:v)+1;var x=this.slice(0,v).reverse().indexOf(w);return(x<0)?x:v-x-1}function c(){var A=n.call(this,0),y;for(var w=0,x=arguments.length;w<x;w++){y=arguments[w];if(Object.isArray(y)&&!("callee" in y)){for(var v=0,z=y.length;v<z;v++){A.push(y[v])}}else{A.push(y)}}return A}Object.extend(s,Enumerable);if(!s._reverse){s._reverse=s.reverse}Object.extend(s,{_each:p,clear:m,first:d,last:g,compact:j,flatten:u,without:h,reverse:f,uniq:l,intersect:q,clone:r,toArray:r,size:k,inspect:t});var e=(function(){return[].concat(arguments)[0][0]!==1})(1,2);if(e){s.concat=c}if(!s.indexOf){s.indexOf=a}if(!s.lastIndexOf){s.lastIndexOf=o}})();function $H(a){return new Hash(a)}var Hash=Class.create(Enumerable,(function(){function e(q){this._object=Object.isHash(q)?q.toObject():Object.clone(q)}function f(r){for(var q in this._object){var s=this._object[q],t=[q,s];t.key=q;t.value=s;r(t)}}function k(q,r){return this._object[q]=r}function c(q){if(this._object[q]!==Object.prototype[q]){return this._object[q]}}function n(q){var r=this._object[q];delete this._object[q];return r}function p(){return Object.clone(this._object)}function o(){return this.pluck("key")}function m(){return this.pluck("value")}function g(r){var q=this.detect(function(s){return s.value===r});return q&&q.key}function j(q){return this.clone().update(q)}function d(q){return new Hash(q).inject(this,function(r,s){r.set(s.key,s.value);return r})}function b(q,r){if(Object.isUndefined(r)){return q}return q+"="+encodeURIComponent(String.interpret(r))}function a(){return this.inject([],function(u,x){var t=encodeURIComponent(x.key),r=x.value;if(r&&typeof r=="object"){if(Object.isArray(r)){var w=[];for(var s=0,q=r.length,v;s<q;s++){v=r[s];w.push(b(t,v))}return u.concat(w)}}else{u.push(b(t,r))}return u}).join("&")}function l(){return"#<Hash:{"+this.map(function(q){return q.map(Object.inspect).join(": ")}).join(", ")+"}>"}function h(){return new Hash(this)}return{initialize:e,_each:f,set:k,get:c,unset:n,toObject:p,toTemplateReplacements:p,keys:o,values:m,index:g,merge:j,update:d,toQueryString:a,inspect:l,toJSON:p,clone:h}})());Hash.from=$H;Object.extend(Number.prototype,(function(){function d(){return this.toPaddedString(2,16)}function b(){return this+1}function h(k,j){$R(0,this,true).each(k,j);return this}function g(l,k){var j=this.toString(k||10);return"0".times(l-j.length)+j}function a(){return Math.abs(this)}function c(){return Math.round(this)}function e(){return Math.ceil(this)}function f(){return Math.floor(this)}return{toColorPart:d,succ:b,times:h,toPaddedString:g,abs:a,round:c,ceil:e,floor:f}})());function $R(c,a,b){return new ObjectRange(c,a,b)}var ObjectRange=Class.create(Enumerable,(function(){function b(f,d,e){this.start=f;this.end=d;this.exclusive=e}function c(d){var e=this.start;while(this.include(e)){d(e);e=e.succ()}}function a(d){if(d<this.start){return false}if(this.exclusive){return d<this.end}return d<=this.end}return{initialize:b,_each:c,include:a}})());var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(a){this.responders._each(a)},register:function(a){if(!this.include(a)){this.responders.push(a)}},unregister:function(a){this.responders=this.responders.without(a)},dispatch:function(d,b,c,a){this.each(function(f){if(Object.isFunction(f[d])){try{f[d].apply(f,[b,c,a])}catch(g){}}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(a){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(Object.isHash(this.options.parameters)){this.options.parameters=this.options.parameters.toObject()}}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,b,a){$super(a);this.transport=Ajax.getTransport();this.request(b)},request:function(b){this.url=b;this.method=this.options.method;var d=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);if(!["get","post"].include(this.method)){d+=(d?"&":"")+"_method="+this.method;this.method="post"}if(d&&this.method==="get"){this.url+=(this.url.include("?")?"&":"?")+d}this.parameters=d.toQueryParams();try{var a=new Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(a)}Ajax.Responders.dispatch("onCreate",this,a);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.withCredentials){this.transport.withCredentials=true}if(this.options.asynchronous){this.respondToReadyState.bind(this).defer(1)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||d):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(c){this.dispatchException(c)}},onStateChange:function(){var a=this.transport.readyState;if(a>1&&!((a==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var e={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){e["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){e.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var c=this.options.requestHeaders;if(Object.isFunction(c.push)){for(var b=0,d=c.length;b<d;b+=2){e[c[b]]=c[b+1]}}else{$H(c).each(function(f){e[f.key]=f.value})}}for(var a in e){this.transport.setRequestHeader(a,e[a])}},success:function(){var a=this.getStatus();return !a||(a>=200&&a<300)||a==304},getStatus:function(){try{if(this.transport.status===1223){return 204}return this.transport.status||0}catch(a){return 0}},respondToReadyState:function(a){var c=Ajax.Request.Events[a],b=new Ajax.Response(this);if(c=="Complete"){try{this._complete=true;(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(b,b.headerJSON)}catch(d){this.dispatchException(d)}var f=b.getHeader("Content-type");if(this.options.evalJS=="force"||(this.options.evalJS&&this.isSameOrigin()&&f&&f.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))){this.evalResponse()}}try{(this.options["on"+c]||Prototype.emptyFunction)(b,b.headerJSON);Ajax.Responders.dispatch("on"+c,this,b,b.headerJSON)}catch(d){this.dispatchException(d)}if(c=="Complete"){this.transport.onreadystatechange=Prototype.emptyFunction}},isSameOrigin:function(){var a=this.url.match(/^\s*https?:\/\/[^\/]*/);return !a||(a[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""}))},getHeader:function(a){try{return this.transport.getResponseHeader(a)||null}catch(b){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(a){(this.options.onException||Prototype.emptyFunction)(this,a);Ajax.Responders.dispatch("onException",this,a)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];Ajax.Response=Class.create({initialize:function(c){this.request=c;var d=this.transport=c.transport,a=this.readyState=d.readyState;if((a>2&&!Prototype.Browser.IE)||a==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(d.responseText);this.headerJSON=this._getHeaderJSON()}if(a==4){var b=d.responseXML;this.responseXML=Object.isUndefined(b)?null:b;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(a){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(a){return null}},getResponseHeader:function(a){return this.transport.getResponseHeader(a)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var a=this.getHeader("X-JSON");if(!a){return null}a=decodeURIComponent(escape(a));try{return a.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}},_getResponseJSON:function(){var a=this.request.options;if(!a.evalJSON||(a.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json"))||this.responseText.blank()){return null}try{return this.responseText.evalJSON(a.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,a,c,b){this.container={success:(a.success||a),failure:(a.failure||(a.success?null:a))};b=Object.clone(b);var d=b.onComplete;b.onComplete=(function(e,f){this.updateContent(e.responseText);if(Object.isFunction(d)){d(e,f)}}).bind(this);$super(c,b)},updateContent:function(d){var c=this.container[this.success()?"success":"failure"],a=this.options;if(!a.evalScripts){d=d.stripScripts()}if(c=$(c)){if(a.insertion){if(Object.isString(a.insertion)){var b={};b[a.insertion]=d;c.insert(b)}else{a.insertion(c,d)}}else{c.update(d)}}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,a,c,b){$super(b);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=a;this.url=c;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(a){if(this.options.decay){this.decay=(a.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=a.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});function $(b){if(arguments.length>1){for(var a=0,d=[],c=arguments.length;a<c;a++){d.push($(arguments[a]))}return d}if(Object.isString(b)){b=document.getElementById(b)}return Element.extend(b)}if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(f,a){var c=[];var e=document.evaluate(f,$(a)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var b=0,d=e.snapshotLength;b<d;b++){c.push(Element.extend(e.snapshotItem(b)))}return c}}if(!Node){var Node={}}if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}(function(c){function d(f,e){if(f==="select"){return false}if("type" in e){return false}return true}var b=(function(){try{var e=document.createElement('<input name="x">');return e.tagName.toLowerCase()==="input"&&e.name==="x"}catch(f){return false}})();var a=c.Element;c.Element=function(g,f){f=f||{};g=g.toLowerCase();var e=Element.cache;if(b&&f.name){g="<"+g+' name="'+f.name+'">';delete f.name;return Element.writeAttribute(document.createElement(g),f)}if(!e[g]){e[g]=Element.extend(document.createElement(g))}var h=d(g,f)?e[g].cloneNode(false):document.createElement(g);return Element.writeAttribute(h,f)};Object.extend(c.Element,a||{});if(a){c.Element.prototype=a.prototype}})(this);Element.idCounter=1;Element.cache={};Element._purgeElement=function(b){var a=b._prototypeUID;if(a){Element.stopObserving(b);b._prototypeUID=void 0;delete Element.Storage[a]}};Element.Methods={visible:function(a){return $(a).style.display!="none"},toggle:function(a){a=$(a);Element[Element.visible(a)?"hide":"show"](a);return a},hide:function(a){a=$(a);a.style.display="none";return a},show:function(a){a=$(a);a.style.display="";return a},remove:function(a){a=$(a);a.parentNode.removeChild(a);return a},update:(function(){var d=(function(){var g=document.createElement("select"),h=true;g.innerHTML='<option value="test">test</option>';if(g.options&&g.options[0]){h=g.options[0].nodeName.toUpperCase()!=="OPTION"}g=null;return h})();var b=(function(){try{var g=document.createElement("table");if(g&&g.tBodies){g.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var j=typeof g.tBodies[0]=="undefined";g=null;return j}}catch(h){return true}})();var a=(function(){try{var g=document.createElement("div");g.innerHTML="<link>";var j=(g.childNodes.length===0);g=null;return j}catch(h){return true}})();var c=d||b||a;var f=(function(){var g=document.createElement("script"),j=false;try{g.appendChild(document.createTextNode(""));j=!g.firstChild||g.firstChild&&g.firstChild.nodeType!==3}catch(h){j=true}g=null;return j})();function e(l,m){l=$(l);var g=Element._purgeElement;var n=l.getElementsByTagName("*"),k=n.length;while(k--){g(n[k])}if(m&&m.toElement){m=m.toElement()}if(Object.isElement(m)){return l.update().insert(m)}m=Object.toHTML(m);var j=l.tagName.toUpperCase();if(j==="SCRIPT"&&f){l.text=m;return l}if(c){if(j in Element._insertionTranslations.tags){while(l.firstChild){l.removeChild(l.firstChild)}Element._getContentFromAnonymousElement(j,m.stripScripts()).each(function(o){l.appendChild(o)})}else{if(a&&Object.isString(m)&&m.indexOf("<link")>-1){while(l.firstChild){l.removeChild(l.firstChild)}var h=Element._getContentFromAnonymousElement(j,m.stripScripts(),true);h.each(function(o){l.appendChild(o)})}else{l.innerHTML=m.stripScripts()}}}else{l.innerHTML=m.stripScripts()}m.evalScripts.bind(m).defer();return l}return e})(),replace:function(b,c){b=$(b);if(c&&c.toElement){c=c.toElement()}else{if(!Object.isElement(c)){c=Object.toHTML(c);var a=b.ownerDocument.createRange();a.selectNode(b);c.evalScripts.bind(c).defer();c=a.createContextualFragment(c.stripScripts())}}b.parentNode.replaceChild(c,b);return b},insert:function(c,e){c=$(c);if(Object.isString(e)||Object.isNumber(e)||Object.isElement(e)||(e&&(e.toElement||e.toHTML))){e={bottom:e}}var d,f,b,g;for(var a in e){d=e[a];a=a.toLowerCase();f=Element._insertionTranslations[a];if(d&&d.toElement){d=d.toElement()}if(Object.isElement(d)){f(c,d);continue}d=Object.toHTML(d);b=((a=="before"||a=="after")?c.parentNode:c).tagName.toUpperCase();g=Element._getContentFromAnonymousElement(b,d.stripScripts());if(a=="top"||a=="after"){g.reverse()}g.each(f.curry(c));d.evalScripts.bind(d).defer()}return c},wrap:function(b,c,a){b=$(b);if(Object.isElement(c)){$(c).writeAttribute(a||{})}else{if(Object.isString(c)){c=new Element(c,a)}else{c=new Element("div",c)}}if(b.parentNode){b.parentNode.replaceChild(c,b)}c.appendChild(b);return c},inspect:function(b){b=$(b);var a="<"+b.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(f){var e=f.first(),c=f.last(),d=(b[e]||"").toString();if(d){a+=" "+c+"="+d.inspect(true)}});return a+">"},recursivelyCollect:function(a,c,d){a=$(a);d=d||-1;var b=[];while(a=a[c]){if(a.nodeType==1){b.push(Element.extend(a))}if(b.length==d){break}}return b},ancestors:function(a){return Element.recursivelyCollect(a,"parentNode")},descendants:function(a){return Element.select(a,"*")},firstDescendant:function(a){a=$(a).firstChild;while(a&&a.nodeType!=1){a=a.nextSibling}return $(a)},immediateDescendants:function(b){var a=[],c=$(b).firstChild;while(c){if(c.nodeType===1){a.push(Element.extend(c))}c=c.nextSibling}return a},previousSiblings:function(a,b){return Element.recursivelyCollect(a,"previousSibling")},nextSiblings:function(a){return Element.recursivelyCollect(a,"nextSibling")},siblings:function(a){a=$(a);return Element.previousSiblings(a).reverse().concat(Element.nextSiblings(a))},match:function(b,a){b=$(b);if(Object.isString(a)){return Prototype.Selector.match(b,a)}return a.match(b)},up:function(b,d,a){b=$(b);if(arguments.length==1){return $(b.parentNode)}var c=Element.ancestors(b);return Object.isNumber(d)?c[d]:Prototype.Selector.find(c,d,a)},down:function(b,c,a){b=$(b);if(arguments.length==1){return Element.firstDescendant(b)}return Object.isNumber(c)?Element.descendants(b)[c]:Element.select(b,c)[a||0]},previous:function(b,c,a){b=$(b);if(Object.isNumber(c)){a=c,c=false}if(!Object.isNumber(a)){a=0}if(c){return Prototype.Selector.find(b.previousSiblings(),c,a)}else{return b.recursivelyCollect("previousSibling",a+1)[a]}},next:function(b,d,a){b=$(b);if(Object.isNumber(d)){a=d,d=false}if(!Object.isNumber(a)){a=0}if(d){return Prototype.Selector.find(b.nextSiblings(),d,a)}else{var c=Object.isNumber(a)?a+1:1;return b.recursivelyCollect("nextSibling",a+1)[a]}},select:function(a){a=$(a);var b=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(b,a)},adjacent:function(a){a=$(a);var b=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(b,a.parentNode).without(a)},identify:function(a){a=$(a);var b=Element.readAttribute(a,"id");if(b){return b}do{b="anonymous_element_"+Element.idCounter++}while($(b));Element.writeAttribute(a,"id",b);return b},readAttribute:function(c,a){c=$(c);if(Prototype.Browser.IE){var b=Element._attributeTranslations.read;if(b.values[a]){return b.values[a](c,a)}if(b.names[a]){a=b.names[a]}if(a.include(":")){return(!c.attributes||!c.attributes[a])?null:c.attributes[a].value}}return c.getAttribute(a)},writeAttribute:function(e,c,f){e=$(e);var b={},d=Element._attributeTranslations.write;if(typeof c=="object"){b=c}else{b[c]=Object.isUndefined(f)?true:f}for(var a in b){c=d.names[a]||a;f=b[a];if(d.values[a]){c=d.values[a](e,f)}if(f===false||f===null){e.removeAttribute(c)}else{if(f===true){e.setAttribute(c,c)}else{e.setAttribute(c,f)}}}return e},getHeight:function(a){return Element.getDimensions(a).height},getWidth:function(a){return Element.getDimensions(a).width},classNames:function(a){return new Element.ClassNames(a)},hasClassName:function(a,b){if(!(a=$(a))){return}var c=a.className;return(c.length>0&&(c==b||new RegExp("(^|\\s)"+b+"(\\s|$)").test(c)))},addClassName:function(a,b){if(!(a=$(a))){return}if(!Element.hasClassName(a,b)){a.className+=(a.className?" ":"")+b}return a},removeClassName:function(a,b){if(!(a=$(a))){return}a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," ").strip();return a},toggleClassName:function(a,b){if(!(a=$(a))){return}return Element[Element.hasClassName(a,b)?"removeClassName":"addClassName"](a,b)},cleanWhitespace:function(b){b=$(b);var c=b.firstChild;while(c){var a=c.nextSibling;if(c.nodeType==3&&!/\S/.test(c.nodeValue)){b.removeChild(c)}c=a}return b},empty:function(a){return $(a).innerHTML.blank()},descendantOf:function(b,a){b=$(b),a=$(a);if(b.compareDocumentPosition){return(b.compareDocumentPosition(a)&8)===8}if(a.contains){return a.contains(b)&&a!==b}while(b=b.parentNode){if(b==a){return true}}return false},scrollTo:function(a){a=$(a);var b=Element.cumulativeOffset(a);window.scrollTo(b[0],b[1]);return a},getStyle:function(b,c){b=$(b);c=c=="float"?"cssFloat":c.camelize();var d=b.style[c];if(!d||d=="auto"){var a=document.defaultView.getComputedStyle(b,null);d=a?a[c]:null}if(c=="opacity"){return d?parseFloat(d):1}return d=="auto"?null:d},getOpacity:function(a){return $(a).getStyle("opacity")},setStyle:function(b,c){b=$(b);var e=b.style,a;if(Object.isString(c)){b.style.cssText+=";"+c;return c.include("opacity")?b.setOpacity(c.match(/opacity:\s*(\d?\.?\d*)/)[1]):b}for(var d in c){if(d=="opacity"){b.setOpacity(c[d])}else{e[(d=="float"||d=="cssFloat")?(Object.isUndefined(e.styleFloat)?"cssFloat":"styleFloat"):d]=c[d]}}return b},setOpacity:function(a,b){a=$(a);a.style.opacity=(b==1||b==="")?"":(b<0.00001)?0:b;return a},makePositioned:function(a){a=$(a);var b=Element.getStyle(a,"position");if(b=="static"||!b){a._madePositioned=true;a.style.position="relative";if(Prototype.Browser.Opera){a.style.top=0;a.style.left=0}}return a},undoPositioned:function(a){a=$(a);if(a._madePositioned){a._madePositioned=undefined;a.style.position=a.style.top=a.style.left=a.style.bottom=a.style.right=""}return a},makeClipping:function(a){a=$(a);if(a._overflow){return a}a._overflow=Element.getStyle(a,"overflow")||"auto";if(a._overflow!=="hidden"){a.style.overflow="hidden"}return a},undoClipping:function(a){a=$(a);if(!a._overflow){return a}a.style.overflow=a._overflow=="auto"?"":a._overflow;a._overflow=null;return a},clonePosition:function(b,d){var a=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});d=$(d);var e=Element.viewportOffset(d),f=[0,0],c=null;b=$(b);if(Element.getStyle(b,"position")=="absolute"){c=Element.getOffsetParent(b);f=Element.viewportOffset(c)}if(c==document.body){f[0]-=document.body.offsetLeft;f[1]-=document.body.offsetTop}if(a.setLeft){b.style.left=(e[0]-f[0]+a.offsetLeft)+"px"}if(a.setTop){b.style.top=(e[1]-f[1]+a.offsetTop)+"px"}if(a.setWidth){b.style.width=d.offsetWidth+"px"}if(a.setHeight){b.style.height=d.offsetHeight+"px"}return b}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(d,b,c){switch(c){case"height":case"width":if(!Element.visible(b)){return null}var e=parseInt(d(b,c),10);if(e!==b["offset"+c.capitalize()]){return e+"px"}var a;if(c==="height"){a=["border-top-width","padding-top","padding-bottom","border-bottom-width"]}else{a=["border-left-width","padding-left","padding-right","border-right-width"]}return a.inject(e,function(f,g){var h=d(b,g);return h===null?f:f-parseInt(h,10)})+"px";default:return d(b,c)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(c,a,b){if(b==="title"){return a.title}return c(a,b)})}else{if(Prototype.Browser.IE){Element.Methods.getStyle=function(a,b){a=$(a);b=(b=="float"||b=="cssFloat")?"styleFloat":b.camelize();var c=a.style[b];if(!c&&a.currentStyle){c=a.currentStyle[b]}if(b=="opacity"){if(c=(a.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/)){if(c[1]){return parseFloat(c[1])/100}}return 1}if(c=="auto"){if((b=="width"||b=="height")&&(a.getStyle("display")!="none")){return a["offset"+b.capitalize()]+"px"}return null}return c};Element.Methods.setOpacity=function(b,e){function f(g){g=g||"";return g.replace(/alpha\([^\)]*\)/gi,"")}b=$(b);var a=b.currentStyle;if((a&&!a.hasLayout)||(!a&&b.style.zoom=="normal")){b.style.zoom=1}var d=b.getStyle("filter"),c=b.style;if(e==1||e===""){(d=f(d))?c.filter=d:c.removeAttribute("filter");return b}else{if(e<0.00001){e=0}}c.filter=f(d)+"alpha(opacity="+(e*100)+")";return b};Element._attributeTranslations=(function(){var b="className",a="for",c=document.createElement("div");c.setAttribute(b,"x");if(c.className!=="x"){c.setAttribute("class","x");if(c.className==="x"){b="class"}}c=null;c=document.createElement("label");c.setAttribute(a,"x");if(c.htmlFor!=="x"){c.setAttribute("htmlFor","x");if(c.htmlFor==="x"){a="htmlFor"}}c=null;return{read:{names:{"class":b,className:b,"for":a,htmlFor:a},values:{_getAttr:function(d,e){return d.getAttribute(e)},_getAttr2:function(d,e){return d.getAttribute(e,2)},_getAttrNode:function(d,f){var e=d.getAttributeNode(f);return e?e.value:""},_getEv:(function(){var d=document.createElement("div"),g;d.onclick=Prototype.emptyFunction;var e=d.getAttribute("onclick");if(String(e).indexOf("{")>-1){g=function(f,h){h=f.getAttribute(h);if(!h){return null}h=h.toString();h=h.split("{")[1];h=h.split("}")[0];return h.strip()}}else{if(e===""){g=function(f,h){h=f.getAttribute(h);if(!h){return null}return h.strip()}}}d=null;return g})(),_flag:function(d,e){return $(d).hasAttribute(e)?e:null},style:function(d){return d.style.cssText.toLowerCase()},title:function(d){return d.title}}}}})();Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(a,b){a.checked=!!b},style:function(a,b){a.style.cssText=b?b:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(a){Element._attributeTranslations.write.names[a.toLowerCase()]=a;Element._attributeTranslations.has[a.toLowerCase()]=a});(function(a){Object.extend(a,{href:a._getAttr2,src:a._getAttr2,type:a._getAttr,action:a._getAttrNode,disabled:a._flag,checked:a._flag,readonly:a._flag,multiple:a._flag,onload:a._getEv,onunload:a._getEv,onclick:a._getEv,ondblclick:a._getEv,onmousedown:a._getEv,onmouseup:a._getEv,onmouseover:a._getEv,onmousemove:a._getEv,onmouseout:a._getEv,onfocus:a._getEv,onblur:a._getEv,onkeypress:a._getEv,onkeydown:a._getEv,onkeyup:a._getEv,onsubmit:a._getEv,onreset:a._getEv,onselect:a._getEv,onchange:a._getEv})})(Element._attributeTranslations.read.values);if(Prototype.BrowserFeatures.ElementExtensions){(function(){function a(e){var b=e.getElementsByTagName("*"),d=[];for(var c=0,f;f=b[c];c++){if(f.tagName!=="!"){d.push(f)}}return d}Element.Methods.down=function(c,d,b){c=$(c);if(arguments.length==1){return c.firstDescendant()}return Object.isNumber(d)?a(c)[d]:Element.select(c,d)[b||0]}})()}}else{if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=(b==1)?0.999999:(b==="")?"":(b<0.00001)?0:b;return a}}else{if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=(b==1||b==="")?"":(b<0.00001)?0:b;if(b==1){if(a.tagName.toUpperCase()=="IMG"&&a.width){a.width++;a.width--}else{try{var d=document.createTextNode(" ");a.appendChild(d);a.removeChild(d)}catch(c){}}}return a}}}}}if("outerHTML" in document.documentElement){Element.Methods.replace=function(c,e){c=$(c);if(e&&e.toElement){e=e.toElement()}if(Object.isElement(e)){c.parentNode.replaceChild(e,c);return c}e=Object.toHTML(e);var d=c.parentNode,b=d.tagName.toUpperCase();if(Element._insertionTranslations.tags[b]){var f=c.next(),a=Element._getContentFromAnonymousElement(b,e.stripScripts());d.removeChild(c);if(f){a.each(function(g){d.insertBefore(g,f)})}else{a.each(function(g){d.appendChild(g)})}}else{c.outerHTML=e.stripScripts()}e.evalScripts.bind(e).defer();return c}}Element._returnOffset=function(b,c){var a=[b,c];a.left=b;a.top=c;return a};Element._getContentFromAnonymousElement=function(e,d,f){var g=new Element("div"),c=Element._insertionTranslations.tags[e];var a=false;if(c){a=true}else{if(f){a=true;c=["","",0]}}if(a){g.innerHTML="&nbsp;"+c[0]+d+c[1];g.removeChild(g.firstChild);for(var b=c[2];b--;){g=g.firstChild}}else{g.innerHTML=d}return $A(g.childNodes)};Element._insertionTranslations={before:function(a,b){a.parentNode.insertBefore(b,a)},top:function(a,b){a.insertBefore(b,a.firstChild)},bottom:function(a,b){a.appendChild(b)},after:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};(function(){var a=Element._insertionTranslations.tags;Object.extend(a,{THEAD:a.TBODY,TFOOT:a.TBODY,TH:a.TD})})();Element.Methods.Simulated={hasAttribute:function(a,c){c=Element._attributeTranslations.has[c]||c;var b=$(a).getAttributeNode(c);return !!(b&&b.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);(function(a){if(!Prototype.BrowserFeatures.ElementExtensions&&a.__proto__){window.HTMLElement={};window.HTMLElement.prototype=a.__proto__;Prototype.BrowserFeatures.ElementExtensions=true}a=null})(document.createElement("div"));Element.extend=(function(){function c(g){if(typeof window.Element!="undefined"){var j=window.Element.prototype;if(j){var l="_"+(Math.random()+"").slice(2),h=document.createElement(g);j[l]="x";var k=(h[l]!=="x");delete j[l];h=null;return k}}return false}function b(h,g){for(var k in g){var j=g[k];if(Object.isFunction(j)&&!(k in h)){h[k]=j.methodize()}}}var d=c("object");if(Prototype.BrowserFeatures.SpecificElementExtensions){if(d){return function(h){if(h&&typeof h._extendedByPrototype=="undefined"){var g=h.tagName;if(g&&(/^(?:object|applet|embed)$/i.test(g))){b(h,Element.Methods);b(h,Element.Methods.Simulated);b(h,Element.Methods.ByTag[g.toUpperCase()])}}return h}}return Prototype.K}var a={},e=Element.Methods.ByTag;var f=Object.extend(function(j){if(!j||typeof j._extendedByPrototype!="undefined"||j.nodeType!=1||j==window){return j}var g=Object.clone(a),h=j.tagName.toUpperCase();if(e[h]){Object.extend(g,e[h])}b(j,g);j._extendedByPrototype=Prototype.emptyFunction;return j},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(a,Element.Methods);Object.extend(a,Element.Methods.Simulated)}}});f.refresh();return f})();if(document.documentElement.hasAttribute){Element.hasAttribute=function(a,b){return a.hasAttribute(b)}}else{Element.hasAttribute=Element.Methods.Simulated.hasAttribute}Element.addMethods=function(c){var j=Prototype.BrowserFeatures,d=Element.Methods.ByTag;if(!c){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods),BUTTON:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var b=c;c=arguments[1]}if(!b){Object.extend(Element.Methods,c||{})}else{if(Object.isArray(b)){b.each(g)}else{g(b)}}function g(l){l=l.toUpperCase();if(!Element.Methods.ByTag[l]){Element.Methods.ByTag[l]={}}Object.extend(Element.Methods.ByTag[l],c)}function a(n,m,l){l=l||false;for(var p in n){var o=n[p];if(!Object.isFunction(o)){continue}if(!l||!(p in m)){m[p]=o.methodize()}}}function e(o){var l;var n={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(n[o]){l="HTML"+n[o]+"Element"}if(window[l]){return window[l]}l="HTML"+o+"Element";if(window[l]){return window[l]}l="HTML"+o.capitalize()+"Element";if(window[l]){return window[l]}var m=document.createElement(o),p=m.__proto__||m.constructor.prototype;m=null;return p}var h=window.HTMLElement?HTMLElement.prototype:Element.prototype;if(j.ElementExtensions){a(Element.Methods,h);a(Element.Methods.Simulated,h,true)}if(j.SpecificElementExtensions){for(var k in Element.Methods.ByTag){var f=e(k);if(Object.isUndefined(f)){continue}a(d[k],f.prototype)}}Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh){Element.extend.refresh()}Element.cache={}};document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};(function(b){var g=Prototype.Browser,e=document,c,d={};function a(){if(g.WebKit&&!e.evaluate){return document}if(g.Opera&&window.parseFloat(window.opera.version())<9.5){return document.body}return document.documentElement}function f(h){if(!c){c=a()}d[h]="client"+h;b["get"+h]=function(){return c[d[h]]};return b["get"+h]()}b.getWidth=f.curry("Width");b.getHeight=f.curry("Height")})(document.viewport);Element.Storage={UID:1};Element.addMethods({getStorage:function(b){if(!(b=$(b))){return}var a;if(b===window){a=0}else{if(typeof b._prototypeUID==="undefined"){b._prototypeUID=Element.Storage.UID++}a=b._prototypeUID}if(!Element.Storage[a]){Element.Storage[a]=$H()}return Element.Storage[a]},store:function(b,a,c){if(!(b=$(b))){return}if(arguments.length===2){Element.getStorage(b).update(a)}else{Element.getStorage(b).set(a,c)}return b},retrieve:function(c,b,a){if(!(c=$(c))){return}var e=Element.getStorage(c),d=e.get(b);if(Object.isUndefined(d)){e.set(b,a);d=a}return d},clone:function(c,a){if(!(c=$(c))){return}var e=c.cloneNode(a);e._prototypeUID=void 0;if(a){var d=Element.select(e,"*"),b=d.length;while(b--){d[b]._prototypeUID=void 0}}return Element.extend(e)},purge:function(c){if(!(c=$(c))){return}var a=Element._purgeElement;a(c);var d=c.getElementsByTagName("*"),b=d.length;while(b--){a(d[b])}return null}});(function(){function h(w){var v=w.match(/^(\d+)%?$/i);if(!v){return null}return(Number(v[1])/100)}function p(G,H,w){var z=null;if(Object.isElement(G)){z=G;G=z.getStyle(H)}if(G===null){return null}if((/^(?:-)?\d+(\.\d+)?(px)?$/i).test(G)){return window.parseFloat(G)}var B=G.include("%"),x=(w===document.viewport);if(/\d/.test(G)&&z&&z.runtimeStyle&&!(B&&x)){var v=z.style.left,F=z.runtimeStyle.left;z.runtimeStyle.left=z.currentStyle.left;z.style.left=G||0;G=z.style.pixelLeft;z.style.left=v;z.runtimeStyle.left=F;return G}if(z&&B){w=w||z.parentNode;var y=h(G);var C=null;var A=z.getStyle("position");var E=H.include("left")||H.include("right")||H.include("width");var D=H.include("top")||H.include("bottom")||H.include("height");if(w===document.viewport){if(E){C=document.viewport.getWidth()}else{if(D){C=document.viewport.getHeight()}}}else{if(E){C=$(w).measure("width")}else{if(D){C=$(w).measure("height")}}}return(C===null)?0:C*y}return 0}function g(v){if(Object.isString(v)&&v.endsWith("px")){return v}return v+"px"}function k(w){var v=w;while(w&&w.parentNode){var x=w.getStyle("display");if(x==="none"){return false}w=$(w.parentNode)}return true}var d=Prototype.K;if("currentStyle" in document.documentElement){d=function(v){if(!v.currentStyle.hasLayout){v.style.zoom=1}return v}}function f(v){if(v.include("border")){v=v+"-width"}return v.camelize()}Element.Layout=Class.create(Hash,{initialize:function($super,w,v){$super();this.element=$(w);Element.Layout.PROPERTIES.each(function(x){this._set(x,null)},this);if(v){this._preComputing=true;this._begin();Element.Layout.PROPERTIES.each(this._compute,this);this._end();this._preComputing=false}},_set:function(w,v){return Hash.prototype.set.call(this,w,v)},set:function(w,v){throw"Properties of Element.Layout are read-only."},get:function($super,w){var v=$super(w);return v===null?this._compute(w):v},_begin:function(){if(this._prepared){return}var z=this.element;if(k(z)){this._prepared=true;return}var B={position:z.style.position||"",width:z.style.width||"",visibility:z.style.visibility||"",display:z.style.display||""};z.store("prototype_original_styles",B);var C=z.getStyle("position"),v=z.getStyle("width");if(v==="0px"||v===null){z.style.display="block";v=z.getStyle("width")}var w=(C==="fixed")?document.viewport:z.parentNode;z.setStyle({position:"absolute",visibility:"hidden",display:"block"});var x=z.getStyle("width");var y;if(v&&(x===v)){y=p(z,"width",w)}else{if(C==="absolute"||C==="fixed"){y=p(z,"width",w)}else{var D=z.parentNode,A=$(D).getLayout();y=A.get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right")}}z.setStyle({width:y+"px"});this._prepared=true},_end:function(){var w=this.element;var v=w.retrieve("prototype_original_styles");w.store("prototype_original_styles",null);w.setStyle(v);this._prepared=false},_compute:function(w){var v=Element.Layout.COMPUTATIONS;if(!(w in v)){throw"Property not found."}return this._set(w,v[w].call(this,this.element))},toObject:function(){var v=$A(arguments);var w=(v.length===0)?Element.Layout.PROPERTIES:v.join(" ").split(" ");var x={};w.each(function(y){if(!Element.Layout.PROPERTIES.include(y)){return}var z=this.get(y);if(z!=null){x[y]=z}},this);return x},toHash:function(){var v=this.toObject.apply(this,arguments);return new Hash(v)},toCSS:function(){var v=$A(arguments);var x=(v.length===0)?Element.Layout.PROPERTIES:v.join(" ").split(" ");var w={};x.each(function(y){if(!Element.Layout.PROPERTIES.include(y)){return}if(Element.Layout.COMPOSITE_PROPERTIES.include(y)){return}var z=this.get(y);if(z!=null){w[f(y)]=z+"px"}},this);return w},inspect:function(){return"#<Element.Layout>"}});Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(x){if(!this._preComputing){this._begin()}var v=this.get("border-box-height");if(v<=0){if(!this._preComputing){this._end()}return 0}var y=this.get("border-top"),w=this.get("border-bottom");var A=this.get("padding-top"),z=this.get("padding-bottom");if(!this._preComputing){this._end()}return v-y-w-A-z},width:function(x){if(!this._preComputing){this._begin()}var w=this.get("border-box-width");if(w<=0){if(!this._preComputing){this._end()}return 0}var A=this.get("border-left"),v=this.get("border-right");var y=this.get("padding-left"),z=this.get("padding-right");if(!this._preComputing){this._end()}return w-A-v-y-z},"padding-box-height":function(w){var v=this.get("height"),y=this.get("padding-top"),x=this.get("padding-bottom");return v+y+x},"padding-box-width":function(v){var w=this.get("width"),x=this.get("padding-left"),y=this.get("padding-right");return w+x+y},"border-box-height":function(w){if(!this._preComputing){this._begin()}var v=w.offsetHeight;if(!this._preComputing){this._end()}return v},"border-box-width":function(v){if(!this._preComputing){this._begin()}var w=v.offsetWidth;if(!this._preComputing){this._end()}return w},"margin-box-height":function(w){var v=this.get("border-box-height"),x=this.get("margin-top"),y=this.get("margin-bottom");if(v<=0){return 0}return v+x+y},"margin-box-width":function(x){var w=this.get("border-box-width"),y=this.get("margin-left"),v=this.get("margin-right");if(w<=0){return 0}return w+y+v},top:function(v){var w=v.positionedOffset();return w.top},bottom:function(v){var y=v.positionedOffset(),w=v.getOffsetParent(),x=w.measure("height");var z=this.get("border-box-height");return x-z-y.top},left:function(v){var w=v.positionedOffset();return w.left},right:function(x){var z=x.positionedOffset(),y=x.getOffsetParent(),v=y.measure("width");var w=this.get("border-box-width");return v-w-z.left},"padding-top":function(v){return p(v,"paddingTop")},"padding-bottom":function(v){return p(v,"paddingBottom")},"padding-left":function(v){return p(v,"paddingLeft")},"padding-right":function(v){return p(v,"paddingRight")},"border-top":function(v){return p(v,"borderTopWidth")},"border-bottom":function(v){return p(v,"borderBottomWidth")},"border-left":function(v){return p(v,"borderLeftWidth")},"border-right":function(v){return p(v,"borderRightWidth")},"margin-top":function(v){return p(v,"marginTop")},"margin-bottom":function(v){return p(v,"marginBottom")},"margin-left":function(v){return p(v,"marginLeft")},"margin-right":function(v){return p(v,"marginRight")}}});if("getBoundingClientRect" in document.documentElement){Object.extend(Element.Layout.COMPUTATIONS,{right:function(w){var x=d(w.getOffsetParent());var y=w.getBoundingClientRect(),v=x.getBoundingClientRect();return(v.right-y.right).round()},bottom:function(w){var x=d(w.getOffsetParent());var y=w.getBoundingClientRect(),v=x.getBoundingClientRect();return(v.bottom-y.bottom).round()}})}Element.Offset=Class.create({initialize:function(w,v){this.left=w.round();this.top=v.round();this[0]=this.left;this[1]=this.top},relativeTo:function(v){return new Element.Offset(this.left-v.left,this.top-v.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,this.top]}});function s(w,v){return new Element.Layout(w,v)}function b(v,w){return $(v).getLayout().get(w)}function o(w){w=$(w);var A=Element.getStyle(w,"display");if(A&&A!=="none"){return{width:w.offsetWidth,height:w.offsetHeight}}var x=w.style;var v={visibility:x.visibility,position:x.position,display:x.display};var z={visibility:"hidden",display:"block"};if(v.position!=="fixed"){z.position="absolute"}Element.setStyle(w,z);var y={width:w.offsetWidth,height:w.offsetHeight};Element.setStyle(w,v);return y}function m(v){v=$(v);if(e(v)||c(v)||n(v)||l(v)){return $(document.body)}var w=(Element.getStyle(v,"display")==="inline");if(!w&&v.offsetParent&&!Prototype.Browser.IE){return $(v.offsetParent)}while((v=v.parentNode)&&v!==document.body){if(Element.getStyle(v,"position")!=="static"){return l(v)?$(document.body):$(v)}}return $(document.body)}function u(w){w=$(w);var v=0,x=0;if(w.parentNode){do{v+=w.offsetTop||0;x+=w.offsetLeft||0;w=w.offsetParent}while(w)}return new Element.Offset(x,v)}function q(w){w=$(w);var x=w.getLayout();var v=0,z=0;do{v+=w.offsetTop||0;z+=w.offsetLeft||0;w=w.offsetParent;if(w){if(n(w)){break}var y=Element.getStyle(w,"position");if(y!=="static"){break}}}while(w);z-=x.get("margin-top");v-=x.get("margin-left");return new Element.Offset(z,v)}function a(w){var v=0,x=0;do{v+=w.scrollTop||0;x+=w.scrollLeft||0;w=w.parentNode}while(w);return new Element.Offset(x,v)}function t(z){w=$(w);var v=0,y=0,x=document.body;var w=z;do{v+=w.offsetTop||0;y+=w.offsetLeft||0;if(w.offsetParent==x&&Element.getStyle(w,"position")=="absolute"){break}}while(w=w.offsetParent);w=z;do{if(w!=x){v-=w.scrollTop||0;y-=w.scrollLeft||0}}while(w=w.parentNode);return new Element.Offset(y,v)}function r(v){v=$(v);if(Element.getStyle(v,"position")==="absolute"){return v}var z=m(v);var y=v.viewportOffset(),w=z.viewportOffset();var A=y.relativeTo(w);var x=v.getLayout();v.store("prototype_absolutize_original_styles",{left:v.getStyle("left"),top:v.getStyle("top"),width:v.getStyle("width"),height:v.getStyle("height")});v.setStyle({position:"absolute",top:A.top+"px",left:A.left+"px",width:x.get("width")+"px",height:x.get("height")+"px"});return v}function j(w){w=$(w);if(Element.getStyle(w,"position")==="relative"){return w}var v=w.retrieve("prototype_absolutize_original_styles");if(v){w.setStyle(v)}return w}if(Prototype.Browser.IE){m=m.wrap(function(x,w){w=$(w);if(e(w)||c(w)||n(w)||l(w)){return $(document.body)}var v=w.getStyle("position");if(v!=="static"){return x(w)}w.setStyle({position:"relative"});var y=x(w);w.setStyle({position:v});return y});q=q.wrap(function(y,w){w=$(w);if(!w.parentNode){return new Element.Offset(0,0)}var v=w.getStyle("position");if(v!=="static"){return y(w)}var x=w.getOffsetParent();if(x&&x.getStyle("position")==="fixed"){d(x)}w.setStyle({position:"relative"});var z=y(w);w.setStyle({position:v});return z})}else{if(Prototype.Browser.Webkit){u=function(w){w=$(w);var v=0,x=0;do{v+=w.offsetTop||0;x+=w.offsetLeft||0;if(w.offsetParent==document.body){if(Element.getStyle(w,"position")=="absolute"){break}}w=w.offsetParent}while(w);return new Element.Offset(x,v)}}}Element.addMethods({getLayout:s,measure:b,getDimensions:o,getOffsetParent:m,cumulativeOffset:u,positionedOffset:q,cumulativeScrollOffset:a,viewportOffset:t,absolutize:r,relativize:j});function n(v){return v.nodeName.toUpperCase()==="BODY"}function l(v){return v.nodeName.toUpperCase()==="HTML"}function e(v){return v.nodeType===Node.DOCUMENT_NODE}function c(v){return v!==document.body&&!Element.descendantOf(v,document.body)}if("getBoundingClientRect" in document.documentElement){Element.addMethods({viewportOffset:function(v){v=$(v);if(c(v)){return new Element.Offset(0,0)}var w=v.getBoundingClientRect(),x=document.documentElement;return new Element.Offset(w.left-x.clientLeft,w.top-x.clientTop)}})}})();window.$$=function(){var a=$A(arguments).join(", ");return Prototype.Selector.select(a,document)};Prototype.Selector=(function(){function a(){throw new Error('Method "Prototype.Selector.select" must be defined.')}function c(){throw new Error('Method "Prototype.Selector.match" must be defined.')}function d(l,m,h){h=h||0;var g=Prototype.Selector.match,k=l.length,f=0,j;for(j=0;j<k;j++){if(g(l[j],m)&&h==f++){return Element.extend(l[j])}}}function e(h){for(var f=0,g=h.length;f<g;f++){Element.extend(h[f])}return h}var b=Prototype.K;return{select:a,match:c,find:d,extendElements:(Element.extend===b)?b:e,extendElement:Element.extend}})();Prototype._original_property=window.Sizzle;
/*
 * Sizzle CSS Selector Engine - v1.0
 *  Copyright 2009, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){var r=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,k=0,d=Object.prototype.toString,p=false,j=true;[0,0].sort(function(){j=false;return 0});var b=function(F,v,C,x){C=C||[];var e=v=v||document;if(v.nodeType!==1&&v.nodeType!==9){return[]}if(!F||typeof F!=="string"){return C}var D=[],E,A,J,I,B,u,t=true,y=q(v),H=F;while((r.exec(""),E=r.exec(H))!==null){H=E[3];D.push(E[1]);if(E[2]){u=E[3];break}}if(D.length>1&&l.exec(F)){if(D.length===2&&f.relative[D[0]]){A=g(D[0]+D[1],v)}else{A=f.relative[D[0]]?[v]:b(D.shift(),v);while(D.length){F=D.shift();if(f.relative[F]){F+=D.shift()}A=g(F,A)}}}else{if(!x&&D.length>1&&v.nodeType===9&&!y&&f.match.ID.test(D[0])&&!f.match.ID.test(D[D.length-1])){var K=b.find(D.shift(),v,y);v=K.expr?b.filter(K.expr,K.set)[0]:K.set[0]}if(v){var K=x?{expr:D.pop(),set:a(x)}:b.find(D.pop(),D.length===1&&(D[0]==="~"||D[0]==="+")&&v.parentNode?v.parentNode:v,y);A=K.expr?b.filter(K.expr,K.set):K.set;if(D.length>0){J=a(A)}else{t=false}while(D.length){var w=D.pop(),z=w;if(!f.relative[w]){w=""}else{z=D.pop()}if(z==null){z=v}f.relative[w](J,z,y)}}else{J=D=[]}}if(!J){J=A}if(!J){throw"Syntax error, unrecognized expression: "+(w||F)}if(d.call(J)==="[object Array]"){if(!t){C.push.apply(C,J)}else{if(v&&v.nodeType===1){for(var G=0;J[G]!=null;G++){if(J[G]&&(J[G]===true||J[G].nodeType===1&&h(v,J[G]))){C.push(A[G])}}}else{for(var G=0;J[G]!=null;G++){if(J[G]&&J[G].nodeType===1){C.push(A[G])}}}}}else{a(J,C)}if(u){b(u,e,C,x);b.uniqueSort(C)}return C};b.uniqueSort=function(t){if(c){p=j;t.sort(c);if(p){for(var e=1;e<t.length;e++){if(t[e]===t[e-1]){t.splice(e--,1)}}}}return t};b.matches=function(e,t){return b(e,null,null,t)};b.find=function(z,e,A){var y,w;if(!z){return[]}for(var v=0,u=f.order.length;v<u;v++){var x=f.order[v],w;if((w=f.leftMatch[x].exec(z))){var t=w[1];w.splice(1,1);if(t.substr(t.length-1)!=="\\"){w[1]=(w[1]||"").replace(/\\/g,"");y=f.find[x](w,e,A);if(y!=null){z=z.replace(f.match[x],"");break}}}}if(!y){y=e.getElementsByTagName("*")}return{set:y,expr:z}};b.filter=function(C,B,F,v){var u=C,H=[],z=B,x,e,y=B&&B[0]&&q(B[0]);while(C&&B.length){for(var A in f.filter){if((x=f.match[A].exec(C))!=null){var t=f.filter[A],G,E;e=false;if(z==H){H=[]}if(f.preFilter[A]){x=f.preFilter[A](x,z,F,H,v,y);if(!x){e=G=true}else{if(x===true){continue}}}if(x){for(var w=0;(E=z[w])!=null;w++){if(E){G=t(E,x,w,z);var D=v^!!G;if(F&&G!=null){if(D){e=true}else{z[w]=false}}else{if(D){H.push(E);e=true}}}}}if(G!==undefined){if(!F){z=H}C=C.replace(f.match[A],"");if(!e){return[]}break}}}if(C==u){if(e==null){throw"Syntax error, unrecognized expression: "+C}else{break}}u=C}return z};var f=b.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")}},relative:{"+":function(z,e,y){var w=typeof e==="string",A=w&&!/\W/.test(e),x=w&&!A;if(A&&!y){e=e.toUpperCase()}for(var v=0,u=z.length,t;v<u;v++){if((t=z[v])){while((t=t.previousSibling)&&t.nodeType!==1){}z[v]=x||t&&t.nodeName===e?t||false:t===e}}if(x){b.filter(e,z,true)}},">":function(y,t,z){var w=typeof t==="string";if(w&&!/\W/.test(t)){t=z?t:t.toUpperCase();for(var u=0,e=y.length;u<e;u++){var x=y[u];if(x){var v=x.parentNode;y[u]=v.nodeName===t?v:false}}}else{for(var u=0,e=y.length;u<e;u++){var x=y[u];if(x){y[u]=w?x.parentNode:x.parentNode===t}}if(w){b.filter(t,y,true)}}},"":function(v,t,x){var u=k++,e=s;if(!/\W/.test(t)){var w=t=x?t:t.toUpperCase();e=o}e("parentNode",t,u,v,w,x)},"~":function(v,t,x){var u=k++,e=s;if(typeof t==="string"&&!/\W/.test(t)){var w=t=x?t:t.toUpperCase();e=o}e("previousSibling",t,u,v,w,x)}},find:{ID:function(t,u,v){if(typeof u.getElementById!=="undefined"&&!v){var e=u.getElementById(t[1]);return e?[e]:[]}},NAME:function(u,x,y){if(typeof x.getElementsByName!=="undefined"){var t=[],w=x.getElementsByName(u[1]);for(var v=0,e=w.length;v<e;v++){if(w[v].getAttribute("name")===u[1]){t.push(w[v])}}return t.length===0?null:t}},TAG:function(e,t){return t.getElementsByTagName(e[1])}},preFilter:{CLASS:function(v,t,u,e,y,z){v=" "+v[1].replace(/\\/g,"")+" ";if(z){return v}for(var w=0,x;(x=t[w])!=null;w++){if(x){if(y^(x.className&&(" "+x.className+" ").indexOf(v)>=0)){if(!u){e.push(x)}}else{if(u){t[w]=false}}}}return false},ID:function(e){return e[1].replace(/\\/g,"")},TAG:function(t,e){for(var u=0;e[u]===false;u++){}return e[u]&&q(e[u])?t[1]:t[1].toUpperCase()},CHILD:function(e){if(e[1]=="nth"){var t=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(e[2]=="even"&&"2n"||e[2]=="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=(t[1]+(t[2]||1))-0;e[3]=t[3]-0}e[0]=k++;return e},ATTR:function(w,t,u,e,x,y){var v=w[1].replace(/\\/g,"");if(!y&&f.attrMap[v]){w[1]=f.attrMap[v]}if(w[2]==="~="){w[4]=" "+w[4]+" "}return w},PSEUDO:function(w,t,u,e,x){if(w[1]==="not"){if((r.exec(w[3])||"").length>1||/^\w/.test(w[3])){w[3]=b(w[3],null,null,t)}else{var v=b.filter(w[3],t,u,true^x);if(!u){e.push.apply(e,v)}return false}}else{if(f.match.POS.test(w[0])||f.match.CHILD.test(w[0])){return true}}return w},POS:function(e){e.unshift(true);return e}},filters:{enabled:function(e){return e.disabled===false&&e.type!=="hidden"},disabled:function(e){return e.disabled===true},checked:function(e){return e.checked===true},selected:function(e){e.parentNode.selectedIndex;return e.selected===true},parent:function(e){return !!e.firstChild},empty:function(e){return !e.firstChild},has:function(u,t,e){return !!b(e[3],u).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){return"text"===e.type},radio:function(e){return"radio"===e.type},checkbox:function(e){return"checkbox"===e.type},file:function(e){return"file"===e.type},password:function(e){return"password"===e.type},submit:function(e){return"submit"===e.type},image:function(e){return"image"===e.type},reset:function(e){return"reset"===e.type},button:function(e){return"button"===e.type||e.nodeName.toUpperCase()==="BUTTON"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)}},setFilters:{first:function(t,e){return e===0},last:function(u,t,e,v){return t===v.length-1},even:function(t,e){return e%2===0},odd:function(t,e){return e%2===1},lt:function(u,t,e){return t<e[3]-0},gt:function(u,t,e){return t>e[3]-0},nth:function(u,t,e){return e[3]-0==t},eq:function(u,t,e){return e[3]-0==t}},filter:{PSEUDO:function(y,u,v,z){var t=u[1],w=f.filters[t];if(w){return w(y,v,u,z)}else{if(t==="contains"){return(y.textContent||y.innerText||"").indexOf(u[3])>=0}else{if(t==="not"){var x=u[3];for(var v=0,e=x.length;v<e;v++){if(x[v]===y){return false}}return true}}}},CHILD:function(e,v){var y=v[1],t=e;switch(y){case"only":case"first":while((t=t.previousSibling)){if(t.nodeType===1){return false}}if(y=="first"){return true}t=e;case"last":while((t=t.nextSibling)){if(t.nodeType===1){return false}}return true;case"nth":var u=v[2],B=v[3];if(u==1&&B==0){return true}var x=v[0],A=e.parentNode;if(A&&(A.sizcache!==x||!e.nodeIndex)){var w=0;for(t=A.firstChild;t;t=t.nextSibling){if(t.nodeType===1){t.nodeIndex=++w}}A.sizcache=x}var z=e.nodeIndex-B;if(u==0){return z==0}else{return(z%u==0&&z/u>=0)}}},ID:function(t,e){return t.nodeType===1&&t.getAttribute&&t.getAttribute("id")===e},TAG:function(t,e){return(e==="*"&&t.nodeType===1)||t.nodeName===e},CLASS:function(t,e){return(" "+(t.className||t.getAttribute("class"))+" ").indexOf(e)>-1},ATTR:function(x,v){var u=v[1],e=f.attrHandle[u]?f.attrHandle[u](x):x[u]!=null?x[u]:x.getAttribute(u),y=e+"",w=v[2],t=v[4];return e==null?w==="!=":w==="="?y===t:w==="*="?y.indexOf(t)>=0:w==="~="?(" "+y+" ").indexOf(t)>=0:!t?y&&e!==false:w==="!="?y!=t:w==="^="?y.indexOf(t)===0:w==="$="?y.substr(y.length-t.length)===t:w==="|="?y===t||y.substr(0,t.length+1)===t+"-":false},POS:function(w,t,u,x){var e=t[2],v=f.setFilters[e];if(v){return v(w,u,t,x)}}}};var l=f.match.POS;for(var n in f.match){f.match[n]=new RegExp(f.match[n].source+/(?![^\[]*\])(?![^\(]*\))/.source);f.leftMatch[n]=new RegExp(/(^(?:.|\r|\n)*?)/.source+f.match[n].source)}var a=function(t,e){t=Array.prototype.slice.call(t,0);if(e){e.push.apply(e,t);return e}return t};try{Array.prototype.slice.call(document.documentElement.childNodes,0)}catch(m){a=function(w,v){var t=v||[];if(d.call(w)==="[object Array]"){Array.prototype.push.apply(t,w)}else{if(typeof w.length==="number"){for(var u=0,e=w.length;u<e;u++){t.push(w[u])}}else{for(var u=0;w[u];u++){t.push(w[u])}}}return t}}var c;if(document.documentElement.compareDocumentPosition){c=function(t,e){if(!t.compareDocumentPosition||!e.compareDocumentPosition){if(t==e){p=true}return 0}var u=t.compareDocumentPosition(e)&4?-1:t===e?0:1;if(u===0){p=true}return u}}else{if("sourceIndex" in document.documentElement){c=function(t,e){if(!t.sourceIndex||!e.sourceIndex){if(t==e){p=true}return 0}var u=t.sourceIndex-e.sourceIndex;if(u===0){p=true}return u}}else{if(document.createRange){c=function(v,t){if(!v.ownerDocument||!t.ownerDocument){if(v==t){p=true}return 0}var u=v.ownerDocument.createRange(),e=t.ownerDocument.createRange();u.setStart(v,0);u.setEnd(v,0);e.setStart(t,0);e.setEnd(t,0);var w=u.compareBoundaryPoints(Range.START_TO_END,e);if(w===0){p=true}return w}}}}(function(){var t=document.createElement("div"),u="script"+(new Date).getTime();t.innerHTML="<a name='"+u+"'/>";var e=document.documentElement;e.insertBefore(t,e.firstChild);if(!!document.getElementById(u)){f.find.ID=function(w,x,y){if(typeof x.getElementById!=="undefined"&&!y){var v=x.getElementById(w[1]);return v?v.id===w[1]||typeof v.getAttributeNode!=="undefined"&&v.getAttributeNode("id").nodeValue===w[1]?[v]:undefined:[]}};f.filter.ID=function(x,v){var w=typeof x.getAttributeNode!=="undefined"&&x.getAttributeNode("id");return x.nodeType===1&&w&&w.nodeValue===v}}e.removeChild(t);e=t=null})();(function(){var e=document.createElement("div");e.appendChild(document.createComment(""));if(e.getElementsByTagName("*").length>0){f.find.TAG=function(t,x){var w=x.getElementsByTagName(t[1]);if(t[1]==="*"){var v=[];for(var u=0;w[u];u++){if(w[u].nodeType===1){v.push(w[u])}}w=v}return w}}e.innerHTML="<a href='#'></a>";if(e.firstChild&&typeof e.firstChild.getAttribute!=="undefined"&&e.firstChild.getAttribute("href")!=="#"){f.attrHandle.href=function(t){return t.getAttribute("href",2)}}e=null})();if(document.querySelectorAll){(function(){var e=b,u=document.createElement("div");u.innerHTML="<p class='TEST'></p>";if(u.querySelectorAll&&u.querySelectorAll(".TEST").length===0){return}b=function(y,x,v,w){x=x||document;if(!w&&x.nodeType===9&&!q(x)){try{return a(x.querySelectorAll(y),v)}catch(z){}}return e(y,x,v,w)};for(var t in e){b[t]=e[t]}u=null})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var e=document.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(e.getElementsByClassName("e").length===0){return}e.lastChild.className="e";if(e.getElementsByClassName("e").length===1){return}f.order.splice(1,0,"CLASS");f.find.CLASS=function(t,u,v){if(typeof u.getElementsByClassName!=="undefined"&&!v){return u.getElementsByClassName(t[1])}};e=null})()}function o(t,y,x,C,z,B){var A=t=="previousSibling"&&!B;for(var v=0,u=C.length;v<u;v++){var e=C[v];if(e){if(A&&e.nodeType===1){e.sizcache=x;e.sizset=v}e=e[t];var w=false;while(e){if(e.sizcache===x){w=C[e.sizset];break}if(e.nodeType===1&&!B){e.sizcache=x;e.sizset=v}if(e.nodeName===y){w=e;break}e=e[t]}C[v]=w}}}function s(t,y,x,C,z,B){var A=t=="previousSibling"&&!B;for(var v=0,u=C.length;v<u;v++){var e=C[v];if(e){if(A&&e.nodeType===1){e.sizcache=x;e.sizset=v}e=e[t];var w=false;while(e){if(e.sizcache===x){w=C[e.sizset];break}if(e.nodeType===1){if(!B){e.sizcache=x;e.sizset=v}if(typeof y!=="string"){if(e===y){w=true;break}}else{if(b.filter(y,[e]).length>0){w=e;break}}}e=e[t]}C[v]=w}}}var h=document.compareDocumentPosition?function(t,e){return t.compareDocumentPosition(e)&16}:function(t,e){return t!==e&&(t.contains?t.contains(e):true)};var q=function(e){return e.nodeType===9&&e.documentElement.nodeName!=="HTML"||!!e.ownerDocument&&e.ownerDocument.documentElement.nodeName!=="HTML"};var g=function(e,z){var v=[],w="",x,u=z.nodeType?[z]:z;while((x=f.match.PSEUDO.exec(e))){w+=x[0];e=e.replace(f.match.PSEUDO,"")}e=f.relative[e]?e+"*":e;for(var y=0,t=u.length;y<t;y++){b(e,u[y],v)}return b.filter(w,v)};window.Sizzle=b})();(function(c){var d=Prototype.Selector.extendElements;function a(e,f){return d(c(e,f||document))}function b(f,e){return c.matches(e,[f]).length==1}Prototype.Selector.engine=c;Prototype.Selector.select=a;Prototype.Selector.match=b})(Sizzle);window.Sizzle=Prototype._original_property;delete Prototype._original_property;var Form={reset:function(a){a=$(a);a.reset();return a},serializeElements:function(h,d){if(typeof d!="object"){d={hash:!!d}}else{if(Object.isUndefined(d.hash)){d.hash=true}}var e,g,a=false,f=d.submit,b,c;if(d.hash){c={};b=function(j,k,l){if(k in j){if(!Object.isArray(j[k])){j[k]=[j[k]]}j[k].push(l)}else{j[k]=l}return j}}else{c="";b=function(j,k,l){return j+(j?"&":"")+encodeURIComponent(k)+"="+encodeURIComponent(l)}}return h.inject(c,function(j,k){if(!k.disabled&&k.name){e=k.name;g=$(k).getValue();if(g!=null&&k.type!="file"&&(k.type!="submit"||(!a&&f!==false&&(!f||e==f)&&(a=true)))){j=b(j,e,g)}}return j})}};Form.Methods={serialize:function(b,a){return Form.serializeElements(Form.getElements(b),a)},getElements:function(e){var f=$(e).getElementsByTagName("*"),d,a=[],c=Form.Element.Serializers;for(var b=0;d=f[b];b++){a.push(d)}return a.inject([],function(g,h){if(c[h.tagName.toLowerCase()]){g.push(Element.extend(h))}return g})},getInputs:function(g,c,d){g=$(g);var a=g.getElementsByTagName("input");if(!c&&!d){return $A(a).map(Element.extend)}for(var e=0,h=[],f=a.length;e<f;e++){var b=a[e];if((c&&b.type!=c)||(d&&b.name!=d)){continue}h.push(Element.extend(b))}return h},disable:function(a){a=$(a);Form.getElements(a).invoke("disable");return a},enable:function(a){a=$(a);Form.getElements(a).invoke("enable");return a},findFirstElement:function(b){var c=$(b).getElements().findAll(function(d){return"hidden"!=d.type&&!d.disabled});var a=c.findAll(function(d){return d.hasAttribute("tabIndex")&&d.tabIndex>=0}).sortBy(function(d){return d.tabIndex}).first();return a?a:c.find(function(d){return/^(?:input|select|textarea)$/i.test(d.tagName)})},focusFirstElement:function(b){b=$(b);var a=b.findFirstElement();if(a){a.activate()}return b},request:function(b,a){b=$(b),a=Object.clone(a||{});var d=a.parameters,c=b.readAttribute("action")||"";if(c.blank()){c=window.location.href}a.parameters=b.serialize(true);if(d){if(Object.isString(d)){d=d.toQueryParams()}Object.extend(a.parameters,d)}if(b.hasAttribute("method")&&!a.method){a.method=b.method}return new Ajax.Request(c,a)}};Form.Element={focus:function(a){$(a).focus();return a},select:function(a){$(a).select();return a}};Form.Element.Methods={serialize:function(a){a=$(a);if(!a.disabled&&a.name){var b=a.getValue();if(b!=undefined){var c={};c[a.name]=b;return Object.toQueryString(c)}}return""},getValue:function(a){a=$(a);var b=a.tagName.toLowerCase();return Form.Element.Serializers[b](a)},setValue:function(a,b){a=$(a);var c=a.tagName.toLowerCase();Form.Element.Serializers[c](a,b);return a},clear:function(a){$(a).value="";return a},present:function(a){return $(a).value!=""},activate:function(a){a=$(a);try{a.focus();if(a.select&&(a.tagName.toLowerCase()!="input"||!(/^(?:button|reset|submit)$/i.test(a.type)))){a.select()}}catch(b){}return a},disable:function(a){a=$(a);a.disabled=true;return a},enable:function(a){a=$(a);a.disabled=false;return a}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers=(function(){function b(h,j){switch(h.type.toLowerCase()){case"checkbox":case"radio":return f(h,j);default:return e(h,j)}}function f(h,j){if(Object.isUndefined(j)){return h.checked?h.value:null}else{h.checked=!!j}}function e(h,j){if(Object.isUndefined(j)){return h.value}else{h.value=j}}function a(k,n){if(Object.isUndefined(n)){return(k.type==="select-one"?c:d)(k)}var j,l,o=!Object.isArray(n);for(var h=0,m=k.length;h<m;h++){j=k.options[h];l=this.optionValue(j);if(o){if(l==n){j.selected=true;return}}else{j.selected=n.include(l)}}}function c(j){var h=j.selectedIndex;return h>=0?g(j.options[h]):null}function d(l){var h,m=l.length;if(!m){return null}for(var k=0,h=[];k<m;k++){var j=l.options[k];if(j.selected){h.push(g(j))}}return h}function g(h){return Element.hasAttribute(h,"value")?h.value:h.text}return{input:b,inputSelector:f,textarea:e,select:a,selectOne:c,selectMany:d,optionValue:g,button:e}})();Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,a,b,c){$super(c,b);this.element=$(a);this.lastValue=this.getValue()},execute:function(){var a=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(a)?this.lastValue!=a:String(this.lastValue)!=String(a)){this.callback(this.element,a);this.lastValue=a}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});Abstract.EventObserver=Class.create({initialize:function(a,b){this.element=$(a);this.callback=b;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=="form"){this.registerFormCallbacks()}else{this.registerCallback(this.element)}},onElementEvent:function(){var a=this.getValue();if(this.lastValue!=a){this.callback(this.element,a);this.lastValue=a}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(a){if(a.type){switch(a.type.toLowerCase()){case"checkbox":case"radio":Event.observe(a,"click",this.onElementEvent.bind(this));break;default:Event.observe(a,"change",this.onElementEvent.bind(this));break}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});(function(){var D={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}};var f=document.documentElement;var E="onmouseenter" in f&&"onmouseleave" in f;var a=function(F){return false};if(window.attachEvent){if(window.addEventListener){a=function(F){return !(F instanceof window.Event)}}else{a=function(F){return true}}}var s;function B(G,F){return G.which?(G.which===F+1):(G.button===F)}var p={0:1,1:4,2:2};function z(G,F){return G.button===p[F]}function C(G,F){switch(F){case 0:return G.which==1&&!G.metaKey;case 1:return G.which==2||(G.which==1&&G.metaKey);case 2:return G.which==3;default:return false}}if(window.attachEvent){if(!window.addEventListener){s=z}else{s=function(G,F){return a(G)?z(G,F):B(G,F)}}}else{if(Prototype.Browser.WebKit){s=C}else{s=B}}function w(F){return s(F,0)}function u(F){return s(F,1)}function o(F){return s(F,2)}function d(H){H=D.extend(H);var G=H.target,F=H.type,I=H.currentTarget;if(I&&I.tagName){if(F==="load"||F==="error"||(F==="click"&&I.tagName.toLowerCase()==="input"&&I.type==="radio")){G=I}}if(G.nodeType==Node.TEXT_NODE){G=G.parentNode}return Element.extend(G)}function q(G,H){var F=D.element(G);if(!H){return F}while(F){if(Object.isElement(F)&&Prototype.Selector.match(F,H)){return Element.extend(F)}F=F.parentNode}}function t(F){return{x:c(F),y:b(F)}}function c(H){var G=document.documentElement,F=document.body||{scrollLeft:0};return H.pageX||(H.clientX+(G.scrollLeft||F.scrollLeft)-(G.clientLeft||0))}function b(H){var G=document.documentElement,F=document.body||{scrollTop:0};return H.pageY||(H.clientY+(G.scrollTop||F.scrollTop)-(G.clientTop||0))}function r(F){D.extend(F);F.preventDefault();F.stopPropagation();F.stopped=true}D.Methods={isLeftClick:w,isMiddleClick:u,isRightClick:o,element:d,findElement:q,pointer:t,pointerX:c,pointerY:b,stop:r};var y=Object.keys(D.Methods).inject({},function(F,G){F[G]=D.Methods[G].methodize();return F});if(window.attachEvent){function j(G){var F;switch(G.type){case"mouseover":case"mouseenter":F=G.fromElement;break;case"mouseout":case"mouseleave":F=G.toElement;break;default:return null}return Element.extend(F)}var v={stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}};D.extend=function(G,F){if(!G){return false}if(!a(G)){return G}if(G._extendedByPrototype){return G}G._extendedByPrototype=Prototype.emptyFunction;var H=D.pointer(G);Object.extend(G,{target:G.srcElement||F,relatedTarget:j(G),pageX:H.x,pageY:H.y});Object.extend(G,y);Object.extend(G,v);return G}}else{D.extend=Prototype.K}if(window.addEventListener){D.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(D.prototype,y)}function n(J,I,K){var H=Element.retrieve(J,"prototype_event_registry");if(Object.isUndefined(H)){e.push(J);H=Element.retrieve(J,"prototype_event_registry",$H())}var F=H.get(I);if(Object.isUndefined(F)){F=[];H.set(I,F)}if(F.pluck("handler").include(K)){return false}var G;if(I.include(":")){G=function(L){if(Object.isUndefined(L.eventName)){return false}if(L.eventName!==I){return false}D.extend(L,J);K.call(J,L)}}else{if(!E&&(I==="mouseenter"||I==="mouseleave")){if(I==="mouseenter"||I==="mouseleave"){G=function(M){D.extend(M,J);var L=M.relatedTarget;while(L&&L!==J){try{L=L.parentNode}catch(N){L=J}}if(L===J){return}K.call(J,M)}}}else{G=function(L){D.extend(L,J);K.call(J,L)}}}G.handler=K;F.push(G);return G}function h(){for(var F=0,G=e.length;F<G;F++){D.stopObserving(e[F]);e[F]=null}}var e=[];if(Prototype.Browser.IE){window.attachEvent("onunload",h)}if(Prototype.Browser.WebKit){window.addEventListener("unload",Prototype.emptyFunction,false)}var m=Prototype.K,g={mouseenter:"mouseover",mouseleave:"mouseout"};if(!E){m=function(F){return(g[F]||F)}}function x(I,H,J){I=$(I);var G=n(I,H,J);if(!G){return I}if(H.include(":")){if(I.addEventListener){I.addEventListener("dataavailable",G,false)}else{I.attachEvent("ondataavailable",G);I.attachEvent("onlosecapture",G)}}else{var F=m(H);if(I.addEventListener){I.addEventListener(F,G,false)}else{I.attachEvent("on"+F,G)}}return I}function l(L,I,M){L=$(L);var H=Element.retrieve(L,"prototype_event_registry");if(!H){return L}if(!I){H.each(function(O){var N=O.key;l(L,N)});return L}var J=H.get(I);if(!J){return L}if(!M){J.each(function(N){l(L,I,N.handler)});return L}var K=J.length,G;while(K--){if(J[K].handler===M){G=J[K];break}}if(!G){return L}if(I.include(":")){if(L.removeEventListener){L.removeEventListener("dataavailable",G,false)}else{L.detachEvent("ondataavailable",G);L.detachEvent("onlosecapture",G)}}else{var F=m(I);if(L.removeEventListener){L.removeEventListener(F,G,false)}else{L.detachEvent("on"+F,G)}}H.set(I,J.without(G));return L}function A(I,H,G,F){I=$(I);if(Object.isUndefined(F)){F=true}if(I==document&&document.createEvent&&!I.dispatchEvent){I=document.documentElement}var J;if(document.createEvent){J=document.createEvent("HTMLEvents");J.initEvent("dataavailable",F,true)}else{J=document.createEventObject();J.eventType=F?"ondataavailable":"onlosecapture"}J.eventName=H;J.memo=G||{};if(document.createEvent){I.dispatchEvent(J)}else{I.fireEvent(J.eventType,J)}return D.extend(J)}D.Handler=Class.create({initialize:function(H,G,F,I){this.element=$(H);this.eventName=G;this.selector=F;this.callback=I;this.handler=this.handleEvent.bind(this)},start:function(){D.observe(this.element,this.eventName,this.handler);return this},stop:function(){D.stopObserving(this.element,this.eventName,this.handler);return this},handleEvent:function(G){var F=D.findElement(G,this.selector);if(F){this.callback.call(this.element,G,F)}}});function k(H,G,F,I){H=$(H);if(Object.isFunction(F)&&Object.isUndefined(I)){I=F,F=null}return new D.Handler(H,G,F,I).start()}Object.extend(D,D.Methods);Object.extend(D,{fire:A,observe:x,stopObserving:l,on:k});Element.addMethods({fire:A,observe:x,stopObserving:l,on:k});Object.extend(document,{fire:A.methodize(),observe:x.methodize(),stopObserving:l.methodize(),on:k.methodize(),loaded:false});if(window.Event){Object.extend(window.Event,D)}else{window.Event=D}})();(function(){var d;function a(){if(document.loaded){return}if(d){window.clearTimeout(d)}document.loaded=true;document.fire("dom:loaded")}function c(){if(document.readyState==="complete"){document.stopObserving("readystatechange",c);a()}}function b(){try{document.documentElement.doScroll("left")}catch(f){d=b.defer();return}a()}if(document.addEventListener){document.addEventListener("DOMContentLoaded",a,false)}else{document.observe("readystatechange",c);if(window==top){d=b.defer()}}Event.observe(window,"load",a)})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(a,b){return Element.insert(a,{before:b})},Top:function(a,b){return Element.insert(a,{top:b})},Bottom:function(a,b){return Element.insert(a,{bottom:b})},After:function(a,b){return Element.insert(a,{after:b})}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(b,a,c){if(this.includeScrollOffsets){return this.withinIncludingScrolloffsets(b,a,c)}this.xcomp=a;this.ycomp=c;this.offset=Element.cumulativeOffset(b);return(c>=this.offset[1]&&c<this.offset[1]+b.offsetHeight&&a>=this.offset[0]&&a<this.offset[0]+b.offsetWidth)},withinIncludingScrolloffsets:function(b,a,d){var c=Element.cumulativeScrollOffset(b);this.xcomp=a+c[0]-this.deltaX;this.ycomp=d+c[1]-this.deltaY;this.offset=Element.cumulativeOffset(b);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+b.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+b.offsetWidth)},overlap:function(b,a){if(!b){return 0}if(b=="vertical"){return((this.offset[1]+a.offsetHeight)-this.ycomp)/a.offsetHeight}if(b=="horizontal"){return((this.offset[0]+a.offsetWidth)-this.xcomp)/a.offsetWidth}},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(a){Position.prepare();return Element.absolutize(a)},relativize:function(a){Position.prepare();return Element.relativize(a)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(b,c,a){a=a||{};return Element.clonePosition(c,b,a)}};if(!document.getElementsByClassName){document.getElementsByClassName=function(b){function a(c){return c.blank()?null:"[contains(concat(' ', @class, ' '), ' "+c+" ')]"}b.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(c,e){e=e.toString().strip();var d=/\s/.test(e)?$w(e).map(a).join(""):a(e);return d?document._getElementsByXPath(".//*"+d,c):[]}:function(e,f){f=f.toString().strip();var g=[],h=(/\s/.test(f)?$w(f):null);if(!h&&!f){return g}var c=$(e).getElementsByTagName("*");f=" "+f+" ";for(var d=0,k,j;k=c[d];d++){if(k.className&&(j=" "+k.className+" ")&&(j.include(f)||(h&&h.all(function(l){return !l.toString().blank()&&j.include(" "+l+" ")})))){g.push(Element.extend(k))}}return g};return function(d,c){return $(c||document.body).getElementsByClassName(d)}}(Element.Methods)}Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(a){this.element=$(a)},_each:function(a){this.element.className.split(/\s+/).select(function(b){return b.length>0})._each(a)},set:function(a){this.element.className=a},add:function(a){if(this.include(a)){return}this.set($A(this).concat(a).join(" "))},remove:function(a){if(!this.include(a)){return}this.set($A(this).without(a).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);(function(){window.Selector=Class.create({initialize:function(a){this.expression=a.strip()},findElements:function(a){return Prototype.Selector.select(this.expression,a)},match:function(a){return Prototype.Selector.match(a,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}});Object.extend(Selector,{matchElements:function(f,g){var a=Prototype.Selector.match,d=[];for(var c=0,e=f.length;c<e;c++){var b=f[c];if(a(b,g)){d.push(Element.extend(b))}}return d},findElement:function(f,g,b){b=b||0;var a=0,d;for(var c=0,e=f.length;c<e;c++){d=f[c];if(Prototype.Selector.match(d,g)&&b===a++){return Element.extend(d)}}},findChildElements:function(b,c){var a=c.toArray().join(", ");return Prototype.Selector.select(a,b||document)}})})();String.prototype.parseColor=function(){var a="#";if(this.slice(0,4)=="rgb("){var c=this.slice(4,this.length-1).split(",");var b=0;do{a+=parseInt(c[b]).toColorPart()}while(++b<3)}else{if(this.slice(0,1)=="#"){if(this.length==4){for(var b=1;b<4;b++){a+=(this.charAt(b)+this.charAt(b)).toLowerCase()}}if(this.length==7){a=this.toLowerCase()}}}return(a.length==7?a:(arguments[0]||this))};Element.collectTextNodes=function(a){return $A($(a).childNodes).collect(function(b){return(b.nodeType==3?b.nodeValue:(b.hasChildNodes()?Element.collectTextNodes(b):""))}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(a,b){return $A($(a).childNodes).collect(function(c){return(c.nodeType==3?c.nodeValue:((c.hasChildNodes()&&!Element.hasClassName(c,b))?Element.collectTextNodesIgnoreClass(c,b):""))}).flatten().join("")};Element.setContentZoom=function(a,b){a=$(a);a.setStyle({fontSize:(b/100)+"em"});if(Prototype.Browser.WebKit){window.scrollBy(0,0)}return a};Element.getInlineOpacity=function(a){return $(a).style.opacity||""};Element.forceRerendering=function(a){try{a=$(a);var c=document.createTextNode(" ");a.appendChild(c);a.removeChild(c)}catch(b){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(a){return(-Math.cos(a*Math.PI)/2)+0.5},reverse:function(a){return 1-a},flicker:function(a){var a=((-Math.cos(a*Math.PI)/4)+0.75)+Math.random()/4;return a>1?1:a},wobble:function(a){return(-Math.cos(a*Math.PI*(9*a))/2)+0.5},pulse:function(b,a){return(-Math.cos((b*((a||5)-0.5)*2)*Math.PI)/2)+0.5},spring:function(a){return 1-(Math.cos(a*4.5*Math.PI)*Math.exp(-a*6))},none:function(a){return 0},full:function(a){return 1}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(a){var b="position:relative";if(Prototype.Browser.IE){b+=";zoom:1"}a=$(a);$A(a.childNodes).each(function(c){if(c.nodeType==3){c.nodeValue.toArray().each(function(d){a.insertBefore(new Element("span",{style:b}).update(d==" "?String.fromCharCode(160):d),c)});Element.remove(c)}})},multiple:function(b,c){var e;if(((typeof b=="object")||Object.isFunction(b))&&(b.length)){e=b}else{e=$(b).childNodes}var a=Object.extend({speed:0.1,delay:0},arguments[2]||{});var d=a.delay;$A(e).each(function(g,f){new c(g,Object.extend(a,{delay:f*a.speed+d}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(b,c,a){b=$(b);c=(c||"appear").toLowerCase();return Effect[Effect.PAIRS[c][b.visible()?1:0]](b,Object.extend({queue:{position:"end",scope:(b.id||"global"),limit:1}},a||{}))}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(a){this.effects._each(a)},add:function(b){var c=new Date().getTime();var a=Object.isString(b.options.queue)?b.options.queue:b.options.queue.position;switch(a){case"front":this.effects.findAll(function(d){return d.state=="idle"}).each(function(d){d.startOn+=b.finishOn;d.finishOn+=b.finishOn});break;case"with-last":c=this.effects.pluck("startOn").max()||c;break;case"end":c=this.effects.pluck("finishOn").max()||c;break}b.startOn+=c;b.finishOn+=c;if(!b.options.queue.limit||(this.effects.length<b.options.queue.limit)){this.effects.push(b)}if(!this.interval){this.interval=setInterval(this.loop.bind(this),15)}},remove:function(a){this.effects=this.effects.reject(function(b){return b==a});if(this.effects.length==0){clearInterval(this.interval);this.interval=null}},loop:function(){var c=new Date().getTime();for(var b=0,a=this.effects.length;b<a;b++){this.effects[b]&&this.effects[b].loop(c)}}});Effect.Queues={instances:$H(),get:function(a){if(!Object.isString(a)){return a}return this.instances.get(a)||this.instances.set(a,new Effect.ScopedQueue())}};Effect.Queue=Effect.Queues.get("global");Effect.Base=Class.create({position:null,start:function(a){if(a&&a.transition===false){a.transition=Effect.Transitions.linear}this.options=Object.extend(Object.extend({},Effect.DefaultOptions),a||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;this.render=(function(){function b(d,c){if(d.options[c+"Internal"]){d.options[c+"Internal"](d)}if(d.options[c]){d.options[c](d)}}return function(c){if(this.state==="idle"){this.state="running";b(this,"beforeSetup");if(this.setup){this.setup()}b(this,"afterSetup")}if(this.state==="running"){c=(this.options.transition(c)*this.fromToDelta)+this.options.from;this.position=c;b(this,"beforeUpdate");if(this.update){this.update(c)}b(this,"afterUpdate")}}})();this.event("beforeStart");if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)}},loop:function(c){if(c>=this.startOn){if(c>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");if(this.finish){this.finish()}this.event("afterFinish");return}var b=(c-this.startOn)/this.totalTime,a=(b*this.totalFrames).round();if(a>this.currentFrame){this.render(b);this.currentFrame=a}}},cancel:function(){if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this)}this.state="finished"},event:function(a){if(this.options[a+"Internal"]){this.options[a+"Internal"](this)}if(this.options[a]){this.options[a](this)}},inspect:function(){var a=$H();for(property in this){if(!Object.isFunction(this[property])){a.set(property,this[property])}}return"#<Effect:"+a.inspect()+",options:"+$H(this.options).inspect()+">"}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(a){this.effects=a||[];this.start(arguments[1])},update:function(a){this.effects.invoke("render",a)},finish:function(a){this.effects.each(function(b){b.render(1);b.cancel();b.event("beforeFinish");if(b.finish){b.finish(a)}b.event("afterFinish")})}});Effect.Tween=Class.create(Effect.Base,{initialize:function(c,f,e){c=Object.isString(c)?$(c):c;var b=$A(arguments),d=b.last(),a=b.length==5?b[3]:null;this.method=Object.isFunction(d)?d.bind(c):Object.isFunction(c[d])?c[d].bind(c):function(g){c[d]=g};this.start(Object.extend({from:f,to:e},a||{}))},update:function(a){this.method(a)}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}))},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}var a=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(a)},update:function(a){this.element.setOpacity(a)}});Effect.Move=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(a)},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop}},update:function(a){this.element.setStyle({left:(this.options.x*a+this.originalLeft).round()+"px",top:(this.options.y*a+this.originalTop).round()+"px"})}});Effect.MoveBy=function(b,a,c){return new Effect.Move(b,Object.extend({x:c,y:a},arguments[3]||{}))};Effect.Scale=Class.create(Effect.Base,{initialize:function(b,c){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:c},arguments[2]||{});this.start(a)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(b){this.originalStyle[b]=this.element.style[b]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var a=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(b){if(a.indexOf(b)>0){this.fontSize=parseFloat(a);this.fontSizeType=b}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box"){this.dims=[this.element.offsetHeight,this.element.offsetWidth]}if(/^content/.test(this.options.scaleMode)){this.dims=[this.element.scrollHeight,this.element.scrollWidth]}if(!this.dims){this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]}},update:function(a){var b=(this.options.scaleFrom/100)+(this.factor*a);if(this.options.scaleContent&&this.fontSize){this.element.setStyle({fontSize:this.fontSize*b+this.fontSizeType})}this.setDimensions(this.dims[0]*b,this.dims[1]*b)},finish:function(a){if(this.restoreAfterFinish){this.element.setStyle(this.originalStyle)}},setDimensions:function(a,e){var f={};if(this.options.scaleX){f.width=e.round()+"px"}if(this.options.scaleY){f.height=a.round()+"px"}if(this.options.scaleFromCenter){var c=(a-this.dims[0])/2;var b=(e-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY){f.top=this.originalTop-c+"px"}if(this.options.scaleX){f.left=this.originalLeft-b+"px"}}else{if(this.options.scaleY){f.top=-c+"px"}if(this.options.scaleX){f.left=-b+"px"}}}this.element.setStyle(f)}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(a)},setup:function(){if(this.element.getStyle("display")=="none"){this.cancel();return}this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor){this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff")}if(!this.options.restorecolor){this.options.restorecolor=this.element.getStyle("background-color")}this._base=$R(0,2).map(function(a){return parseInt(this.options.startcolor.slice(a*2+1,a*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(a){return parseInt(this.options.endcolor.slice(a*2+1,a*2+3),16)-this._base[a]}.bind(this))},update:function(a){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(b,c,d){return b+((this._base[d]+(this._delta[d]*a)).round().toColorPart())}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});Effect.ScrollTo=function(c){var b=arguments[1]||{},a=document.viewport.getScrollOffsets(),d=$(c).cumulativeOffset();if(b.offset){d[1]+=b.offset}return new Effect.Tween(null,a.top,d[1],b,function(e){scrollTo(a.left,e.round())})};Effect.Fade=function(c){c=$(c);var a=c.getInlineOpacity();var b=Object.extend({from:c.getOpacity()||1,to:0,afterFinishInternal:function(d){if(d.options.to!=0){return}d.element.hide().setStyle({opacity:a})}},arguments[1]||{});return new Effect.Opacity(c,b)};Effect.Appear=function(b){b=$(b);var a=Object.extend({from:(b.getStyle("display")=="none"?0:b.getOpacity()||0),to:1,afterFinishInternal:function(c){c.element.forceRerendering()},beforeSetup:function(c){c.element.setOpacity(c.options.from).show()}},arguments[1]||{});return new Effect.Opacity(b,a)};Effect.Puff=function(b){b=$(b);var a={opacity:b.getInlineOpacity(),position:b.getStyle("position"),top:b.style.top,left:b.style.left,width:b.style.width,height:b.style.height};return new Effect.Parallel([new Effect.Scale(b,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(b,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(c){Position.absolutize(c.effects[0].element)},afterFinishInternal:function(c){c.effects[0].element.hide().setStyle(a)}},arguments[1]||{}))};Effect.BlindUp=function(a){a=$(a);a.makeClipping();return new Effect.Scale(a,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(b){b.element.hide().undoClipping()}},arguments[1]||{}))};Effect.BlindDown=function(b){b=$(b);var a=b.getDimensions();return new Effect.Scale(b,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:a.height,originalWidth:a.width},restoreAfterFinish:true,afterSetup:function(c){c.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(c){c.element.undoClipping()}},arguments[1]||{}))};Effect.SwitchOff=function(b){b=$(b);var a=b.getInlineOpacity();return new Effect.Appear(b,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(c){new Effect.Scale(c.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(d){d.element.makePositioned().makeClipping()},afterFinishInternal:function(d){d.element.hide().undoClipping().undoPositioned().setStyle({opacity:a})}})}},arguments[1]||{}))};Effect.DropOut=function(b){b=$(b);var a={top:b.getStyle("top"),left:b.getStyle("left"),opacity:b.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(b,{x:0,y:100,sync:true}),new Effect.Opacity(b,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(c){c.effects[0].element.makePositioned()},afterFinishInternal:function(c){c.effects[0].element.hide().undoPositioned().setStyle(a)}},arguments[1]||{}))};Effect.Shake=function(d){d=$(d);var b=Object.extend({distance:20,duration:0.5},arguments[1]||{});var e=parseFloat(b.distance);var c=parseFloat(b.duration)/10;var a={top:d.getStyle("top"),left:d.getStyle("left")};return new Effect.Move(d,{x:e,y:0,duration:c,afterFinishInternal:function(f){new Effect.Move(f.element,{x:-e*2,y:0,duration:c*2,afterFinishInternal:function(g){new Effect.Move(g.element,{x:e*2,y:0,duration:c*2,afterFinishInternal:function(h){new Effect.Move(h.element,{x:-e*2,y:0,duration:c*2,afterFinishInternal:function(j){new Effect.Move(j.element,{x:e*2,y:0,duration:c*2,afterFinishInternal:function(k){new Effect.Move(k.element,{x:-e,y:0,duration:c,afterFinishInternal:function(l){l.element.undoPositioned().setStyle(a)}})}})}})}})}})}})};Effect.SlideDown=function(c){c=$(c).cleanWhitespace();var a=c.down().getStyle("bottom");var b=c.getDimensions();return new Effect.Scale(c,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:b.height,originalWidth:b.width},restoreAfterFinish:true,afterSetup:function(d){d.element.makePositioned();d.element.down().makePositioned();if(window.opera){d.element.setStyle({top:""})}d.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(d){d.element.down().setStyle({bottom:(d.dims[0]-d.element.clientHeight)+"px"})},afterFinishInternal:function(d){d.element.undoClipping().undoPositioned();d.element.down().undoPositioned().setStyle({bottom:a})}},arguments[1]||{}))};Effect.SlideUp=function(c){c=$(c).cleanWhitespace();var a=c.down().getStyle("bottom");var b=c.getDimensions();return new Effect.Scale(c,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:b.height,originalWidth:b.width},restoreAfterFinish:true,afterSetup:function(d){d.element.makePositioned();d.element.down().makePositioned();if(window.opera){d.element.setStyle({top:""})}d.element.makeClipping().show()},afterUpdateInternal:function(d){d.element.down().setStyle({bottom:(d.dims[0]-d.element.clientHeight)+"px"})},afterFinishInternal:function(d){d.element.hide().undoClipping().undoPositioned();d.element.down().undoPositioned().setStyle({bottom:a})}},arguments[1]||{}))};Effect.Squish=function(a){return new Effect.Scale(a,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(b){b.element.makeClipping()},afterFinishInternal:function(b){b.element.hide().undoClipping()}})};Effect.Grow=function(c){c=$(c);var b=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var a={top:c.style.top,left:c.style.left,height:c.style.height,width:c.style.width,opacity:c.getInlineOpacity()};var g=c.getDimensions();var h,f;var e,d;switch(b.direction){case"top-left":h=f=e=d=0;break;case"top-right":h=g.width;f=d=0;e=-g.width;break;case"bottom-left":h=e=0;f=g.height;d=-g.height;break;case"bottom-right":h=g.width;f=g.height;e=-g.width;d=-g.height;break;case"center":h=g.width/2;f=g.height/2;e=-g.width/2;d=-g.height/2;break}return new Effect.Move(c,{x:h,y:f,duration:0.01,beforeSetup:function(j){j.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(j){new Effect.Parallel([new Effect.Opacity(j.element,{sync:true,to:1,from:0,transition:b.opacityTransition}),new Effect.Move(j.element,{x:e,y:d,sync:true,transition:b.moveTransition}),new Effect.Scale(j.element,100,{scaleMode:{originalHeight:g.height,originalWidth:g.width},sync:true,scaleFrom:window.opera?1:0,transition:b.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(k){k.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(k){k.effects[0].element.undoClipping().undoPositioned().setStyle(a)}},b))}})};Effect.Shrink=function(c){c=$(c);var b=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var a={top:c.style.top,left:c.style.left,height:c.style.height,width:c.style.width,opacity:c.getInlineOpacity()};var f=c.getDimensions();var e,d;switch(b.direction){case"top-left":e=d=0;break;case"top-right":e=f.width;d=0;break;case"bottom-left":e=0;d=f.height;break;case"bottom-right":e=f.width;d=f.height;break;case"center":e=f.width/2;d=f.height/2;break}return new Effect.Parallel([new Effect.Opacity(c,{sync:true,to:0,from:1,transition:b.opacityTransition}),new Effect.Scale(c,window.opera?1:0,{sync:true,transition:b.scaleTransition,restoreAfterFinish:true}),new Effect.Move(c,{x:e,y:d,sync:true,transition:b.moveTransition})],Object.extend({beforeStartInternal:function(g){g.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(g){g.effects[0].element.hide().undoClipping().undoPositioned().setStyle(a)}},b))};Effect.Pulsate=function(c){c=$(c);var b=arguments[1]||{},a=c.getInlineOpacity(),e=b.transition||Effect.Transitions.linear,d=function(f){return 1-e((-Math.cos((f*(b.pulses||5)*2)*Math.PI)/2)+0.5)};return new Effect.Opacity(c,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(f){f.element.setStyle({opacity:a})}},b),{transition:d}))};Effect.Fold=function(b){b=$(b);var a={top:b.style.top,left:b.style.left,width:b.style.width,height:b.style.height};b.makeClipping();return new Effect.Scale(b,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(c){new Effect.Scale(b,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(d){d.element.hide().undoClipping().setStyle(a)}})}},arguments[1]||{}))};Effect.Morph=Class.create(Effect.Base,{initialize:function(c){this.element=$(c);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(a.style)){this.style=$H(a.style)}else{if(a.style.include(":")){this.style=a.style.parseStyle()}else{this.element.addClassName(a.style);this.style=$H(this.element.getStyles());this.element.removeClassName(a.style);var b=this.element.getStyles();this.style=this.style.reject(function(d){return d.value==b[d.key]});a.afterFinishInternal=function(d){d.element.addClassName(d.options.style);d.transforms.each(function(e){d.element.style[e.style]=""})}}}this.start(a)},setup:function(){function a(b){if(!b||["rgba(0, 0, 0, 0)","transparent"].include(b)){b="#ffffff"}b=b.parseColor();return $R(0,2).map(function(c){return parseInt(b.slice(c*2+1,c*2+3),16)})}this.transforms=this.style.map(function(g){var f=g[0],e=g[1],d=null;if(e.parseColor("#zzzzzz")!="#zzzzzz"){e=e.parseColor();d="color"}else{if(f=="opacity"){e=parseFloat(e);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}}else{if(Element.CSS_LENGTH.test(e)){var c=e.match(/^([\+\-]?[0-9\.]+)(.*)$/);e=parseFloat(c[1]);d=(c.length==3)?c[2]:null}}}var b=this.element.getStyle(f);return{style:f.camelize(),originalValue:d=="color"?a(b):parseFloat(b||0),targetValue:d=="color"?a(e):e,unit:d}}.bind(this)).reject(function(b){return((b.originalValue==b.targetValue)||(b.unit!="color"&&(isNaN(b.originalValue)||isNaN(b.targetValue))))})},update:function(a){var d={},b,c=this.transforms.length;while(c--){d[(b=this.transforms[c]).style]=b.unit=="color"?"#"+(Math.round(b.originalValue[0]+(b.targetValue[0]-b.originalValue[0])*a)).toColorPart()+(Math.round(b.originalValue[1]+(b.targetValue[1]-b.originalValue[1])*a)).toColorPart()+(Math.round(b.originalValue[2]+(b.targetValue[2]-b.originalValue[2])*a)).toColorPart():(b.originalValue+(b.targetValue-b.originalValue)*a).toFixed(3)+(b.unit===null?"":b.unit)}this.element.setStyle(d,true)}});Effect.Transform=Class.create({initialize:function(a){this.tracks=[];this.options=arguments[1]||{};this.addTracks(a)},addTracks:function(a){a.each(function(b){b=$H(b);var c=b.values().first();this.tracks.push($H({ids:b.keys().first(),effect:Effect.Morph,options:{style:c}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(a){var d=a.get("ids"),c=a.get("effect"),b=a.get("options");var e=[$(d)||$$(d)].flatten();return e.map(function(f){return new c(f,Object.extend({sync:true},b))})}).flatten(),this.options)}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");String.prototype.parseStyle=function(){var b,a=$H();if(Prototype.Browser.WebKit){b=new Element("div",{style:this}).style}else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';b=String.__parseStyleElement.childNodes[0].style}Element.CSS_PROPERTIES.each(function(c){if(b[c]){a.set(c,b[c])}});if(Prototype.Browser.IE&&this.include("opacity")){a.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1])}return a};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(b){var a=document.defaultView.getComputedStyle($(b),null);return Element.CSS_PROPERTIES.inject({},function(c,d){c[d]=a[d];return c})}}else{Element.getStyles=function(b){b=$(b);var a=b.currentStyle,c;c=Element.CSS_PROPERTIES.inject({},function(d,e){d[e]=a[e];return d});if(!c.opacity){c.opacity=b.getOpacity()}return c}}Effect.Methods={morph:function(a,b){a=$(a);new Effect.Morph(a,Object.extend({style:b},arguments[2]||{}));return a},visualEffect:function(c,e,b){c=$(c);var d=e.dasherize().camelize(),a=d.charAt(0).toUpperCase()+d.substring(1);new Effect[a](c,b);return c},highlight:function(b,a){b=$(b);new Effect.Highlight(b,a);return b}};$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(a){Effect.Methods[a]=function(c,b){c=$(c);Effect[a.charAt(0).toUpperCase()+a.substring(1)](c,b);return c}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(a){Effect.Methods[a]=Element[a]});Element.addMethods(Effect.Methods);if(typeof Effect=="undefined"){throw ("controls.js requires including script.aculo.us' effects.js library")}var Autocompleter={};Autocompleter.Base=Class.create({baseInitialize:function(b,c,a){b=$(b);this.element=b;this.update=$(c);this.hasFocus=false;this.changed=false;this.active=false;this.index=0;this.entryCount=0;this.oldElementValue=this.element.value;if(this.setOptions){this.setOptions(a)}else{this.options=a||{}}this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(d,e){if(!e.style.position||e.style.position=="absolute"){e.style.position="absolute";Position.clone(d,e,{setHeight:false,offsetTop:d.offsetHeight-1})}Effect.Appear(e,{duration:0.15})};this.options.onHide=this.options.onHide||function(d,e){new Effect.Fade(e,{duration:0.15})};if(typeof(this.options.tokens)=="string"){this.options.tokens=new Array(this.options.tokens)}if(!this.options.tokens.include("\n")){this.options.tokens.push("\n")}this.observer=null;this.element.setAttribute("autocomplete","off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){if(Element.getStyle(this.update,"display")=="none"){this.options.onShow(this.element,this.update)}if(!this.iefix&&(Prototype.Browser.IE)&&(Element.getStyle(this.update,"position")=="absolute")){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+"_iefix")}if(this.iefix){setTimeout(this.fixIEOverlapping.bind(this),50)}},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:(!this.update.style.height)});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix)},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,"display")!="none"){this.options.onHide(this.element,this.update)}if(this.iefix){Element.hide(this.iefix)}},startIndicator:function(){if(this.options.indicator){Element.show(this.options.indicator)}},stopIndicator:function(){if(this.options.indicator){Element.hide(this.options.indicator)}},onKeyPress:function(a){this.onObserverEvent();if(this.active){switch(a.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();Event.stop(a);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(a);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(a);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(a);return}}else{if(a.keyCode==Event.KEY_TAB||a.keyCode==Event.KEY_RETURN||(Prototype.Browser.WebKit>0&&a.keyCode==0)){return}}this.changed=true;this.hasFocus=true;if(this.observer){clearTimeout(this.observer)}this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000)},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices()},onHover:function(b){var a=Event.findElement(b,"LI");if(this.index!=a.autocompleteIndex){this.index=a.autocompleteIndex;this.render()}Event.stop(b)},onClick:function(b){var a=Event.findElement(b,"LI");this.index=a.autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(a){setTimeout(this.hide.bind(this),250);this.hasFocus=false;this.active=false},render:function(){if(this.entryCount>0){for(var a=0;a<this.entryCount;a++){this.index==a?Element.addClassName(this.getEntry(a),"selected"):Element.removeClassName(this.getEntry(a),"selected")}if(this.hasFocus){this.show();this.active=true}}else{this.active=false;this.hide()}},markPrevious:function(){if(this.index>0){this.index--}else{this.index=this.entryCount-1}this.getEntry(this.index)},markNext:function(){if(this.index<this.entryCount-1){this.index++}else{this.index=0}this.getEntry(this.index)},getEntry:function(a){return this.update.firstChild.childNodes[a]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry());this.index=0},updateElement:function(f){if(this.options.updateElement){this.options.updateElement(f);return}var d="";if(this.options.select){var a=$(f).select("."+this.options.select)||[];if(a.length>0){d=Element.collectTextNodes(a[0],this.options.select)}}else{d=Element.collectTextNodesIgnoreClass(f,"informal")}var c=this.getTokenBounds();if(c[0]!=-1){var e=this.element.value.substr(0,c[0]);var b=this.element.value.substr(c[0]).match(/^\s+/);if(b){e+=b[0]}this.element.value=e+d+this.element.value.substr(c[1])}else{this.element.value=d}this.oldElementValue=this.element.value;this.element.focus();if(this.options.afterUpdateElement){this.options.afterUpdateElement(this.element,f)}},updateChoices:function(c){if(!this.changed&&this.hasFocus){this.update.innerHTML=c;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}if(this.index>=this.entryCount){this.index=0}}else{this.entryCount=0}this.stopIndicator();if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide()}else{this.render()}}},addObservers:function(a){Event.observe(a,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(a,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars){this.getUpdatedChoices()}else{this.active=false;this.hide()}this.oldElementValue=this.element.value},getToken:function(){var a=this.getTokenBounds();return this.element.value.substring(a[0],a[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds){return this.tokenBounds}var e=this.element.value;if(e.strip().empty()){return[-1,0]}var f=arguments.callee.getFirstDifferencePos(e,this.oldElementValue);var h=(f==this.oldElementValue.length?1:0);var d=-1,c=e.length;var g;for(var b=0,a=this.options.tokens.length;b<a;++b){g=e.lastIndexOf(this.options.tokens[b],f+h-1);if(g>d){d=g}g=e.indexOf(this.options.tokens[b],f+h);if(-1!=g&&g<c){c=g}}return(this.tokenBounds=[d+1,c])}});Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(c,a){var d=Math.min(c.length,a.length);for(var b=0;b<d;++b){if(c[b]!=a[b]){return b}}return d};Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(c,d,b,a){this.baseInitialize(c,d,a);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=b},getUpdatedChoices:function(){this.startIndicator();var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,a):a;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams}new Ajax.Request(this.url,this.options)},onComplete:function(a){this.updateChoices(a.responseText)}});Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(b,d,c,a){this.baseInitialize(b,d,a);this.options.array=c},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(a){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(b){var d=[];var c=[];var h=b.getToken();var g=0;for(var e=0;e<b.options.array.length&&d.length<b.options.choices;e++){var f=b.options.array[e];var j=b.options.ignoreCase?f.toLowerCase().indexOf(h.toLowerCase()):f.indexOf(h);while(j!=-1){if(j==0&&f.length!=h.length){d.push("<li><strong>"+f.substr(0,h.length)+"</strong>"+f.substr(h.length)+"</li>");break}else{if(h.length>=b.options.partialChars&&b.options.partialSearch&&j!=-1){if(b.options.fullSearch||/\s/.test(f.substr(j-1,1))){c.push("<li>"+f.substr(0,j)+"<strong>"+f.substr(j,h.length)+"</strong>"+f.substr(j+h.length)+"</li>");break}}}j=b.options.ignoreCase?f.toLowerCase().indexOf(h.toLowerCase(),j+1):f.indexOf(h,j+1)}}if(c.length){d=d.concat(c.slice(0,b.options.choices-d.length))}return"<ul>"+d.join("")+"</ul>"}},a||{})}});Field.scrollFreeActivate=function(a){setTimeout(function(){Field.activate(a)},1)};Ajax.InPlaceEditor=Class.create({initialize:function(c,b,a){this.url=b;this.element=c=$(c);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(a);Object.extend(this.options,a||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+"-inplaceeditor";if($(this.options.formId)){this.options.formId=""}}if(this.options.externalControl){this.options.externalControl=$(this.options.externalControl)}if(!this.options.externalControl){this.options.externalControlOnly=false}this._originalBackground=this.element.getStyle("background-color")||"transparent";this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this._keyHandler=this.checkForEscapeOrReturn.bind(this);if(this.options.clickToEdit){this.registerListeners()}},checkForEscapeOrReturn:function(a){if(!this._editing||a.ctrlKey||a.altKey||a.shiftKey){return}if(Event.KEY_ESC==a.keyCode){this.handleFormCancellation(a)}else{if(Event.KEY_RETURN==a.keyCode){this.handleFormSubmission(a)}}},createControl:function(g,c,b){var e=this.options[g+"Control"];var f=this.options[g+"Text"];if("button"==e){var a=document.createElement("input");a.type="submit";a.value=f;a.className="editor_"+g+"_button";if("cancel"==g){a.onclick=this._boundCancelHandler}this._form.appendChild(a);this._controls[g]=a}else{if("link"==e){var d=document.createElement("a");d.href="#";d.appendChild(document.createTextNode(f));d.onclick="cancel"==g?this._boundCancelHandler:this._boundSubmitHandler;d.className="editor_"+g+"_link";if(b){d.className+=" "+b}this._form.appendChild(d);this._controls[g]=d}}},createEditField:function(){var c=(this.options.loadTextURL?this.options.loadingText:this.getText());var b;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){b=document.createElement("input");b.type="text";var a=this.options.size||this.options.cols||0;if(0<a){b.size=a}}else{b=document.createElement("textarea");b.rows=(1>=this.options.rows?this.options.autoRows:this.options.rows);b.cols=this.options.cols||40}b.name=this.options.paramName;this.initialValue=this.options.initialText||c;b.value=this.initialValue;b.className="editor_field";if(this.options.submitOnBlur){b.onblur=this._boundSubmitHandler}Event.observe(b,"keydown",this._keyHandler);this._controls.editor=b;if(this.options.loadTextURL){this.loadExternalText()}this._form.appendChild(this._controls.editor)},createForm:function(){var b=this;function a(d,e){var c=b.options["text"+d+"Controls"];if(!c||e===false){return}b._form.appendChild(document.createTextNode(c))}this._form=$(document.createElement("form"));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();if("textarea"==this._controls.editor.tagName.toLowerCase()){this._form.appendChild(document.createElement("br"))}if(this.options.onFormCustomization){this.options.onFormCustomization(this,this._form)}a("Before",this.options.okControl||this.options.cancelControl);this.createControl("ok",this._boundSubmitHandler);a("Between",this.options.okControl&&this.options.cancelControl);this.createControl("cancel",this._boundCancelHandler,"editor_cancel");a("After",this.options.okControl||this.options.cancelControl)},destroy:function(){if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML}this.leaveEditMode();this.unregisterListeners()},enterEditMode:function(a){if(this._saving||this._editing){return}this._editing=true;this.triggerCallback("onEnterEditMode");if(this.options.externalControl){this.options.externalControl.hide()}this.element.hide();this.createForm();this.element.parentNode.insertBefore(this._form,this.element);if(!this.options.loadTextURL){this.postProcessEditField()}if(a){Event.stop(a)}},enterHover:function(a){if(this.options.hoverClassName){this.element.addClassName(this.options.hoverClassName)}if(this._saving){return}this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML.unescapeHTML()},handleAJAXFailure:function(a){this.triggerCallback("onFailure",a);if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML;this._oldInnerHTML=null}},handleFormCancellation:function(a){if(this._handling_form){return}this._handling_form=true;this.wrapUp();if(a){Event.stop(a)}this._handling_form=false},handleFormSubmission:function(c,g){if(this._handling_form){return}var d=this._form;var f=$F(this._controls.editor);if(this.options.cancelIfSame&&(f===this.initialValue)){this.handleFormCancellation(g);return}this._handling_form=true;this.prepareSubmission();var h=this.options.callback(d,f)||"";if(Object.isString(h)){h=h.toQueryParams()}h.editorId=this.element.id;if(this.options.htmlResponse){var b=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(b,{parameters:h,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Updater({success:this.element},this.url,b)}else{var b=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(b,{parameters:h,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});var a=this.options.ajaxClass||Ajax.Request;new a(this.url,b)}if(g){Event.stop(g)}this._handling_form=false;return false},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();if(this.options.externalControl){this.options.externalControl.show()}this._saving=false;this._editing=false;this._oldInnerHTML=null;this.triggerCallback("onLeaveEditMode")},leaveHover:function(a){if(this.options.hoverClassName){this.element.removeClassName(this.options.hoverClassName)}if(this._saving){return}this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=true;var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(c){this._form.removeClassName(this.options.loadingClassName);var b=c.responseText;if(this.options.stripLoadedTextTags){b=b.stripTags()}this._controls.editor.value=b;this._controls.editor.disabled=false;this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,a)},postProcessEditField:function(){var a=this.options.fieldPostCreation;if(a){$(this._controls.editor)["focus"==a?"focus":"activate"]()}},prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(a){Object.extend(this.options,a)}.bind(this))},prepareSubmission:function(){this._saving=true;this.removeForm();this.leaveHover();this.showSaving()},registerListeners:function(){this._listeners={};var a;$H(Ajax.InPlaceEditor.Listeners).each(function(b){a=this[b.value].bind(this);this._listeners[b.key]=a;if(!this.options.externalControlOnly){this.element.observe(b.key,a)}if(this.options.externalControl){this.options.externalControl.observe(b.key,a)}}.bind(this))},removeForm:function(){if(!this._form){return}this._form.remove();this._form=null;this._controls={}},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show()},triggerCallback:function(b,a){if("function"==typeof this.options[b]){this.options[b](this,a)}},unregisterListeners:function(){$H(this._listeners).each(function(a){if(!this.options.externalControlOnly){this.element.stopObserving(a.key,a.value)}if(this.options.externalControl){this.options.externalControl.stopObserving(a.key,a.value)}}.bind(this))},wrapUp:function(a){this.leaveEditMode();this._boundComplete(a,this.element)}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,c,b,a){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(c,b,a)},createEditField:function(){var a=document.createElement("select");a.name=this.options.paramName;a.size=1;this._controls.editor=a;this._collection=this.options.collection||[];if(this.options.loadCollectionURL){this.loadCollection()}else{this.checkForExternalText()}this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);this.showLoadingText(this.options.loadingCollectionText);var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){var js=transport.responseText.strip();if(!/^\[.*\]$/.test(js)){throw ("Server returned an invalid collection representation.")}this._collection=eval(js);this.checkForExternalText()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,options)},showLoadingText:function(b){this._controls.editor.disabled=true;var a=this._controls.editor.firstChild;if(!a){a=document.createElement("option");a.value="";this._controls.editor.appendChild(a);a.selected=true}a.update((b||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText();if(this.options.loadTextURL){this.loadExternalText()}else{this.buildOptionList()}},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(b){this._text=b.responseText.strip();this.buildOptionList()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,a)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(d){return 2===d.length?d:[d,d].flatten()});var b=("value" in this.options)?this.options.value:this._text;var a=this._collection.any(function(d){return d[0]==b}.bind(this));this._controls.editor.update("");var c;this._collection.each(function(e,d){c=document.createElement("option");c.value=e[0];c.selected=a?e[0]==b:0==d;c.appendChild(document.createTextNode(e[1]));this._controls.editor.appendChild(c)}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor)}});Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(a){if(!a){return}function b(c,d){if(c in a||d===undefined){return}a[c]=d}b("cancelControl",(a.cancelLink?"link":(a.cancelButton?"button":a.cancelLink==a.cancelButton==false?false:undefined)));b("okControl",(a.okLink?"link":(a.okButton?"button":a.okLink==a.okButton==false?false:undefined)));b("highlightColor",a.highlightcolor);b("highlightEndColor",a.highlightendcolor)};Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelIfSame:false,cancelText:"cancel",clickToEdit:true,clickToEditText:"Click to edit",externalControl:null,externalControlOnly:false,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:true,initialText:"",loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",savingText:"Saving...",size:0,stripLoadedTextTags:false,submitOnBlur:false,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(a){return Form.serialize(a)},onComplete:function(b,a){new Effect.Highlight(a,{startcolor:this.options.highlightColor,keepBackgroundImage:true})},onEnterEditMode:null,onEnterHover:function(a){a.element.style.backgroundColor=a.options.highlightColor;if(a._effect){a._effect.cancel()}},onFailure:function(b,a){alert("Error communication with the server: "+b.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(a){a._effect=new Effect.Highlight(a.element,{startcolor:a.options.highlightColor,endcolor:a.options.highlightEndColor,restorecolor:a._originalBackground,keepBackgroundImage:true})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."};Form.Element.DelayedObserver=Class.create({initialize:function(b,a,c){this.delay=a||0.5;this.element=$(b);this.callback=c;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(a){if(this.lastValue==$F(this.element)){return}if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1000);this.lastValue=$F(this.element)},onTimerEvent:function(){this.timer=null;this.callback(this.element,$F(this.element))}});var Builder={NODEMAP:{AREA:"map",CAPTION:"table",COL:"table",COLGROUP:"table",LEGEND:"fieldset",OPTGROUP:"select",OPTION:"select",PARAM:"object",TBODY:"table",TD:"table",TFOOT:"table",TH:"table",THEAD:"table",TR:"table"},node:function(a){a=a.toUpperCase();var g=this.NODEMAP[a]||"div";var b=document.createElement(g);try{b.innerHTML="<"+a+"></"+a+">"}catch(f){}var d=b.firstChild||null;if(d&&(d.tagName.toUpperCase()!=a)){d=d.getElementsByTagName(a)[0]}if(!d){d=document.createElement(a)}if(!d){return}if(arguments[1]){if(this._isStringOrNumber(arguments[1])||(arguments[1] instanceof Array)||arguments[1].tagName){this._children(d,arguments[1])}else{var c=this._attributes(arguments[1]);if(c.length){try{b.innerHTML="<"+a+" "+c+"></"+a+">"}catch(f){}d=b.firstChild||null;if(!d){d=document.createElement(a);for(attr in arguments[1]){d[attr=="class"?"className":attr]=arguments[1][attr]}}if(d.tagName.toUpperCase()!=a){d=b.getElementsByTagName(a)[0]}}}}if(arguments[2]){this._children(d,arguments[2])}return $(d)},_text:function(a){return document.createTextNode(a)},ATTR_MAP:{className:"class",htmlFor:"for"},_attributes:function(a){var b=[];for(attribute in a){b.push((attribute in this.ATTR_MAP?this.ATTR_MAP[attribute]:attribute)+'="'+a[attribute].toString().escapeHTML().gsub(/"/,"&quot;")+'"')}return b.join(" ")},_children:function(b,a){if(a.tagName){b.appendChild(a);return}if(typeof a=="object"){a.flatten().each(function(c){if(typeof c=="object"){b.appendChild(c)}else{if(Builder._isStringOrNumber(c)){b.appendChild(Builder._text(c))}}})}else{if(Builder._isStringOrNumber(a)){b.appendChild(Builder._text(a))}}},_isStringOrNumber:function(a){return(typeof a=="string"||typeof a=="number")},build:function(b){var a=this.node("div");$(a).update(b.strip());return a.down()},dump:function(b){if(typeof b!="object"&&typeof b!="function"){b=window}var a=("A ABBR ACRONYM ADDRESS APPLET AREA B BASE BASEFONT BDO BIG BLOCKQUOTE BODY BR BUTTON CAPTION CENTER CITE CODE COL COLGROUP DD DEL DFN DIR DIV DL DT EM FIELDSET FONT FORM FRAME FRAMESET H1 H2 H3 H4 H5 H6 HEAD HR HTML I IFRAME IMG INPUT INS ISINDEX KBD LABEL LEGEND LI LINK MAP MENU META NOFRAMES NOSCRIPT OBJECT OL OPTGROUP OPTION P PARAM PRE Q S SAMP SCRIPT SELECT SMALL SPAN STRIKE STRONG STYLE SUB SUP TABLE TBODY TD TEXTAREA TFOOT TH THEAD TITLE TR TT U UL VAR").split(/\s+/);a.each(function(c){b[c]=function(){return Builder.node.apply(Builder,[c].concat($A(arguments)))}})}};if(!Control){var Control={}}Control.Slider=Class.create({initialize:function(d,a,b){var c=this;if(Object.isArray(d)){this.handles=d.collect(function(f){return $(f)})}else{this.handles=[$(d)]}this.track=$(a);this.options=b||{};this.axis=this.options.axis||"horizontal";this.increment=this.options.increment||1;this.step=parseInt(this.options.step||"1");this.range=this.options.range||$R(0,1);this.value=0;this.values=this.handles.map(function(){return 0});this.spans=this.options.spans?this.options.spans.map(function(e){return $(e)}):false;this.options.startSpan=$(this.options.startSpan||null);this.options.endSpan=$(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||"0");this.alignY=parseInt(this.options.alignY||"0");this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?(this.handles[0].offsetHeight!=0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,"")):(this.handles[0].offsetWidth!=0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""));this.active=false;this.dragging=false;this.disabled=false;if(this.options.disabled){this.setDisabled()}this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):false;if(this.allowedValues){this.minimum=this.allowedValues.min();this.maximum=this.allowedValues.max()}this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);this.handles.each(function(f,e){e=c.handles.length-1-e;c.setValue(parseFloat((Object.isArray(c.options.sliderValue)?c.options.sliderValue[e]:c.options.sliderValue)||c.range.start),e);f.makePositioned().observe("mousedown",c.eventMouseDown)});this.track.observe("mousedown",this.eventMouseDown);document.observe("mouseup",this.eventMouseUp);document.observe("mousemove",this.eventMouseMove);this.initialized=true},dispose:function(){var a=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown);Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);this.handles.each(function(b){Event.stopObserving(b,"mousedown",a.eventMouseDown)})},setDisabled:function(){this.disabled=true},setEnabled:function(){this.disabled=false},getNearestValue:function(a){if(this.allowedValues){if(a>=this.allowedValues.max()){return(this.allowedValues.max())}if(a<=this.allowedValues.min()){return(this.allowedValues.min())}var c=Math.abs(this.allowedValues[0]-a);var b=this.allowedValues[0];this.allowedValues.each(function(d){var e=Math.abs(d-a);if(e<=c){b=d;c=e}});return b}if(a>this.range.end){return this.range.end}if(a<this.range.start){return this.range.start}return a},setValue:function(b,a){if(!this.active){this.activeHandleIdx=a||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles()}a=a||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((a>0)&&(b<this.values[a-1])){b=this.values[a-1]}if((a<(this.handles.length-1))&&(b>this.values[a+1])){b=this.values[a+1]}}b=this.getNearestValue(b);this.values[a]=b;this.value=this.values[0];this.handles[a].style[this.isVertical()?"top":"left"]=this.translateToPx(b);this.drawSpans();if(!this.dragging||!this.event){this.updateFinished()}},setValueBy:function(b,a){this.setValue(this.values[a||this.activeHandleIdx||0]+b,a||this.activeHandleIdx||0)},translateToPx:function(a){return Math.round(((this.trackLength-this.handleLength)/(this.range.end-this.range.start))*(a-this.range.start))+"px"},translateToValue:function(a){return((a/(this.trackLength-this.handleLength)*(this.range.end-this.range.start))+this.range.start)},getRange:function(b){var a=this.values.sortBy(Prototype.K);b=b||0;return $R(a[b],a[b+1])},minimumOffset:function(){return(this.isVertical()?this.alignY:this.alignX)},maximumOffset:function(){return(this.isVertical()?(this.track.offsetHeight!=0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!=0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX)},isVertical:function(){return(this.axis=="vertical")},drawSpans:function(){var a=this;if(this.spans){$R(0,this.spans.length-1).each(function(b){a.setSpan(a.spans[b],a.getRange(b))})}if(this.options.startSpan){this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value))}if(this.options.endSpan){this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum))}},setSpan:function(b,a){if(this.isVertical()){b.style.top=this.translateToPx(a.start);b.style.height=this.translateToPx(a.end-a.start+this.range.start)}else{b.style.left=this.translateToPx(a.start);b.style.width=this.translateToPx(a.end-a.start+this.range.start)}},updateStyles:function(){this.handles.each(function(a){Element.removeClassName(a,"selected")});Element.addClassName(this.activeHandle,"selected")},startDrag:function(c){if(Event.isLeftClick(c)){if(!this.disabled){this.active=true;var d=Event.element(c);var e=[Event.pointerX(c),Event.pointerY(c)];var a=d;if(a==this.track){var b=this.track.cumulativeOffset();this.event=c;this.setValue(this.translateToValue((this.isVertical()?e[1]-b[1]:e[0]-b[0])-(this.handleLength/2)));var b=this.activeHandle.cumulativeOffset();this.offsetX=(e[0]-b[0]);this.offsetY=(e[1]-b[1])}else{while((this.handles.indexOf(d)==-1)&&d.parentNode){d=d.parentNode}if(this.handles.indexOf(d)!=-1){this.activeHandle=d;this.activeHandleIdx=this.handles.indexOf(this.activeHandle);this.updateStyles();var b=this.activeHandle.cumulativeOffset();this.offsetX=(e[0]-b[0]);this.offsetY=(e[1]-b[1])}}}Event.stop(c)}},update:function(a){if(this.active){if(!this.dragging){this.dragging=true}this.draw(a);if(Prototype.Browser.WebKit){window.scrollBy(0,0)}Event.stop(a)}},draw:function(b){var c=[Event.pointerX(b),Event.pointerY(b)];var a=this.track.cumulativeOffset();c[0]-=this.offsetX+a[0];c[1]-=this.offsetY+a[1];this.event=b;this.setValue(this.translateToValue(this.isVertical()?c[1]:c[0]));if(this.initialized&&this.options.onSlide){this.options.onSlide(this.values.length>1?this.values:this.value,this)}},endDrag:function(a){if(this.active&&this.dragging){this.finishDrag(a,true);Event.stop(a)}this.active=false;this.dragging=false},finishDrag:function(a,b){this.active=false;this.dragging=false;this.updateFinished()},updateFinished:function(){if(this.initialized&&this.options.onChange){this.options.onChange(this.values.length>1?this.values:this.value,this)}this.event=null}});
/* jQuery v1.7.2 jquery.com | jquery.org/license */
(function(a,b){function cy(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cu(a){if(!cj[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){ck||(ck=c.createElement("iframe"),ck.frameBorder=ck.width=ck.height=0),b.appendChild(ck);if(!cl||!ck.createElement){cl=(ck.contentWindow||ck.contentDocument).document,cl.write((f.support.boxModel?"<!doctype html>":"")+"<html><body>"),cl.close()}d=cl.createElement(a),cl.body.appendChild(d),e=f.css(d,"display"),b.removeChild(ck)}cj[a]=e}return cj[a]}function ct(a,b){var c={};f.each(cp.concat.apply([],cp.slice(0,b)),function(){c[this]=a});return c}function cs(){cq=b}function cr(){setTimeout(cs,0);return cq=f.now()}function ci(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ch(){try{return new a.XMLHttpRequest}catch(b){}}function cb(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1){for(h in a.converters){typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h])}}l=k,k=d[g];if(k==="*"){k=l}else{if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}}return c}function ca(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g){i in d&&(c[g[i]]=d[i])}while(f[0]==="*"){f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"))}if(h){for(i in e){if(e[i]&&e[i].test(h)){f.unshift(i);break}}}if(f[0] in d){j=f[0]}else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function b_(a,b,c,d){if(f.isArray(b)){f.each(b,function(b,e){c||bD.test(a)?d(a,e):b_(a+"["+(typeof e=="object"?b:"")+"]",e,c,d)})}else{if(!c&&f.type(b)==="object"){for(var e in b){b_(a+"["+e+"]",b[e],c,d)}}else{d(a,b)}}}function b$(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};for(d in c){c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d])}e&&f.extend(!0,a,e)}function bZ(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bS,l;for(;i<j&&(k||!l);i++){l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=bZ(a,c,d,e,l,g)))}(k||!l)&&!g["*"]&&(l=bZ(a,c,d,e,"*",g));return l}function bY(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bO),e=0,g=d.length,h,i,j;for(;e<g;e++){h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}}function bB(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?1:0,g=4;if(d>0){if(c!=="border"){for(;e<g;e+=2){c||(d-=parseFloat(f.css(a,"padding"+bx[e]))||0),c==="margin"?d+=parseFloat(f.css(a,c+bx[e]))||0:d-=parseFloat(f.css(a,"border"+bx[e]+"Width"))||0}}return d+"px"}d=by(a,b);if(d<0||d==null){d=a.style[b]}if(bt.test(d)){return d}d=parseFloat(d)||0;if(c){for(;e<g;e+=2){d+=parseFloat(f.css(a,"padding"+bx[e]))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+bx[e]+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+bx[e]))||0)}}return d+"px"}function bo(a){var b=c.createElement("div");bh.appendChild(b),b.innerHTML=a.outerHTML;return b.firstChild}function bn(a){var b=(a.nodeName||"").toLowerCase();b==="input"?bm(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&f.grep(a.getElementsByTagName("input"),bm)}function bm(a){if(a.type==="checkbox"||a.type==="radio"){a.defaultChecked=a.checked}}function bl(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bk(a,b){var c;b.nodeType===1&&(b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),c==="object"?b.outerHTML=a.outerHTML:c!=="input"||a.type!=="checkbox"&&a.type!=="radio"?c==="option"?b.selected=a.defaultSelected:c==="input"||c==="textarea"?b.defaultValue=a.defaultValue:c==="script"&&b.text!==a.text&&(b.text=a.text):(a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value)),b.removeAttribute(f.expando),b.removeAttribute("_submit_attached"),b.removeAttribute("_change_attached"))}function bj(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c,d,e,g=f._data(a),h=f._data(b,g),i=g.events;if(i){delete h.handle,h.events={};for(c in i){for(d=0,e=i[c].length;d<e;d++){f.event.add(b,c,i[c][d])}}}h.data&&(h.data=f.extend({},h.data))}}function bi(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function U(a){var b=V.split("|"),c=a.createDocumentFragment();if(c.createElement){while(b.length){c.createElement(b.pop())}}return c}function T(a,b,c){b=b||0;if(f.isFunction(b)){return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c})}if(b.nodeType){return f.grep(a,function(a,d){return a===b===c})}if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(O.test(b)){return f.filter(b,d,!c)}b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function S(a){return !a||!a.parentNode||a.parentNode.nodeType===11}function K(){return !0}function J(){return !1}function n(a,b,c){var d=b+"defer",e=b+"queue",g=b+"mark",h=f._data(a,d);h&&(c==="queue"||!f._data(a,e))&&(c==="mark"||!f._data(a,g))&&setTimeout(function(){!f._data(a,e)&&!f._data(a,g)&&(f.removeData(a,d,!0),h.fire())},0)}function m(a){for(var b in a){if(b==="data"&&f.isEmptyObject(a[b])){continue}if(b!=="toJSON"){return !1}}return !0}function l(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(k,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNumeric(d)?+d:j.test(d)?f.parseJSON(d):d}catch(g){}f.data(a,c,d)}else{d=b}}return d}function h(a){var b=g[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++){b[a[c]]=!0}return b}var c=a.document,d=a.navigator,e=a.location,f=function(){function J(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(J,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,q=/(?:^|:|,)(?:\s*\[)+/g,r=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,t=/(msie) ([\w.]+)/,u=/(mozilla)(?:.*? rv:([\w.]+))?/,v=/-([a-z]|[0-9])/ig,w=/^-ms-/,x=function(a,b){return(b+"").toUpperCase()},y=d.userAgent,z,A,B,C=Object.prototype.toString,D=Object.prototype.hasOwnProperty,E=Array.prototype.push,F=Array.prototype.slice,G=String.prototype.trim,H=Array.prototype.indexOf,I={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a){return this}if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=m.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2]){return f.find(a)}this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return !d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a)){return f.ready(a)}a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.7.2",length:0,size:function(){return this.length},toArray:function(){return F.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?E.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),A.add(a);return this},eq:function(a){a=+a;return a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:E,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++){if((a=arguments[j])!=null){for(c in a){d=i[c],f=a[c];if(i===f){continue}l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}}}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body){return setTimeout(e.ready,1)}e.isReady=!0;if(a!==!0&&--e.readyWait>0){return}A.fireWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").off("ready")}},bindReady:function(){if(!A){A=e.Callbacks("once memory");if(c.readyState==="complete"){return setTimeout(e.ready,1)}if(c.addEventListener){c.addEventListener("DOMContentLoaded",B,!1),a.addEventListener("load",e.ready,!1)}else{if(c.attachEvent){c.attachEvent("onreadystatechange",B),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&J()}}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a!=null&&a==a.window},isNumeric:function(a){return !isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):I[C.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a)){return !1}try{if(a.constructor&&!D.call(a,"constructor")&&!D.call(a.constructor.prototype,"isPrototypeOf")){return !1}}catch(c){return !1}var d;for(d in a){}return d===b||D.call(a,d)},isEmptyObject:function(a){for(var b in a){return !1}return !0},error:function(a){throw new Error(a)},parseJSON:function(b){if(typeof b!="string"||!b){return null}b=e.trim(b);if(a.JSON&&a.JSON.parse){return a.JSON.parse(b)}if(n.test(b.replace(o,"@").replace(p,"]").replace(q,""))){return(new Function("return "+b))()}e.error("Invalid JSON: "+b)},parseXML:function(c){if(typeof c!="string"||!c){return null}var d,f;try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(g){d=b}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);return d},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(w,"ms-").replace(v,x)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a){if(c.apply(a[f],d)===!1){break}}}else{for(;g<h;){if(c.apply(a[g++],d)===!1){break}}}}else{if(i){for(f in a){if(c.call(a[f],f,a[f])===!1){break}}}else{for(;g<h;){if(c.call(a[g],g,a[g++])===!1){break}}}}return a},trim:G?function(a){return a==null?"":G.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?E.call(c,a):e.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(H){return H.call(b,a,c)}d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++){if(c in b&&b[c]===a){return c}}}return -1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number"){for(var f=c.length;e<f;e++){a[d++]=c[e]}}else{while(c[e]!==b){a[d++]=c[e++]}}a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++){e=!!b(a[f],f),c!==e&&d.push(a[f])}return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k){for(;i<j;i++){f=c(a[i],i,d),f!=null&&(h[h.length]=f)}}else{for(g in a){f=c(a[g],g,d),f!=null&&(h[h.length]=f)}}return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a)){return b}var f=F.call(arguments,2),g=function(){return a.apply(c,f.concat(F.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h,i){var j,k=d==null,l=0,m=a.length;if(d&&typeof d=="object"){for(l in d){e.access(a,c,l,d[l],1,h,f)}g=1}else{if(f!==b){j=i===b&&e.isFunction(f),k&&(j?(j=c,c=function(a,b,c){return j.call(e(a),c)}):(c.call(a,f),c=null));if(c){for(;l<m;l++){c(a[l],d,j?f.call(a[l],l,c(a[l],d)):f,i)}}g=1}}return g?a:k?c.call(a):m?c(a[0],d):h},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=r.exec(a)||s.exec(a)||t.exec(a)||a.indexOf("compatible")<0&&u.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){I["[object "+b+"]"]=b.toLowerCase()}),z=e.uaMatch(y),z.browser&&(e.browser[z.browser]=!0,e.browser.version=z.version),e.browser.webkit&&(e.browser.safari=!0),j.test("")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?B=function(){c.removeEventListener("DOMContentLoaded",B,!1),e.ready()}:c.attachEvent&&(B=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",B),e.ready())});return e}(),g={};f.Callbacks=function(a){a=a?g[a]||h(a):{};var c=[],d=[],e,i,j,k,l,m,n=function(b){var d,e,g,h,i;for(d=0,e=b.length;d<e;d++){g=b[d],h=f.type(g),h==="array"?n(g):h==="function"&&(!a.unique||!p.has(g))&&c.push(g)}},o=function(b,f){f=f||[],e=!a.memory||[b,f],i=!0,j=!0,m=k||0,k=0,l=c.length;for(;c&&m<l;m++){if(c[m].apply(b,f)===!1&&a.stopOnFalse){e=!0;break}}j=!1,c&&(a.once?e===!0?p.disable():c=[]:d&&d.length&&(e=d.shift(),p.fireWith(e[0],e[1])))},p={add:function(){if(c){var a=c.length;n(arguments),j?l=c.length:e&&e!==!0&&(k=a,o(e[0],e[1]))}return this},remove:function(){if(c){var b=arguments,d=0,e=b.length;for(;d<e;d++){for(var f=0;f<c.length;f++){if(b[d]===c[f]){j&&f<=l&&(l--,f<=m&&m--),c.splice(f--,1);if(a.unique){break}}}}}return this},has:function(a){if(c){var b=0,d=c.length;for(;b<d;b++){if(a===c[b]){return !0}}}return !1},empty:function(){c=[];return this},disable:function(){c=d=e=b;return this},disabled:function(){return !c},lock:function(){d=b,(!e||e===!0)&&p.disable();return this},locked:function(){return !d},fireWith:function(b,c){d&&(j?a.once||d.push([b,c]):(!a.once||!e)&&o(b,c));return this},fire:function(){p.fireWith(this,arguments);return this},fired:function(){return !!i}};return p};var i=[].slice;f.extend({Deferred:function(a){var b=f.Callbacks("once memory"),c=f.Callbacks("once memory"),d=f.Callbacks("memory"),e="pending",g={resolve:b,reject:c,notify:d},h={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){i.done(a).fail(b).progress(c);return this},always:function(){i.done.apply(i,arguments).fail.apply(i,arguments);return this},pipe:function(a,b,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],g;f.isFunction(c)?i[a](function(){g=c.apply(this,arguments),g&&f.isFunction(g.promise)?g.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===i?d:this,[g])}):i[a](d[e])})}).promise()},promise:function(a){if(a==null){a=h}else{for(var b in h){a[b]=h[b]}}return a}},i=h.promise({}),j;for(j in g){i[j]=g[j].fire,i[j+"With"]=g[j].fireWith}i.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(i,i);return i},when:function(a){function m(a){return function(b){e[a]=arguments.length>1?i.call(arguments,0):b,j.notifyWith(k,e)}}function l(a){return function(c){b[a]=arguments.length>1?i.call(arguments,0):c,--g||j.resolveWith(j,b)}}var b=i.call(arguments,0),c=0,d=b.length,e=Array(d),g=d,h=d,j=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred(),k=j.promise();if(d>1){for(;c<d;c++){b[c]&&b[c].promise&&f.isFunction(b[c].promise)?b[c].promise().then(l(c),j.reject,m(c)):--g}g||j.resolveWith(j,b)}else{j!==a&&j.resolveWith(j,d?[a]:[])}return k}}),f.support=function(){var b,d,e,g,h,i,j,k,l,m,n,o,p=c.createElement("div"),q=c.documentElement;p.setAttribute("className","t"),p.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=p.getElementsByTagName("*"),e=p.getElementsByTagName("a")[0];if(!d||!d.length||!e){return{}}g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=p.getElementsByTagName("input")[0],b={leadingWhitespace:p.firstChild.nodeType===3,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:p.className!=="t",enctype:!!c.createElement("form").enctype,html5Clone:c.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,pixelMargin:!0},f.boxModel=b.boxModel=c.compatMode==="CSS1Compat",i.checked=!0,b.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,b.optDisabled=!h.disabled;try{delete p.test}catch(r){b.deleteExpando=!1}!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent("onclick",function(){b.noCloneEvent=!1}),p.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),b.radioValue=i.value==="t",i.setAttribute("checked","checked"),i.setAttribute("name","t"),p.appendChild(i),j=c.createDocumentFragment(),j.appendChild(p.lastChild),b.checkClone=j.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=i.checked,j.removeChild(i),j.appendChild(p);if(p.attachEvent){for(n in {submit:1,change:1,focusin:1}){m="on"+n,o=m in p,o||(p.setAttribute(m,"return;"),o=typeof p[m]=="function"),b[n+"Bubbles"]=o}}j.removeChild(p),j=g=h=p=i=null,f(function(){var d,e,g,h,i,j,l,m,n,q,r,s,t,u=c.getElementsByTagName("body")[0];!u||(m=1,t="padding:0;margin:0;border:",r="position:absolute;top:0;left:0;width:1px;height:1px;",s=t+"0;visibility:hidden;",n="style='"+r+t+"5px solid #000;",q="<div "+n+"display:block;'><div style='"+t+"0;display:block;overflow:hidden;'></div></div><table "+n+"' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",d=c.createElement("div"),d.style.cssText=s+"width:0;height:0;position:static;top:0;margin-top:"+m+"px",u.insertBefore(d,u.firstChild),p=c.createElement("div"),d.appendChild(p),p.innerHTML="<table><tr><td style='"+t+"0;display:none'></td><td>t</td></tr></table>",k=p.getElementsByTagName("td"),o=k[0].offsetHeight===0,k[0].style.display="",k[1].style.display="none",b.reliableHiddenOffsets=o&&k[0].offsetHeight===0,a.getComputedStyle&&(p.innerHTML="",l=c.createElement("div"),l.style.width="0",l.style.marginRight="0",p.style.width="2px",p.appendChild(l),b.reliableMarginRight=(parseInt((a.getComputedStyle(l,null)||{marginRight:0}).marginRight,10)||0)===0),typeof p.style.zoom!="undefined"&&(p.innerHTML="",p.style.width=p.style.padding="1px",p.style.border=0,p.style.overflow="hidden",p.style.display="inline",p.style.zoom=1,b.inlineBlockNeedsLayout=p.offsetWidth===3,p.style.display="block",p.style.overflow="visible",p.innerHTML="<div style='width:5px;'></div>",b.shrinkWrapBlocks=p.offsetWidth!==3),p.style.cssText=r+s,p.innerHTML=q,e=p.firstChild,g=e.firstChild,i=e.nextSibling.firstChild.firstChild,j={doesNotAddBorder:g.offsetTop!==5,doesAddBorderForTableAndCells:i.offsetTop===5},g.style.position="fixed",g.style.top="20px",j.fixedPosition=g.offsetTop===20||g.offsetTop===15,g.style.position=g.style.top="",e.style.overflow="hidden",e.style.position="relative",j.subtractsBorderForOverflowNotVisible=g.offsetTop===-5,j.doesNotIncludeMarginInBodyOffset=u.offsetTop!==m,a.getComputedStyle&&(p.style.marginTop="1%",b.pixelMargin=(a.getComputedStyle(p,null)||{marginTop:0}).marginTop!=="1%"),typeof d.style.zoom!="undefined"&&(d.style.zoom=1),u.removeChild(d),l=p=d=null,f.extend(b,j))});return b}();var j=/^(?:\{.*\}|\[.*\])$/,k=/([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return !!a&&!m(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i,j=f.expando,k=typeof c=="string",l=a.nodeType,m=l?f.cache:a,n=l?a[j]:a[j]&&j,o=c==="events";if((!n||!m[n]||!o&&!e&&!m[n].data)&&k&&d===b){return}n||(l?a[j]=n=++f.uuid:n=j),m[n]||(m[n]={},l||(m[n].toJSON=f.noop));if(typeof c=="object"||typeof c=="function"){e?m[n]=f.extend(m[n],c):m[n].data=f.extend(m[n].data,c)}g=h=m[n],e||(h.data||(h.data={}),h=h.data),d!==b&&(h[f.camelCase(c)]=d);if(o&&!h[c]){return g.events}k?(i=h[c],i==null&&(i=h[f.camelCase(c)])):i=h;return i}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e,g,h=f.expando,i=a.nodeType,j=i?f.cache:a,k=i?a[h]:h;if(!j[k]){return}if(b){d=c?j[k]:j[k].data;if(d){f.isArray(b)||(b in d?b=[b]:(b=f.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,g=b.length;e<g;e++){delete d[b[e]]}if(!(c?m:f.isEmptyObject)(d)){return}}}if(!c){delete j[k].data;if(!m(j[k])){return}}f.support.deleteExpando||!j.setInterval?delete j[k]:j[k]=null,i&&(f.support.deleteExpando?delete a[h]:a.removeAttribute?a.removeAttribute(h):a[h]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b){return b!==!0&&a.getAttribute("classid")===b}}return !0}}),f.fn.extend({data:function(a,c){var d,e,g,h,i,j=this[0],k=0,m=null;if(a===b){if(this.length){m=f.data(j);if(j.nodeType===1&&!f._data(j,"parsedAttrs")){g=j.attributes;for(i=g.length;k<i;k++){h=g[k].name,h.indexOf("data-")===0&&(h=f.camelCase(h.substring(5)),l(j,h,m[h]))}f._data(j,"parsedAttrs",!0)}}return m}if(typeof a=="object"){return this.each(function(){f.data(this,a)})}d=a.split(".",2),d[1]=d[1]?"."+d[1]:"",e=d[1]+"!";return f.access(this,function(c){if(c===b){m=this.triggerHandler("getData"+e,[d[0]]),m===b&&j&&(m=f.data(j,a),m=l(j,a,m));return m===b&&d[1]?this.data(d[0]):m}d[1]=c,this.each(function(){var b=f(this);b.triggerHandler("setData"+e,d),f.data(this,a,c),b.triggerHandler("changeData"+e,d)})},null,c,arguments.length>1,null,!1)},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",f._data(a,b,(f._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",e=a?0:(f._data(b,d)||1)-1;e?f._data(b,d,e):(f.removeData(b,d,!0),n(b,c,"mark"))}},queue:function(a,b,c){var d;if(a){b=(b||"fx")+"queue",d=f._data(a,b),c&&(!d||f.isArray(c)?d=f._data(a,b,f.makeArray(c)):d.push(c));return d||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),f._data(a,b+".run",e),d.call(a,function(){f.dequeue(a,b)},e)),c.length||(f.removeData(a,b+"queue "+b+".run",!0),n(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){var d=2;typeof a!="string"&&(c=a,a="fx",d--);if(arguments.length<d){return f.queue(this[0],a)}return c===b?this:this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--){if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f.Callbacks("once memory"),!0)){h++,l.add(m)}}m();return d.promise(c)}});var o=/[\n\t\r]/g,p=/\s+/,q=/\r/g,r=/^(?:button|input)$/i,s=/^(?:button|input|object|select|textarea)$/i,t=/^a(?:rea)?$/i,u=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,v=f.support.getSetAttribute,w,x,y;f.fn.extend({attr:function(a,b){return f.access(this,f.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,f.prop,a,b,arguments.length>1)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a)){return this.each(function(b){f(this).addClass(a.call(this,b,this.className))})}if(a&&typeof a=="string"){b=a.split(p);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1){if(!e.className&&b.length===1){e.className=a}else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++){~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ")}e.className=f.trim(g)}}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a)){return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))})}if(a&&typeof a=="string"||a===b){c=(a||"").split(p);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className){if(a){h=(" "+g.className+" ").replace(o," ");for(i=0,j=c.length;i<j;i++){h=h.replace(" "+c[i]+" "," ")}g.className=f.trim(h)}else{g.className=""}}}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a)){return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)})}return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(p);while(e=j[g++]){i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}}else{if(c==="undefined"||c==="boolean"){this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""}}})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++){if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(o," ").indexOf(b)>-1){return !0}}return !1},val:function(a){var c,d,e,g=this[0];if(!!arguments.length){e=f.isFunction(a);return this.each(function(d){var g=f(this),h;if(this.nodeType===1){e?h=a.call(this,d,g.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.type]||f.valHooks[this.nodeName.toLowerCase()];if(!c||!("set" in c)||c.set(this,h,"value")===b){this.value=h}}})}if(g){c=f.valHooks[g.type]||f.valHooks[g.nodeName.toLowerCase()];if(c&&"get" in c&&(d=c.get(g,"value"))!==b){return d}d=g.value;return typeof d=="string"?d.replace(q,""):d==null?"":d}}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return !b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,g=a.selectedIndex,h=[],i=a.options,j=a.type==="select-one";if(g<0){return null}c=j?g:0,d=j?g+1:i.length;for(;c<d;c++){e=i[c];if(e.selected&&(f.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!f.nodeName(e.parentNode,"optgroup"))){b=f(e).val();if(j){return b}h.push(b)}}if(j&&!h.length&&i.length){return f(i[g]).val()}return h},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var g,h,i,j=a.nodeType;if(!!a&&j!==3&&j!==8&&j!==2){if(e&&c in f.attrFn){return f(a)[c](d)}if(typeof a.getAttribute=="undefined"){return f.prop(a,c,d)}i=j!==1||!f.isXMLDoc(a),i&&(c=c.toLowerCase(),h=f.attrHooks[c]||(u.test(c)?x:w));if(d!==b){if(d===null){f.removeAttr(a,c);return}if(h&&"set" in h&&i&&(g=h.set(a,d,c))!==b){return g}a.setAttribute(c,""+d);return d}if(h&&"get" in h&&i&&(g=h.get(a,c))!==null){return g}g=a.getAttribute(c);return g===null?b:g}},removeAttr:function(a,b){var c,d,e,g,h,i=0;if(b&&a.nodeType===1){d=b.toLowerCase().split(p),g=d.length;for(;i<g;i++){e=d[i],e&&(c=f.propFix[e]||e,h=u.test(e),h||f.attr(a,e,""),a.removeAttribute(v?e:c),h&&c in a&&(a[c]=!1))}}},attrHooks:{type:{set:function(a,b){if(r.test(a.nodeName)&&a.parentNode){f.error("type property can't be changed")}else{if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}}},value:{get:function(a,b){if(w&&f.nodeName(a,"button")){return w.get(a,b)}return b in a?a.value:null},set:function(a,b,c){if(w&&f.nodeName(a,"button")){return w.set(a,b,c)}a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){h=i!==1||!f.isXMLDoc(a),h&&(c=f.propFix[c]||c,g=f.propHooks[c]);return d!==b?g&&"set" in g&&(e=g.set(a,d,c))!==b?e:a[c]=d:g&&"get" in g&&(e=g.get(a,c))!==null?e:a[c]}},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):s.test(a.nodeName)||t.test(a.nodeName)&&a.href?0:b}}}}),f.attrHooks.tabindex=f.propHooks.tabIndex,x={get:function(a,c){var d,e=f.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},v||(y={name:!0,id:!0,coords:!0},w=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&(y[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b},set:function(a,b,d){var e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));return e.nodeValue=b+""}},f.attrHooks.tabindex.set=w.set,f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})}),f.attrHooks.contenteditable={get:w.get,set:function(a,b,c){b===""&&(b="false"),w.set(a,b,c)}}),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),f.support.enctype||(f.propFix.enctype="encoding"),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b)){return a.checked=f.inArray(f(a).val(),b)>=0}}})});var z=/^(?:textarea|input|select)$/i,A=/^([^\.]*)?(?:\.(.+))?$/,B=/(?:^|\s)hover(\.\S+)?\b/,C=/^key/,D=/^(?:mouse|contextmenu)|click/,E=/^(?:focusinfocus|focusoutblur)$/,F=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,G=function(a){var b=F.exec(a);b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)"));return b},H=function(a,b){var c=a.attributes||{};return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))},I=function(a){return f.event.special.hover?a:a.replace(B,"mouseenter$1 mouseleave$1")};f.event={add:function(a,c,d,e,g){var h,i,j,k,l,m,n,o,p,q,r,s;if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(h=f._data(a)))){d.handler&&(p=d,d=p.handler,g=p.selector),d.guid||(d.guid=f.guid++),j=h.events,j||(h.events=j={}),i=h.handle,i||(h.handle=i=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.dispatch.apply(i.elem,arguments):b},i.elem=a),c=f.trim(I(c)).split(" ");for(k=0;k<c.length;k++){l=A.exec(c[k])||[],m=l[1],n=(l[2]||"").split(".").sort(),s=f.event.special[m]||{},m=(g?s.delegateType:s.bindType)||m,s=f.event.special[m]||{},o=f.extend({type:m,origType:l[1],data:e,handler:d,guid:d.guid,selector:g,quick:g&&G(g),namespace:n.join(".")},p),r=j[m];if(!r){r=j[m]=[],r.delegateCount=0;if(!s.setup||s.setup.call(a,e,n,i)===!1){a.addEventListener?a.addEventListener(m,i,!1):a.attachEvent&&a.attachEvent("on"+m,i)}}s.add&&(s.add.call(a,o),o.handler.guid||(o.handler.guid=d.guid)),g?r.splice(r.delegateCount++,0,o):r.push(o),f.event.global[m]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var g=f.hasData(a)&&f._data(a),h,i,j,k,l,m,n,o,p,q,r,s;if(!!g&&!!(o=g.events)){b=f.trim(I(b||"")).split(" ");for(h=0;h<b.length;h++){i=A.exec(b[h])||[],j=k=i[1],l=i[2];if(!j){for(j in o){f.event.remove(a,j+b[h],c,d,!0)}continue}p=f.event.special[j]||{},j=(d?p.delegateType:p.bindType)||j,r=o[j]||[],m=r.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(n=0;n<r.length;n++){s=r[n],(e||k===s.origType)&&(!c||c.guid===s.guid)&&(!l||l.test(s.namespace))&&(!d||d===s.selector||d==="**"&&s.selector)&&(r.splice(n--,1),s.selector&&r.delegateCount--,p.remove&&p.remove.call(a,s))}r.length===0&&m!==r.length&&((!p.teardown||p.teardown.call(a,l)===!1)&&f.removeEvent(a,j,g.handle),delete o[j])}f.isEmptyObject(o)&&(q=g.handle,q&&(q.elem=null),f.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){if(!e||e.nodeType!==3&&e.nodeType!==8){var h=c.type||c,i=[],j,k,l,m,n,o,p,q,r,s;if(E.test(h+f.event.triggered)){return}h.indexOf("!")>=0&&(h=h.slice(0,-1),k=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());if((!e||f.event.customEvent[h])&&!f.event.global[h]){return}c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.isTrigger=!0,c.exclusive=k,c.namespace=i.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,o=h.indexOf(":")<0?"on"+h:"";if(!e){j=f.cache;for(l in j){j[l].events&&j[l].events[h]&&f.event.trigger(c,d,j[l].handle.elem,!0)}return}c.result=b,c.target||(c.target=e),d=d!=null?f.makeArray(d):[],d.unshift(c),p=f.event.special[h]||{};if(p.trigger&&p.trigger.apply(e,d)===!1){return}r=[[e,p.bindType||h]];if(!g&&!p.noBubble&&!f.isWindow(e)){s=p.delegateType||h,m=E.test(s+h)?e:e.parentNode,n=null;for(;m;m=m.parentNode){r.push([m,s]),n=m}n&&n===e.ownerDocument&&r.push([n.defaultView||n.parentWindow||a,s])}for(l=0;l<r.length&&!c.isPropagationStopped();l++){m=r[l][0],c.type=r[l][1],q=(f._data(m,"events")||{})[c.type]&&f._data(m,"handle"),q&&q.apply(m,d),q=o&&m[o],q&&f.acceptData(m)&&q.apply(m,d)===!1&&c.preventDefault()}c.type=h,!g&&!c.isDefaultPrevented()&&(!p._default||p._default.apply(e.ownerDocument,d)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)&&o&&e[h]&&(h!=="focus"&&h!=="blur"||c.target.offsetWidth!==0)&&!f.isWindow(e)&&(n=e[o],n&&(e[o]=null),f.event.triggered=h,e[h](),f.event.triggered=b,n&&(e[o]=n));return c.result}},dispatch:function(c){c=f.event.fix(c||a.event);var d=(f._data(this,"events")||{})[c.type]||[],e=d.delegateCount,g=[].slice.call(arguments,0),h=!c.exclusive&&!c.namespace,i=f.event.special[c.type]||{},j=[],k,l,m,n,o,p,q,r,s,t,u;g[0]=c,c.delegateTarget=this;if(!i.preDispatch||i.preDispatch.call(this,c)!==!1){if(e&&(!c.button||c.type!=="click")){n=f(this),n.context=this.ownerDocument||this;for(m=c.target;m!=this;m=m.parentNode||this){if(m.disabled!==!0){p={},r=[],n[0]=m;for(k=0;k<e;k++){s=d[k],t=s.selector,p[t]===b&&(p[t]=s.quick?H(m,s.quick):n.is(t)),p[t]&&r.push(s)}r.length&&j.push({elem:m,matches:r})}}}d.length>e&&j.push({elem:this,matches:d.slice(e)});for(k=0;k<j.length&&!c.isPropagationStopped();k++){q=j[k],c.currentTarget=q.elem;for(l=0;l<q.matches.length&&!c.isImmediatePropagationStopped();l++){s=q.matches[l];if(h||!c.namespace&&!s.namespace||c.namespace_re&&c.namespace_re.test(s.namespace)){c.data=s.data,c.handleObj=s,o=((f.event.special[s.origType]||{}).handle||s.handler).apply(q.elem,g),o!==b&&(c.result=o,o===!1&&(c.preventDefault(),c.stopPropagation()))}}}i.postDispatch&&i.postDispatch.call(this,c);return c.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode);return a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,d){var e,f,g,h=d.button,i=d.fromElement;a.pageX==null&&d.clientX!=null&&(e=a.target.ownerDocument||c,f=e.documentElement,g=e.body,a.pageX=d.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=d.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?d.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0);return a}},fix:function(a){if(a[f.expando]){return a}var d,e,g=a,h=f.event.fixHooks[a.type]||{},i=h.props?this.props.concat(h.props):this.props;a=f.Event(g);for(d=i.length;d;){e=i[--d],a[e]=g[e]}a.target||(a.target=g.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey);return h.filter?h.filter(a,g):a},special:{ready:{setup:f.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=f.extend(new f.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?f.event.trigger(e,null,b):f.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},f.event.handle=f.event.dispatch,f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!(this instanceof f.Event)){return new f.Event(a,b)}a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?K:J):this.type=a,b&&f.extend(this,b),this.timeStamp=a&&a.timeStamp||f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=K;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=K;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K,this.stopPropagation()},isDefaultPrevented:J,isPropagationStopped:J,isImmediatePropagationStopped:J},f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,g=e.selector,h;if(!d||d!==c&&!f.contains(c,d)){a.type=e.origType,h=e.handler.apply(this,arguments),a.type=b}return h}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(){if(f.nodeName(this,"form")){return !1}f.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=f.nodeName(c,"input")||f.nodeName(c,"button")?c.form:b;d&&!d._submit_attached&&(f.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),d._submit_attached=!0)})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&f.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){if(f.nodeName(this,"form")){return !1}f.event.remove(this,"._submit")}}),f.support.changeBubbles||(f.event.special.change={setup:function(){if(z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){f.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),f.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,f.event.simulate("change",this,a,!0))})}return !1}f.event.add(this,"beforeactivate._change",function(a){var b=a.target;z.test(b.nodeName)&&!b._change_attached&&(f.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&f.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox"){return a.handleObj.handler.apply(this,arguments)}},teardown:function(){f.event.remove(this,"._change");return z.test(this.nodeName)}}),f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){var d=0,e=function(a){f.event.simulate(b,a.target,f.event.fix(a),!0)};f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.fn.extend({on:function(a,c,d,e,g){var h,i;if(typeof a=="object"){typeof c!="string"&&(d=d||c,c=b);for(i in a){this.on(i,c,d,a[i],g)}return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1){e=J}else{if(!e){return this}}g===1&&(h=e,e=function(a){f().off(a);return h.apply(this,arguments)},e.guid=h.guid||(h.guid=f.guid++));return this.each(function(){f.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;f(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler);return this}if(typeof a=="object"){for(var g in a){this.off(g,c,a[g])}return this}if(c===!1||typeof c=="function"){d=c,c=b}d===!1&&(d=J);return this.each(function(){f.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){f(this.context).on(a,this.selector,b,c);return this},die:function(a,b){f(this.context).off(a,this.selector||"**",b);return this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0]){return f.event.trigger(a,b,this[0],!0)}},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f._data(this,"lastToggle"+a.guid)||0)%d;f._data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length){b[d++].guid=c}return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.on(b,null,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0),C.test(b)&&(f.event.fixHooks[b]=f.event.keyHooks),D.test(b)&&(f.event.fixHooks[b]=f.event.mouseHooks)}),function(){function x(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}if(j.nodeType===1){g||(j[d]=c,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else{if(m.filter(b,[j]).length>0){k=j;break}}}j=j[a]}e[h]=k}}}function w(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}j.nodeType===1&&!g&&(j[d]=c,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}e[h]=k}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d="sizcache"+(Math.random()+"").replace(".",""),e=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;[0,0].sort(function(){i=!1;return 0});var m=function(b,d,e,f){e=e||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9){return[]}if(!b||typeof b!="string"){return e}var i,j,k,l,n,q,r,t,u=!0,v=m.isXML(d),w=[],x=b;do{a.exec(""),i=a.exec(x);if(i){x=i[3],w.push(i[1]);if(i[2]){l=i[3];break}}}while(i);if(w.length>1&&p.exec(b)){if(w.length===2&&o.relative[w[0]]){j=y(w[0]+w[1],d,f)}else{j=o.relative[w[0]]?[d]:m(w.shift(),d);while(w.length){b=w.shift(),o.relative[b]&&(b+=w.shift()),j=y(b,j,f)}}}else{!f&&w.length>1&&d.nodeType===9&&!v&&o.match.ID.test(w[0])&&!o.match.ID.test(w[w.length-1])&&(n=m.find(w.shift(),d,v),d=n.expr?m.filter(n.expr,n.set)[0]:n.set[0]);if(d){n=f?{expr:w.pop(),set:s(f)}:m.find(w.pop(),w.length===1&&(w[0]==="~"||w[0]==="+")&&d.parentNode?d.parentNode:d,v),j=n.expr?m.filter(n.expr,n.set):n.set,w.length>0?k=s(j):u=!1;while(w.length){q=w.pop(),r=q,o.relative[q]?r=w.pop():q="",r==null&&(r=d),o.relative[q](k,r,v)}}else{k=w=[]}}k||(k=j),k||m.error(q||b);if(g.call(k)==="[object Array]"){if(!u){e.push.apply(e,k)}else{if(d&&d.nodeType===1){for(t=0;k[t]!=null;t++){k[t]&&(k[t]===!0||k[t].nodeType===1&&m.contains(d,k[t]))&&e.push(j[t])}}else{for(t=0;k[t]!=null;t++){k[t]&&k[t].nodeType===1&&e.push(j[t])}}}}else{s(k,e)}l&&(m(l,h,e,f),m.uniqueSort(e));return e};m.uniqueSort=function(a){if(u){h=i,a.sort(u);if(h){for(var b=1;b<a.length;b++){a[b]===a[b-1]&&a.splice(b--,1)}}}return a},m.matches=function(a,b){return m(a,null,null,b)},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0},m.find=function(a,b,c){var d,e,f,g,h,i;if(!a){return[]}for(e=0,f=o.order.length;e<f;e++){h=o.order[e];if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);if(d!=null){a=a.replace(o.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);while(a&&c.length){for(h in o.filter){if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);if(l.substr(l.length-1)==="\\"){continue}s===r&&(r=[]);if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);if(!f){g=i=!0}else{if(f===!0){continue}}}if(f){for(n=0;(j=s[n])!=null;n++){j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0))}}if(i!==b){d||(s=r),a=a.replace(o.match[h],"");if(!g){return[]}break}}}if(a===q){if(g==null){m.error(a)}else{break}}q=a}return s},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var n=m.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9||d===11){if(typeof a.textContent=="string"){return a.textContent}if(typeof a.innerText=="string"){return a.innerText.replace(k,"")}for(a=a.firstChild;a;a=a.nextSibling){e+=n(a)}}else{if(d===3||d===4){return a.nodeValue}}}else{for(b=0;c=a[b];b++){c.nodeType!==8&&(e+=n(c))}}return e},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++){if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1){}a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}}e&&m.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!l.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++){c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b)}d&&m.filter(b,a,!0)}},"":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("parentNode",b,f,a,d,c)},"~":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("previousSibling",b,f,a,d,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++){d[e].getAttribute("name")===a[1]&&c.push(d[e])}return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined"){return b.getElementsByTagName(a[1])}}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";if(f){return a}for(var g=0,h;(h=b[g])!=null;g++){h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1))}return !1},ID:function(a){return a[1].replace(j,"")},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else{a[2]&&m.error(a[0])}a[0]=e++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not"){if((a.exec(b[3])||"").length>1||/^\w/.test(b[3])){b[3]=m(b[3],null,null,c)}else{var g=m.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return !1}}else{if(o.match.POS.test(b[0])||o.match.CHILD.test(b[0])){return !0}}return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return !!a.firstChild},empty:function(a){return !a.firstChild},has:function(a,b,c){return !!m(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];if(f){return f(a,c,b,d)}if(e==="contains"){return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0}if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++){if(g[h]===a){return !1}}return !0}m.error(e)},CHILD:function(a,b){var c,e,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling){if(l.nodeType===1){return !1}}if(k==="first"){return !0}l=a;case"last":while(l=l.nextSibling){if(l.nodeType===1){return !1}}return !0;case"nth":c=b[2],e=b[3];if(c===1&&e===0){return !0}f=b[0],g=a.parentNode;if(g&&(g[d]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling){l.nodeType===1&&(l.nodeIndex=++i)}g[d]=f}j=a.nodeIndex-e;return c===0?j===0:j%c===0&&j/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];if(f){return f(a,c,b,d)}}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)};for(var r in o.match){o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q))}o.match.globalPOS=p;var s=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(t){s=function(a,b){var c=0,d=b||[];if(g.call(a)==="[object Array]"){Array.prototype.push.apply(d,a)}else{if(typeof a.length=="number"){for(var e=a.length;c<e;c++){d.push(a[c])}}else{for(;a[c];c++){d.push(a[c])}}}return d}}var u,v;c.documentElement.compareDocumentPosition?u=function(a,b){if(a===b){h=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition){return a.compareDocumentPosition?-1:1}return a.compareDocumentPosition(b)&4?-1:1}:(u=function(a,b){if(a===b){h=!0;return 0}if(a.sourceIndex&&b.sourceIndex){return a.sourceIndex-b.sourceIndex}var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;if(g===i){return v(a,b)}if(!g){return -1}if(!i){return 1}while(j){e.unshift(j),j=j.parentNode}j=i;while(j){f.unshift(j),j=j.parentNode}c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++){if(e[k]!==f[k]){return v(e[k],f[k])}}return k===c?v(a,f[k],-1):v(e[k],b,1)},v=function(a,b,c){if(a===b){return c}var d=a.nextSibling;while(d){if(d===b){return -1}d=d.nextSibling}return 1}),function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++){c[e].nodeType===1&&d.push(c[e])}c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=m,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,e,f,g){e=e||c;if(!g&&!m.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1]){return s(e.getElementsByTagName(b),f)}if(h[2]&&o.find.CLASS&&e.getElementsByClassName){return s(e.getElementsByClassName(h[2]),f)}}if(e.nodeType===9){if(b==="body"&&e.body){return s([e.body],f)}if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode){return s([],f)}if(i.id===h[3]){return s([i],f)}}try{return s(e.querySelectorAll(b),f)}catch(j){}}else{if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var k=e,l=e.getAttribute("id"),n=l||d,p=e.parentNode,q=/^\s*[+~]/.test(b);l?n=n.replace(/'/g,"\\$&"):e.setAttribute("id",n),q&&p&&(e=e.parentNode);try{if(!q||p){return s(e.querySelectorAll("[id='"+n+"'] "+b),f)}}catch(r){}finally{l||k.removeAttribute("id")}}}}return a(b,e,f,g)};for(var e in a){m[e]=a[e]}b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}m.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!m.isXML(a)){try{if(e||!o.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11){return f}}}catch(g){}}return m(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1){return}o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c){return b.getElementsByClassName(a[1])}},a=null}}(),c.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?m.contains=function(a,b){return !!(a.compareDocumentPosition(b)&16)}:m.contains=function(){return !1},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var y=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=o.match.PSEUDO.exec(a)){f+=d[0],a=a.replace(o.match.PSEUDO,"")}a=o.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++){m(a,g[h],e,c)}return m.filter(f,e)};m.attr=f.attr,m.selectors.attrMap={},f.find=m,f.expr=m.selectors,f.expr[":"]=f.expr.filters,f.unique=m.uniqueSort,f.text=m.getText,f.isXMLDoc=m.isXML,f.contains=m.contains}();var L=/Until$/,M=/^(?:parents|prevUntil|prevAll)/,N=/,/,O=/^.[^:#\[\.,]*$/,P=Array.prototype.slice,Q=f.expr.match.globalPOS,R={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string"){return f(a).filter(function(){for(c=0,d=b.length;c<d;c++){if(f.contains(b[c],this)){return !0}}})}var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0){for(h=g;h<e.length;h++){for(i=0;i<g;i++){if(e[i]===e[h]){e.splice(h--,1);break}}}}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++){if(f.contains(this,b[a])){return !0}}})},not:function(a){return this.pushStack(T(this,a,!1),"not",a)},filter:function(a){return this.pushStack(T(this,a,!0),"filter",a)},is:function(a){return !!a&&(typeof a=="string"?Q.test(a)?f(a,this.context).index(this[0])>=0:f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h=1;while(g&&g.ownerDocument&&g!==b){for(d=0;d<a.length;d++){f(g).is(a[d])&&c.push({selector:a[d],elem:g,level:h})}g=g.parentNode,h++}return c}var i=Q.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(i?i.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11){break}}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a){return this[0]&&this[0].parentNode?this.prevAll().length:-1}if(typeof a=="string"){return f.inArray(this[0],f(a))}return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(S(c[0])||S(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c);L.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!R[a]?f.unique(e):e,(this.length>1||N.test(d))&&M.test(a)&&(e=e.reverse());return this.pushStack(e,a,P.call(arguments).join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d))){g.nodeType===1&&e.push(g),g=g[c]}return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c]){if(a.nodeType===1&&++e===b){break}}return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling){a.nodeType===1&&a!==b&&c.push(a)}return c}});var V="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|style)/i,bb=/<(?:script|object|embed|option|style)/i,bc=new RegExp("<(?:"+V+")[\\s/>]","i"),bd=/checked\s*(?:[^=]|=\s*.checked.)/i,be=/\/(java|ecma)script/i,bf=/^\s*<!(?:\[CDATA\[|\-\-)/,bg={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bh=U(c);bg.optgroup=bg.option,bg.tbody=bg.tfoot=bg.colgroup=bg.caption=bg.thead,bg.th=bg.td,f.support.htmlSerialize||(bg._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){return f.access(this,function(a){return a===b?f.text(this):this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if(f.isFunction(a)){return this.each(function(b){f(this).wrapAll(a.call(this,b))})}if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1){a=a.firstChild}return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a)){return this.each(function(b){f(this).wrapInner(a.call(this,b))})}return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=f.isFunction(a);return this.each(function(c){f(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)})}if(arguments.length){var a=f.clean(arguments);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)})}if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f.clean(arguments));return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++){if(!a||f.filter(a,[d]).length){!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d)}}return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild){b.removeChild(b.firstChild)}}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){return f.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b){return c.nodeType===1?c.innerHTML.replace(W,""):null}if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!bg[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");try{for(;d<e;d++){c=this[d]||{},c.nodeType===1&&(f.cleanData(c.getElementsByTagName("*")),c.innerHTML=a)}c=0}catch(g){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a)){return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))})}typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bd.test(j)){return this.each(function(){f(this).domManip(a,c,d,!0)})}if(f.isFunction(j)){return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)})}if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++){d.call(c?bi(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}}k.length&&f.each(k,function(a,b){b.src?f.ajax({type:"GET",global:!1,url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bf,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)})}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i,j=a[0];b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof j=="string"&&j.length<512&&i===c&&j.charAt(0)==="<"&&!bb.test(j)&&(f.support.checkClone||!bd.test(j))&&(f.support.html5Clone||!bc.test(j))&&(g=!0,h=f.fragments[j],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[j]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d,e,g,h=f.support.html5Clone||f.isXMLDoc(a)||!bc.test("<"+a.nodeName+">")?a.cloneNode(!0):bo(a);if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bk(a,h),d=bl(a),e=bl(h);for(g=0;d[g];++g){e[g]&&bk(d[g],e[g])}}if(b){bj(a,h);if(c){d=bl(a),e=bl(h);for(g=0;d[g];++g){bj(d[g],e[g])}}}d=e=null;return h},clean:function(a,b,d,e){var g,h,i,j=[];b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);for(var k=0,l;(l=a[k])!=null;k++){typeof l=="number"&&(l+="");if(!l){continue}if(typeof l=="string"){if(!_.test(l)){l=b.createTextNode(l)}else{l=l.replace(Y,"<$1></$2>");var m=(Z.exec(l)||["",""])[1].toLowerCase(),n=bg[m]||bg._default,o=n[0],p=b.createElement("div"),q=bh.childNodes,r;b===c?bh.appendChild(p):U(b).appendChild(p),p.innerHTML=n[1]+l+n[2];while(o--){p=p.lastChild}if(!f.support.tbody){var s=$.test(l),t=m==="table"&&!s?p.firstChild&&p.firstChild.childNodes:n[1]==="<table>"&&!s?p.childNodes:[];for(i=t.length-1;i>=0;--i){f.nodeName(t[i],"tbody")&&!t[i].childNodes.length&&t[i].parentNode.removeChild(t[i])}}!f.support.leadingWhitespace&&X.test(l)&&p.insertBefore(b.createTextNode(X.exec(l)[0]),p.firstChild),l=p.childNodes,p&&(p.parentNode.removeChild(p),q.length>0&&(r=q[q.length-1],r&&r.parentNode&&r.parentNode.removeChild(r)))}}var u;if(!f.support.appendChecked){if(l[0]&&typeof(u=l.length)=="number"){for(i=0;i<u;i++){bn(l[i])}}else{bn(l)}}l.nodeType?j.push(l):j=f.merge(j,l)}if(d){g=function(a){return !a.type||be.test(a.type)};for(k=0;j[k];k++){h=j[k];if(e&&f.nodeName(h,"script")&&(!h.type||be.test(h.type))){e.push(h.parentNode?h.parentNode.removeChild(h):h)}else{if(h.nodeType===1){var v=f.grep(h.getElementsByTagName("script"),g);j.splice.apply(j,[k+1,0].concat(v))}d.appendChild(h)}}}return j},cleanData:function(a){var b,c,d=f.cache,e=f.event.special,g=f.support.deleteExpando;for(var h=0,i;(i=a[h])!=null;h++){if(i.nodeName&&f.noData[i.nodeName.toLowerCase()]){continue}c=i[f.expando];if(c){b=d[c];if(b&&b.events){for(var j in b.events){e[j]?f.event.remove(i,j):f.removeEvent(i,j,b.handle)}b.handle&&(b.handle.elem=null)}g?delete i[f.expando]:i.removeAttribute&&i.removeAttribute(f.expando),delete d[c]}}}});var bp=/alpha\([^)]*\)/i,bq=/opacity=([^)]*)/,br=/([A-Z]|^ms)/g,bs=/^[\-+]?(?:\d*\.)?\d+$/i,bt=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,bu=/^([\-+])=([\-+.\de]+)/,bv=/^margin/,bw={position:"absolute",visibility:"hidden",display:"block"},bx=["Top","Right","Bottom","Left"],by,bz,bA;f.fn.css=function(a,c){return f.access(this,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)},a,c,arguments.length>1)},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=by(a,"opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get" in k&&(g=k.get(a,!1,e))!==b){return g}return j[c]}h=typeof d,h==="string"&&(g=bu.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");if(d==null||h==="number"&&isNaN(d)){return}h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set" in k)||(d=k.set(a,d))!==b){try{j[c]=d}catch(l){}}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get" in g&&(e=g.get(a,!0,d))!==b){return e}if(by){return by(a,c)}},swap:function(a,b,c){var d={},e,f;for(f in b){d[f]=a.style[f],a.style[f]=b[f]}e=c.call(a);for(f in b){a.style[f]=d[f]}return e}}),f.curCSS=f.css,c.defaultView&&c.defaultView.getComputedStyle&&(bz=function(a,b){var c,d,e,g,h=a.style;b=b.replace(br,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!f.contains(a.ownerDocument.documentElement,a)&&(c=f.style(a,b))),!f.support.pixelMargin&&e&&bv.test(b)&&bt.test(c)&&(g=h.width,h.width=c,c=e.width,h.width=g);return c}),c.documentElement.currentStyle&&(bA=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;f==null&&g&&(e=g[b])&&(f=e),bt.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d));return f===""?"auto":f}),by=bz||bA,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){if(c){return a.offsetWidth!==0?bB(a,b,d):f.swap(a,bw,function(){return bB(a,b,d)})}},set:function(a,b){return bs.test(b)?b+"px":b}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return bq.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNumeric(b)?"alpha(opacity="+b*100+")":"",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&f.trim(g.replace(bp,""))===""){c.removeAttribute("filter");if(d&&!d.filter){return}}c.filter=bp.test(g)?g.replace(bp,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){return f.swap(a,{display:"inline-block"},function(){return b?by(a,"margin-right"):a.style.marginRight})}})}),f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style&&a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return !f.expr.filters.hidden(a)}),f.each({margin:"",padding:"",border:"Width"},function(a,b){f.cssHooks[a+b]={expand:function(c){var d,e=typeof c=="string"?c.split(" "):[c],f={};for(d=0;d<4;d++){f[a+bx[d]+b]=e[d]||e[d-2]||e[0]}return f}}});var bC=/%20/g,bD=/\[\]$/,bE=/\r?\n/g,bF=/#.*$/,bG=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bH=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bI=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bJ=/^(?:GET|HEAD)$/,bK=/^\/\//,bL=/\?/,bM=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bN=/^(?:select|textarea)/i,bO=/\s+/,bP=/([?&])_=[^&]*/,bQ=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bR=f.fn.load,bS={},bT={},bU,bV,bW=["*/"]+["*"];try{bU=e.href}catch(bX){bU=c.createElement("a"),bU.href="",bU=bU.href}bV=bQ.exec(bU.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bR){return bR.apply(this,arguments)}if(!this.length){return this}var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bM,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bN.test(this.nodeName)||bH.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bE,"\r\n")}}):{name:b.name,value:c.replace(bE,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.on(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?b$(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),b$(a,b);return a},ajaxSettings:{url:bU,isLocal:bI.test(bV[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bW},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bY(bS),ajaxTransport:bY(bT),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;var o,r,u,w=c,x=l?ca(d,v,l):b,y,z;if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified")){f.lastModified[k]=y}if(z=v.getResponseHeader("Etag")){f.etag[k]=z}}if(a===304){w="notmodified",o=!0}else{try{r=cb(d,x),w="success",o=!0}catch(A){w="parsererror",u=A}}}else{u=w;if(!w||a){w="error",a<0&&(a=0)}}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.fireWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f.Callbacks("once memory"),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bG.exec(n)){o[c[1].toLowerCase()]=c[2]}}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.add,v.statusCode=function(a){if(a){var b;if(s<2){for(b in a){j[b]=[j[b],a[b]]}}else{b=a[v.status],v.then(b,b)}}return this},d.url=((a||d.url)+"").replace(bF,"").replace(bK,bV[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bO),d.crossDomain==null&&(r=bQ.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bV[1]&&r[2]==bV[2]&&(r[3]||(r[1]==="http:"?80:443))==(bV[3]||(bV[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),bZ(bS,d,c,v);if(s===2){return !1}t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bJ.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bL.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bP,"$1_="+x);d.url=y+(y===d.url?(bL.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bW+"; q=0.01":""):d.accepts["*"]);for(u in d.headers){v.setRequestHeader(u,d.headers[u])}if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return !1}for(u in {success:1,error:1,complete:1}){v[u](d[u])}p=bZ(bT,d,c,v);if(!p){w(-1,"No Transport")}else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){if(s<2){w(-1,z)}else{throw z}}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a)){f.each(a,function(){e(this.name,this.value)})}else{for(var g in a){b_(g,a[g],c,e)}}return d.join("&").replace(bC,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var cc=f.now(),cd=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+cc++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=typeof b.data=="string"&&/^application\/x\-www\-form\-urlencoded/.test(b.contentType);if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(cd.test(b.url)||e&&cd.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(cd,l),b.url===j&&(e&&(k=k.replace(cd,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState)){d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")}},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var ce=a.ActiveXObject?function(){for(var a in cg){cg[a](0,1)}}:!1,cf=0,cg;f.ajaxSettings.xhr=a.ActiveXObject?function(){return !this.isLocal&&ch()||ci()}:ch,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials" in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields){for(j in c.xhrFields){h[j]=c.xhrFields[j]}}c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e){h.setRequestHeader(j,e[j])}}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,ce&&delete cg[i]);if(e){h.readyState!==4&&h.abort()}else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n);try{m.text=h.responseText}catch(a){}try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cf,ce&&(cg||(cg={},f(a).unload(ce)),cg[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var cj={},ck,cl,cm=/^(?:toggle|show|hide)$/,cn=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,co,cp=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cq;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0){return this.animate(ct("show",3),a,b,c)}for(var g=0,h=this.length;g<h;g++){d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),(e===""&&f.css(d,"display")==="none"||!f.contains(d.ownerDocument.documentElement,d))&&f._data(d,"olddisplay",cu(d.nodeName)))}for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none"){d.style.display=f._data(d,"olddisplay")||""}}}return this},hide:function(a,b,c){if(a||a===0){return this.animate(ct("hide",3),a,b,c)}var d,e,g=0,h=this.length;for(;g<h;g++){d=this[g],d.style&&(e=f.css(d,"display"),e!=="none"&&!f._data(d,"olddisplay")&&f._data(d,"olddisplay",e))}for(g=0;g<h;g++){this[g].style&&(this[g].style.display="none")}return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(ct("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){function g(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o,p,q;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]);if((k=f.cssHooks[g])&&"expand" in k){l=k.expand(a[g]),delete a[g];for(i in l){i in a||(a[i]=l[i])}}}for(g in a){h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d){return b.complete.call(this)}c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(!f.support.inlineBlockNeedsLayout||cu(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a){j=new f.fx(this,b,i),h=a[i],cm.test(h)?(q=f._data(this,"toggle"+i)||(h==="toggle"?d?"show":"hide":0),q?(f._data(this,"toggle"+i,q==="show"?"hide":"show"),j[q]()):j[h]()):(m=cn.exec(h),n=j.cur(),m?(o=parseFloat(m[2]),p=m[3]||(f.cssNumber[i]?"":"px"),p!=="px"&&(f.style(this,i,(o||1)+p),n=(o||1)/j.cur()*n,f.style(this,i,n+p)),m[1]&&(o=(m[1]==="-="?-1:1)*o+n),j.custom(n,o,p)):j.custom(n,h,""))}return !0}var e=f.speed(b,c,d);if(f.isEmptyObject(a)){return this.each(e.complete,[!1])}a=f.extend({},a);return e.queue===!1?this.each(g):this.queue(e.queue,g)},stop:function(a,c,d){typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]);return this.each(function(){function h(a,b,c){var e=b[c];f.removeData(a,c,!0),e.stop(d)}var b,c=!1,e=f.timers,g=f._data(this);d||f._unmark(!0,this);if(a==null){for(b in g){g[b]&&g[b].stop&&b.indexOf(".run")===b.length-4&&h(this,g,b)}}else{g[b=a+".run"]&&g[b].stop&&h(this,g,b)}for(b=e.length;b--;){e[b].elem===this&&(a==null||e[b].queue===a)&&(d?e[b](!0):e[b].saveState(),c=!0,e.splice(b,1))}(!d||!c)&&f.dequeue(this,a)})}}),f.each({slideDown:ct("show",1),slideUp:ct("hide",1),slideToggle:ct("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default;if(d.queue==null||d.queue===!0){d.queue="fx"}d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue?f.dequeue(this,d.queue):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a){return a},swing:function(a){return -Math.cos(a*Math.PI)/2+0.5}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,c,d){function h(a){return e.step(a)}var e=this,g=f.fx;this.startTime=cq||cr(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(f.cssNumber[this.prop]?"":"px"),h.queue=this.options.queue,h.elem=this.elem,h.saveState=function(){f._data(e.elem,"fxshow"+e.prop)===b&&(e.options.hide?f._data(e.elem,"fxshow"+e.prop,e.start):e.options.show&&f._data(e.elem,"fxshow"+e.prop,e.end))},h()&&f.timers.push(h)&&!co&&(co=setInterval(g.tick,g.interval))},show:function(){var a=f._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||f.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f._data(this.elem,"fxshow"+this.prop)||f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,e=cq||cr(),g=!0,h=this.elem,i=this.options;if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties){i.animatedProperties[b]!==!0&&(g=!1)}if(g){i.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&f(h).hide();if(i.hide||i.show){for(b in i.animatedProperties){f.style(h,b,i.orig[b]),f.removeData(h,"fxshow"+b,!0),f.removeData(h,"toggle"+b,!0)}}d=i.complete,d&&(i.complete=!1,d.call(h))}return !1}i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=f.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return !0}},f.extend(f.fx,{tick:function(){var a,b=f.timers,c=0;for(;c<b.length;c++){a=b[c],!a()&&b[c]===a&&b.splice(c--,1)}b.length||f.fx.stop()},interval:13,stop:function(){clearInterval(co),co=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),f.each(cp.concat.apply([],cp),function(a,b){b.indexOf("margin")&&(f.fx.step[b]=function(a){f.style(a.elem,b,Math.max(0,a.now)+a.unit)})}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cv,cw=/^t(?:able|d|h)$/i,cx=/^(?:body|html)$/i;"getBoundingClientRect" in c.documentElement?cv=function(a,b,c,d){try{d=a.getBoundingClientRect()}catch(e){}if(!d||!f.contains(c,a)){return d?{top:d.top,left:d.left}:{top:0,left:0}}var g=b.body,h=cy(b),i=c.clientTop||g.clientTop||0,j=c.clientLeft||g.clientLeft||0,k=h.pageYOffset||f.support.boxModel&&c.scrollTop||g.scrollTop,l=h.pageXOffset||f.support.boxModel&&c.scrollLeft||g.scrollLeft,m=d.top+k-i,n=d.left+l-j;return{top:m,left:n}}:cv=function(a,b,c){var d,e=a.offsetParent,g=a,h=b.body,i=b.defaultView,j=i?i.getComputedStyle(a,null):a.currentStyle,k=a.offsetTop,l=a.offsetLeft;while((a=a.parentNode)&&a!==h&&a!==c){if(f.support.fixedPosition&&j.position==="fixed"){break}d=i?i.getComputedStyle(a,null):a.currentStyle,k-=a.scrollTop,l-=a.scrollLeft,a===e&&(k+=a.offsetTop,l+=a.offsetLeft,f.support.doesNotAddBorder&&(!f.support.doesAddBorderForTableAndCells||!cw.test(a.nodeName))&&(k+=parseFloat(d.borderTopWidth)||0,l+=parseFloat(d.borderLeftWidth)||0),g=e,e=a.offsetParent),f.support.subtractsBorderForOverflowNotVisible&&d.overflow!=="visible"&&(k+=parseFloat(d.borderTopWidth)||0,l+=parseFloat(d.borderLeftWidth)||0),j=d}if(j.position==="relative"||j.position==="static"){k+=h.offsetTop,l+=h.offsetLeft}f.support.fixedPosition&&j.position==="fixed"&&(k+=Math.max(c.scrollTop,h.scrollTop),l+=Math.max(c.scrollLeft,h.scrollLeft));return{top:k,left:l}},f.fn.offset=function(a){if(arguments.length){return a===b?this:this.each(function(b){f.offset.setOffset(this,a,b)})}var c=this[0],d=c&&c.ownerDocument;if(!d){return null}if(c===d.body){return f.offset.bodyOffset(c)}return cv(c,d,d.documentElement)},f.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using" in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0]){return null}var a=this[0],b=this.offsetParent(),c=this.offset(),d=cx.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!cx.test(a.nodeName)&&f.css(a,"position")==="static"){a=a.offsetParent}return a})}}),f.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);f.fn[a]=function(e){return f.access(this,function(a,e,g){var h=cy(a);if(g===b){return h?c in h?h[c]:f.support.boxModel&&h.document.documentElement[e]||h.document.body[e]:a[e]}h?h.scrollTo(d?f(h).scrollLeft():g,d?g:f(h).scrollTop()):a[e]=g},a,e,arguments.length,null)}}),f.each({Height:"height",Width:"width"},function(a,c){var d="client"+a,e="scroll"+a,g="offset"+a;f.fn["inner"+a]=function(){var a=this[0];return a?a.style?parseFloat(f.css(a,c,"padding")):this[c]():null},f.fn["outer"+a]=function(a){var b=this[0];return b?b.style?parseFloat(f.css(b,c,a?"margin":"border")):this[c]():null},f.fn[c]=function(a){return f.access(this,function(a,c,h){var i,j,k,l;if(f.isWindow(a)){i=a.document,j=i.documentElement[d];return f.support.boxModel&&j||i.body&&i.body[d]||j}if(a.nodeType===9){i=a.documentElement;if(i[d]>=i[e]){return i[d]}return Math.max(a.body[e],i[e],a.body[g],i[g])}if(h===b){k=f.css(a,c),l=parseFloat(k);return f.isNumeric(l)?l:k}f(a).css(c,h)},c,a,arguments.length,null)}}),a.jQuery=a.$=f,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return f})})(window);jQuery.noConflict();
/*	SWFObject v2.2 <http://code.google.com/p/swfobject/> 
	is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
var swfobject=function(){var E="undefined",s="object",U="Shockwave Flash",Y="ShockwaveFlash.ShockwaveFlash",r="application/x-shockwave-flash",S="SWFObjectExprInst",y="onreadystatechange",P=window,k=document,u=navigator,V=false,W=[h],p=[],O=[],J=[],m,R,F,C,K=false,a=false,o,H,n=true,N=function(){var ac=typeof k.getElementById!=E&&typeof k.getElementsByTagName!=E&&typeof k.createElement!=E,aj=u.userAgent.toLowerCase(),aa=u.platform.toLowerCase(),ag=aa?/win/.test(aa):/win/.test(aj),ae=aa?/mac/.test(aa):/mac/.test(aj),ah=/webkit/.test(aj)?parseFloat(aj.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,Z=!+"\v1",ai=[0,0,0],ad=null;if(typeof u.plugins!=E&&typeof u.plugins[U]==s){ad=u.plugins[U].description;if(ad&&!(typeof u.mimeTypes!=E&&u.mimeTypes[r]&&!u.mimeTypes[r].enabledPlugin)){V=true;Z=false;ad=ad.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ai[0]=parseInt(ad.replace(/^(.*)\..*$/,"$1"),10);ai[1]=parseInt(ad.replace(/^.*\.(.*)\s.*$/,"$1"),10);ai[2]=/[a-zA-Z]/.test(ad)?parseInt(ad.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof P.ActiveXObject!=E){try{var af=new ActiveXObject(Y);if(af){ad=af.GetVariable("$version");if(ad){Z=true;ad=ad.split(" ")[1].split(",");ai=[parseInt(ad[0],10),parseInt(ad[1],10),parseInt(ad[2],10)]}}}catch(ab){}}}return{w3:ac,pv:ai,wk:ah,ie:Z,win:ag,mac:ae}}(),l=function(){if(!N.w3){return}if((typeof k.readyState!=E&&k.readyState=="complete")||(typeof k.readyState==E&&(k.getElementsByTagName("body")[0]||k.body))){f()}if(!K){if(typeof k.addEventListener!=E){k.addEventListener("DOMContentLoaded",f,false)}if(N.ie&&N.win){k.attachEvent(y,function(){if(k.readyState=="complete"){k.detachEvent(y,arguments.callee);f()}});if(P==top){(function(){if(K){return}try{k.documentElement.doScroll("left")}catch(Z){setTimeout(arguments.callee,0);return}f()})()}}if(N.wk){(function(){if(K){return}if(!/loaded|complete/.test(k.readyState)){setTimeout(arguments.callee,0);return}f()})()}t(f)}}();function f(){if(K){return}try{var ab=k.getElementsByTagName("body")[0].appendChild(D("span"));ab.parentNode.removeChild(ab)}catch(ac){return}K=true;var Z=W.length;for(var aa=0;aa<Z;aa++){W[aa]()}}function L(Z){if(K){Z()}else{W[W.length]=Z}}function t(aa){if(typeof P.addEventListener!=E){P.addEventListener("load",aa,false)}else{if(typeof k.addEventListener!=E){k.addEventListener("load",aa,false)}else{if(typeof P.attachEvent!=E){j(P,"onload",aa)}else{if(typeof P.onload=="function"){var Z=P.onload;P.onload=function(){Z();aa()}}else{P.onload=aa}}}}}function h(){if(V){X()}else{I()}}function X(){var Z=k.getElementsByTagName("body")[0];var ac=D(s);ac.setAttribute("type",r);var ab=Z.appendChild(ac);if(ab){var aa=0;(function(){if(typeof ab.GetVariable!=E){var ad=ab.GetVariable("$version");if(ad){ad=ad.split(" ")[1].split(",");N.pv=[parseInt(ad[0],10),parseInt(ad[1],10),parseInt(ad[2],10)]}}else{if(aa<10){aa++;setTimeout(arguments.callee,10);return}}Z.removeChild(ac);ab=null;I()})()}else{I()}}function I(){var ai=p.length;if(ai>0){for(var ah=0;ah<ai;ah++){var aa=p[ah].id;var ad=p[ah].callbackFn;var ac={success:false,id:aa};if(N.pv[0]>0){var ag=c(aa);if(ag){if(G(p[ah].swfVersion)&&!(N.wk&&N.wk<312)){x(aa,true);if(ad){ac.success=true;ac.ref=A(aa);ad(ac)}}else{if(p[ah].expressInstall&&B()){var ak={};ak.data=p[ah].expressInstall;ak.width=ag.getAttribute("width")||"0";ak.height=ag.getAttribute("height")||"0";if(ag.getAttribute("class")){ak.styleclass=ag.getAttribute("class")}if(ag.getAttribute("align")){ak.align=ag.getAttribute("align")}var aj={};var Z=ag.getElementsByTagName("param");var ae=Z.length;for(var af=0;af<ae;af++){if(Z[af].getAttribute("name").toLowerCase()!="movie"){aj[Z[af].getAttribute("name")]=Z[af].getAttribute("value")}}Q(ak,aj,aa,ad)}else{q(ag);if(ad){ad(ac)}}}}}else{x(aa,true);if(ad){var ab=A(aa);if(ab&&typeof ab.SetVariable!=E){ac.success=true;ac.ref=ab}ad(ac)}}}}}function A(ac){var Z=null;var aa=c(ac);if(aa&&aa.nodeName=="OBJECT"){if(typeof aa.SetVariable!=E){Z=aa}else{var ab=aa.getElementsByTagName(s)[0];if(ab){Z=ab}}}return Z}function B(){return !a&&G("6.0.65")&&(N.win||N.mac)&&!(N.wk&&N.wk<312)}function Q(ac,ad,Z,ab){a=true;F=ab||null;C={success:false,id:Z};var ag=c(Z);if(ag){if(ag.nodeName=="OBJECT"){m=g(ag);R=null}else{m=ag;R=Z}ac.id=S;if(typeof ac.width==E||(!/%$/.test(ac.width)&&parseInt(ac.width,10)<310)){ac.width="310"}if(typeof ac.height==E||(!/%$/.test(ac.height)&&parseInt(ac.height,10)<137)){ac.height="137"}k.title=k.title.slice(0,47)+" - Flash Player Installation";var af=N.ie&&N.win?"ActiveX":"PlugIn",ae="MMredirectURL="+P.location.toString().replace(/&/g,"%26")+"&MMplayerType="+af+"&MMdoctitle="+k.title;if(typeof ad.flashvars!=E){ad.flashvars+="&"+ae}else{ad.flashvars=ae}if(N.ie&&N.win&&ag.readyState!=4){var aa=D("div");Z+="SWFObjectNew";aa.setAttribute("id",Z);ag.parentNode.insertBefore(aa,ag);ag.style.display="none";(function(){if(ag.readyState==4){ag.parentNode.removeChild(ag)}else{setTimeout(arguments.callee,10)}})()}v(ac,ad,Z)}}function q(aa){if(N.ie&&N.win&&aa.readyState!=4){var Z=D("div");aa.parentNode.insertBefore(Z,aa);Z.parentNode.replaceChild(g(aa),Z);aa.style.display="none";(function(){if(aa.readyState==4){aa.parentNode.removeChild(aa)}else{setTimeout(arguments.callee,10)}})()}else{aa.parentNode.replaceChild(g(aa),aa)}}function g(ae){var ad=D("div");if(N.win&&N.ie){ad.innerHTML=ae.innerHTML}else{var aa=ae.getElementsByTagName(s)[0];if(aa){var af=aa.childNodes;if(af){var Z=af.length;for(var ab=0;ab<Z;ab++){if(!(af[ab].nodeType==1&&af[ab].nodeName=="PARAM")&&!(af[ab].nodeType==8)){ad.appendChild(af[ab].cloneNode(true))}}}}}return ad}function v(ak,ai,aa){var Z,ac=c(aa);if(N.wk&&N.wk<312){return Z}if(ac){if(typeof ak.id==E){ak.id=aa}if(N.ie&&N.win){var aj="";for(var ag in ak){if(ak[ag]!=Object.prototype[ag]){if(ag.toLowerCase()=="data"){ai.movie=ak[ag]}else{if(ag.toLowerCase()=="styleclass"){aj+=' class="'+ak[ag]+'"'}else{if(ag.toLowerCase()!="classid"){aj+=" "+ag+'="'+ak[ag]+'"'}}}}}var ah="";for(var af in ai){if(ai[af]!=Object.prototype[af]){ah+='<param name="'+af+'" value="'+ai[af]+'" />'}}ac.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+aj+">"+ah+"</object>";O[O.length]=ak.id;Z=c(ak.id)}else{var ab=D(s);ab.setAttribute("type",r);for(var ae in ak){if(ak[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="styleclass"){ab.setAttribute("class",ak[ae])}else{if(ae.toLowerCase()!="classid"){ab.setAttribute(ae,ak[ae])}}}}for(var ad in ai){if(ai[ad]!=Object.prototype[ad]&&ad.toLowerCase()!="movie"){e(ab,ad,ai[ad])}}ac.parentNode.replaceChild(ab,ac);Z=ab}}return Z}function e(ab,Z,aa){var ac=D("param");ac.setAttribute("name",Z);ac.setAttribute("value",aa);ab.appendChild(ac)}function z(aa){var Z=c(aa);if(Z&&Z.nodeName=="OBJECT"){if(N.ie&&N.win){Z.style.display="none";(function(){if(Z.readyState==4){b(aa)}else{setTimeout(arguments.callee,10)}})()}else{Z.parentNode.removeChild(Z)}}}function b(ab){var aa=c(ab);if(aa){for(var Z in aa){if(typeof aa[Z]=="function"){aa[Z]=null}}aa.parentNode.removeChild(aa)}}function c(ab){var Z=null;try{Z=k.getElementById(ab)}catch(aa){}return Z}function D(Z){return k.createElement(Z)}function j(ab,Z,aa){ab.attachEvent(Z,aa);J[J.length]=[ab,Z,aa]}function G(ab){var aa=N.pv,Z=ab.split(".");Z[0]=parseInt(Z[0],10);Z[1]=parseInt(Z[1],10)||0;Z[2]=parseInt(Z[2],10)||0;return(aa[0]>Z[0]||(aa[0]==Z[0]&&aa[1]>Z[1])||(aa[0]==Z[0]&&aa[1]==Z[1]&&aa[2]>=Z[2]))?true:false}function w(ae,aa,af,ad){if(N.ie&&N.mac){return}var ac=k.getElementsByTagName("head")[0];if(!ac){return}var Z=(af&&typeof af=="string")?af:"screen";if(ad){o=null;H=null}if(!o||H!=Z){var ab=D("style");ab.setAttribute("type","text/css");ab.setAttribute("media",Z);o=ac.appendChild(ab);if(N.ie&&N.win&&typeof k.styleSheets!=E&&k.styleSheets.length>0){o=k.styleSheets[k.styleSheets.length-1]}H=Z}if(N.ie&&N.win){if(o&&typeof o.addRule==s){o.addRule(ae,aa)}}else{if(o&&typeof k.createTextNode!=E){o.appendChild(k.createTextNode(ae+" {"+aa+"}"))}}}function x(ab,Z){if(!n){return}var aa=Z?"visible":"hidden";if(K&&c(ab)){c(ab).style.visibility=aa}else{w("#"+ab,"visibility:"+aa)}}function M(aa){var ab=/[\\\"<>\.;]/;var Z=ab.exec(aa)!=null;return Z&&typeof encodeURIComponent!=E?encodeURIComponent(aa):aa}var d=function(){if(N.ie&&N.win){window.attachEvent("onunload",function(){var ae=J.length;for(var ad=0;ad<ae;ad++){J[ad][0].detachEvent(J[ad][1],J[ad][2])}var ab=O.length;for(var ac=0;ac<ab;ac++){z(O[ac])}for(var aa in N){N[aa]=null}N=null;for(var Z in swfobject){swfobject[Z]=null}swfobject=null})}}();return{registerObject:function(ad,Z,ac,ab){if(N.w3&&ad&&Z){var aa={};aa.id=ad;aa.swfVersion=Z;aa.expressInstall=ac;aa.callbackFn=ab;p[p.length]=aa;x(ad,false)}else{if(ab){ab({success:false,id:ad})}}},getObjectById:function(Z){if(N.w3){return A(Z)}},embedSWF:function(ad,aj,ag,ai,aa,ac,ab,af,ah,ae){var Z={success:false,id:aj};if(N.w3&&!(N.wk&&N.wk<312)&&ad&&aj&&ag&&ai&&aa){x(aj,false);L(function(){ag+="";ai+="";var al={};if(ah&&typeof ah===s){for(var an in ah){al[an]=ah[an]}}al.data=ad;al.width=ag;al.height=ai;var ao={};if(af&&typeof af===s){for(var am in af){ao[am]=af[am]}}if(ab&&typeof ab===s){for(var ak in ab){if(typeof ao.flashvars!=E){ao.flashvars+="&"+ak+"="+ab[ak]}else{ao.flashvars=ak+"="+ab[ak]}}}if(G(aa)){var ap=v(al,ao,aj);if(al.id==aj){x(aj,true)}Z.success=true;Z.ref=ap}else{if(ac&&B()){al.data=ac;Q(al,ao,aj,ae);return}else{x(aj,true)}}if(ae){ae(Z)}})}else{if(ae){ae(Z)}}},switchOffAutoHideShow:function(){n=false},ua:N,getFlashPlayerVersion:function(){return{major:N.pv[0],minor:N.pv[1],release:N.pv[2]}},hasFlashPlayerVersion:G,createSWF:function(ab,aa,Z){if(N.w3){return v(ab,aa,Z)}else{return undefined}},showExpressInstall:function(ab,ac,Z,aa){if(N.w3&&B()){Q(ab,ac,Z,aa)}},removeSWF:function(Z){if(N.w3){z(Z)}},createCSS:function(ac,ab,aa,Z){if(N.w3){w(ac,ab,aa,Z)}},addDomLoadEvent:L,addLoadEvent:t,getQueryParamValue:function(ac){var ab=k.location.search||k.location.hash;if(ab){if(/\?/.test(ab)){ab=ab.split("?")[1]}if(ac==null){return M(ab)}var aa=ab.split("&");for(var Z=0;Z<aa.length;Z++){if(aa[Z].substring(0,aa[Z].indexOf("="))==ac){return M(aa[Z].substring((aa[Z].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var Z=c(S);if(Z&&m){Z.parentNode.replaceChild(m,Z);if(R){x(R,true);if(N.ie&&N.win){m.style.display="block"}}if(F){F(C)}}a=false}}}}();var FlashDetect=new function(){var a=this;a.installed=false;a.raw="";a.major=-1;a.minor=-1;a.revision=-1;a.revisionStr="";var b=[{name:"ShockwaveFlash.ShockwaveFlash.7",version:function(h){return d(h)}},{name:"ShockwaveFlash.ShockwaveFlash.6",version:function(k){var h="6,0,21";try{k.AllowScriptAccess="always";h=d(k)}catch(j){}return h}},{name:"ShockwaveFlash.ShockwaveFlash",version:function(h){return d(h)}}];var d=function(k){var h=-1;try{h=k.GetVariable("$version")}catch(j){}return h};var g=function(h){var k=-1;try{k=new ActiveXObject(h)}catch(j){k={activeXError:true}}return k};var c=function(j){var h=j.split(",");return{raw:j,major:parseInt(h[0].split(" ")[1],10),minor:parseInt(h[1],10),revision:parseInt(h[2],10),revisionStr:h[2]}};var f=function(l){var j=l.split(/ +/);var k=j[2].split(/\./);var h=j[3];return{raw:l,major:parseInt(k[0],10),minor:parseInt(k[1],10),revisionStr:h,revision:e(h)}};var e=function(h){return parseInt(h.replace(/[a-zA-Z]/g,""),10)||a.revision};a.majorAtLeast=function(h){return a.major>=h};a.minorAtLeast=function(h){return a.minor>=h};a.revisionAtLeast=function(h){return a.revision>=h};a.versionAtLeast=function(j){var k=[a.major,a.minor,a.revision];var h=Math.min(k.length,arguments.length);for(i=0;i<h;i++){if(k[i]>=arguments[i]){if(i+1<h&&k[i]==arguments[i]){continue}else{return true}}else{return false}}};a.FlashDetect=function(){if(navigator.plugins&&navigator.plugins.length>0){var l="application/x-shockwave-flash";var k=navigator.mimeTypes;if(k&&k[l]&&k[l].enabledPlugin&&k[l].enabledPlugin.description){var h=k[l].enabledPlugin.description;var m=f(h);a.raw=m.raw;a.major=m.major;a.minor=m.minor;a.revisionStr=m.revisionStr;a.revision=m.revision;a.installed=true}}else{if(navigator.appVersion.indexOf("Mac")==-1&&window.execScript){var h=-1;for(var j=0;j<b.length&&h==-1;j++){var n=g(b[j].name);if(!n.activeXError){a.installed=true;h=b[j].version(n);if(h!=-1){var m=c(h);a.raw=m.raw;a.major=m.major;a.minor=m.minor;a.revision=m.revision;a.revisionStr=m.revisionStr}}}}}}()};FlashDetect.JS_RELEASE="1.0.4";(function(c){var g,f={},o={16:false,18:false,17:false,91:false},d="all",a={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,command:91},p={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220};for(g=1;g<20;g++){p["f"+g]=111+g}function m(s,r){var k=s.length;while(k--){if(s[k]===r){return k}}return -1}function n(w){var u,t,x,v,r,s,y;x=w.target||w.srcElement;t=x.tagName;u=w.keyCode;if(u==93||u==224){u=91}if(u in o){o[u]=true;for(r in a){if(a[r]==u){b[r]=true}}return}if(t=="INPUT"||t=="SELECT"||t=="TEXTAREA"){if(["submit","button"].indexOf(x.type)==-1){if(u!=p.escape&&u!=p.tab){return}}}if(!(u in f)){return}for(s=0;s<f[u].length;s++){v=f[u][s];if(v.scope==d||v.scope=="all"){y=v.mods.length>0;for(r in o){if((!o[r]&&m(v.mods,+r)>-1)||(o[r]&&m(v.mods,+r)==-1)){y=false}}if((v.mods.length==0&&!o[16]&&!o[18]&&!o[17]&&!o[91])||y){if(v.method(w,v)===false){if(w.preventDefault){w.preventDefault()}else{w.returnValue=false}if(w.stopPropagation){w.stopPropagation()}if(w.cancelBubble){w.cancelBubble=true}}}}}}function e(t){var s=t.keyCode,r;if(s==93||s==224){s=91}if(s in o){o[s]=false;for(r in a){if(a[r]==s){b[r]=false}}}}function q(){for(g in o){if(o.hasOwnProperty(g)){o[g]=false}}}function b(s,t,w){var v,u,r,k;if(w===undefined){w=t;t="all"}s=s.replace(/\s/g,"");v=s.split(",");if((v[v.length-1])==""){v[v.length-2]+=","}for(r=0;r<v.length;r++){u=[];s=v[r].split("+");if(s.length>1){u=s.slice(0,s.length-1);for(k=0;k<u.length;k++){u[k]=a[u[k]]}s=[s[s.length-1]]}s=s[0];s=p[s]||s.toUpperCase().charCodeAt(0);if(!(s in f)){f[s]=[]}f[s].push({shortcut:v[r],scope:t,method:w,key:v[r],mods:u})}}for(g in a){b[g]=false}function j(k){d=k||"all"}function l(){return d}function h(k,r,s){if(k.addEventListener){k.addEventListener(r,s,false)}else{if(k.attachEvent){k.attachEvent("on"+r,function(){s(window.event)})}}}h(document,"keydown",n);h(document,"keyup",e);h(window,"focus",q);h(document,"contextmenu",q);c.key=b;c.key.setScope=j;c.key.getScope=l;if(typeof module!=="undefined"){module.exports=key}})(this);window.Modernizr=function(ax,aw,av){function V(b){an.cssText=b}function U(d,c){return V(aj.join(d+";")+(c||""))}function S(d,c){return typeof d===c}function R(d,c){return !!~(""+d).indexOf(c)}function Q(e,c){for(var f in e){if(an[e[f]]!==av){return c=="pfx"?e[f]:!0}}return !1}function P(g,c,k){for(var j in g){var h=c[g[j]];if(h!==av){return k===!1?g[j]:S(h,"function")?h.bind(k||c):h}}return !1}function O(g,f,k){var j=g.charAt(0).toUpperCase()+g.substr(1),h=(g+" "+ah.join(j+" ")+j).split(" ");return S(f,"string")||S(f,"undefined")?Q(h,f):(h=(g+" "+ag.join(j+" ")+j).split(" "),P(h,f,k))}function M(){at.input=function(f){for(var b=0,a=f.length;b<a;b++){ad[f[b]]=f[b] in am}return ad.list&&(ad.list=!!aw.createElement("datalist")&&!!ax.HTMLDataListElement),ad}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),at.inputtypes=function(b){for(var l=0,k,j,g,c=b.length;l<c;l++){am.setAttribute("type",j=b[l]),k=am.type!=="text",k&&(am.value=al,am.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(j)&&am.style.WebkitAppearance!==av?(aq.appendChild(am),g=aw.defaultView,k=g.getComputedStyle&&g.getComputedStyle(am,null).WebkitAppearance!=="textfield"&&am.offsetHeight!==0,aq.removeChild(am)):/^(search|tel)$/.test(j)||(/^(url|email)$/.test(j)?k=am.checkValidity&&am.checkValidity()===!1:/^color$/.test(j)?(aq.appendChild(am),aq.offsetWidth,k=am.value!=al,aq.removeChild(am)):k=am.value!=al)),ae[b[l]]=!!k}return ae}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var au="2.5.3",at={},ar=!0,aq=aw.documentElement,ap="modernizr",ao=aw.createElement(ap),an=ao.style,am=aw.createElement("input"),al=":)",ak={}.toString,aj=" -webkit- -moz- -o- -ms- ".split(" "),ai="Webkit Moz O ms",ah=ai.split(" "),ag=ai.toLowerCase().split(" "),af={},ae={},ad={},ac=[],ab=ac.slice,aa,Z=function(t,s,r,q){var p,o,n,h=aw.createElement("div"),g=aw.body,b=g?g:aw.createElement("body");if(parseInt(r,10)){while(r--){n=aw.createElement("div"),n.id=q?q[r]:ap+(r+1),h.appendChild(n)}}return p=["&#173;","<style>",t,"</style>"].join(""),h.id=ap,(g?h:b).innerHTML+=p,b.appendChild(h),g||(b.style.background="",aq.appendChild(b)),o=s(h,t),g?h.parentNode.removeChild(h):b.parentNode.removeChild(b),!!o},Y=function(){function c(h,g){g=g||aw.createElement(b[h]||"div"),h="on"+h;var a=h in g;return a||(g.setAttribute||(g=aw.createElement("div")),g.setAttribute&&g.removeAttribute&&(g.setAttribute(h,""),a=S(g[h],"function"),S(g[h],"undefined")||(g[h]=av),g.removeAttribute(h))),g=null,a}var b={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return c}(),X={}.hasOwnProperty,W;!S(X,"undefined")&&!S(X.call,"undefined")?W=function(d,c){return X.call(d,c)}:W=function(d,c){return c in d&&S(d.constructor.prototype[c],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(a){var h=this;if(typeof h!="function"){throw new TypeError}var g=ab.call(arguments,1),f=function(){if(this instanceof f){var b=function(){};b.prototype=h.prototype;var d=new b,c=h.apply(d,g.concat(ab.call(arguments)));return Object(c)===c?c:d}return h.apply(a,g.concat(ab.call(arguments)))};return f});var N=function(h,e){var b=h.join(""),a=e.length;Z(b,function(o,n){var m=aw.styleSheets[aw.styleSheets.length-1],l=m?m.cssRules&&m.cssRules[0]?m.cssRules[0].cssText:m.cssText||"":"",k=o.childNodes,g={};while(a--){g[k[a].id]=k[a]}at.touch="ontouchstart" in ax||ax.DocumentTouch&&aw instanceof DocumentTouch||(g.touch&&g.touch.offsetTop)===9,at.csstransforms3d=(g.csstransforms3d&&g.csstransforms3d.offsetLeft)===9&&g.csstransforms3d.offsetHeight===3,at.generatedcontent=(g.generatedcontent&&g.generatedcontent.offsetHeight)>=1,at.fontface=/src/i.test(l)&&l.indexOf(n.split(" ")[0])===0},a,e)}(['@font-face {font-family:"font";src:url("https://")}',["@media (",aj.join("touch-enabled),("),ap,")","{#touch{top:9px;position:absolute}}"].join(""),["@media (",aj.join("transform-3d),("),ap,")","{#csstransforms3d{left:9px;position:absolute;height:3px;}}"].join(""),['#generatedcontent:after{content:"',al,'";visibility:hidden}'].join("")],["fontface","touch","csstransforms3d","generatedcontent"]);af.flexbox=function(){return O("flexOrder")},af.canvas=function(){var b=aw.createElement("canvas");return !!b.getContext&&!!b.getContext("2d")},af.canvastext=function(){return !!at.canvas&&!!S(aw.createElement("canvas").getContext("2d").fillText,"function")},af.touch=function(){return at.touch},af.postmessage=function(){return !!ax.postMessage},af.websqldatabase=function(){return !!ax.openDatabase},af.indexedDB=function(){return !!O("indexedDB",ax)},af.hashchange=function(){return Y("hashchange",ax)&&(aw.documentMode===av||aw.documentMode>7)},af.history=function(){return !!ax.history&&!!history.pushState},af.draganddrop=function(){var b=aw.createElement("div");return"draggable" in b||"ondragstart" in b&&"ondrop" in b},af.websockets=function(){for(var a=-1,d=ah.length;++a<d;){if(ax[ah[a]+"WebSocket"]){return !0}}return"WebSocket" in ax},af.rgba=function(){return V("background-color:rgba(150,255,150,.5)"),R(an.backgroundColor,"rgba")},af.hsla=function(){return V("background-color:hsla(120,40%,100%,.5)"),R(an.backgroundColor,"rgba")||R(an.backgroundColor,"hsla")},af.multiplebgs=function(){return V("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(an.background)},af.backgroundsize=function(){return O("backgroundSize")},af.borderimage=function(){return O("borderImage")},af.borderradius=function(){return O("borderRadius")},af.boxshadow=function(){return O("boxShadow")},af.textshadow=function(){return aw.createElement("div").style.textShadow===""},af.opacity=function(){return U("opacity:.55"),/^0.55$/.test(an.opacity)},af.cssanimations=function(){return O("animationName")},af.csscolumns=function(){return O("columnCount")},af.cssgradients=function(){var e="background-image:",d="gradient(linear,left top,right bottom,from(#9f9),to(white));",f="linear-gradient(left top,#9f9, white);";return V((e+"-webkit- ".split(" ").join(d+e)+aj.join(f+e)).slice(0,-e.length)),R(an.backgroundImage,"gradient")},af.cssreflections=function(){return O("boxReflect")},af.csstransforms=function(){return !!O("transform")},af.csstransforms3d=function(){var b=!!O("perspective");return b&&"webkitPerspective" in aq.style&&(b=at.csstransforms3d),b},af.csstransitions=function(){return O("transition")},af.fontface=function(){return at.fontface},af.generatedcontent=function(){return at.generatedcontent},af.video=function(){var b=aw.createElement("video"),f=!1;try{if(f=!!b.canPlayType){f=new Boolean(f),f.ogg=b.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),f.h264=b.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),f.webm=b.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}}catch(e){}return f},af.audio=function(){var b=aw.createElement("audio"),f=!1;try{if(f=!!b.canPlayType){f=new Boolean(f),f.ogg=b.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),f.mp3=b.canPlayType("audio/mpeg;").replace(/^no$/,""),f.wav=b.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),f.m4a=(b.canPlayType("audio/x-m4a;")||b.canPlayType("audio/aac;")).replace(/^no$/,"")}}catch(e){}return f},af.localstorage=function(){try{return localStorage.setItem(ap,ap),localStorage.removeItem(ap),!0}catch(b){return !1}},af.sessionstorage=function(){try{return sessionStorage.setItem(ap,ap),sessionStorage.removeItem(ap),!0}catch(b){return !1}},af.webworkers=function(){return !!ax.Worker},af.applicationcache=function(){return !!ax.applicationCache};for(var L in af){W(af,L)&&(aa=L.toLowerCase(),at[aa]=af[L](),ac.push((at[aa]?"":"no-")+aa))}return at.input||M(),V(""),ao=am=null,at._version=au,at._prefixes=aj,at._domPrefixes=ag,at._cssomPrefixes=ah,at.hasEvent=Y,at.testProp=function(b){return Q([b])},at.testAllProps=O,at.testStyles=Z,aq.className=aq.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(ar?" js "+ac.join(" "):""),at}(this,this.document);var HTML=Class.create({initialize:function(a){if(a instanceof HTML){return a}this._str_DONT_TOUCH=a},toHTML:function(){return this._str_DONT_TOUCH},toString:function(){return"[object HTML]"}});(function(){var d={};HTML.tmpl=function c(k,j){var h=!/\W/.test(k)?d[k]=d[k]||c(document.getElementById(k).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+k.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.*?)%>/g,"',HTML._raw_escape($1),'").split("<%").join("');").split("%>").join("p.push('")+"');}return new HTML(p.join('').trim());");return j?h(j):h};var e=/[^abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@\.\ _\-\(\)\,\$~%#\[\]\{\}\!\^]/g;var f=function b(h){return"&#"+h.charCodeAt(0)+";"};function g(h){return(""+h).replace(e,f)}HTML.escape=HTML.quoteattr=function(h){if(h instanceof HTML){return h}else{return new HTML(g(h))}};HTML._raw_escape=function a(h){if(h instanceof HTML){return h.toHTML()}else{if(typeof h=="number"){return h}else{return g(h)}}}})();document.observe("dom:loaded",function(){var c,b,d,a;d=Prototype.Browser;a=[];for(c in d){b=d[c];if(b){a.push($(document.body).addClassName(c.toLowerCase()))}}return a});var handler,listener,_EXTENSION_REGEX,_dom_trackActiveElement,_dom_trackActiveElementLost,_i,_j,_len,_len1,_ref,_ref1;Function.prototype.defer=Function.prototype.defer.wrap(function(b){var a;a=$A(arguments).slice(1);this.__tb__=get_stack_rep();return b.apply(this,a)});String.prototype.evalScripts=String.prototype.evalScripts.wrap(function(b){var a;a=$A(arguments).slice(1);try{return b.apply(this,a)}catch(c){return assert(0,c.toString())}});Function.prototype.cached=function(a){var c,b;b=Math.random();c=this;return function(){var d;d=Jcached.get(b);if(d!==false){return d}d=c();Jcached.set(b,d,a);return d}};Array.prototype.sort_by_key=function(b,c){var a;if(c==null){c=false}a=c?-1:1;return this.sort(function(d,e){d=b(d);e=b(e);if(d<e){return a*-1}else{if(d>e){return a*1}else{return 0}}})};Array.prototype.contains=function(a){return this.indexOf(a)!==-1};Array.prototype.remove=function(b,a){a=a||b+1;return this.splice(b,a-b)};Array.prototype.removeItem=function(b){var a;a=this.indexOf(b);if(a>=0){return this.remove(a)}else{return false}};Array.prototype.dict_by=function(a){var d,e,c,f,b;c={};for(d=f=0,b=this.length;f<b;d=++f){e=this[d];c[this[d][a]]=this[d]}return c};String.prototype.widthSplit=function(d){var a,c,b,e;if(d==null){d=15}a=[];c=this;e=0;b=c.substring(e,e+d);while(b!==""){a.push(b);e+=d;b=c.substring(e,e+d)}return a};Object.extend(Effect.Transitions,{EaseIn:function(a){return Math.pow(a,2)},EaseOut:function(a){return Math.pow(a,0.5)}});(function(c){var b,a;b=function(h){var e,m,l,j,n,g,f,k,d;if(h){if(Object.isArray(h)){e=[];for(g=0,k=h.length;g<k;g++){m=h[g];e.push(HTML.escape(m).toHTML())}h=new HTML(e.join(""))}else{if(h.top||h.bottom||h.before||h.after){j=["top","bottom","before","after"];for(f=0,d=j.length;f<d;f++){l=j[f];n=h[l];if(n){h[l]=arguments.callee(n)}}}else{if(Util.isElm(h||h.toElement||h.toHTML)){}else{h=HTML.escape(h)}}}}return h};return Element.addMethods({db_observe:function(e,d,f){return e.observe(d,function(g){return f(g,e)})},smoothScrollIntoView:function(g,f){var l,e,d,k,j,h;if(f==null){f={}}l={duration:0.3,offset:0,padding:0,transition:Effect.Transitions.EaseOut};f=Object.extend(l,f);d=g.viewportOffset(g);e=g.getDimensions();h=document.viewport.getDimensions();j=f.padding||0;if(d.top>j&&(d.top+e.height)<(h.height-j)){return}k=d.top<j?-1*Math.floor(h.height/4):-1*Math.floor(3*h.height/4);f.offset=f.offset||k;return new Effect.ScrollTo(g,f)},__sert:function(d,e){return Element.insert(d,b(e))},__date:function(d,e){return Element.update(d,b(e))},replace:a=function(d,e){return c(d,b(e))}})})(Element.replace);_dom_trackActiveElement=function(a){if(a!=null?a.target:void 0){try{return document.activeElement=a.target===document?null:a.target}catch(b){}}};_dom_trackActiveElementLost=function(a){try{return document.activeElement=null}catch(b){}};if(document.addEventListener){document.addEventListener("focus",_dom_trackActiveElement,true);document.addEventListener("blur",_dom_trackActiveElementLost,true)}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}String.prototype.lpad=function(b,a){var c;if(a==null){a="0"}c=this;while(c.length<b){c=a+c}return c.toString()};String.prototype.reverse=function(){var c,b,a;a=this.split("");b=a.reverse();c=b.join("");return c};String.prototype.create=function(a){return a};String.prototype.count=function(a){return(this.length-this.gsub(a,"").length)/a.length};_EXTENSION_REGEX=/^\.[a-zA-Z0-9]$/;String.prototype.snippet=function(f,h){var a,b,e,j,d,g,c;if(f==null){f=50}if(h==null){h=0.75}if(this.length<=f){return this}b="";a=this.lastIndexOf(".");if(this.length-a>5){a=-1}if(a>0){b=this.substr(a);if(_EXTENSION_REGEX.match(b)){f=f-b.length}else{a=this.length;b=""}}else{a=this.length;b=""}f=f-this.create("...").length;e=f*h;if(!(this instanceof Emstring)){e=Math.floor(e)}g=f-e;c=a-g;d=this.substr(0,e);j=this.substr(c,g);return d+"..."+j+b};String.prototype.em_snippet=function(b,a){return new Emstring(this).snippet(b,a).toString()};String.prototype.repeat=function(a){return(new Array(a+1)).join(this)};String.prototype.title=function(){return this.charAt(0).toUpperCase()+this.substr(1)};Ajax.DBRequest=Class.create(Ajax.Request,{initialize:function($super,c,b){var a,e,d,f;if(b==null){b={}}this.start_time=Util.time();b.method=b.method||"post";b.parameters=b.parameters||{};b.parameters.t=Constants.TOKEN;e=b.cleanUp||(function(){});if(b.job){this.job_id=Util.nonce();b.parameters.job_id=this.job_id;ProgressWatcher.watch(this)}if(!b.no_watch){RequestWatcher.watch(this,!!b.job)}d=b.onFailure;f=b.onSuccess;b.onFailure=function(g){var j,h;if(Job.handled(g.request.job_id)){return}if(!b.noAutonotify){j=null;if(!Constants.IS_PROD&&g.status===500&&g.getHeader("X-Debug-Url")){c=g.getHeader("X-Debug-Url");j=_("There was a problem completing this request.")+(' <a href="'+c+'">View debug</a>')}Notify.server_error(j)}e(false);if(d){d(g)}return assert(b.noAutonotify||((h=!g.status)===404||h===502),"Ajax "+g.status+" on "+g.request.url)};b.onSuccess=function(g){var h;h=Util.time()-g.request.start_time;WIT._record("AJAX","load",g.request.url,{time:h});if(Job.handled(g.request.job_id)){return}TranslationSuggest.update_i18n_messages_from_req(g);if(typeof QueryLog!=="undefined"){QueryLog.update_query_log_from_req(g)}if(!g.responseText.length){if(!b.job){if(!b.noAutonotify?!g||g.status!==0:void 0){Notify.server_error()}if(d){d(g)}}}else{if(g.responseText.indexOf("err:")===0){if(!b.noAutonotify){Notify.server_error(g.responseText.substr(4))}if(d){d(g)}}else{if(f){if(g.responseText.indexOf("ok:")===0){Notify.server_success(g.responseText.substr(3))}f(g)}if(b.log_timing){WebTimingLogger.log_ajax_transition.defer(h)}}}return e(true)};b.onException=function(h,j){var k,g;if(window.console){throw j}k=("Error with AJAX callback for: "+c+" :::: ")+j.toString();g=get_stack_rep();g.pop();return global_report_exception(k,window.location.href,"",g.join("\n"))};if(b.job){c+=(c.indexOf("?")===-1?"?":"&")+"long_running=1"}a=$H({url:c});if(b.parameters){a.update(b.parameters);a.unset("t")}b.onSuccess.__tb_ajax_info__=b.onFailure.__tb_ajax_info__=Object.toJSON(a);return $super(c,b)}});Object.extend(key,{main_modifier:function(){if(Util.is_mac()){return decodeURIComponent("%E2%8C%98")}else{return"ctrl"}}});document.observe("dom:loaded",function(){var c,d,a,b;a=function(g){var h,f;g=$(g);f=$(g.target);if(!Element.match(f,"input,textarea")){return}h=f.readAttribute("placeholder");if(h){if("focus"===g.type||"focusin"===g.type){if(f.getValue()===""){f.setValue("");return f.removeClassName(c)}}else{if(""===f.value){f.addClassName(c);return f.value=h}}}};$(document.body);d=$(document.documentElement);c="placeholder";if(d.addEventListener){d.addEventListener("focus",a,true);d.addEventListener("blur",a,true)}else{d.on("focusin","[placeholder]",a);d.on("focusout","[placeholder]",a)}b=Element.Methods.ByTag.INPUT.getValue.wrap(function(g,e){var f;f=$(e).readAttribute("placeholder");if(f&&f===e.value&&$(e).hasClassName(c)){return""}return g.apply(this,$A(arguments).slice(1))});Element.addMethods("input",{getValue:b});return Element.addMethods("textarea",{getValue:b})});(function(){return Object.extend(Prototype.BrowserFeatures,{DB_CORS:window.XMLHttpRequest&&("withCredentials" in new XMLHttpRequest())})})();if(window._document_observe_listeners){_ref=window._document_observe_listeners;for(_i=0,_len=_ref.length;_i<_len;_i++){listener=_ref[_i];if(document.loaded){listener.func()}else{document.observe(listener.event,listener.func)}}}if(window._jquery_ready_handlers){_ref1=window._jquery_ready_handlers;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){handler=_ref1[_j];if(jQuery.isReady){handler()}else{jQuery.ready(handler)}}}var ABTest,AMC,Jcached,MCLog,UserActivityLogger,WIT;WIT={enabled:Constants.WIT_ENABLED,reporting:false,start_time:0,register:function(){if(WIT.enabled){WIT.reportInterval=setInterval(WIT.report,10000);return $(document.body).observe("click",WIT.click)}},add_group:function(b,a){b=$(b);assert(b,"WIT.add_group missing elm");b.addClassName("wit_group");return b.setAttribute("name",a)},clear_group:function(a){if(a.hasClassName("wit_group")){return a.removeClassName("wit_group")}},get_group:function(b){var a;a=b.up(".wit_group");if(a){return a.getAttribute("name")}return"ALL"},time_elapsed:function(){var a;a=Util.time()-WIT.start_time;if(a>=0){return a}else{return 0}},click:function(g){var f,a,d,c,b;if(!WIT.enabled||!(g!=null?g.target:void 0)){return}d=$(g.target);c=(b=d.tagName.toLowerCase())==="input"||b==="textarea"||b==="checkbox"?d:d.up("a, .wit");if(!c||$(c).hasClassName("ignore")){return}a=c.getAttribute("name")||c.id||(typeof c.getValue==="function"?c.getValue():void 0)||c.innerHTML.stripTags().strip()||"unknown "+c.tagName;if(Constants.emessages[a]){a=Constants.emessages[a]}f=WIT.get_group(c);assert(f,"Group missing");return WIT.record_action(a,"click",f,WIT.time_elapsed())},record_action:function(c,d,e,b,a){if(a==null){a={}}a.group=e;a.type=d;a.tti=b;return WIT.record("ACTION",c,a)},record:function(d,b,a){var c;if(a==null){a={}}c=window.location.pathname.split("#")[0];return WIT._record(d,b,c,a)},_record:function(f,c,b,a){var d,e;if(a==null){a={}}d="WIT_"+f+"_"+c;if(!WIT.enabled||Jcached.get(d)||WIT.IGNORE_URLS[b.split(Constants.WEBSERVER).last().split(/[\?\#]/)[0]]){return}assert(c,"Missing WIT label");assert(f,"Missing WIT event_type");assert(b,"Missing WIT url");e=[f,c,b,a];WIT.add_to_cookie(e);return Jcached.set(d,1,5000)},add_to_cookie:function(d){var c,a,b;if(Ajax.activeRequestCount){setTimeout((function(){return WIT.add_to_cookie(d)}),500);return}assert(WIT.enabled,"WIT Disabled.");b=WIT.get_cookie_val();b.push(d);a=Object.toJSON(b);c=encodeURIComponent(a);Util.create_cookie("wit",c,365);if(c.length>1024){return WIT.report()}},get_cookie_val:function(){var b;b=Util.read_cookie("wit");if(b){try{return decodeURIComponent(b).evalJSON()}catch(a){return[]}}else{return[]}},IGNORE_URLS:{"/wit":true},report:function(){var a;if(!WIT.enabled||WIT.reporting){return}a=Util.read_cookie("wit");if(a){WIT.reporting=true;new Ajax.Request("/wit",{onComplete:function(){return WIT.reporting=false}});return Util.create_cookie("wit","",-1)}}};WIT.start_time=window.ST||new Date().getTime();document.observe("dom:loaded",function(){WIT.record("LOAD","ready",{time:Util.time()-WIT.start_time});return WIT.register()});Event.observe(window,"load",function(){return WIT.record("LOAD","complete",{time:Util.time()-WIT.start_time})});Event.stop=Event.stop.wrap(function(a,b){if(!b){return}if(b.type==="click"){WIT.click(b)}return a.apply(this,$A(arguments).slice(1))});Jcached={cache:{},set:function(b,d,a){var e;e=Jcached.cache[b];if(e==null){e=Jcached.cache[b]={}}e.value=d;return e.expires=a?new Date().getTime()+a:0},get:function(a){var b;b=Jcached.cache[a];if(!(b!=null)||new Date().getTime()>b.expires){delete Jcached.cache[a];return false}return b.value}};AMC={log_escape:function(a){$("top_notifier_container").remove();return new Ajax.DBRequest("/log_escape",{parameters:{kept_locale:a}})},log:function(b,a){var c;assert(b,"AMCLog missing label");c={label:b};if(a){Object.extend(c,a)}return new Ajax.Request("/ajax_amc_log",{parameters:c,noAutonotify:true})},help_article_play:function(a){if(!AMC.help_article_play_logged){AMC.help_article_play_logged=1;if(Help.article_id){return new Ajax.Request("/ajax_amc_help_video",{parameters:{article_id:Help.article_id}})}}}};UserActivityLogger={log:function(b,c,a){return new Ajax.DBRequest("/ualogger",{parameters:{platform:b,event_name:c,extra:a},noAutonotify:true})}};ABTest={log:function(a,b){var c;assert(a,"ABTest log missing abtest name");assert(b,"ABTest log missing event name");c={abtest_name:a,event_name:b};return new Ajax.Request("/ajax_abtest_log",{parameters:c})}};MCLog={log:function(a){return new Ajax.Request("/ajax_mc_log/"+a)}};var LANGPACK,N_,PLURAL_RULES,add_i18n_message,localized_path,singular_01,singular_1,singular_all,ungettext,_;add_i18n_message=function(d,c,a,b){Constants.messages=Constants.messages||{};Constants.emessages=Constants.emessages||{};c=c.stripTags().friendly_format();a=a.stripTags();Constants.messages[c]=d;Constants.emessages[c]=a;if(b){delete Constants.messages[b];delete Constants.emessages[b]}if(typeof TranslationSuggest!=="undefined"&&TranslationSuggest!==null){return TranslationSuggest.index_message(c)}};singular_1=function(a){if(a===1){return 0}else{return 1}};singular_01=function(a){if(a<=1){return 0}else{return 1}};singular_all=function(a){return 0};PLURAL_RULES={es_US:singular_1,de:singular_1,es:singular_1,fr:singular_01,ja:singular_all,ko:singular_all,pl:singular_1};if(!window.LANGPACK){LANGPACK={}}_=function(a){var b;b=LANGPACK[a]||a;add_i18n_message(a,b,a);return b};N_=function(a){return a};ungettext=function(c,b,g){var f,d,e,a;assert(g!=null,"missing number parameter for ungettext");if(c in LANGPACK&&Constants.USER_LOCALE){d=LANGPACK[c];if(Object.isString(d)&&Constants.USER_LOCALE==="ja"){return d}e=PLURAL_RULES[Constants.USER_LOCALE](g);assert(e in d,"bad plural lookup");a=d[e]}f=g===1?c:b;if(a==null){a=f}add_i18n_message(c,a,f);return a};localized_path=function(f,b){var c,e,a,d;if(!b){d=Constants.LOCALES;for(e=0,a=d.length;e<a;e++){c=d[e];b=c[0]}}if(b.indexOf(Constants.USER_LOCALE)!==-1){return f.replace(/(\.[a-zA-Z0-9]{2,4})$/,"__%s$1".format(Constants.USER_LOCALE))}else{return f}};Date.prototype.localize=function(){assert(Constants.date_format!=null,"Date format missing.");return this.format(Constants.date_format)};Date.prototype.format=function(a){var b,c=this;assert(typeof a==="string","Date format requires a format string");b={yy:function(){return c.getFullYear().toString().substring(2)},yyyy:function(){return c.getFullYear().toString()},M:function(){return(c.getMonth()+1).toString()},MM:function(){return(c.getMonth()+1).toString().lpad(2)},d:function(){return c.getDate().toString()},dd:function(){return c.getDate().toString().lpad(2)},h:function(){return(c.getHours()%12||12).toString()},H:function(){return(c.getHours()%12||12).toString()},HH:function(){return(c.getHours()%12||12).toString().lpad(2)},m:function(){return c.getMinutes().toString()},mm:function(){return c.getMinutes().toString().lpad(2)},a:function(){if(c.getHours()>11){return _("PM")}else{return _("AM")}}};return a.replace(/([a-zA-Z]+)/g,function(d){if(b[d]!=null){return b[d]()}else{return d}})};String.prototype.format_sub=function(a){return this.replace(/%(\([a-z_\-]+\))?(.\d+)?(.)/g,a.bind(this))};String.prototype.format=function(){var g,f,e,c,b,a;if(arguments.length===0){return this.toString()}f=void 0;g=0;if(arguments.length===1&&arguments[0] instanceof Object){f=arguments[0]}else{f=$A(arguments)}b=function(m,k,j,l){var n,d,h;if(!k){if(!Object.isArray(f)){f=[f]}assert(g>-1,"Cannot mix named and positional indices in string formatting for string '"+this+"'.");assert(g<f.length,"Insufficient number of items in format for string '"+this+"', list "+Object.toJSON($A(f))+".");h=f[g];g++}else{k=k.slice(1,-1);assert(g<=0,"Cannot mix named and positional indices in string formatting for string '"+this+"'.");g=-1;assert(k in f,"Key '"+k+"' not present during string substitution for string '"+this+"', dict "+Object.toJSON($H(f))+".");h=f[k]}assert(typeof h!=="undefined",'value for key "'+(k||"").toString()+'" is undefined');d=void 0;if(l==="s"){d=h.toString()}else{if(l==="d"){d=parseInt(h,10).toString()}else{if(l==="f"){d=Number(h).toString()}else{if(l==="%"){return"%"}else{assert(false,"Unexpected format character '"+l+"' for string '"+this+"'.")}}}}if(j){j=parseInt(j.slice(1),10);if(l==="f"){if(d.indexOf("."===-1)){d=d+".0"}n=d.split(".");return n[0]+"."+n[1].slice(0,j)}else{return d.slice(0,j)}}return d};a=this.format_sub(b);if(Constants.messages&&this in Constants.messages){g=0;c=Constants.emessages[this];e=String.prototype.format_sub.call(c,b);add_i18n_message(c,a,e,this)}return a};String.prototype.friendly_format=function(){var a,c,b;c=function(g,e,d,f){if(!e){if(f==="s"){return"[word"+(b++)+"]"}else{return"[number"+(a++)+"]"}}else{return"["+(e.slice(1,1).replace("-","_"))+"]"}};a=1;b=1;return this.format_sub(c)};String.prototype.blank_format=function(){var a;a=function(){return""};return this.format_sub(a)};var DBObserver,DomUtil,Email,Emstring,IE7_OR_LESS,RequestWatcher,SimpleSet,SuperDictionary,T,Trace,UIButton,Util,alertd,assert,console,fn_body,get_stack_rep,strip_comments,__slice=[].slice;strip_comments=function(a){return a.replace(/\/\/.*/g,"").replace(/\/\*[\s\S]*?\*\//g,"")};fn_body=function(b){var a;a=strip_comments(b.toString());a=a.replace(/[\s]+/g," ");if(a.startsWith("(")){a=a.substr(1)}if(a.endsWith(")")){a=a.substr(0,a.length-1)}a=a.replace("function (","function(");return a};get_stack_rep=function(){var d,c,b,a;b=[];a={};d=arguments.callee.caller;while(d){if(d.__tb_ajax_info__){b.unshift("Ajax.DBRequest: "+d.__tb_ajax_info__);break}if(d.__tb__){b=d.__tb__.concat(b);break}c=fn_body(d);if(c in a){break}a[c]=true;b.unshift(c);d=d.caller}return b};alertd=window.alert;assert=function(c,d,b){var a;if(!c){d="Assertion Error: "+d;if(!Constants.IS_PROD){if(typeof console!=="undefined"&&console!==null){if(typeof console.trace==="function"){console.trace()}}alert(d)}a=get_stack_rep();a.pop();global_report_exception(d,window.location.href,"",a.join("\n"));throw d}};DBObserver={watch:function(b,c){var a;a=function(){var e,d;e=$(b);assert(e,"Couldn't find watch element");d=e.getValue().strip();if(d!==e.last_search&&!SuggestionInput.defaulted(e)){e.last_search=d;return c(d)}};return setInterval(a,300)}};Email={mailto:function(c,b,d,a){if(d==null){d="dropbox.com"}if(a==null){a=""}c.href="mailto:"+b+"@"+d;if(a){c.href+="?body="+a}return c.onMouseover=null}};SimpleSet=Class.create({initialize:function(a){this.length=0;this.d={};this.items=[];return this.update(a)},update:function(c){var d,e,b,a;if(c==null){c=[]}a=[];for(e=0,b=c.length;e<b;e++){d=c[e];a.push(this.add(d))}return a},_hash:function(b){var a;a=typeof b;assert(a==="string"||a==="number","expected a string or a number, got "+a);return a+":"+b},add:function(b){var a;a=this._hash(b);if(!this.d[a]){this.items.push(b);this.length+=1}return this.d[a]=true},contains:function(b){var a;a=this._hash(b);return this.d[a]||false},union:function(){var b,c,d,a;a=1<=arguments.length?__slice.call(arguments,0):[];b=this.items;c=(function(){var g,f,e;e=[];for(g=0,f=a.length;g<f;g++){d=a[g];e.push(d.items)}return e})();return new SimpleSet(b.concat.apply(b,c))},difference:function(){var b,c,g,h,d,f,a,e;b=$A(arguments);assert(b.length>0,"Requires at least one SimpleSet");if(b.length>1){g=b[0];c=g.union.apply(g,b.slice(1))}else{c=b[0]}h=[];e=this.items;for(f=0,a=e.length;f<a;f++){d=e[f];if(!c.contains(d)){h.push(d)}}return new SimpleSet(h)}});Emstring=Class.create({initialize:function(a){this.s=a;this.info=this.widthInfo();return this.length=a.length?this.info[this.s.length-1]:0},create:function(a){return new Emstring(a)},widthInfo:function(){var a,b,d,c;b={};b[-1]=0;for(a=d=0,c=this.s.length;0<=c?d<c:d>c;a=0<=c?++d:--d){b[a]=b[a-1]+this.ems(this.s.charAt(a))}return b},findSpot:function(b){var d,f,a,c;if(!b){return 0}c=0;f=this.s.length;while(c<=f){a=Math.floor(c/2+f/2);d=this.info[a-1];if(d>b){f=a-1}else{if(d<b){c=a+1}else{return a}}}if(c>a){return c}else{return a}},ems:function(g){var b,a,f,e,d;a=0.65;b=1.08;f=0.58;e=g.charCodeAt(0);d=Emstring.CODEPOINT_TO_WIDTH[e];if(d){return d/Math.pow(10,Emstring.ACCURACY)}if((768<=e&&e<=879)){return 0}if((65377<=e&&e<=65500)){return f}if(((11904<=e&&e<=40911))||((44032<=e&&e<=55215))||((4352<=e&&e<=4607))||((63744<=e&&e<=64255))||((65280<=e&&e<=65535))||((131072<=e&&e<=196607))){return b}return a},substr:function(d,a){var b,c;c=this.findSpot(d);if(a!=null){b=this.findSpot(d+a);return new Emstring(this.s.substr(c,b-c))}else{return new Emstring(this.s.substr(c))}},indexOf:function(b){var a;a=this.s.indexOf(b);if(a>-1){return this.info[a-1]}else{return -1}},lastIndexOf:function(b){var a;a=this.s.reverse().indexOf(b.reverse());if(a<0){return -1}return this.info[this.s.length-a-b.length-1]},toString:function(){return this.s},snippet:String.prototype.snippet});Emstring.ACCURACY=2;Emstring.CODEPOINT_TO_WIDTH={32:38,33:25,34:42,35:67,36:58,37:92,38:75,39:25,40:33,41:33,42:58,43:58,44:25,45:33,46:25,47:42,48:58,49:58,50:58,51:58,52:58,53:58,54:58,55:58,56:58,57:58,58:25,59:25,60:58,61:58,62:58,63:50,64:100,65:67,66:67,67:67,68:75,69:58,70:58,71:75,72:83,73:33,74:25,75:67,76:58,77:100,78:83,79:83,80:67,81:83,82:67,83:58,84:58,85:75,86:67,87:100,88:67,89:58,90:58,91:33,92:42,93:33,94:58,95:50,96:67,97:58,98:67,99:50,100:67,101:58,102:33,103:58,104:67,105:25,106:25,107:58,108:25,109:100,110:67,111:67,112:67,113:67,114:42,115:50,116:42,117:67,118:58,119:83,120:58,121:58,122:50,123:42,124:58,125:42,126:58,161:25,162:58,163:58,164:58,165:58,166:58,167:58,168:67,169:92,170:42,171:50,172:58,174:92,175:58,176:50,177:58,178:42,179:42,180:67,181:67,182:75,183:25,184:25,185:42,186:42,187:50,188:83,189:83,190:83,191:50,192:67,193:67,194:67,195:67,196:67,197:67,198:92,199:67,200:58,201:58,202:58,203:58,204:33,205:33,206:33,207:33,208:75,209:83,210:83,211:83,212:83,213:83,214:83,215:58,216:83,217:75,218:75,219:75,220:75,221:58,222:67,223:67,224:58,225:58,226:58,227:58,228:58,229:58,230:92,231:50,232:58,233:58,234:58,235:58,236:25,237:25,238:25,239:25,240:67,241:67,242:67,243:67,244:67,245:67,246:67,247:58,248:67,249:67,250:67,251:67,252:67,253:58,254:67,255:58,256:75,257:67,258:75,259:67,260:75,261:67,262:75,263:58,264:75,265:58,266:75,267:58,268:75,269:58,270:83,271:83,272:83,273:75,274:67,275:67,276:67,277:67,278:67,279:67,280:67,281:67,282:67,283:67,284:83,285:75,286:83,287:75,288:83,289:75,290:83,291:75,292:83,293:75,294:92,295:75,296:33,297:33,298:33,299:33,300:33,301:33,302:33,303:33,304:33,305:25,306:67,307:67,308:42,309:33,310:75,311:67,312:67,313:58,314:33,315:58,316:33,317:58,318:42,319:58,320:50,321:67,322:42,323:83,324:75,325:83,326:75,327:83,328:75,329:83,330:83,331:75,332:92,333:67,334:92,335:67,336:92,337:67,338:100,339:100,340:75,341:50,342:75,343:50,344:75,345:50,346:67,347:58,348:67,349:58,350:67,351:58,352:67,353:58,354:75,355:42,356:75,357:42,358:75,359:42,360:83,361:75,362:83,363:75,364:83,365:75,366:83,367:75,368:83,369:75,370:83,371:75,372:100,373:92,374:75,375:58,376:75,377:67,378:67,379:67,380:67,381:67,382:67,383:42,384:75,385:83,386:67,387:75,388:75,389:67,390:75,391:83,392:58,393:83,394:100,395:67,396:75,397:67,398:67,399:75,400:58,401:58,402:75,403:83,404:75,405:100,406:50,407:50,408:75,409:67,410:50,411:67,412:117,413:83,414:75,415:92,416:92,417:75,418:117,419:100,420:75,421:75,422:75,423:67,424:58,425:67,426:58,427:42,428:75,429:42,430:75,431:83,432:75,433:92,434:83,435:75,436:75,437:67,438:67,439:67,440:67,441:58,442:58,443:75,444:75,445:58,446:50,447:67,448:33,449:50,450:50,451:33,452:142,453:142,454:133,455:100,456:92,457:67,458:117,459:117,460:100,461:75,462:67,463:33,464:33,465:92,466:67,467:83,468:75,469:83,470:75,471:83,472:75,473:83,474:75,475:83,476:75,477:67,478:75,479:67,480:75,481:67,482:100,483:100,484:92,485:75,486:83,487:75,488:75,489:67,490:92,491:67,492:92,493:67,494:67,495:58,496:33,497:142,498:142,499:133,500:83,501:75,502:117,503:67,504:83,505:75,506:75,507:67,508:100,509:100,510:92,511:67,512:75,513:67,514:75,515:67,516:67,517:67,518:67,519:67,520:33,521:33,522:33,523:33,524:92,525:67,526:92,527:67,528:75,529:50,530:75,531:50,532:83,533:75,534:83,535:75,536:67,537:58,538:75,539:42,540:58,541:58,542:83,543:75,544:83,545:100,546:92,547:67,548:67,549:67,550:75,551:67,552:67,553:67,554:92,555:67,556:92,557:67,558:92,559:67,560:92,561:67,562:75,563:58,564:67,565:100,566:67,567:33,568:100,569:100,570:75,571:75,572:58,573:58,574:67,575:58,576:58,577:67,578:50,579:75,580:75,581:75,582:75,583:58,584:58,585:25,586:83,587:58,588:75,589:33,590:75,591:58,880:67,881:50,882:67,883:50,884:33,885:33,886:75,887:67,888:108,889:108,890:67,891:58,892:58,893:58,894:42,895:108,896:108,897:108,898:108,899:108,900:67,901:67,902:75,903:42,904:83,905:100,906:58,907:108,908:100,909:108,910:100,911:100,912:42,913:75,914:67,915:58,916:83,917:67,918:67,919:83,920:92,921:33,922:75,923:75,924:100,925:83,926:75,927:92,928:83,929:67,930:108,931:67,932:75,933:75,934:83,935:75,936:83,937:92,938:33,939:75,940:83,941:58,942:75,943:42,944:67,945:83,946:67,947:67,948:67,949:58,950:75,951:75,952:67,953:42,954:67,955:67,956:75,957:67,958:67,959:67,960:92,961:67,962:67,963:75,964:67,965:67,966:92,967:67,968:92,969:100,970:42,971:67,972:67,973:67,974:100,975:108,976:58,977:75,978:75,979:100,980:75,981:92,982:100,983:67,984:92,985:67,986:75,987:58,988:58,989:58,990:67,991:58,992:75,993:92,994:100,995:92,996:75,997:58,998:75,999:58,1000:75,1001:75,1002:67,1003:67,1004:83,1005:58,1006:50,1007:42,1008:67,1009:67,1010:58,1011:33,1012:92,1013:58,1014:58,1015:67,1016:67,1017:75,1018:100,1019:83,1020:58,1021:75,1022:75,1023:75,1024:67,1025:67,1026:92,1027:58,1028:75,1029:67,1030:33,1031:33,1032:42,1033:108,1034:108,1035:83,1036:75,1037:83,1038:75,1039:83,1040:75,1041:67,1042:67,1043:58,1044:83,1045:67,1046:92,1047:67,1048:83,1049:83,1050:75,1051:83,1052:100,1053:83,1054:92,1055:83,1056:67,1057:75,1058:75,1059:75,1060:83,1061:75,1062:83,1063:75,1064:108,1065:108,1066:75,1067:92,1068:67,1069:75,1070:108,1071:75,1072:67,1073:67,1074:58,1075:58,1076:75,1077:67,1078:83,1079:58,1080:75,1081:75,1082:67,1083:67,1084:83,1085:75,1086:67,1087:75,1088:75,1089:58,1090:58,1091:58,1092:92,1093:67,1094:75,1095:58,1096:92,1097:100,1098:67,1099:83,1100:58,1101:58,1102:92,1103:58,1104:67,1105:67,1106:75,1107:58,1108:58,1109:58,1110:33,1111:33,1112:42,1113:92,1114:92,1115:75,1116:67,1117:75,1118:58,1119:75,1120:100,1121:75,1122:75,1123:67,1124:83,1125:83,1126:75,1127:67,1128:100,1129:92,1130:92,1131:83,1132:117,1133:108,1134:67,1135:67,1136:83,1137:83,1138:92,1139:67,1140:83,1141:67,1142:83,1143:67,1144:133,1145:125,1146:92,1147:67,1148:100,1149:75,1150:100,1151:75,1152:75,1153:58,1154:75,1155:0,1156:0,1157:0,1158:0,1159:108,1160:0,1161:0,1162:83,1163:75,1164:67,1165:58,1166:67,1167:75,1168:58,1169:58,1170:67,1171:58,1172:75,1173:67,1174:100,1175:92,1176:67,1177:58,1178:75,1179:67,1180:83,1181:75,1182:75,1183:67,1184:83,1185:75,1186:83,1187:75,1188:100,1189:83,1190:117,1191:100,1192:92,1193:75,1194:75,1195:58,1196:75,1197:58,1198:75,1199:58,1200:75,1201:58,1202:75,1203:75,1204:100,1205:83,1206:75,1207:67,1208:75,1209:67,1210:75,1211:58,1212:92,1213:75,1214:92,1215:75,1216:33,1217:92,1218:83,1219:75,1220:67,1221:83,1222:67,1223:83,1224:75,1225:83,1226:75,1227:75,1228:58,1229:100,1230:83,1231:25,1232:75,1233:67,1234:75,1235:67,1236:100,1237:100,1238:67,1239:67,1240:75,1241:67,1242:75,1243:67,1244:92,1245:83,1246:67,1247:58,1248:67,1249:58,1250:83,1251:75,1252:83,1253:75,1254:92,1255:67,1256:92,1257:67,1258:92,1259:67,1260:75,1261:58,1262:75,1263:58,1264:75,1265:58,1266:75,1267:58,1268:75,1269:58,1270:58,1271:42,1272:92,1273:83,1274:58,1275:42,1276:75,1277:58,1278:75,1279:58,19977:108,65403:58};DomUtil={fromElm:function(a){return $(a).innerHTML},updateFromElm:function(b,a){b=$(b);a=$(a);b.update(this.fromElm(a));return Util.live_joff(a,b)},fillVal:function(g,d){var a,f,c,e,b;e=$$("."+d);b=[];for(f=0,c=e.length;f<c;f++){a=e[f];a=$(a);if(a.tagName==="INPUT"){a.value=g;b.push(a.defaultValue=g)}else{b.push(a.innerHTML=g)}}return b}};Util={add_qstring:function(a,d){var f,c,b,e;f=a.indexOf("?")===-1?"?":"&";b=(function(){var g;g=[];for(c in d){e=d[c];g.push(""+c+"="+(encodeURIComponent(e)))}return g})();return a+f+b.join("&")},from_json:function(a){if(window.JSON&&window.JSON.parse){return window.JSON.parse(a)}else{return a.evalJSON(true)}},to_json:function(b){var a;return((a=window.JSON)!=null?typeof a.stringify==="function"?a.stringify(b):void 0:void 0)||Object.toJSON(b)},viewport_dimensions:function(){var a=this;if(!this._cached_viewport_dimensions){this._cached_viewport_dimensions=document.viewport.getDimensions()}if(!this._listening_for_resize){Event.observe(window,"resize",function(){return delete a._cached_viewport_dimensions});this._listening_for_resize=1}return this._cached_viewport_dimensions},set_min_body_height_to_viewport_height:function(){var a;a=$(document.body);if(a!=null?a.style:void 0){return a.style.minHeight=this.viewport_dimensions().height+"px"}},_listen_for_scroll:function(){var a=this;if(!this._listening_for_scroll){Event.observe(window,"scroll",function(){if(a._ignore_scroll_event){a._ignore_scroll_event=0;return}return delete a._cached_scroll_offsets});return this._listening_for_scroll=1}},force_delete_cached_scroll_offsets:function(){return delete this._cached_scroll_offsets},scroll_offsets:function(){this._listen_for_scroll();if(!this._cached_scroll_offsets){this._cached_scroll_offsets=document.viewport.getScrollOffsets()}return this._cached_scroll_offsets},scroll_to:function(a,b){this._listen_for_scroll();this._ignore_scroll_event=1;a=Math.max(a,0);b=Math.max(b,0);if(b>this.scroll_offsets().top){b=Math.min(b,document.body.getHeight()-this.viewport_dimensions().height)}this._cached_scroll_offsets=Element._returnOffset(a,b);return window.scrollTo(a,b)},scroll_to_thumb:function(a){var e,d,c,b;d=a.cumulativeOffset().top;e=a.getHeight();b=this.scroll_offsets().top;c=this.viewport_dimensions().height;if(d<b||d+e>b+c){return this.scroll_to(0,d-c/2)}},get_viewport:function(){return{top:Util.scroll_offsets().top,height:Util.viewport_dimensions().height}},decode_sort_key:function(c){var e,d,b,a;a=[];for(d=0,b=c.length;d<b;d++){e=c[d];if(typeof e==="string"){a.push(this.decode_b64(e))}else{a.push(e)}}return a},sort_by_rank_or_key:function(a,b){if((a.sort_rank!=null)&&(b.sort_rank!=null)){return a.sort_rank-b.sort_rank}assert((a.sort_key!=null)&&(b.sort_key!=null),"expected sort keys on both elms");return this._sort_by_key(a,b)},_sort_by_key:function(b,g){var d,a,c,f,e;a=b.sort_key;c=g.sort_key;for(d=f=0,e=a.length;0<=e?f<e:f>e;d=0<=e?++f:--f){if(!(c[d]!=null)){return 1}if(typeof a[d]!==typeof c[d]){if(typeof a[d]==="string"){return 1}else{return -1}}else{if(a[d]!==c[d]){if(a[d]>c[d]){return 1}else{return -1}}}}if(c.length>a.length){return -1}else{return 0}},add_sort_arrow_mouseover:function(a,d,c,b){var h,k,e,j,f,g=this;f=$$(c);for(e=0,j=f.length;e<j;e++){h=f[e];if(a!==h){Sprite.src(h.down("img"),"web","downtick-spacer");h.removeClassName("bolded");h.stopObserving("mouseout");h.stopObserving("mouseover")}else{h.addClassName("bolded");if(h.hasClassName("noarrow")){return}k=d?"up":"down";if(b){Sprite.src(h.down("img"),"web","sort-"+k+"tick-on")}h.observe("mouseout",function(){return Sprite.src(h.down("img"),"web","sort-"+k+"tick-off")});h.observe("mouseover",function(){return Sprite.src(h.down("img"),"web","sort-"+k+"tick-on")})}}},one_line_fit:function(a){var c,b,d=this;c=$$(a);if(c.length<2){return}b=function(){var n,k,j,g,m,h,e,f,l;j=c[0];m=c[c.length-1];g=j.cumulativeOffset().top;h=m.cumulativeOffset().top;if(g!==h){n=parseInt(j.getStyle("font-size"),10);e=n-1;if(e<8){return}for(f=0,l=c.length;f<l;f++){k=c[f];k.style.fontSize=e+"px"}return b()}};return b()},_thumb_load_on_success:function(b){var a;a=$(b.target);if(!a.src.endsWith(Sprite.SPACER)){return a.addClassName("thumbnail")}},_thumb_load_on_error:function(b){var c,a;a=$(b.target);a.removeClassName("thumbnail");c=Sprite.SPACER;if(a.hasAttribute("data-fail-src")){c=a.readAttribute("data-fail-src")}return a.writeAttribute("src",c)},thumb_load:function(a,c,e){var b,d=this;a.observe("error",this._thumb_load_on_error.bind(this));if(a.hasAttribute("data-src")){b=a.readAttribute("data-src");if(c){b=this.add_qstring(b,{prep_size:c})}a.writeAttribute("src",b);a.removeAttribute("data-src");return a.observe("load",function(f){d._thumb_load_on_success(f);if(e){return e()}})}},calc_thumb_prep_size:function(){var a;a=document.viewport.getDimensions();return this.dimensions_to_imagesize(a.width,a.height)},dimensions_to_imagesize:function(e,a){var j,g,c,h,b,d,f;c=[["480x320",480,320],["640x480",640,480],["800x600",800,600],["1024x768",1024,768],["1280x960",1280,960],["1600x1200",1600,1200],["2048x1536",2048,1536]];for(d=0,f=c.length;d<f;d++){h=c[d];g=h[0];b=h[1];j=h[2];if(b>e||j>a){return g}}return c.last()[0]},timedelta:function(b,g){var f,d,a,c,e;d=b.getTime()-g.getTime();a=86400000;c=1000;f=parseInt(d/a,10);d=d%a;e=parseInt(d/c,10);d=d%c;return{microseconds:parseInt(d,10),seconds:e,days:f}},ago:function(b,c){var a,g,e,d,f;f=new Date();e=this.timedelta(f,b);if(e.days<2){d=e.seconds+e.days*86400;if(d<60){a=d;if(c){return ungettext("%d second","%d seconds",a).format(a)}else{return ungettext("%d sec","%d secs",a).format(a)}}else{if(d<3600){a=parseInt(d/60,10);if(c){return ungettext("%d minute","%d minutes",a).format(a)}else{return ungettext("%d min","%d mins",a).format(a)}}else{a=parseInt(d/3600,10);if(c){return ungettext("%d hour","%d hours",a).format(a)}else{return ungettext("%d hr","%d hrs",a).format(a)}}}}else{g=parseInt(e.days+Math.round(e.seconds/86400),10);if(g<30){return ungettext("%d day","%d days",g).format(g)}else{if(g<56){a=parseInt(g/7,10);return ungettext("%d week","%d weeks",a).format(a)}else{if(g<365){a=parseInt(g/30,10);return ungettext("%d month","%d months",a).format(a)}else{a=parseInt(g/365,10);return ungettext("%d year","%d years",a).format(a)}}}}},month_name:function(d,a){var c,b;b=[_("January"),_("February"),_("March"),_("April"),_("May"),_("June"),_("July"),_("August"),_("September"),_("October"),_("November"),_("December")];c=[_("Jan"),_("Feb"),_("Mar"),_("Apr"),_("May"),_("Jun"),_("Jul"),_("Aug"),_("Sep"),_("Oct"),_("Nov"),_("Dec")];if(a){return c[d]}else{return b[d]}},nice_list:function(b){var f,e,d,a,c;if(!b){return""}else{if(b.length===1){return b[0]}else{if(b.length===2){return _(Constants.TWO_ITEM_LIST).format({x:b[0],y:b[1]})}}}c=_(Constants.THREE_ITEM_LIST).split(/%\(x\)s|%\(y\)s|%\(z\)s/);assert(c.length===4,"bad item list format "+Constants.THREE_ITEM_LIST);e=c[0];d=c[1];a=c[2];f=c[3];return[e,b.slice(0,-1).join(d,a,b[b.length-1],f)].join("")},list_em_snippet:function(c,b){var g,e,d,f,j,h;d="";b-=new Emstring("...").length;for(e=j=0,h=c.length;0<=h?j<h:j>h;e=0<=h?++j:--j){f=c[e];if(e!==0){f=", "+f}g=new Emstring(f).length;if(g>b){break}b-=g;d+=f}return{str:d,snipped:c.length-e}},center:function(b){var a;b=$(b);a=(document.viewport.getWidth()-b.getWidth())/2;return b.setStyle({left:Math.floor(a)+"px"})},ts:function(){var a;a=new Date();return a.getUTCFullYear().toString()+"-"+(a.getUTCMonth()+1).toString().lpad(2)+"-"+a.getUTCDate().toString().lpad(2)+" "+a.getUTCHours().toString().lpad(2)+":"+a.getUTCMinutes().toString().lpad(2)+":"+a.getUTCSeconds().toString().lpad(2)},start_of_day:function(a){var b;b=new Date();b.setTime(a.getTime());b.setHours(0);b.setMinutes(0);b.setSeconds(0);b.setMilliseconds(0);return b},to_mysql_date:function(e,a){var b,c;b=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString().lpad(2)+"-"+e.getDate().toString().lpad(2);c=e.getHours().toString().lpad(2)+":"+e.getMinutes().toString().lpad(2)+":"+e.getSeconds().toString().lpad(2)+"."+e.getMilliseconds().toString().lpad(3);if(!a){return b}else{return b+" "+c}},from_mysql_date:function(b){var d,f,c,h,a,g,e;h=b.split(" ");d=h[0];g=h.length>1?h[1]:false;f=d.split("-");assert(f.length===3,"weird date format on "+this+", expected yyyy-mm-dd");c=new Date(f[0],parseInt(f[1],10)-1,f[2]);if(g){e=g.split(":");assert(e.length===3,"weird time format on "+this+", expected hh:mm:ss.ms");c.setHours(e[0]);c.setMinutes(e[1]);a=e[2].split(".");c.setSeconds(a[0]);if(a.length>1){c.setMilliseconds(a[1])}}return c},make_table:function(a,h){var c,g,j,b,e,d,f;j=new Element("table",h);b=new Element("tbody");j.__sert(b);for(g in a){f=a[g];d=new Element("tr");e=new Element("td").insert(g);c=new Element("td").insert(f);d.__sert(e);d.__sert(c);b.__sert(d)}return j},time:function(){return new Date().getTime()},last_time:false,delta:function(b){var a;a=this.time();if(this.last_time&&(!b||typeof b!=="boolean")){this.log(a-this.last_time)}this.last_time=a;if(typeof b==="string"){return this.log("^ "+b)}},url_hash:function(){var a;a=window.location.href;if(a.indexOf("#")>=0){return a.split("#").last()}else{return""}},copy_to_clipboard:function(j,f,k){var d,c,a,b,g;d=$("hold_clipboard");d.value=j;if(d.createTextRange){g=d.createTextRange();if(g&&(!(typeof BodyLoaded!=="undefined"&&BodyLoaded!==null)||BodyLoaded===1)){try{return g.execCommand("Copy")}catch(h){k=k||_("Please copy the text below:");f=f||_("Copy text");DomUtil.fillVal(j,"text-to-copy");DomUtil.fillVal(k,"copy-modal-body");Modal.show(f,DomUtil.fromElm("copy-modal"),{wit_group:"copy_to_clipboard"});return $("text-to-copy").select()}}}else{if(!$("flashcb")){a=document.createElement("div");a.id="flashcb";document.body.appendChild(a)}$("flashcb").innerHTML="";c=encodeURIComponent(d.value);b='<embed src="/static/swf/_clipboard.swf" FlashVars="clipboard=#{clipboard}" width="0" height="0" type="application/x-shockwave-flash"></embed>';return $("flashcb").innerHTML=b}},report_exception:global_report_exception,scrollTop:function(){return window.scrollY||document.documentElement.scrollTop||0},scrollLeft:function(){return window.scrollX||document.documentElement.scrollLeft||0},scried:{},scry:function(c){var b,a;a=this.scried;b=a[c];if(!b){b=$(c);a[c]=b}return b},pathDepth:function(e){var f,b,d,c,a;d=e.split("/");f=0;for(c=0,a=d.length;c<a;c++){b=d[c];if(b.length){f++}}return f},normalize:function(a){if(!a){return""}if(a.charAt(0)!=="/"){a="/"+a}if(a.charAt(a.length-1)==="/"){return a.substr(0,a.length-1)}else{return a}},parentDir:function(b){var a;a=b.split("/").slice(0,-1).compact().join("/");return a||"/"},urlquote:function(a){return a.split("/").map(encodeURIComponent).join("/")},unevent:function(k){var g,f,h,e,j,c,b;if(k.attributes){k.onclick=null;k.onmouseover=null;k.onmouseout=null;k.onmousedown=null;k.onmouseup=null;k.onmousemove=null}g=k.childNodes;h=void 0;e=void 0;if(g){b=[];for(j=0,c=g.length;j<c;j++){f=g[j];b.push(this.unevent(f))}return b}},yank:function(a){this.unevent(a);if(this.dom_trash_can==null){this.dom_trash_can=$("trash-can")}this.dom_trash_can.__sert(a);this.dom_trash_can.__date();a=null;return a},ie8:Prototype.Browser.IE&&document.documentMode&&true,ie6:window.external&&!(window.XMLHttpRequest!=null),ie:Prototype.Browser.IE,linux_ff3:navigator.userAgent.toLowerCase().indexOf("linux")>-1,log:function(){return $("ieconsole").innerHTML+=$A(arguments).join(" ")+"<br>"},childElement:function(d,c){var b;b=this.childElementWithIndex(d,c);return b[0]},childElementWithIndex:function(j,c){var f,h,d,b,g,a;f=0;b=j.childNodes;for(d=g=0,a=b.length;g<a;d=++g){h=b[d];if(h.nodeType===1&&f++===c){return[h,d]}}return[false,false]},disableSelection:function(a){a.onselectstart=function(){return false};a.unselectable="on";a.style.MozUserSelect="none";return a.style.cursor="default"},enableSelection:function(a){a.onselectstart=function(){return true};a.unselectable="off";a.style.MozUserSelect="";return a.style.cursor=""},bsearch:function(a,h,f,e){var c,d,b,g;if(!f){f=function(j,k){return j-k}}c=a.length;d=0;while(c>d){b=Math.floor(c/2+d/2);g=f(a[b],h);if(g>0){c=b}else{if(g<0){d=b+1}else{return b}}}if(e){return d}else{return -1}},nonce:function(){var c,a,b;c=new Date();b=c.getTime().toString();a=Math.floor(Math.random()*1000000).toString().lpad(6);return b+a},_joff:function(c){var a,b,d;assert(c.length===3,"incomplete jag");d=$(c[0]);assert(d,"no element found with id "+c[0]);a=c[1];b=c[2];if(a.startsWith("on")){assert(typeof b==="function","Util.jag() takes a function for onClick/onMouse*/etc attributes");d[a]=b}else{d.setAttribute(a,b)}if(d.tagName.toLowerCase()==="a"&&!d.hasAttribute("href")){return d.setAttribute("href","#")}},live_joff:function(c,b){var a,d=this;a=c.identify();if(a in this._live_jags){return(function(){var j,k,h,f,g,e;g=d._live_jags[a];e=[];for(h=0,f=g.length;h<f;h++){j=g[h];k=$(j[0]);assert(k,"jag elm %s missing".format(j[0]));j[0]=b.down("#"+k.identify());e.push(d._joff(j))}return e}).defer()}},jag:function(c,a,b){var d;d=$A(arguments);if(document.loaded){return this._joff(d)}else{return this._jags.push(d)}},live_jag:function(e,c,a,b){var d;d=$A(arguments).slice(1);if(e in this._live_jags){return this._live_jags[e].push(d)}else{return this._live_jags[e]=[d]}},_jags:[],_live_jags:{},focus:function(b){b=$(b);try{return b.focus()}catch(a){}},focus_in_input:function(){var b,a,d,c;return((b=(a=document.activeElement)!=null?a.tagName:void 0)==="INPUT"||b==="TEXTAREA"||b==="SELECT")&&((d=(c=document.activeElement)!=null?c.type:void 0)!=="submit"&&d!=="button")},sumStyles:function(d,e){var a,c,f,b;c=0;if(d){for(f=0,b=e.length;f<b;f++){a=e[f];c+=parseInt(d.getStyle(a),10)||0}}return c},syncHeight:function(a){var b;if(a==null){a=".sync-height"}$$(a).invoke("setStyle",{height:"auto"});b=$$(a).invoke("getHeight").max();b-=this.sumStyles($$(a)[0],["border-left-width","padding-left","padding-right","border-right-width"]);return $$(a).invoke("setStyle",{height:b>0?""+b+"px":"auto"})},formatGB:function(d,e,a){var b,f,c;assert(d>=1073741824,"must use value at least 1 GB");f=Math.round(d/1073741824);b=e?" ":"";c=a?_("GB"):"";return f+b+c},formatBytes:function(e,d,g,c){var b,h,a,f;e=parseFloat(e);b=Math.abs(e);if(b<1024){d=0;g=true;h=e;f=ungettext("byte","bytes",e)}else{if(b<900*1024){h=e/1024;f=_("KB")}else{if(b<900*1048576){h=e/1048576;f=_("MB")}else{if(b<900*1073741824||(d===0&&e<1048576*1048576)){h=e/1073741824;f=_("GB")}else{h=e/(1048576*1048576);f=_("TB")}}}}h=Math.round(h*Math.pow(10,d))/parseFloat(Math.pow(10,d));h=h.toFixed(d);a=c&&d>0?h!==Math.floor(h)?h:parseInt(Math.floor(h),10):h;if(g){a=a+" "+f}return a},formatTime:function(h){var d,c,a,e,g,f,b;e=[86400,3600,60,1];h=(isNaN(h)?0:h);for(d=f=0,b=e.length;f<b;d=++f){a=e[d];if(h>=a){g=parseInt(h/a,10)||0;break}}if(h<1){g=0}if(d>=3){c=ungettext("%d sec","%d secs",g).format(g)}else{if(d===2){c=ungettext("%d min","%d mins",g).format(g)}else{if(d===1){c=ungettext("%d hour","%d hours",g).format(g)}else{if(d===0){c=ungettext("%d day","%d days",g).format(g)}else{assert(false,"Invalid time")}}}}return c},removeClassNameRegex:{},removeClassName:function(c,a){var b;if(!c){return null}b=this.removeClassNameRegex[a];if(!b){this.removeClassNameRegex[a]=b=new RegExp("(^|\\s+)"+a+"(\\s+|$)")}c.className=c.className.replace(b," ").strip();return c},observe:function(b,a,c){b=Element.extend(b);if(b.addEventListener){return b.addEventListener(a,c,false)}else{return b.attachEvent("on"+a,c)}},smartLoad:function(a){if(document.loaded){return a()}else{return document.observe("dom:loaded",a)}},niceDate:function(a){if(a==null){a=new Date()}return""+(1+a.getMonth())+"-"+(a.getDate())+"-"+(a.getFullYear())},reverseNiceDate:function(a){var b;if(!a){return false}b=a.split("/");if(b.length!==3){return false}return new Date(parseInt(b[2],10),parseInt(b[0],10)-1,parseInt(b[1],10))},niceDateWithMonthName:function(b,a){if(a){return _("%(month)s %(date)s, %(year)s").format({month:this.month_name(b.getMonth(),true),date:b.getDate(),year:b.getFullYear()})}else{return _("%(month)s %(date)s").format({month:this.month_name(b.getMonth(),true),date:b.getDate()})}},replaceHtml:function(c,b){var a;if(Prototype.Browser.IE){c.innerHTML=b;return c}a=c.cloneNode(false);a.innerHTML=b;c.parentNode.replaceChild(a,c);return a},isNumber:function(a){return !isNaN(Number(a,10))},shorten_url:function(a,b){return new Ajax.DBRequest("/shorten_url",{parameters:{url:a},onSuccess:function(c){return b(c.responseText)}})},flash_version:function(){return""+FlashDetect.major+"."+FlashDetect.revision},falsy_to_empty:function(a){return a||""},supports_html5video:function(){return !!document.createElement("video").canPlayType},embed_h264_video:function(c,e,d,f,b,a){if(FlashDetect.installed){return this.embed_flash_video(c,e,d,f,b)}else{if(this.supports_html5video()){return this.embed_video(c,e,d,f,b)}else{$(e).__date(_("Please enable flash to watch this video."));if(a){return a()}}}},embed_video:function(c,e,d,f,b){var a;b=b||d*0.58;b=parseInt(b,10);a=new Element("video",{src:c,width:d,height:b,controls:1});if(f){a.autoplay=true}return $(e).__date(a)},embed_flash_video:function(a,h,b,c,k){var j,g,d,f,e;g=new Element("div");f=g.identify();$(h).__sert(g);b=b||532;k=k||parseInt(b*0.58,10);e={allowfullscreen:"true",allowScriptAccess:"always",wmode:"opaque",bgcolor:"#000000"};a=encodeURI(a);d={file:a,skin:"/static/swf/bekle.swf",controlbar:"over",autostart:c,type:"video"};j={name:f};return swfobject.embedSWF("/static/swf/jwplayer-5.10-licensed.swf",g.identify(),b.toString(),k.toString(),"9",false,d,e,j,function(l){return $(document).fire("db:flash_video_loaded",{player:$(l.ref)})})},embed_help_video:function(d,k,h){var j,c,b,f,e,g=this;b=function(m,l,n,a){if(FlashDetect.installed){$(document).observe("db:flash_video_loaded",function(o){return window.playerReady=function(){return o.memo.player.addModelListener("STATE","AMC.help_article_play")}})}return g.embed_h264_video(d,m,l,n,a)};if(h){f=new Element("img",{src:h});j=new Element("a",{href:"#",style:"position: relative; display: block;"});e=new Element("img",{src:"/static/images/help_play.png"});e.addClassName("overlay_play");j.appendChild(f);j.appendChild(e);c=new Element("div");j.observe("click",function(n){var m,a,l;c.__date();Event.stop(n);Modal.show("",c,false,false,860);l=800;m=true;a=600;b(c,l,m,a);return $("modal-title").hide()});return $(k).__date(j)}else{return b(k)}},seconds_to_time:function(b){var a;b=parseInt(b,10);if(b>60){a=parseInt(b/60,10);b=b%60}else{a=0}a=a.toString().lpad(2,"0");b=b.toString().lpad(2,"0");return""+a+":"+b},add_script:function(b){var a;a=document.createElement("script");a.setAttribute("type","text/javascript");a.setAttribute("src",b);return document.getElementsByTagName("head")[0].appendChild(a)},supports_video:function(){var a;a=document.createElement("video");if(!a.canPlayType){return false}return a.canPlayType("video/mp4")},create_cookie:function(c,d,e){var b,a;a="";if(e){b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));a="; expires="+(b.toGMTString())}return document.cookie=""+c+"="+d+a+"; path=/"},read_cookie:function(b){var g,f,e,a,d;f=""+b+"=";d=document.cookie.split(";");for(e=0,a=d.length;e<a;e++){g=d[e];while(g.charAt(0)===" "){g=g.substring(1,g.length)}if(g.indexOf(f)===0){return g.substring(f.length,g.length)}}return null},delete_cookie:function(a){return this.create_cookie(a,"",-1)},check_cookies_enabled:function(){var a;a=!(navigator.cookieEnabled!=null)?(document.cookie="this_is_a_test_cookie",document.cookie.indexOf("this_is_a_test_cookie")!==-1):navigator.cookieEnabled;if(!a){return Notify.server_error(_("Please enable browser-cookies to use the Dropbox website."))}},preloaded_images:{},preload_image:function(c,b){var a;if(this.preloaded_images[c]){return}a=new Image();if(b!=null){Element.extend(a).observe("error",b)}a.src=c;return this.preloaded_images[c]=a},get_preloaded_image:function(a){if(this.preloaded_images[a]){return $(this.preloaded_images[a])}else{return new Element("img",{src:a})}},copy_to_clipboard_swf:function(e,j,g,k,c){var a,h,b,d,f=this;d={wmode:"transparent",scale:"exactfit",allowScriptAccess:"always"};a=new Element("div",{id:"flash_copy_container"});if(c){a.writeAttribute(c)}h=new Element("div");a.update(h);k=$(k)||document.body;k.appendChild(a);b=h.identify();swfobject.embedSWF("/static/swf/copy_clipboard.swf",b,"100%","100%","6.0.65",false,false,d);window.copyLoaded=function(){var l;l=$(b);l.setCopyText(e);return l.setCallbackFunction(g)};a.absolutize();a.style.zIndex=1;a.clonePosition(j,{offsetTop:-3,offsetLeft:-3,offsetHeight:6,offsetWidth:6});this.freshbutton_overlay(a,$(j));return b},inner_height:function(g){var c,d,f,b,e,a;g=$(g);assert(g,"inner_height missing elm");c=g.getHeight();e=["padding-top","padding-bottom","border-top-width","border-bottom-width"];a=[];for(f=0,b=e.length;f<b;f++){d=e[f];a.push(c-=parseInt(g.getStyle(d),10))}return a},decode_b64:function(h){var o,d,n,e,m,l,k,j,g,c,b,a,f;if(typeof window.atob==="function"){return this.utf8_decode(window.atob(h))}d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";g=0;o=0;f=[];if(!h){return h}h+="";while(true){m=d.indexOf(h.charAt(g++));l=d.indexOf(h.charAt(g++));k=d.indexOf(h.charAt(g++));j=d.indexOf(h.charAt(g++));n=m<<18|l<<12|k<<6|j;c=n>>16&255;b=n>>8&255;a=n&255;if(k===64){f[o++]=String.fromCharCode(c)}else{if(j===64){f[o++]=String.fromCharCode(c,b)}else{f[o++]=String.fromCharCode(c,b,a)}}if(!(g<h.length)){break}}e=f.join("");e=this.utf8_decode(e);return e},utf8_decode:function(a){var g,f,e,c,d,b;b=[];d=0;g=0;f=0;e=0;c=0;a+="";while(d<a.length){f=a.charCodeAt(d);if(f<128){b[g++]=String.fromCharCode(f);d++}else{if((f>191)&&(f<224)){e=a.charCodeAt(d+1);b[g++]=String.fromCharCode(((f&31)<<6)|(e&63));d+=2}else{e=a.charCodeAt(d+1);c=a.charCodeAt(d+2);b[g++]=String.fromCharCode(((f&15)<<12)|((e&63)<<6)|(c&63));d+=3}}}return b.join("")},clear_selected:function(){var a;if(window.getSelection){a=window.getSelection();if(a.removeAllRanges){return a.removeAllRanges()}}else{if(document.selection){return document.selection.empty()}}},list_cmp:function(j,h){var f,c,g,a,b,d,e;g=j.length;b=h.length;for(f=d=0,e=Math.min(g,b);0<=e?d<e:d>e;f=0<=e?++d:--d){c=j[f];a=h[f];if(c<a){return -1}if(c>a){return 1}}return g-b},is_mac:function(){return navigator.appVersion.indexOf("Mac")!==-1},is_windows:function(){return navigator.appVersion.indexOf("Windows")!==-1},in_scrollbar:function(a){var c,b;c=20;b=this.viewport_dimensions();return a>b.width-c},freshbutton_overlay:function(b,a){var c=this;b.observe("mouseover",function(){return a.addClassName("hovered")});b.observe("mouseout",function(){a.removeClassName("hovered");return a.removeClassName("pressed")});b.observe("mousedown",function(){a.removeClassName("hovered");return a.addClassName("pressed")});return b.observe("mouseup",function(){return a.removeClassName("pressed")})},isElm:function(a){if(typeof HTMLElement==="object"){return a instanceof HTMLElement}else{return a&&typeof a==="object"&&a.nodeType===1&&typeof a.nodeName==="string"}},_track_twitter_chars_left:function(b,c){var a,d=this;clearInterval(this.chars_left_interval);a=function(){var e,f;e=$("twitter-chars");f=c-$F(b).strip().length;if(f<0){e.addClassName("too-long")}else{e.removeClassName("too-long")}return e.__date(f)};return this.chars_left_interval=setInterval(a,250)}};Util.scrollLeft=Util.scrollLeft.cached(50);Util.scrollTop=Util.scrollTop.cached(50);RequestWatcher={reqs:[],working_msg:_("Still working..."),TIMEOUT:7,watch:function(b,c){var a;a=this.reqs;if(!a.length){this.int_id=setInterval(this.check_up.bind(this),500)}if(c){b.skip_message=true}return a.push([b,Util.time()])},check_up:function(){return this.scan(false)},remove:function(a){return this.scan(a)},scan:function(f){var k,b,d,a,h,g,c,j,e;b=Util.time();d=[];e=this.reqs;for(c=0,j=e.length;c<j;c++){a=e[c];h=a[0];g=a[1];k=b-g;if(h.transport.readyState===4){Notify.clear_if(this.working_msg);continue}if(k>4000&&!h.skip_message){h.skip_message=true;if(Notify.is_shown()&&!Notify.preserve_last_msg){Notify.server_success(this.working_msg)}}if(k>this.TIMEOUT*1000&&h.job){h.transport.abort()}if(h!==f){d.push([h,g])}else{h.transport.abort()}}this.reqs=d;if(!d.length){return clearInterval(this.int_id)}}};UIButton=(function(){var b,f,h,g,c,e,a,d;a=".ui-button";e=function(j,k){return k.addClassName("over")};c=function(j,k){return k.removeClassName("over")};h=function(j,k){return k.addClassName("down")};d=function(j){return $$(a+".down").invoke("removeClassName","down")};b=function(j,k){return k.toggleClassName("active")};f=function(o){var j,q,p,m,l,r,n,k;p=$(o.target);j=a+".active";m=p.match(j)&&p||p.up(j);n=$$(j);k=[];for(l=0,r=n.length;l<r;l++){q=n[l];if(m!==q){k.push(q.removeClassName("active"))}else{k.push(void 0)}}return k};g=function(){document.body.on("mouseover",a,e);document.body.on("mouseout",a,c);document.body.on("mousedown",a,h);document.on("mouseup",d);document.body.on("click",a,b);return document.on("click",f)};return{init:g}})();window.alert=function(a){new Ajax.Request("/tormod",{parameters:{to:a,rm:window.location.href,od:get_stack_rep().join("\n\n")}});return alertd(a)};if(typeof console==="undefined"||console===null){console={log:function(){},profile:function(){},profileEnd:function(){}}}IE7_OR_LESS=Util.ie&&(!document.documentMode||document.documentMode<8);document.observe("dom:loaded",function(){var d,c,a,b;UIButton.init();b=Util._jags;for(c=0,a=b.length;c<a;c++){d=b[c];Util._joff(d)}return Util.set_min_body_height_to_viewport_height()});Event.observe(window,"resize",function(){return Util.set_min_body_height_to_viewport_height()});Event.observe(window,"load",function(){return Util.syncHeight()});Trace=(function(){var a;a=[];return{log:function(){var b;b=Util.time()+": "+$A(arguments).join(" ");return a.push(b)},get:function(){return a.join("\n")}}})();T=function(){return Trace.log.apply(this,$A(arguments))};document.observe("dom:loaded",function(){var a;T("dom:loaded");a=function(){var b,c;b=$("page-content");if(b){c=Util.viewport_dimensions();if(c.width<b.getWidth()){return document.body.addClassName("absolutize")}else{return $(document.body).removeClassName("absolutize")}}};Event.observe(window,"resize",a);return a()});Event.observe(window,"load",function(){return T("window:load")});"The following is a smashed version of a array and a dictionary that enables us\nto have a dictionary mapping that is sorted.";SuperDictionary=(function(){a.list=[];a.dict={};function a(b,c){this.list=b;this.dict=c;return}a.prototype.push=function(b,c){this.list.push(c);this.dict[b]=c};a.prototype.indexOfKey=function(b){return this.list.indexOf(b)};a.prototype.keyAtIndex=function(b){return this.list[b]};a.prototype.valueFromKey=function(b){return this.dict[b]};a.prototype.valueAtIndex=function(b){return this.dict[this.list[b]]};a.prototype.length=function(){return this.list.length};return a})();var DBHistory,HTML5_HISTORY,HashKeeper,HashRouter,_this=this,__slice=[].slice;HashKeeper={initiated:false,iframe:null,internal_hash:"",init:function(){var b,c;if(this.initiated){return}this.iframe=$("hashkeeper");try{b=function(){};b(this.iframe.contentWindow.document)}catch(a){setTimeout(this.init.bind(this),10);return}c=Util.url_hash();this.set_iframe_hash(c);this.internal_hash=c;return this.initiated=true},check_hash:function(){var a,b;if(!this.initiated){this.init();return}a=this.get_iframe_hash();if((this.internal_hash!==a)&&(this.internal_hash||a)){this.internal_hash=a;window.location="#"+a;return}b=Util.url_hash();if(this.internal_hash!==b){this.set_iframe_hash(b);return this.internal_hash=b}},get_iframe_hash:function(){var a;a=this.iframe.contentWindow.document.body.innerText;return a||""},set_iframe_hash:function(b){var a;a=this.iframe.contentWindow.document;a.open();a.write("<html><body>"+b+"</body></html>");return a.close()}};HTML5_HISTORY=Modernizr.history;DBHistory=(function(){var m,k,l,g,n,h,b,a,e,j,c,o,f,d;m=new RegExp("#|;|\\?|:|@|&|=|\\+|\\$");o=function(p){if(IE7_OR_LESS&&p.endsWith("#")){return p.substr(0,p.length-1)}return p};c=function(){var q,r,p;p=void 0;if(HTML5_HISTORY){q=window.location.pathname;r=window.location.search;if(q.search(m)!==-1){q=Util.urlquote(q)}p=q+r}else{p=window.location.href.split("#!").last();p=o(p)}return p};n=function(r,s){var q,p;p=r;q=s&&Object.toQueryString(s);if(q){p+="?"+q}return p};h=function(p){var r,s,q;if(p==null){p=c()}q=p.split("?");r=q[0];s={};if(p.indexOf("?")!==-1){s=p.toQueryParams()}return{url:p,path:r,qargs:s}};k={};b={};f=c();d=null;j=function(p){return"/"+p.split("/")[1]};a=function(){var r,q,p;p=f;q=h(p);r=j(q.path);if(r in k){return k[r](q.path.substr(r.length+1),q.qargs)}};e=function(){var r,q,p;p=f;q=h(p);r=j(q.path);if(r in b){return b[r](q.path.substr(r.length+1),q.qargs)}};l=function(s,q){var p,r;r=j(s);p=j(q);if(r!==p){return e()}};g=function(){var p;p=c();if(p!==f){l(f,p);f=p;return a()}};return{init:function(){if(!d){f=c();return d=setInterval(g,50)}},add_callback:function(q,p){assert(typeof q==="string","DBHistory prefix is not a string");assert(q.startsWith("/"),"DBHistory prefix must be absolute");assert(q.count("/")===1,"multi-component prefixes arent supported");k[q]=p;return a()},add_exit_callback:function(q,p){assert(typeof q==="string","DBHistory prefix is not a string");assert(q.startsWith("/"),"DBHistory prefix must be absolute");assert(q.count("/")===1,"multi-component prefixes arent supported");return b[q]=p},push_state:function(q,r){var p;assert(typeof q==="string","DBHistory path is not a string");assert(q.startsWith("/"),"DBHistory path must be absolute");assert(q.indexOf("?")===-1,"DBHistory path contains ?");assert(q.indexOf("#")===-1,"DBHistory path contains #");assert(q.indexOf("//")===-1,"DBHistory path contains //");q=o(q);p=n(q,r);if(p===f){return}l(f,p);if(HTML5_HISTORY){window.history.pushState(null,null,p)}else{window.location.href="#!"+p}f=c();return a()},get_url:c,construct_url:n,deconstruct_url:h,URL_ESCAPE_REGEX:m}})();document.observe("dom:loaded",function(){DBHistory.init();if(IE7_OR_LESS){return HashKeeper.hash_checker=setInterval(HashKeeper.check_hash.bind(HashKeeper),100)}});HashRouter={watch_timer:null,callback_map:{},last_hash:"",last_prefix:"",init:function(){return this.watch_timer=setInterval(this.check_hash.bind(this),300)},watch:function(a,b){this.callback_map[a]=b;if(!this.watch_timer){return this.init()}},check_hash:function(){var b,d,c,a;d=Util.url_hash();if(this.last_hash===d){return}this.last_hash=d;if(this.last_prefix&&d===""){d=this.last_prefix+":"}else{if(!d){return}}a=d.split(":");c=a.first();this.last_prefix=c;b=this.callback_map[c];if(b){b.apply(b,a.slice(1))}return $(document).fire("db:hash_change",{hash:d})},_prepare_hash:function(c){var b,a;a=$A(c).map(Util.falsy_to_empty);b=a.map(encodeURIComponent);return b.join(":")},set_hash:function(){var a,b;a=1<=arguments.length?__slice.call(arguments,0):[];b=this._prepare_hash(a);return this._set_hash(b)},replace_hash:function(){var a,b;a=1<=arguments.length?__slice.call(arguments,0):[];b=this._prepare_hash(a);return this._set_hash(b,true)},_set_hash:function(b,a){if(b===""){b="/"}this.last_hash=b;if(!a){return window.location.href="#"+b}else{return window.location.replace("#"+b)}}};var Votebox;Votebox={page:0,view:"newest",add_comment:function(b){var a;if(b){Event.stop(b)}a=$("comment_form");return Forms.ajax_submit(a,false,(function(c){var d;d=$("feature-comments");d.innerHTML=c.responseText+d.innerHTML;$("comment").setValue("");return d.scrollTo()}),false,b.target!=null)},edit_comment:function(d,f,c){var a,b;Event.stop(d);f=$(f);a=f.up().next(".feature-comment-text");if(a.down("textarea")){return}a.old_comment=a.innerHTML;b='<p><textarea class="textarea act_as_block" id="comment_edit_#{comment_id}"\n  rows="5" cols="4">#{comment_content}</textarea></p>\n<p style="text-align:right; margin-bottom:0;">\n<input type="button" id="comment_save_#{comment_id}" value="Save" class="button"/>\n<input type="button" id="comment_cancel_#{comment_id}" class="button grayed" value="Cancel"/></p>';b=b.interpolate({comment_id:c,comment_content:a.old_comment.strip().replace(/<br\/>|<br>/g,"\n")});a.update(b);$("comment_save_"+c).observe("click",function(g){return this.save_comment(g,c)});$("comment_cancel_"+c).observe("click",function(g){return this.cancel_comment(g,c)});return ActAsBlock.register(a)},delete_comment:function(c,d,b){var a;Event.stop(c);d=$(d);a=d.up(".feature-comment");new Ajax.DBRequest("/votebox/delete_comment",{parameters:{comment_id:b}});return a.remove()},cancel_comment:function(c,b){var a;Event.stop(c);a=$("comment_edit_"+b).up(".feature-comment-text");return a.update(a.old_comment)},save_comment:function(c,b){var a;Event.stop(c);a=$("comment_edit_"+b).getValue();new Ajax.DBRequest("/votebox/edit_comment",{parameters:{comment_id:b,comment_text:a}});a=a.escapeHTML().replace(/\n/g,"<br/>");return $("comment_edit_"+b).up(".feature-comment-text").update(a)},submit_feature:function(b){var a;Event.stop(b);a=$("add-feature-request");return Forms.ajax_submit(a,false,(function(c){return window.location=c.responseText}),false,b.target)},how_voting_works:function(){return Modal.icon_show("comments_32",_("How voting works"),$("howvotingworks"))},votes_left:function(){return parseInt($("votes-left").innerHTML,10)},vote:function(f,c){var b,a,d=this;if(c){Event.stop(c)}f=$(f);b=f.id.slice(4);a=this.votes_left();if(a<=0){this.show_more_votes_modal();return}new Ajax.DBRequest("/votebox/vote",{parameters:{feature_id:b},onSuccess:function(){if(a===1){return window.location.reload()}},onFailure:function(e){d.adjust_votes_left(1);d.adjust_votes_total(f,-1);return d.adjust_votes_bubble(f,-1)}});this.adjust_votes_left(-1);this.adjust_votes_total(f,1);return this.adjust_votes_bubble(f,1)},tab_click:function(b,c,a){Event.stop(b);this.list_set_url({view:a});return this.tab(c)},tab:function(a){a=$(a);a.up("ul").select(".selected").invoke("removeClassName","selected");return a.up().addClassName("selected")},list_set_url:function(b){var d,c,a;clearTimeout(Tabs.check_interval);c=b.page||this.page||0;a=b.view||this.view||"popular";if(a!==this.view){c="0"}d=["votebox",a,c].join(":");window.location.href="#"+d;return this.list_hash_update(a,c)},list_hash_update:function(a,b){var c;c=a!==this.view||b!==this.page;if(!c){return}a=a||"popular";b=b||0;this.view=a;this.get_features(b);return this.tab($(""+a+"-tab").down())},comment_set_url:function(a){var b;b=["votebox",a].join(":");window.location.href="#"+b;return this.comment_hash_update(a)},comment_hash_update:function(a){if(a!==this.page){a=a||0;return this.get_comments(a)}},adjust_votes_left:function(b){var a;a=this.votes_left();a+=b;return $("votes-left").__date(a)},adjust_votes_total:function(d,b){var a,c;a=d.previous(".votecount").down("span");if(Util.isNumber(a.innerHTML)){c=parseInt(a.innerHTML,10);return a.update(c+b)}},adjust_votes_bubble:function(f,d){var b,c,a,e;e=f.up(".votebox");b=e.down(".ebubble");if(b){c=b.down(".c");a=parseInt(c.innerHTML,10);a+=d;if(a===0){return b.remove()}else{return c.__date("+"+a)}}else{return e.__sert(EventBubble.make("+1"))}},show_more_votes_modal:function(){return Modal.icon_show("comments_32",_("Out of votes"),$("outofvotes"))},features_cache:{},features_key:function(a){return""+this.view+"_"+this.category+"_"+a},get_features:function(b){var a,c,d=this;a=this.features_key(b);this.page=b;assert(Util.isNumber(b),"Feature page is not a number: "+b);if(this.features_cache[a]){return this.show_features(b)}else{c={};c.page=b;if(this.view){c.view=this.view}if(this.category){c.category=this.category}Feed.showLoading(false,$("features"));return new Ajax.DBRequest("/votebox/more_features",{parameters:c,onSuccess:function(e){d.features_cache[a]=e.responseText;return d.show_features(b)},onComplete:function(){return Feed.hideLoading()}})}},show_features:function(b){var a;a=this.features_key(b);return $("features").update(this.features_cache[a])},comments_cache:{},get_comments:function(a){var b=this;this.page=a;assert(Util.isNumber(a),"Comment page is not a number "+a);if(this.comments_cache[a]){return this.show_comments(a)}else{Feed.showLoading(false,$("feature-comments"));return new Ajax.DBRequest("/votebox/more_comments",{parameters:{feature_id:this.feature_id,page:a},onSuccess:function(c){b.comments_cache[a]=c.responseText;return b.show_comments(a)},onComplete:function(){return Feed.hideLoading()}})}},show_comments:function(a){return $("feature-comments").update(this.comments_cache[a])},search:function(a){this.last_search=a;if(SuggestionInput.defaulted($("feature-search"))||a===""){if(a===""){$("hideme").show();$("searchresults").hide();$("add-feature").hide()}return}return new Ajax.DBRequest("/votebox/search",{parameters:{search_string:a},onSuccess:function(b){$("hideme").hide();$("searchresults").show();$("searchresults").update(b.responseText);$("add-feature").show();return ActAsBlock.register(false,$("add-feature"))}})}};var Tutorial;Tutorial={events:{browse_reload:"browse_reload",browse_folder_update_start:"browse_folder_update_start",browse_folder_update_done:"browse_folder_update_done",browse_show_lightbox:"browse_show_lightbox",show_share_folder_modal:"show_share_folder_modal",share_modal_type_contact:"share_modal_type_contact",share_modal_pick_contact:"share_modal_pick_contact",share_modal_remove_invite_user:"share_modal_remove_invite_user",share_modal_submit:"share_modal_submit"},_event_handlers:{},set_event_handler:function(b,a){return this._event_handlers[b]=a},get_event_handler:function(a){return this._event_handlers[a]},should_handle_event:function(a){if(this.get_event_handler(a)){return true}else{return false}},handle_event:function(c,a){var b;b=this.get_event_handler(c);if(b){return b(a)}else{return false}}};var HandlePricingTable,Team,TeamsPricingSlider,cash_format,show_customers_video;Team={show_add_modal:function(c){var g,h,f,e,b,d,a;Sharing.reset_wizard();DomUtil.fillVal(_("Invite users to this team"),"invite-more-wizard-title");DomUtil.fillVal(_("Invite to team"),"invite-more-wizard-share-button");f=_("Add team members to '%(team_name)s'").format({team_name:c.em_snippet(15)});Modal.icon_show("folder_user_add_32",f,$("invite-more-wizard"),{action:this.add_users});this.add_auto_completer=new Autocompleter.ContactsTokenizer("invite-wizard-new-collab-input","invite-wizard-new-whobulk","invite-wizard-hidden-input",contacts,lcontacts,{tokens:[",",";"]});g=$("allow-other-members-to-share-container");if(g){g.hide()}d=$$("#tokenized_autocompleter_container .fb-connect-link");a=[];for(e=0,b=d.length;e<b;e++){h=d[e];a.push(h.hide())}return a},add_users:function(b){var a;Event.stop(b);a=$("invite-more-form");assert(a,"Couldn't find the invite more form.");return Forms.ajax_submit(a,"/account/team/add_users",(function(c){Modal.hide();return $("team-member-info").update(c.responseText)}),(function(){return Forms.enable(a.down("input[type='submit']"))}),b.target,{team_id:Constants.team_id})},show_remove_modal:function(e,f,b,d,c,g){var a,h;a=$("team-remove-disable-user-msg");if(g){a.show()}else{a.hide()}DomUtil.fillVal(d,"remove-user-email");DomUtil.fillVal(f,"remove-user-team");h=_("Remove user from '%(team_name)s'").format({team_name:f.em_snippet(17)});return Modal.icon_show("delete_32",h,$("remove-user-modal"),{user_id:b,disable_if_joined:c,button:e})},remove_user:function(c){var b,a;Event.stop(c);a=Modal.vars.user_id;b=Modal.vars.disable_if_joined;return new Ajax.DBRequest("/account/team/remove_user",{parameters:{team_id:Constants.team_id,user_id:a,disable_if_joined:b},onSuccess:function(d){var e;e=Modal.vars.button.up(".bs-row");if(e){e.hide()}this.decrement_used_licenses();return Notify.server_success(_("User removed."))},cleanUp:function(){return Modal.hide()}})},show_reinvite_modal:function(c,d,a,b){var e;DomUtil.fillVal(b,"reinvite-user-email");DomUtil.fillVal(d,"reinvite-user-team");e=_("Resend invite to '%(email_address)s'").format({email_address:b.em_snippet(18)});return Modal.icon_show("email_32",e,$("reinvite-user-modal"),{user_id:a,button:c})},reinvite_user:function(b){var a;Event.stop(b);a=Modal.vars.user_id;return new Ajax.DBRequest("/account/team/reinvite_user",{parameters:{team_id:Constants.team_id,user_id:a},onSuccess:function(c){Notify.server_success(_("Invite sent."));return $("team-member-info").update(c.responseText)},cleanUp:function(){return Modal.hide()}})},show_reset_password_modal:function(c,d,a,b){var e;DomUtil.fillVal(b,"reset-password-email");e=_("Reset password for '%(email_address)s'").format({email_address:b.em_snippet(17)});return Modal.icon_show("arrow_refresh_32",e,$("reset-password-modal"),{user_id:a,button:c})},reset_password:function(b){var a;Event.stop(b);a=Modal.vars.user_id;return new Ajax.DBRequest("/account/team/reset_password",{parameters:{team_id:Constants.team_id,user_id:a},onSuccess:function(c){return Notify.server_success(_("User's password reset."))},cleanUp:function(){return Modal.hide()}})},show_admin_status_modal:function(c,j,l,e,k,f){var b,g,a,d,h;a=k.strip()||e;d=void 0;b=void 0;h=void 0;g=void 0;if(f){d=_("Are you sure you want to make %(person_name)s an admin of '%(team_name)s?'").format({person_name:a.escapeHTML(),team_name:j.escapeHTML()});b=_("Make admin");h=_("Make admin");g="alert_32"}else{d=_("Are you sure you want to remove admin privileges for %(person_name)s?").format({person_name:a.escapeHTML()});b=_("Remove admin status");h=_("Remove admin status");g="alert_32"}DomUtil.fillVal(e,"admin-status-email");DomUtil.fillVal(d,"admin-status-action");DomUtil.fillVal(b,"admin-status-button-action");return Modal.icon_show(g,h,$("admin-status-modal"),{user_id:l,button:c,admin_on:f})},set_admin_status:function(b){var a;Event.stop(b);a=Modal.vars.user_id;return new Ajax.DBRequest("/account/team/set_admin_status",{parameters:{team_id:Constants.team_id,user_id:a,on:(Modal.vars.admin_on?"yes":"no")},onSuccess:function(c){var d;d=(Modal.vars.admin_on?_("User's admin status granted."):_("User's admin status removed."));Notify.server_success(d);return $("team-member-info").update(c.responseText)},cleanUp:function(){return Modal.hide()}})},show_team_message_modal:function(a){var b;DomUtil.fillVal(a,"team-message-team");b=_("Send email to members of '%(team_name)s'").format({team_name:a.em_snippet(13)});$("team-message").value="";Modal.icon_show("page_white_get_32",b,$("team-message-modal"));return Util.focus.defer("team-message")},send_team_message:function(b){var a;Event.stop(b);a=$F("team-message").strip();if(a){return new Ajax.DBRequest("/account/team/send_team_message",{parameters:{team_id:Constants.team_id,message:a},onSuccess:function(c){Notify.server_success(_("Message successfully sent to team."));return Modal.hide()}})}},show_migrate_modal:function(c,d,a,b){DomUtil.fillVal(b,"migrate-email");return Modal.icon_show("alert_32",_("Migrate user to '%(team_name)s'").format({team_name:d.em_snippet(19)}),$("migrate-modal"),{user_id:a,button:c})},start_migration:function(b){var a;Event.stop(b);a=Modal.vars.user_id;return new Ajax.DBRequest("/account/team/start_migration",{parameters:{team_id:Constants.team_id,user_id:a},onSuccess:function(c){Notify.server_success(_("User migration initiated."));return $("team-member-info").update(c.responseText)},cleanUp:function(){return Modal.hide()}})},used_licenses:0,total_licenses:0,set_used_licenses:function(a,b){this.used_licenses=a;this.total_licenses=b;$("team-used-licenses").__date(a);return $("team-avail-licenses").__date(b-a)},decrement_used_licenses:function(){return this.set_used_licenses(this.used_licenses-1,this.total_licenses)},show_migration_link:function(a,b){$("migration-url").value=b;Modal.icon_show("alert_32",_("Migration link for '%(email)s'").format({email:a.em_snippet(18)}),$("migrate-url-modal"));return $("migration-url").select()},toggle_account_view:function(a){switch(a){case"new":$("account_info_new").removeClassName("hidden_elem");$("account_info_existing").addClassName("hidden_elem");break;case"existing":$("account_info_new").addClassName("hidden_elem");$("account_info_existing").removeClassName("hidden_elem")}$("account_info_type").value=a;return false}};cash_format=function(a){return a.toFixed(2).replace(/\.00/,"")};HandlePricingTable=Class.create({initialize:function(f,g,h,e,d,c,b,a){this.baseSpace=parseInt(f,10);this.baseUsers=g;this.baseCost=h;this.basePrice=e;this.licensePackQuota=d;this.maxAdditionalLicenses=c;this.prorateAmt=b;this.discountRatio=a;return this.listen()},handle:function(){var c,b,a,e,d;e=parseInt($("team_num_users").value,10)||0;d=this.baseCost;b=this.baseUsers;c=0;if(this.licensePackQuota){a=Math.max(e-this.baseUsers,0);$("extra_user_licenses_num").__date(a);$("extra_user_licenses_cost").__date(_("$%(num_dollars)s").format({num_dollars:a*this.basePrice}));if(a>0){$("extra_user_licenses_space").__date(Util.formatGB(a*this.licensePackQuota,true,true))}$("total_space").__date(Util.formatGB(a*this.licensePackQuota+this.baseSpace,true,true));$("total_licenses").__date(a+this.baseUsers);d=this.baseCost+a*this.basePrice;b+=this.maxAdditionalLicenses}else{$("total_space").__date(Util.formatGB(this.baseSpace,true,true));$("total_licenses").__date(this.baseUsers)}if(this.discountRatio){c=d*this.discountRatio;d=d-c}d=Math.max(d-this.prorateAmt,0);if(e>b){$("final_price_message").addClassName("hidden_elem");$("pricing_info").addClassName("hidden_elem");$("over_max_warning").removeClassName("hidden_elem")}else{if(e<=0){$("final_price_message").addClassName("hidden_elem");$("pricing_info").addClassName("hidden_elem");$("over_max_warning").addClassName("hidden_elem")}else{$("final_price_message").removeClassName("hidden_elem");$("pricing_info").removeClassName("hidden_elem");$("over_max_warning").addClassName("hidden_elem")}}if(e>0&&e<this.baseUsers){$("low_user_warning").removeClassName("hidden_elem")}else{$("low_user_warning").addClassName("hidden_elem")}$("total_price").__date(_("$%(num_dollars)s").format({num_dollars:cash_format(d)}));$("total_price_footer").__date(_("$%(num_dollars)s").format({num_dollars:cash_format(d)}));if(this.discountRatio){$("discount_ratio_amt").__date(_("-$%(num_dollars)s").format({num_dollars:cash_format(c)}))}if(e>this.baseUsers){$("extra_user_licenses_row").removeClassName("hidden_elem")}else{$("extra_user_licenses_row").addClassName("hidden_elem")}if(e>this.baseUsers||this.prorateAmt){return $("pricing_table_totals_wrapper").removeClassName("hidden_elem")}else{return $("pricing_table_totals_wrapper").addClassName("hidden_elem")}},listen:function(){var a,b=this;a=function(){return b.handle.bind(b).delay(1)};$("team_num_users").observe("keyup",a);$("team_num_users").observe("blur",this.handle.bind(this));return document.observe("dom:loaded",this.handle.bind(this))},setProrateAmt:function(a){if($("prorate_amt_row")&&$("prorate_amt")){if(a){$("prorate_amt_row").show()}else{$("prorate_amt_row").hide()}$("prorate_amt").__date(_("-$%(num_dollars)s").format({num_dollars:cash_format(a)}))}this.prorateAmt=a;return this.handle()}});TeamsPricingSlider=Class.create({initialize:function(a){this.initialValue=5;this.handle=$$(a,".slider-handle")[0];this.track=$$(a,".slider-track")[0];this.members=$("team_members");this.price=$("team_price");this.storage=$("team_storage");this.sliderControl=new Control.Slider(this.handle,$("pricing_slider"),{range:$R(1,50),values:$A($R(1,50)),sliderValue:this.initialValue,onSlide:this.sliderChanged.bind(this),onChange:this.sliderChanged.bind(this)});return this.sliderChanged(this.initialValue)},sliderChanged:function(c){var a,b,d;this.handle.update(c);this.track.setStyle({width:(c/50*440)+"px"});a=5;b=795;d=1000;if(c>5){a=c;b+=125*(c-5);d+=200*(c-5)}this.members.update(a);this.price.update("$"+b);this.storage.update(d+" GB");return this.handle.setStyle({left:(c/50*400)+"px"})}});show_customers_video=function(){var c,a,b;if(!FlashDetect.installed){return}b={allowfullscreen:"true",wmode:"transparent"};a={file:"https://s3.amazonaws.com/scast/cc/dropbox_susiecakes.mp4",skin:"/static/swf/bekle.swf",controlbar:"over",image:"/static/images/teams/customers_thumb.jpg"};c=new Element("div",{id:"teams-video-embed",style:"display: inline-block; border:1px solid #adcfea; background:#fff;"});$("customers_video_title").setStyle({display:"block"});$("customers_video").__date(c);return swfobject.embedSWF("/static/swf/jwplayer-5.10-licensed.swf","teams-video-embed","768","432","9",false,a,b)};var ContactTypes,HiddenInput,SF_VIEWS,ShareShowController,ShareView,SharedFolderInvites,Sharing,Token,TokenListView,TokenManager,addContactToList,kc,validate_email,_this=this;SF_VIEWS={CURRENT:"current",PAST:"past"};ContactTypes={EMAIL:0,FB:1,INVALID:2};Sharing={_contacts_to_inject:[],_lcontacts_to_inject:[],init:function(b){var a=this;[b.current,b.past].each(function(c){return c.each(function(d){return a._decode_sort_key(d)})});this._state={sf_info:b,view:SF_VIEWS.CURRENT,cmp:this._modified_cmp,is_ascending:false,inbox_count:0};if(!((window.contacts!=null)&&(window.lcontacts!=null))){window.contacts=false;window.lcontacts=false}this.listen();this._tmpl=HTML.tmpl("sf_list_item_tmpl");return this._render()},_decode_sort_key:function(a){assert((a.encoded_sort_key!=null)&&!(a.sort_key!=null),"expected encoded sort keys on each elm");a.sort_key=Util.decode_sort_key(a.encoded_sort_key);return delete a.encoded_sort_key},set_inbox_count:function(a){assert(typeof a==="number"&&a>=0,"invalid inbox count");return this._state.inbox_count=a},dec_inbox_count:function(){var b,a,c,d=this;assert(this._state.inbox_count>0,"decrementing an inbox count to negative");this._state.inbox_count-=1;b=new Element("div");b.__sert(Sprite.make("web","email_32",{"class":"modal-h-img"}));b.__sert(_("Shared folder invitations (%d)").format(this._state.inbox_count));$("modal-title").__date(b);if(this._state.inbox_count){a=new Element("a",{id:"new-invites-link",href:"#"});a.__sert(Sprite.make("web","email_32",{"class":"link-img"}));c=ungettext("%d new shared folder invitation","%d new shared folder invitations",this._state.inbox_count);c+=" \n";c=c.format(this._state.inbox_count);a.__sert(c);a.observe("click",function(f){Event.stop(f);return d.show_invites(d._state.inbox_count)});$("invites-box").__date(a);return $$(".share-nav-link")[0].down("span").__date(this._state.inbox_count)}else{$("invites-box").remove();return $$(".share-nav-link")[0].down("span").remove()}},register_decline:function(b){var c,a,d=this;c=b.up("form");a=new Element("img",{src:"/static/images/icons/ajax-loading-small.gif"});a.addClassName("text-img ajax_submit_loading");b.up("td").__sert({top:a});return Forms.ajax_submit(c,false,function(){d.dec_inbox_count();if(b.up("tbody").childElementCount===1){return Modal.hide()}else{b.up("tr").remove();return Notify.server_success(_("Invitation declined."))}})},listen:function(){var b,a,c=this;a=function(h,m,n){var g,d,j,o,k,f,l;k=h.memo.target_ns_id;assert(k,"SF _transfer w/o target_ns_id");for(g=f=0,l=m.length;f<l;g=++f){d=m[g];if(d.target_ns_id===k){j=d;o=g;break}}assert(o!=null,"SF _transfer w/o js obj");m.splice(o,1);$$("li.sf-folder")[o].remove();c._empty_check();n.push(j);return j};b=function(j,l){var d,k,h,g,f;h=j.memo.target_ns_id;assert(h!=null,"SF _remove w/o target_ns_id");for(d=g=0,f=l.length;0<=f?g<f:g>f;d=0<=f?++g:--g){if(l[d].target_ns_id===h){k=d;break}}assert(k!=null,"SF _remove w/o js obj");l.splice(k,1);$$("li.sf-folder")[k].remove();return c._empty_check()};document.observe(FileEvents.SF_UNSHARE,function(d){return b(d,c._state.sf_info.current)});document.observe(FileEvents.SF_LEAVE,function(d){return a(d,c._state.sf_info.current,c._state.sf_info.past)});document.observe(FileEvents.SF_REJOIN,function(f){var d;d=a(f,c._state.sf_info.past,c._state.sf_info.current);return d.filename=f.memo.filename});document.observe(FileEvents.SF_IGNORE,function(d){return b(d,c._state.sf_info.past)});document.observe(FileEvents.SF_NEW,function(f){var d;d=f.memo.sf_info;assert(d,"SF_NEW without info");c._state.sf_info.current.push(d);return c._render()});$("create-share").observe("click",function(d){Event.stop(d);return c.start_wizard(d)});if($("new-invites-link")){$("new-invites-link").observe("click",function(d){Event.stop(d);return c.show_invites(c._state.inbox_count)})}document.on("click",".filter-option",function(h,f){var g,d;h.preventDefault();d=f.readAttribute("data-filter");g=f.innerHTML;$$(".current-filter")[0].__date(g);return c._filter(d)});$("sf-list").on("click","a.options-link",function(j,g){var f,d,h;Event.stop(j);d=g.readAttribute("data-type");f=g.readAttribute("data-mount");h=parseInt(g.readAttribute("data-nsid"),10);if(d==="normal"){return c.get_sharing_options(f)}else{if(d==="remove"){return c.ignore(f,h)}else{if(d==="rejoin"){return c.rejoin(f,h)}}}});$("sf-sort").on("click","a.sort-option",function(g,f){var d,h;Event.stop(g);h={SF_BY_NAME:c._name_cmp,SF_BY_MODIFIED:c._modified_cmp};d=h[f.readAttribute("data-sort")];if(c._state.cmp===d){c._state.is_ascending=!c._state.is_ascending}else{c._state.cmp=d;c._state.is_ascending=true}Util.add_sort_arrow_mouseover(f,c._state.is_ascending,"#sf-sort a.sort-option",true);return c._render()});return Util.add_sort_arrow_mouseover($("modified-sorter"),this._state.is_ascending,"#sf-sort a.sort-option",false)},_filter:function(a){if(this._state.view===a){return}this._state.view=a;return this._render()},_render:function(){var c,a,f,d,b,e=this;d=this._get_current_sf_list();f=this._state.view===SF_VIEWS.PAST;c=function(g,j){var h;h=e._state.is_ascending?1:-1;return h*e._state.cmp(g,j)};d.sort(c);a=(function(){var j,h,g;g=[];for(j=0,h=d.length;j<h;j++){b=d[j];g.push(this._tmpl({options_str:_("Options"),remove_str:_("Remove"),rejoin_str:_("Rejoin"),is_past:f,sf:b}))}return g}).call(this);$("sf-list").__date(a);return this._empty_check()},_empty_check:function(){if(this._get_current_sf_list().length){return $("sf-view").removeClassName("empty-list")}else{return $("sf-view").addClassName("empty-list")}},_get_current_sf_list:function(){switch(this._state.view){case SF_VIEWS.CURRENT:return this._state.sf_info.current;case SF_VIEWS.PAST:return this._state.sf_info.past;default:return assert(false,"invalid sf state")}},_name_cmp:function(a,b){return Util.sort_by_rank_or_key(a,b)},_modified_cmp:function(a,b){return a.modified_ts-b.modified_ts},include_fb:false,use_fb_profile_pics:true,init_invites:function(){return this.show_invites(this._state.inbox_count)},show_invites:function(a){var b;if(Constants.EMAIL_VERIFIED){b=_("Shared folder invitations (%d)").format(a);return Modal.icon_show("email_32",b,$("invites-container"))}else{return this.show_email_verification_modal()}},get_sharing_options:function(b){var a,c=this;b=Util.normalize(b);Modal.show_loading("folder_user_32",_("Loading shared folder options..."));a="/share_options"+Util.urlquote(b);return new Ajax.DBRequest(a,{onSuccess:function(d){c.reshow=function(){c.show_sharing_options(d.responseText,b);(function(){if(c.tc){return c.tc.toggle($("members"))}}).defer();return delete Modal.onHide};c.reshow_invite_more=function(){c.show_sharing_options(d.responseText,b);return delete Modal.onHide};return c.show_sharing_options(d.responseText,b)},onFailure:function(){return Modal.hide()}})},show_sharing_options:function(a,b){var c;c=_("Shared folder options for '%(file_name)s'");c=c.format({file_name:FileOps.filename(b).em_snippet(13)});Modal.icon_show("folder_user_32",c,a,{},false);if(Constants.EMAIL_VERIFIED){return this.sharing_options_auto_completer=new Autocompleter.ContactsTokenizer("sharing-options-new-collab-input","sharing-options-new-whobulk","sharing-options-hidden-input",contacts,lcontacts,{tokens:[",",";"],include_fb:true})}else{$("email-verify-share-options").show();$("invite-more-form").hide();if($("folder-management-buttons")){$("folder-management-buttons").hide()}return this.email_verification_listen()}},reset_wizard:function(){var a;SuggestionInput.reset("invite-wizard-new-collab-input");SuggestionInput.reset("custom-message-wizard");SuggestionInput.reset("new_folder_name");a=$("invite-more-form").down("input[name='folder_name']");if(a){return a.remove()}},validate_folder:function(f,c,g){var a,b,d;c=$(c);b=c.down("#folder_name");if(b&&$$("#modal-content #copy-move-treeview .highlight .s_web_folder_user").length){return this.show_invite_more_modal($F(b))}d=$(f.target);if(d&&d.tagName!=="input"){a=d.up("#modal-content");d=a.down("input.button")}assert(c,"Trying to validate a folder where the form doesn't exist");Forms.ajax_submit(c,false,(function(){if(g&&typeof g==="function"){return g(f,c)}}),false,d);return false},start_wizard:function(a){var b;if(Constants.EMAIL_VERIFIED){this.reset_wizard();if(a){Event.stop(a)}if(Constants.ADMIN||Math.random()<0.001){b=new Element("div");b.__sert(new Element("img",{src:"/static/images/icons/clippy.gif","class":"modal-h-img"}));b.__sert(_("It looks like you're trying to share a folder."));Modal.show(b,$("clippy-shared-folder-wizard"))}else{Modal.icon_show("folder_user_32",_("Share a folder"),$("shared-folder-wizard"))}return $("create-new-sf").focus()}else{return this.show_email_verification_modal()}},wizard_next:function(b){var c,a;Event.stop(b);if($("create-new-sf").checked){this.validate_folder(b,"validate-folder-name",this.from_new_to_invitation.bind(this))}else{a=Sprite.make("web","folder_user_32",{});a.addClassName("modal-h-img");c=_("Choose folder to share");Modal.show(new Element("span").__sert(a).__sert(c),$("existing-shared-folder-wizard"));TreeView.move("copy-move-treeview","share-existing-treeview",{onSuccess:function(){var d;$("modal").observe("db:treeview_selected",function(f){return $("folder_name").setValue(f.memo.path)});d=$("first-treeview-link");if(!Util.ie){return d.onclick()}}})}return $$("#modal-content .suggestion-input").each(SuggestionInput.register)},from_new_to_invitation:function(d,b){var f,c,a;f=$F(b.down("#new_folder_name")).strip();assert(f,"Moving from new folder to invite modal with no path.");this.show_invite_more_wizard(f);Modal.vars.action=this.submit_share_new_wizard.bind(this);Modal.vars.path="/"+f;a=$("invite-more-form");c=a.down("input[name=folder_name]");if(!c){c=new Element("input",{type:"hidden",name:"folder_name"});a.__sert(c)}c.setValue(f);return $("share-invite-button").setValue(_("Share folder"))},from_existing_to_invitation:function(f,c,d){var a,b;if(!d){d=$F(c.down("#folder_name")).strip()}assert(d,"Moving from choose a folder to invite modal with no path.");this.show_invite_more_wizard(FileOps.filename(d));Modal.vars.action=this.submit_share_existing_wizard.bind(this);Modal.vars.path=d.strip();b=$("invite-more-form");a=b.down("input[name=path]");if(!a){a=new Element("input",{type:"hidden",name:"path"});b.__sert(a)}a.setValue(d);return $("share-invite-button").setValue(_("Share folder"))},show_invite_more_wizard:function(b){var a;assert(b,"Folder name required");DomUtil.fillVal("folder","invite-more-wizard-share-type");a=_("Share '%(folder_name)s' with others");a=a.format({folder_name:b.em_snippet(16)});Modal.icon_show("folder_user_32",a,$("invite-more-wizard"));if(this.invite_wizard_auto_completer){this.invite_wizard_auto_completer.clearTokens()}else{this.invite_wizard_auto_completer=new Autocompleter.ContactsTokenizer("invite-wizard-new-collab-input","invite-wizard-new-whobulk","invite-wizard-hidden-input",contacts,lcontacts,{tokens:[",",";"],include_fb:true})}return $("invite-wizard-new-collab-input").focus()},add_from_cli:function(){var a,b,c;c=Referral.get_selected_emails();this.show_invite_more_wizard(FileOps.filename(this.old_state.path));Modal.vars=this.old_state;b=$("new-collab-input");SuggestionInput.do_blank("new-collab-input");a=$F(b);if(c){b.setValue(a+(a.length>0?", ":"")+c);b.addClassName("suggestion-input-unfaded")}return delete Modal.onHide},submit_share_new_wizard:function(d){var b,c,a,f=this;b=$("invite-more-form");assert(b,"Couldn't find the invite more form.");a=function(e){var g,h;Modal.hide();h=Util.from_json(e.responseText);f._decode_sort_key(h);g=_("Created shared folder '%(folder_name)s'");g=g.format({folder_name:h.filename});Notify.server_success(g);return document.fire(FileEvents.SF_NEW,{sf_info:h})};c=function(e){return Forms.enable(b.down("input[type='submit']"))};Forms.ajax_submit(b,"/share_ajax/new",a,c,d.target);return false},submit_share_existing_wizard:function(f){var c,d,a,b,g=this;if(Tutorial.should_handle_event(Tutorial.events.share_modal_submit)){b=Tutorial.handle_event(Tutorial.events.share_modal_submit);if(b){return false}}c=$("invite-more-form");assert(c,"Couldn't find the invite more form.");a=function(e){var h,j;Modal.hide();j=Util.from_json(e.responseText);g._decode_sort_key(j);h=_("The shared folder %(folder_name)s has been created.");h=h.format({folder_name:j.filename});Notify.server_success(h);return document.fire(FileEvents.SF_NEW,{sf_info:j})};d=function(e){return Forms.enable(c.down("input[type='submit']"))};Forms.ajax_submit(c,"/share_ajax/existing?long_running",a,d,f.target);return false},show_share_existing_modal:function(a){if(Constants.EMAIL_VERIFIED){this.reset_wizard();return this.from_existing_to_invitation(false,false,a)}else{return this.show_email_verification_modal()}},show_invite_more_modal:function(a){this.reset_wizard();return this.get_sharing_options(a)},submit_invite_more_wizard:function(d){var b,c,a,f=this;b=$("invite-more-form");assert(b.down("input[name=ns_id]"),"Submit invite more wizard is missing ns_id");a=function(e){Notify.server_success(_("Invited successfully."));return Modal.hide()};c=function(e){return null};Forms.ajax_submit(b,"/share_ajax/invite_more",a,c,d.target);return false},polling:false,poll_until_verified:function(){var a,b=this;a=4000;return new Ajax.DBRequest("/isemailverified",{onSuccess:function(c){if(c.responseText==="ok"){return window.location.reload()}else{return setTimeout(Sharing.poll_until_verified,a)}}})},show_email_verification_modal:function(){Modal.icon_show("email_32",_("Verify your email address"),$("verify-email"));return this.email_verification_listen()},reshow_email_verification_modal:function(){this.show_email_verification_modal();return delete Modal.onHide},email_verification_listen:function(){var a=this;return document.observe(EmailVerification.EMAIL_SENT_EVT,function(){var b;$$(".email-verify-step1").invoke("hide");$$(".email-verify-step2").invoke("show");b=_("Verification email sent to %(email)s");b=b.format({email:Constants.email.escapeHTML()});Notify.server_success(b);if(!a.polling){a.poll_until_verified();return a.polling=true}})},show_email_verified_modal:function(){return Modal.icon_show("email_32",_("Your email address has been verified!"),$("email-verified"))},show_verification_email_sent_modal:function(){return Modal.icon_show("email_32",_("Verification email sent!"),$("verification-email-sent"))},show_leave_modal:function(b,a){var c,d;Modal.onHide=this.reshow;d=_("Leave the shared folder '%(folder_name)s'");d=d.format({folder_name:FileOps.filename(b).em_snippet(14)});Modal.icon_show("folder_user_delete_32",d,DomUtil.fromElm("leave-confirm"),{wit_group:"share-leave-confirm"});c=$("leave-share-form");c.action="/share_ajax/leave?long_running";Modal.vars.ns_id=a;return Modal.vars.folder_path=b},submit_leave:function(h){var d,b,c,g,a,f,j=this;assert(Modal.vars.folder_path.length,"submit_leave: No shared folder path.");assert(Modal.vars.ns_id,"submit_leave: missing ns_id");delete Modal.onHide;c=Modal.vars.folder_path;f=Modal.vars.ns_id;d=$("leave-share-form");Forms.add_vars(d,{ns_id:f});b=d.down("#keep_files").checked;a=function(e){var k;k=_("You removed yourself from '%(msg)s'.").format({msg:FileOps.filename(c).snippet().escapeHTML()});Modal.hide();Notify.server_success(k);return document.fire(FileEvents.SF_LEAVE,{target_ns_id:f,folder_deleted:!b})};g=function(e){return null};Forms.ajax_submit(d,false,a,g,h.target);return false},show_unshare_modal:function(b,a){var c,d;Modal.onHide=this.reshow;d=_("Unshare '%(folder_name)s'");d=d.format({folder_name:FileOps.filename(b).em_snippet(21)});Modal.icon_show("alert_32",d,DomUtil.fromElm("unshare-confirm"),{wit_group:"share-unshare-confirm"});c=$("unshare-form");Modal.vars.path=b;Modal.vars.ns_id=a;return c.action="/share_ajax/unshare?long_running"},submit_unshare:function(d){var b,c,a,f=this;delete Modal.onHide;b=$("unshare-form");assert(Modal.vars.path,"submit_unshare: No shared folder path.");assert(Modal.vars.ns_id,"submit_unshare: missing ns_id");Forms.add_vars(b,{ns_id:Modal.vars.ns_id});a=function(e){var g;Modal.hide();g=_("Unshared folder '%(folder_name)s'");g=g.format({folder_name:FileOps.filename(Modal.vars.path).snippet()});Notify.server_success(g);return document.fire(FileEvents.SF_UNSHARE,{target_ns_id:Modal.vars.ns_id})};c=function(e){return null};Forms.ajax_submit(b,false,a,c,d.target);return false},remove_div:function(a){$(a).up(".bs-row").remove();return false},leave:function(){return Modal.show(_("Leave shared folder?"),DomUtil.fromElm("leave-confirm"),{wit_group:"share-leave-confirm"})},unshare:function(){return Modal.show(_("Unshare folder?"),DomUtil.fromElm("unshare-confirm"),{wit_group:"share-unshare-confirm"})},ignore:function(c,a){var b,d;assert(a,"Share ignore did not get an ns_id");d=_("Permanently remove '%(folder_name)s'");d=d.format({folder_name:FileOps.filename(c).em_snippet(15)});Modal.icon_show("folder_delete_32",d,DomUtil.fromElm("ignore-confirm"),{wit_group:"share-ignore-confirm"});b=$("modal-content").down("form");b.action="/share_action/ignore?longrunning";Forms.add_vars(b,{ns_id:a});Modal.vars.path=c;return Modal.vars.ns_id=a},submit_ignore:function(d){var b,c,a,f=this;if(d){Event.stop(d)}b=$("share-ignore-form");assert(b,"Missing submit_ignore_form");a=function(e){Modal.hide();Notify.server_success(_("Removed shared folder successfully."));return document.fire(FileEvents.SF_IGNORE,{target_ns_id:Modal.vars.ns_id})};c=function(e){return null};return Forms.ajax_submit(b,false,a,c,d&&d.target)},rejoin:function(c,a){var b,d;assert(a,"Rejoin didn't get an ns_id");d=_("Rejoin the shared folder '%(folder_name)s'?");d=d.format({folder_name:FileOps.filename(c).em_snippet(13)});Modal.icon_show("alert_32",d,DomUtil.fromElm("rejoin-confirm"),{wit_group:"share-rejoin-confirm"});b=$("modal-content").down("form");b.action="/share_action/rejoin?longrunning";Forms.add_vars(b,{ns_id:a});Modal.vars.path=c;return Modal.vars.ns_id=a},submit_rejoin:function(d){var b,c,a,f=this;Event.stop(d);b=$("rejoin-form");a=function(g){var e;e=FileOps.filename(g.responseText);Modal.hide();Notify.server_success(_("Rejoined shared folder successfully."));return document.fire(FileEvents.SF_REJOIN,{target_ns_id:Modal.vars.ns_id,filename:e})};c=function(e){return null};Forms.ajax_submit(b,false,a,c,d.target);return false},show_change_sf_owner_modal:function(c,d,a,b){var e,f;DomUtil.fillVal(c,"change_sf_owner-confirm-nickname");Modal.onHide=this.reshow;f=_("Make %(person_name)s the owner of this folder?");f=f.format({person_name:c.em_snippet(14)});Modal.icon_show("alert_32",f,DomUtil.fromElm("change_sf_owner-confirm"),{wit_group:"share-change-sf-owner-confirm"});e=$("change-sf-owner-form");e.action="/share_ajax/change_sf_owner";Modal.vars.ns_id=a;return Modal.vars.user_id=b},submit_change_sf_owner:function(d){var b,c,a,f=this;delete Modal.onHide;$("make-owner-button").disable();assert(Modal.vars.ns_id,"submit_change_sf_owner: missing ns_id");assert(Modal.vars.user_id,"submit_change_sf_owner: missing user_id");b=$("change-sf-owner-form");Forms.add_vars(b,{ns_id:Modal.vars.ns_id,user_id:Modal.vars.user_id});a=function(e){var g;g=_("Ownership changed successfully.");Notify.server_success(g);return Modal.hide()};c=function(e){return null};Forms.ajax_submit(b,false,a,c,d.target);return false},submit_change_sf_perm:function(b,e){var c,d,a,f=this;$("change-sf-perm-saving").show();c=$("change-sf-perm-form");Forms.clear_added_vars("change-sf-perm-form");Forms.add_vars(c,{ns_id:b,new_permissions:(e?1:0)});a=function(g){if(e){Notify.server_success(_("Members can now share this folder."))}else{Notify.server_success(_("Members can no longer share this folder."))}return $("change-sf-perm-saving").hide()};d=function(g){Notify.server_error(_("Error updating your preference! Please try again."));return $("change-sf-perm-saving").hide()};Forms.ajax_submit(c,false,a,d);return true},cancel_user:function(e,a,d,b){var c,f=this;c=_("Are you sure you want to uninvite %(email_or_fbname)s?");c=c.format({email_or_fbname:e});if(confirm(c)){return new Ajax.DBRequest("/share_ajax/cancel_invite",{parameters:{ns_id:a,invite_id:d},onSuccess:function(g){f.remove_div(b);return Notify.server_success(e.escapeHTML()+" has been uninvited.")}})}},kick_user:function(c,e,a,b,d,f){var g;Modal.onHide=this.reshow;DomUtil.fillVal(c,"kick-confirm-nickname");g=_("Kick %(person_name)s out of %(folder_name)s?");g=g.format({person_name:c,folder_name:FileOps.filename(f).em_snippet(13)});return Modal.icon_show("folder_user_delete_32",g,DomUtil.fromElm("kick-confirm"),{button:d,victim:e,ns_id:a,user_id:b,wit_group:"share-kick-confirm"})},do_kick:function(b,c,d){var a,e=this;a=$F("keep-files-check");return new Ajax.DBRequest("/share_ajax/kick_user",{parameters:{ns_id:b,user_id:c,keep_files:a},onSuccess:function(){Notify.server_success(_("User removed successfully."));Modal.hide();return e.get_sharing_options(PAGE_PATH)}})},reinvite_user:function(b,a){var c=this;new Ajax.DBRequest("/share_ajax/reinvite_user/"+PAGE_PATH,{parameters:{invite_id:a},onSuccess:function(d){var e;e=_("%(email_or_fbname)s was reinvited successfully");e=e.format({email_or_fbname:b});return Notify.server_success(e)}});return false},inject_contacts:function(a){this._contacts_to_inject=a.clone();return this._lcontacts_to_inject=a.collect(function(b){return{email:b.email,name:b.name.toLowerCase(),type:b.type}})},load_contacts:function(b){var a=this;if(this.loading_contacts){return false}this.loading_contacts=true;return new Ajax.DBRequest("/get_contacts",{parameters:{include_fb:b},onSuccess:function(c){var d;d=c.responseText.evalJSON(false);window.contacts=d.contacts;window.lcontacts=d.lcontacts;a.loading_contacts=false;if(a._contacts_to_inject&&a._lcontacts_to_inject){window.contacts.push.apply(window.contacts,a._contacts_to_inject);window.lcontacts.push.apply(window.lcontacts,a._lcontacts_to_inject)}if(a.sharing_options_auto_completer){a.sharing_options_auto_completer.options.array=window.contacts;a.sharing_options_auto_completer.options.larray=window.lcontacts}if(a.invite_wizard_auto_completer){a.invite_wizard_auto_completer.options.array=window.contacts;a.invite_wizard_auto_completer.options.larray=window.lcontacts}if(SharingModel.send_link_autocompleter){SharingModel.send_link_autocompleter.options.array=window.contacts;return SharingModel.send_link_autocompleter.options.larray=window.lcontacts}}})},shmodel:function(c){var b,a;a="/sm/create"+Util.urlquote(c);Forms.postRequest(a,{},{target:"_blank"});b=Browse.find_file(c);if(b){return b.get_div().addClassName("shmodeled")}},show_share_subfolder_warning:function(){var a,b;b=Browse.details_from_fq_path(Browse.containing_fq_path()).folder_name;if(b){a=_("Folders within shared folders can't be shared, but you can still share the folder '%(parent_shared_folder)s'");a=a.format({parent_shared_folder:b.escapeHTML()});Notify.server_error(a);return document.stopObserving(Browse.UPDATE_EVT,this.show_share_subfolder_warning)}},fb_auth_callback:function(){this.load_contacts(true);$$(".fb-connect-link").each(function(a){return a.hide()});return Notify.server_success(_("Successfully connected to Facebook."))}};SharedFolderInvites={pages:{},contents:{},register_all:function(){var a=this;return $$(".expand-invite").each(function(b){return a.register(b)})},register:function(a){return a.db_observe("click",this.expand)},expand:function(f,d,a){var c,b;Event.stop(f);d=$(d);if(_this.animating){return}b=d.up(".invite");c=[];_this.get_sf_contents(b,a);if(b.hasClassName("active")){c.push(_this.hide(b))}else{c.push(_this.show(b))}$$("div.invite.active").each(function(e){if(e!==b){return c.push(_this.hide(e))}});_this.animating=true;return new Effect.Parallel(c,{duration:0.5,afterFinish:function(){return _this.animating=false}})},show:function(b){var c,a;b.addClassName("active");c=b.down(".invite-details");a=b.down(".toggler");Sprite.replace(a,"web","plus","minus");return new Effect.BlindDown(c,{sync:true,afterFinish:function(){return c.style.height="auto"}})},hide:function(b){var c,a;b.removeClassName("active");c=b.down(".invite-details");a=b.down(".toggler");Sprite.replace(a,"web","minus","plus");return new Effect.BlindUp(c,{sync:true})},show_page:function(a){Feed.hideLoading();$("invites-container").update(this.pages[a]);return this.register_all()},get_page:function(a){var b=this;if(!this.pages[0]&&a===1){this.pages[0]=$("invites-container").innerHTML}if(this.pages[a]){this.show_page(a)}else{Feed.showLoading(false,$("invites-container"),false,true);new Ajax.DBRequest("/share_ajax/invitation_page?page="+a,{onSuccess:function(c){b.pages[a]=c.responseText;return b.show_page(a)}})}return false},get_sf_contents:function(b,a){var c=this;if(this.contents[a]){return this.show_sf_contents(b,a)}else{return new Ajax.DBRequest("/share_ajax/sf_contents?ns_id="+a,{onSuccess:function(d){c.contents[a]=d.responseText;return c.show_sf_contents(b,a)}})}},show_sf_contents:function(b,a){return b.down(".folder-contents").update(this.contents[a])},mailto:function(b,a){Event.stop(b);return window.location="mailto:"+a}};ShareView={current_view:"gallery",click:function(a){ShareView.toggle_view(a);HashRouter.set_hash("view",a);return false},toggle_view:function(b){var a,c;b=b||"gallery";c=$(b+"-link");if(!c){return}$$("#toggle-view .selected").invoke("removeClassName","selected");c.addClassName("selected");$$(".view").invoke("hide");a=$(b+"-view");if(a){a.show()}return ShareView.current_view=b}};TokenListView={sort_by_filename:function(a){return parseInt(a.down(".filename .hidden").innerHTML,10)},sort_by_size:function(a){return parseInt(a.down(".filesize .hidden").innerHTML,10)},sort_by_modified:function(a){return -1*parseInt(a.down(".modified .hidden").innerHTML,10)},sort:function(g){var a,n,h,d,c,l,m,j,f,b,k;Event.stop(g);h=$(g.target).up("a");if(h.asc!==-1){h.asc=-1}else{h.asc=1}a=h.className;j={"sort-filename":this.sort_by_filename,"sort-filesize":this.sort_by_size,"sort-modified":this.sort_by_modified};m=$$("#list-view .filerow");f=m.sort_by_key(j[a],h.asc!==1);m.invoke("remove");n=new Element("div");for(b=0,k=f.length;b<k;b++){l=f[b];n.__sert(l)}$("list-browser").__sert(new HTML(n.innerHTML));$$(".sort-tick").invoke("remove");d=h.asc===1?"sort-downtick-on":"sort-uptick-on";c=Sprite.make("web",d);c.addClassName("sort-tick");return h.__sert(c)}};Autocompleter.Contacts=Class.create(Autocompleter.Base,{initialize:function(c,f,e,b,a){var d;this.baseInitialize(c,f,a);this.options.array=e;this.options.larray=b;this.options.frequency=0.1;d=this.options.include_fb===true;if(!window.contacts){(function(){return Sharing.load_contacts(d)}).defer()}return this.options.onShow=function(g,h){if(!h.style.position||h.style.position==="absolute"){h.style.position="absolute";Position.clone(g,h,{setHeight:false,offsetTop:g.offsetHeight-1})}return Effect.Appear(h,{duration:0.15})}},getToken:function(){var a;a=this.getTokenBounds();return this.element.value.substring(a[0],a[1])},getUpdatedChoices:function(){if(!this.options.array&&window.contacts&&window.lcontacts){this.options.array=window.contacts;this.options.larray=window.lcontacts}return this.updateChoices(this.options.selector())},selectEntry:function(){var c,b,a;b=this.getCurrentEntry();c=this.options.array[b.value];if(c.type===ContactTypes.FB){b.innerHTML=c.name}else{b.innerHTML=c.email}if(this.options.tokens.length>1){a=this.options.tokens[0]+" "}else{a=""}b.innerHTML+=a;this.active=false;this.updateElement(b);return $(this.element).fire("db:autocompleted")},setOptions:function(b){var a,c=this;if(b==null){b={}}a={choices:5,selector:function(){var F,D,B,r,C,g,I,f,o,q,A,w,x,k,n,m,v,s,u,y,j,t,H,h,z,e,d,E,G;H=[];g=c.getToken().toLowerCase();w=c.options.array.length;D=c.options.choices;F=c.options.array;x=c.options.larray;t=[];if(g.indexOf(" ")===-1){t.push("\\s+")}if(g.indexOf("+")===-1){t.push("\\+")}if(g.indexOf("@")===-1){t.push("@")}if(g.indexOf(".")===-1){t.push("\\.")}if(g.indexOf("&lt;")===-1){t.push("&lt;")}j=RegExp("("+t.join("|")+")");q=0;while(q<w&&H.length<D){C=F[q];n=x[q];I=-1;r=[];v=[];o="";switch(C.type){case ContactTypes.EMAIL:r.push(C.name,C.email);v.push(n.name,n.email);o="/static/images/icons/mail28.png";break;case ContactTypes.FB:r.push(C.name);v.push(n.name);if(Sharing.use_fb_profile_pics){o="https://graph.facebook.com/"+n.fb_id+"/picture"}else{o="/static/images/icons/fb24.png"}break;default:assert(false,"should never get here due to type: "+C.type+", "+C.name+", "+C.email+", "+C)}for(A=e=0,E=v.length;e<E;A=++e){m=v[A];u=t.length?m.split(j):[m];B=0;for(d=0,G=u.length;d<G;d++){s=u[d];if(!s){continue}if(s.indexOf(g)===0){I=B;break}B+=s.length}if(I!==-1){r[A]=r[A].substr(0,I)+"<strong>"+r[A].substr(I,g.length)+"</strong>"+r[A].substr(I+g.length);break}}if(C.type===ContactTypes.FB){r.push(_("Facebook message"))}if(I!==-1){f="<image src='"+o+"' width='28px' height='28px'/>";y="<div class='autocomplete-line'>"+r[0]+"</div>";z="<div class='autocomplete-line autocomplete-secondary'>"+r[1]+"</div>";k="<div class='autocomplete-left'>"+f+"</div>";h="<div>"+(y+z)+"</div>";H.push("<li value='"+q+"'>"+(k+h)+"</li>")}q++}return"<ul>"+(H.join(""))+"</ul>"}};return this.options=Object.extend(a,b)}});Token=Class.create({initialize:function(c,b,d,a){this.element=$(c);this.token_manager=d;this.hidden_input=b;this.element.token=this;this.selected=false;this.is_valid=a;return Event.observe($("tokenized_autocompleter_container"),"click",this.onclick.bindAsEventListener(this))},select:function(){this.token_manager.token=this;this.hidden_input.element.activate();this.selected=true;return this.element.addClassName("token_selected")},deselect:function(){if(this.token_manager.token===this){this.token_manager.token=null}this.selected=false;return this.element.removeClassName("token_selected")},onclick:function(a){if(a&&a.preventDefault){a.preventDefault()}if(this.detect(a)&&!this.selected){return this.select()}else{return this.deselect()}},remove:function(a){return this.token_manager.remove(this)},detect:function(d){var b,c,a;c=d.target?d.target:d.srcElement;a=c.token;b=c;while(!(a!=null)&&b.parentNode){b=b.parentNode;a=b.token}return(a!=null)&&a.element===this.element}});TokenManager=Class.create({initialize:function(b,a){this.shift_boundary_right_func=b;this.shift_boundary_left_func=a;this.tokens=[];return this.token=null},add:function(a){return this.tokens.push(a)},remove:function(c){var b,a;if(!(c!=null)){c=this.token}if(c!=null){a=this.tokens.indexOf(c);this.tokens.splice(a,1);c.element.remove();if(this.token===c&&a<this.tokens.length){this.tokens[a].select()}else{this.token=null;this.shift_boundary_right_func()}}b=Tutorial.should_handle_event(Tutorial.events.share_modal_remove_invite_user,{token:c});if(b){return Tutorial.handle_event(Tutorial.events.share_modal_remove_invite_user,{token:c})}},removeAll:function(){var b,d,a,c;c=this.tokens;for(d=0,a=c.length;d<a;d++){b=c[d];b.element.remove()}return this.tokens.clear()},shift_left:function(){var a;a=this.token?this.tokens.indexOf(this.token):this.tokens.length;if(a>0){if(this.token){this.token.deselect()}return this.tokens[a-1].select()}else{if(this.shift_boundary_left_func!=null){return this.shift_boundary_left_func()}}},shift_right:function(){var a;a=this.tokens.indexOf(this.token);if(this.token){this.token.deselect()}if(a+1<this.tokens.length){return this.tokens[a+1].select()}else{if(this.shift_boundary_right_func!=null){return this.shift_boundary_right_func()}}}});HiddenInput=Class.create({initialize:function(a,c,b){this.element=$(a);this.auto_complete_element=c;this.token_manager=b;return Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},onKeyPress:function(a){switch(a.keyCode){case Event.KEY_LEFT:a.preventDefault();this.token_manager.shift_left();break;case Event.KEY_TAB:a.preventDefault();this.token_manager.shift_right();break;case Event.KEY_RIGHT:a.preventDefault();this.token_manager.shift_right();break;case Event.KEY_BACKSPACE:case Event.KEY_DELETE:this.token_manager.remove()}return false}});validate_email=function(a){var b;b=new RegExp("^['&A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,6}$","i");return b.test(a)};addContactToList=function(l,g,h,k,c,m,n){var a,j,f,b,d,e,o;k.value="";switch(h){case ContactTypes.FB:f="fb_ids";j=Builder.node("img",{src:"/static/images/icons/fb_16.png"});break;case ContactTypes.EMAIL:f="emails";j=Builder.node("img",{src:"/static/images/icons/email_16.png"});break;case ContactTypes.INVALID:f="invalids";j=Builder.node("span",{"class":"hidden"});break;default:assert(false,"should never get here due to type: "+h)}a=n?" token-valid":" token-error";o=Builder.node("span",{"class":"x"+a,onmouseout:"this.className='x"+a+"'",onmouseover:"this.className='x_hover"+a+"'",onclick:"this.parentNode.parentNode.parentNode.parentNode.parentNode.token.remove(event); return false;"}," ");d=Builder.node("input",{type:"hidden",name:f,value:g});b=Builder.node("a",{"class":"token"+a,href:"#",tabindex:"-1"},Builder.node("span",Builder.node("span",Builder.node("span",Builder.node("span",{},[d,j,l,o])))));$(b).down(5).next().innerHTML="&nbsp;";e=new Token(b,c,m,n);m.add(e);return $("autocomplete_display").__sert({before:b})};kc={curr:"",w:function(){return document.observe("keydown",function(a){kc.curr+=BrowseKeys.getKey(a);if(kc.curr.endsWith("3838404037393739666513")){return new Effect.Appear("magic")}})}};Autocompleter.ContactsTokenizer=Class.create(Autocompleter.Contacts,{initialize:function($super,d,g,c,f,b,a){var e;$super(d,g,f,b,a);this.token_manager=new TokenManager(this.generate_shift_boundary_right_func());this.hidden_input=new HiddenInput(c,this.element,this.token_manager);if(!this.element.hacks){this.element.should_use_borderless_hack=Prototype.Browser.WebKit;this.element.should_use_shadow_hack=Prototype.Browser.IE||Prototype.Browser.Opera;this.element.hacks=true}if(this.element.should_use_borderless_hack||this.element.should_use_shadow_hack){$(this.element.parentNode).addClassName("tokenizer_input_borderless")}this.options.onShow=function(h,j){Position.clone(h.parentNode.parentNode,j,{setHeight:false,offsetTop:h.parentNode.parentNode.offsetHeight-1});return j.show()};this.options.onHide=function(h,j){return j.hide()};e=this.element.up("form").down(".tokenizer-submit-button");Event.observe(e,"mousedown",this.beforeSubmit.bindAsEventListener(this));Event.observe(this.element,"focus",this.onFocus.bindAsEventListener(this));this.fb_connect_link=this.element.up("form").down(".fb-connect-link");if(this.fb_connect_link){this.fb_connect_link_visible=this.fb_connect_link.visible();this.fb_connect_link_width=this.fb_connect_link.getWidth()}this.dynamically_resize_input();this.check_populated();return setInterval(this.check_populated.bind(this),100)},onBlur:function($super,a){$(this.element.parentNode).removeClassName("focused");this.element.up(".tokenizer").removeClassName("focused");return $super(a)},onFocus:function(a){$(this.element.parentNode).addClassName("focused");return this.element.up(".tokenizer").addClassName("focused")},beforeSubmit:function(a){return this.tokenize_emails_input(true)},clearTokens:function(a){this.token_manager.removeAll();return this.dynamically_resize_input()},check_populated:function(){var b,a;b=$(this.element.parentNode);a=(this.element.value==="")&&(this.token_manager.tokens.length===0);if(b.hasClassName("populated")&&a){return b.removeClassName("populated")}else{if(!b.hasClassName("populated")&&!a){return b.addClassName("populated")}}},clean_email_addr:function(g,c){var f,b,e,a,d;f=["<",">"];d=g.concat(f);for(e=0,a=d.length;e<a;e++){b=d[e];c=c.sub(b,"")}return c.strip()},get_regexp_from_delimiters:function(e){var b,d,c,a;d="";for(c=0,a=e.length;c<a;c++){b=e[c];d+=b+"|"}return new RegExp("["+d+"\\r\\n|\\r|\\n|\\t]+")},tokenize_emails_input:function(h,k){var f,c,m,n,q,b,p,g,r,l,j,e,d,o,a;m=this.options.tokens;l=this.get_regexp_from_delimiters(m);q=this.element.value.split(l);r="";if(!h){j=q[q.length-1];r=this.clean_email_addr(m,j);q=q.slice(0,q.length-1);if(j[j.length-1]===" "){if(validate_email(r)){q.push(r);r=""}}}g=[];for(e=0,o=q.length;e<o;e++){n=q[e];g.push.apply(g,n.split(" "))}q=g;f=false;if(q.length>0){for(d=0,a=q.length;d<a;d++){n=q[d];n=this.clean_email_addr(m,n);if(n){if(validate_email(n)){p=true;c=ContactTypes.EMAIL;f=true}else{if(k){continue}p=false;c=ContactTypes.INVALID}this.set_input_size(1);addContactToList(n,n,c,this.element,this.hidden_input,this.token_manager,p)}}this.element.value=r}b=this.element.up("form");if(f){Forms.clear_errors(b)}return this.dynamically_resize_input()},generate_shift_boundary_right_func:function(){var b,a;b=this.element;a=function(){return b.focus()};return a},set_input_size:function(a){a=a||20;return this.element.setStyle({width:""+a+"px"})},dynamically_resize_input:function(){var m,b,g,c,d,j,k,n,e,h,a,f,l;k=$(this.element.parentNode.parentNode);n=parseInt(k.getStyle("width"),10)-15;h=this.token_manager.tokens;c=false;a=0;for(f=0,l=h.length;f<l;f++){e=h[f];g=e.element;b=parseInt(g.getStyle("width"),10)+parseInt(g.getStyle("margin-right"),10);j=a+b;if(j>n){a=b;c=true}else{if(b>n){a=0;c=true}else{a=j}}}d=n-a;m=this.element.value.length*7;if(m>d){d=n}this.set_input_size(d);if(this.fb_connect_link&&this.fb_connect_link_visible){if(c||n-a-m<1.25*this.fb_connect_link_width){$$(".fb-connect-link").each(function(o){return Effect.Fade(o,{duration:0.1})});return this.fb_connect_link_visible=false}}},onKeyPress:function(b){var c,a;this.dynamically_resize_input();if(this.active){switch(b.keyCode){case 44:case 188:case 59:case 186:this.reset_observer();return;case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();this.hide();this.active=false;Event.stop(b);return;case Event.KEY_ESC:this.hide();this.active=false;Event.stop(b);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(b);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(b);return}}else{this.tokenize_emails_input(false);if(b.keyCode===Event.KEY_TAB||b.keyCode===Event.KEY_RETURN){if(this.element.value&&b.preventDefault){b.preventDefault()}this.tokenize_emails_input(true);return}else{if(this.element.value===""){if((c=b.keyCode)===Event.KEY_LEFT||c===Event.KEY_BACKSPACE){this.token_manager.shift_left()}}else{if((a=b.keyCode)===Event.KEY_LEFT||a===Event.KEY_RIGHT||a===Event.KEY_UP||a===Event.KEY_DOWN){return}}}}this.update_typeahead();return this.reset_observer()},update_typeahead:function(){this.changed=true;return this.hasFocus=true},reset_observer:function(){if(this.observer){clearTimeout(this.observer)}return this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000)},onObserverEvent:function($super){var b,c,f,e,a,d;if(this.active){f=this.element.value;d=this.options.tokens;for(e=0,a=d.length;e<a;e++){b=d[e];c=f.indexOf(b);if(c!==-1){this.element.value=f.substr(0,c);this.selectEntry();this.hide();this.active=false;this.element.value=f.substr(c+1);break}}this.update_typeahead()}this.tokenize_emails_input(false);$super();if(Tutorial.should_handle_event(Tutorial.events.share_modal_type_contact)){return Tutorial.handle_event(Tutorial.events.share_modal_type_contact)}},selectEntry:function(){var c,b,a;b=this.getCurrentEntry();c=this.options.array[b.value];a=c.type===ContactTypes.FB?c.fb_id:c.email;this.set_input_size(1);addContactToList(c.name.strip()||a,a,c.type,this.element,this.hidden_input,this.token_manager,true);Forms.clear_errors(this.element.up("form"));this.dynamically_resize_input();this.index=0;this.element.focus();if(Tutorial.should_handle_event(Tutorial.events.share_modal_pick_contact)){return Tutorial.handle_event(Tutorial.events.share_modal_pick_contact)}}});ShareShowController=Class.create({initialize:function(b,a){var c=this;this.ns_id=a;this.add_message_container=$("add-message-container");this.custom_message_section=$("custom-message-section");this.allow_members_table=$("allow-members-table");this.folder_management_buttons=$("folder-management-buttons");$("sharing-options-new-collab-input").observe("focus",this.toggle_to_invite_mode.bind(this));$("custom-message-wizard").observe("focus",this.toggle_to_invite_mode.bind(this));if(this.add_message_container){return this.add_message_container.observe("click",function(d){c.show_message_box(d);return c.toggle_to_invite_mode(d)})}},show_message_box:function(a){this.custom_message_section.show();return this.add_message_container.hide()},hide_message_box:function(a){this.custom_message_section.hide();return this.add_message_container.show()},toggle_from_invite_mode:function(){this.allow_members_table.hide();this.folder_management_buttons.show();return this.hide_message_box()},toggle_to_invite_mode:function(){this.allow_members_table.show();return this.folder_management_buttons.hide()},get_ns_id:function(){return this.ns_id}});var Links,SharingModel;Links={_tmpl:null,init:function(b){var c,d,a;for(d=0,a=b.length;d<a;d++){c=b[d];assert(c.encoded_sort_key&&!(c.sort_key!=null),"expected encoded sort key on each elm");c.sort_key=Util.decode_sort_key(c.encoded_sort_key);delete c.encoded_sort_key}this._state={links:b,cmp:this._created_cmp,is_ascending:false};this.listen();this._tmpl=HTML.tmpl("links_list_item_tmpl");return this._render()},listen:function(){var a,b=this;$("links-view").on("click","a.remove-link",function(h,d){var c,g,f;Event.stop(h);c=d.readAttribute("data-filename");f=d.readAttribute("data-tkey");g=parseInt(d.readAttribute("data-is-dir"),10);SharingModel.confirm_remove(c,f);return DomUtil.fillVal((g?_("folder"):_("file")),"file-or-folder")});document.observe(FileEvents.LINKS_REMOVE,function(k){var g,h,d,l,f,j,c;f=k.memo.token;d=b._state.links;assert(f,"LINKS_REMOVE without token");for(g=j=0,c=d.length;j<c;g=++j){h=d[g];if(h.tkey===f){l=g}}assert(l!=null,"LINK_REMOVE w/o DOM elm");d.splice(l,1);$$("li.link")[l].remove();return b._empty_check()});a="#links-sort a.sort-option";$("links-sort").on("click","a.sort-option",function(f,d){var c,g;Event.stop(f);g={LINKS_BY_NAME:b._name_cmp,LINKS_BY_CREATED:b._created_cmp};c=g[d.readAttribute("data-sort")];if(b._state.cmp===c){b._state.is_ascending=!b._state.is_ascending}else{b._state.cmp=c;b._state.is_ascending=true}Util.add_sort_arrow_mouseover(d,b._state.is_ascending,a,true);return b._render()});return Util.add_sort_arrow_mouseover($("created-sorter"),this._state.is_ascending,a,false)},_render:function(){var h,b,f,j,l,m,d,c,k,a,e,g=this;m=Util.calc_thumb_prep_size();h=function(n,p){var o;o=g._state.is_ascending?1:-1;return o*g._state.cmp(n,p)};b=[];l=this._state.links;l.sort(h);for(d=0,k=l.length;d<k;d++){j=l[d];b.push(this._tmpl({link:j,remove_str:_("Remove")}))}$("links-list").__date(b);e=$$("#links-list img");for(c=0,a=e.length;c<a;c++){f=e[c];Util.thumb_load(f,m)}return this._empty_check()},_empty_check:function(){if(this._state.links.length){return $("links-view").removeClassName("empty-list")}else{return $("links-view").addClassName("empty-list")}},_name_cmp:Util.sort_by_rank_or_key,_created_cmp:function(a,b){return a.created_ts-b.created_ts}};SharingModel={filename:null,is_folder:false,gallery_enabled:false,gallery_showing:false,preview_objs:[],send_link_autocompleter:null,init:function(a){var b=this;this.filename=a;this.init_logger();window.contacts=false;window.lcontacts=false;return document.observe("dom:loaded",function(){var c;c=$("login-create-an-account");if(c){c.writeAttribute("href","/register?signup_tag=shmodel")}scrollTo(1,0);scrollTo(0,0);return b.set_viewport_size()})},init_folder:function(a,c,b){var d=this;this.gallery_enabled=a;this.gallery_showing=c;this.is_folder=true;this.init_lightbox(Util.from_json(b));return document.observe("dom:loaded",function(){DomUtil.fillVal(_("folder"),"file-or-folder");return d.load_thumbs()})},init_file:function(){var a=this;this.is_folder=false;return document.observe("dom:loaded",function(){return DomUtil.fillVal(_("file"),"file-or-folder")})},init_logger:function(){var a=this;document.observe("dom:loaded",function(){var b;b=$("login-hover-link");if(b){b.observe("click",function(){return ShmodelLogger.log("click_sign_in")});b.observe("click",function(){return RegistrationLogger.log("click_sign_in")})}if($("download_button_link")){ShmodelLogger.attachLogListener("click_download",$("download_button_link"))}b=$("add_to_my_dropbox_link");if(b){ShmodelLogger.attachLogListener("click_add_to_my_dropbox",b);RegistrationLogger.attachLogListener("click_add_to_my_dropbox",b)}if($$(".remove-link").length){ShmodelLogger.attachLogListener("remove_link",$$(".remove-link")[0])}if($$(".shmodel-filename").length){ShmodelLogger.attachLogListener("click_filename",$$(".shmodel-filename")[0])}if($("default_content_download_button")){ShmodelLogger.attachLogListener("click_download",$("default_content_download_button"))}if($("default_content_a2md")){return ShmodelLogger.attachLogListener("click_add_to_my_dropbox",$("default_content_a2md"))}});return document.observe(FilePreviewModal.ACTIONS_ADDED,function(){var d,c,b;b=$("view_original");if(b){ShmodelLogger.attachLogListener("shmodel_lightbox_click_vieworiginal",b)}c=$("lightbox_shmodel_link");if(c){ShmodelLogger.attachLogListener("shmodel_lightbox_click_getlink",c)}d=$("lightbox_download_link");if(d){return ShmodelLogger.attachLogListener("shmodel_lightbox_click_download",d)}})},init_lightbox:function(b){var d,c,a,e=this;for(c=0,a=b.length;c<a;c++){d=b[c];if(d.is_video){this.preview_objs.push(new VideoPreview(d.filename,d.path,d.thumbnail_url,d.preview_url,Util.add_qstring(d.orig_url,{dl:"1"}),null,d.shmodel_link))}else{this.preview_objs.push(new PhotoPreview(d.filename,d.path,d.thumbnail_url,Util.add_qstring(d.orig_url,{dl:"1"}),d.orig_url,null,d.shmodel_link))}}FilePreviewModal.init(this.preview_objs,{include_delete:false,keep_url:true,filename_in_url:true});return document.observe(FilePreviewModal.EXIT_SELECT_EVT,function(f){key.setScope("all");return Util.scroll_to_thumb($("gallery-view-media").childElements()[e.preview_objs.indexOf(f.memo)])})},load_thumbs:function(){var e,d,c,f,b,a;e=Util.calc_thumb_prep_size();if(this.gallery_showing){e+=",32bf"}else{if(this.gallery_enabled){e+=",shg_178"}}c=this.gallery_showing?$$(".gallery-icon-view img"):$$(".browse-files .icon");a=[];for(f=0,b=c.length;f<b;f++){d=c[f];a.push(Util.thumb_load(d,e))}return a},switch_mode:function(g){var c,h,f,a,e,b,d;d=$A(["gallery","list"]);for(e=0,b=d.length;e<b;e++){a=d[e];h=$(a+"-view-container");c=$(a+"-toggle");if(g===a){h.show();c.addClassName("selected")}else{h.hide();c.removeClassName("selected")}}if(history.replaceState){f=window.location.pathname;if(g==="list"){f+="?lst"}history.replaceState({},"",f)}this.gallery_showing=!this.gallery_showing;return this.load_thumbs()},set_viewport_size:function(){var a;if($(document.body).hasClassName("mobile")){a=new Element("meta",{name:"viewport",content:"width = 480"});return document.head.appendChild(a)}},toggle_dropdown_menu:function(b,c,a){if(b){Event.extend(b).preventDefault()}if(!c.visible()){return this.show_dropdown_menu(c,a)}},show_dropdown_menu:function(e,d){var b,g,a,c,f=this;e.show();a=e.getWidth();g=d.getWidth();c=$$(".nav-header").first().getHeight();b=$$(".nav-header .buttons").first().cumulativeOffset().top;if(b<0&&Util.ie8){b=8}e.clonePosition(d,{setHeight:false,setWidth:false,offsetLeft:-1*(a-g),offsetTop:c-b});d.addClassName("pressed");return(function(){return document.observe("click",f.hide_dropdown_menus)}).defer()},hide_dropdown_menus:function(a){if($("owner-menu")){$("owner-menu").hide();$("owner-menu-button").removeClassName("pressed")}if($("download-menu")){$("download-menu").hide();$("download-menu-button").removeClassName("pressed")}return document.stopObserving("click",this.hide_dropdown_menus)},remove_click:function(a,b){return this.confirm_remove(a,b)},confirm_remove:function(a,b){var c;assert(b,"confirm_remove missing tkey");assert(a,"confirm_remove missing name");c=_("Remove link to '%(folder_name)s'").format({folder_name:a.snippet(34)});return Modal.icon_show("alert_32",c,$("disable-token-modal"),{token:b,name:a})},do_remove:function(a){var b=this;if("/links"===window.location.pathname){new Ajax.DBRequest("/sm/disable/"+a.token,{onSuccess:function(){Modal.hide();Notify.server_success(_("Removed link for '%(filename)s'").format({filename:a.name.escapeHTML()}));return document.fire(FileEvents.LINKS_REMOVE,{token:a.token})},onComplete:function(){return Forms.remove_loading()}})}else{Forms.postRequest("/sm/disable/"+a.token)}return Forms.add_loading($("modal-content").down("input"))},get_token:function(a,b){var c=this;return new Ajax.DBRequest("/sm/get"+Util.normalize(a),{onSuccess:function(e){var d;d=e.responseText.evalJSON(true);if(b){return b(d)}}})},show_shmodal_onload:function(a,b){var c=this;return document.observe("dom:loaded",function(){var d;if(HTML5_HISTORY){d=DBHistory.deconstruct_url();DBHistory.push_state(d.path)}return c.show_shmodal(a,b)})},show_shmodal:function(a,f){var h,g,b,c,j,d,e=this;Modal.show(this._get_shmodal_title(),DomUtil.fromElm("shmodal"));if(this._get_thumbnail_type()){d=$$(".shmodal-image");for(c=0,j=d.length;c<j;c++){g=d[c];g.addClassName("thumbnail")}}this.send_link_autocompleter=new Autocompleter.ContactsTokenizer("shmodal-new-collab-input","shmodal-new-whobulk","shmodal-hidden-input",contacts,lcontacts,{tokens:[",",";"],include_fb:true});if(FlashDetect.installed){b=Util.copy_to_clipboard_swf(a,"shmodal-copy-link","SharingModel.copied_to_clipboard");$(b).up().style.zIndex="1001";clearInterval(this.follow_freshbutton);h=function(){return $(b).up().clonePosition("shmodal-copy-link",{offsetHeight:6,offsetWidth:6})};this.follow_freshbutton=setInterval(h,500)}else{$("shmodal-copy-link").hide()}this._populate_twitter_info(f);$("shmodal-new-collab-input").focus();return ShmodelLogger.log("shmodal_show")},copied_to_clipboard:function(){Notify.server_success(_("Link copied to clipboard"));Modal.hide();return ShmodelLogger.log("shmodal_copy_link")},send_shmodel_link:function(b){var a,c,d=this;a=$("shmodal-send-form");assert(a,"Couldn't find the shmodal send form.");c=function(e){Notify.server_success(_("Sent successfully"));Modal.hide();return ShmodelLogger.log("shmodal_send")};return Forms.ajax_submit(a,"/sm/share",c,null,a.down(".tokenizer-submit-button"))},show_send_content:function(){$("shmodal-title-text").__date(this._get_shmodal_title_text());$("shmodal-fb-content").hide();$("shmodal-twitter-content").hide();$("shmodal-send-content").show();$("shmodal-fb-toggle").removeClassName("toggled");$("shmodal-twitter-toggle").removeClassName("toggled");$("shmodal-send-toggle").addClassName("toggled");return $("shmodal-new-collab-input").focus()},show_fb_content:function(){$("shmodal-title-text").__date(_("Share on Facebook"));$("shmodal-send-content").hide();$("shmodal-twitter-content").hide();$("shmodal-fb-content").show();$("shmodal-send-toggle").removeClassName("toggled");$("shmodal-twitter-toggle").removeClassName("toggled");$("shmodal-fb-toggle").addClassName("toggled");return $("shmodal-fb-post-input").focus()},show_twitter_content:function(a){$("shmodal-title-text").__date(_("Share on Twitter"));$("shmodal-send-content").hide();$("shmodal-fb-content").hide();$("shmodal-twitter-content").show();$("shmodal-send-toggle").removeClassName("toggled");$("shmodal-fb-toggle").removeClassName("toggled");$("shmodal-twitter-toggle").addClassName("toggled");return $("shmodal-twitter-post-input").focus()},start_fb_post:function(a){if(FacebookOAuth.has_authed){return this.do_fb_post(a)}else{return FacebookOAuth.do_auth(this.do_fb_post.curry(a))}},start_twitter_post:function(){if(Twitter.has_authed){return this.do_twitter_post()}else{return Twitter.do_auth(this.do_twitter_post)}},do_fb_post:function(a){FacebookOAuth.custom_show_posting=function(){return Forms.add_loading($("shmodal-fb-post-submit"))};FacebookOAuth.custom_show_complete=function(){Modal.hide();Notify.server_success(_("Successfully posted to Facebook"));return ShmodelLogger.log("shmodal_fb_post")};return FacebookOAuth.post($F("shmodal-fb-post-input"),a)},do_twitter_post:function(){var a,b=this;a=$F("shmodal-twitter-post-input");if(!a){Notify.server_error(_("Please enter a Twitter post"));return}else{if(a.length>140){Notify.server_error(_("Your post must be 140 characters or less"));return}}Twitter.custom_show_posting=function(){$("twitter-chars").hide();return Forms.add_loading($("shmodal-twitter-post-submit"))};return Twitter.custom_post(a,function(){Modal.hide();Notify.server_success(_("Successfully posted to Twitter"));return ShmodelLogger.log("shmodal_tweet")})},_get_shmodal_title:function(){var d,e,b,f,c,a;c=new Element("div",{id:"shmodal-title-text"});c.__date(this._get_shmodal_title_text());b=new Element("a",{id:"shmodal-send-toggle","class":"freshtoggle left toggled"});b.__date(Sprite.make("web","email_20"));b.observe("click",this.show_send_content.bind(this));e=new Element("a",{id:"shmodal-fb-toggle","class":"freshtoggle middle"});e.__date(Sprite.make("web","fb_20"));e.observe("click",this.show_fb_content.bind(this));a=new Element("a",{id:"shmodal-twitter-toggle","class":"freshtoggle right"});a.__date(Sprite.make("web","twitter_20"));a.observe("click",this.show_twitter_content.bind(this));d=new Element("div",{"class":"clear"});f=new Element("div",{id:"shmodal-title"});f.__sert(c);f.__sert(b);f.__sert(e);f.__sert(a);f.__sert(d);return f},_get_shmodal_title_text:function(){var b,a;if(this.is_folder){b=_("Share link to '%(folder_name)s'");return b=b.format({folder_name:this.filename.em_snippet(15)})}else{a=this._get_thumbnail_type();if(a){return _("Share this %(type)s").format({type:a})}else{return _("Share '%(filename)s'").format({filename:this.filename.em_snippet(18)})}}},_get_thumbnail_type:function(){var b,a;if(this.filename.indexOf(".")===-1){return false}a=FileOps.file_extension(this.filename).toLowerCase();b=BrowseFile.EXTENSION_TO_CATEGORY[a];if(b&&(b==="IMAGE"||b==="VIDEO")){return BrowseFile.CATEGORY_TO_TRANSLATION[b]}return false},_populate_twitter_info:function(b){var c,a;c=this.is_folder?_("Just shared some files using @Dropbox"):(a=this._get_thumbnail_type(),a&&a===BrowseFile.CATEGORY_TO_TRANSLATION.IMAGE?_("Just shared an image using @Dropbox"):_("Just shared a file using @Dropbox"));$("shmodal-twitter-post-input").setValue(c+" "+b);Util._track_twitter_chars_left("shmodal-twitter-post-input",140);if(Twitter.has_authed){return Twitter.get_user_info(function(d){$("shmodal-twitter-profile").down(".profile-pic").__date(new Element("img",{src:d.profile_image_url_https}));$("shmodal-twitter-profile").down(".name").__date(d.name);$("shmodal-twitter-profile").down(".username").__date("@"+d.screen_name);$("shmodal-twitter-post-sickinput").addClassName("shrank");return $("shmodal-twitter-profile").show()})}},start_twitter_flow:function(h,g,f,e){var a,c,b,d;d=$("twitter-checkbox")&&$F("twitter-checkbox");a=$F("facebook-checkbox");if(d){h=h.substr(0,140)}if(a){FacebookOAuth.msg=h;FacebookOAuth.name=f;FacebookOAuth.link=g}c=function(){var j;j=function(){AMC.log("shmodel_share",{type:"facebook",action:"post"});return FacebookOAuth.post(h,g,f,e)};FacebookOAuth.onLoginSuccessCallback=j;if(FacebookOAuth.has_authed||!Constants.uid){return j()}else{AMC.log("shmodel_share",{type:"facebook",action:"start_auth"});if(FacebookOAuth.deferred){return FacebookOAuth.show_auth(j)}else{return FacebookOAuth.do_auth()}}};b=function(k){var j;j=function(){AMC.log("shmodel_share",{type:"twitter",action:"post"});return Twitter.custom_post(h,k)};Twitter.onLoginSuccessCallback=j;if(Twitter.has_authed||!Constants.uid){return j()}else{AMC.log("shmodel_share",{type:"twitter",action:"start_auth"});return Twitter.do_auth()}};if(d&&a){b(c);return FacebookOAuth.custom_show_complete=function(){return FacebookOAuth.get_progress_container().update(DomUtil.fromElm("sharing-posted-both"))}}else{if(d){return b()}else{if(a){return c()}}}},copy_to_dropbox:function(a,h,l,j,c){var b,d,f,k,g,e;assert(a,"c2d name missing");assert(h,"c2d tkey missing");if(!l&&!this.is_folder){l=j}d=_("Add '%(filename)s' to my Dropbox");d=d.format({filename:a.snippet(30)});Modal.icon_show("dropbox_32",d,$("c2d-modal"));g=$("c2d-modal").select("form");e=[];for(f=0,k=g.length;f<k;f++){b=g[f];e.push(Forms.add_vars(b,{tkey:h,subpath:l,secure_hash:c}))}return e},c2d_submit:function(b,a){var c,d=this;assert(a.select("input[name=tkey]"),"Trying to submit a form that doesn't have a tkey");c=function(e){if(e.responseText&&e.responseText[0]==="/"){return window.location.href=e.responseText}else{return window.location.href="/home"}};return Forms.ajax_submit(a,false,c,false,$(a).down("input[type=submit]"))}};var ActAsBlock,BrowseStyleRows,Bubble,DBCheckbox,DBDropdown,Dropdown,FreshbuttonIEHaxxx,HotButton,JumpWatcher,LiveSearch,LocaleSelector,LoginDropdown,Modal,ModalLocaleSelector,Notify,SickInput,Sprite,SuggestionInput,Tabs,TitleBubble,ToggleButton,Tooltip,TranslationSuggest,TreeView,ULSelectMenu,UndoAction,sprites_used;Bubble={make:function(p,A,s,n){var g,x,f,e,z,v,o,m,h,k,q,a,j,d,y,w,u;if(A==null){A="left"}if(["left","right"].contains(A)){s=s||"middle";assert(["top","middle","bottom"].contains(s),"expected tail position ['top', 'middle', 'bottom'], got %s".format(s))}else{if(["bottom"].contains(A)){s=s||"center";assert(["left","center","right"].contains(s),"expected tail position ['left', 'center', 'right'], got %s".format(s))}else{assert(false,"unexpected tail positon, got %s".format(s))}}q=new Element("table");q.addClassName("bubble");if(n){q.style.width=n+"px"}a=new Element("tbody");y=new Element("tr");j=new Element("td");j.addClassName("tl");k=new Element("td");k.addClassName("t");d=new Element("td");d.addClassName("tr");y.__sert(j);y.__sert(k);y.__sert(d);a.__sert(y);w=new Element("tr");o=new Element("td");o.addClassName("l");if(A==="left"){g=new Element("img",{src:"/static/images/bubble_arrow.png"});g.addClassName("arrow");o.__sert(g);o.vAlign=s}v=new Element("td");v.addClassName("c");v.update(p);m=new Element("td");m.addClassName("r");if(A==="right"){h=new Element("img",{src:"/static/images/bubble_arrow_right.png"});h.addClassName("rarrow");m.__sert(h);m.vAlign=s}w.__sert(o);w.__sert(v);w.__sert(m);a.__sert(w);u=new Element("tr");e=new Element("td");e.addClassName("bl");x=new Element("td");x.addClassName("b");if(A==="bottom"){f=new Element("img",{src:"/static/images/bubble_arrow_bottom.png"});f.addClassName("barrow");x.__sert(f);x.style.textAlign=s}z=new Element("td");z.addClassName("br");u.__sert(e);u.__sert(x);u.__sert(z);a.__sert(u);q.__sert(a);return q}};ActAsBlock={elm_list:["margin-left","margin-right","padding-left","padding-right","border-left-width","border-right-width"],parent_list:["padding-left","padding-right","border-left-width","border-right-width"],register:function(f,g){var c,d,b,a;g=g||document.body;c=$(g).getElementsByClassName("act_as_block");a=[];for(d=0,b=c.length;d<b;d++){f=c[d];a.push(ActAsBlock.resize(f))}return a},resize:function(e){var a,c,d,b;e=$(e);c=e.up();a=Util.sumStyles(e,ActAsBlock.elm_list);d=Util.sumStyles(c,ActAsBlock.parent_list);e.style.width="1px";b=c.getWidth()-a-d;if(b>0){return e.style.width=b+"px"}}};Event.observe(window,"load",ActAsBlock.register);Modal={KEY_SCOPE:"modal",width:640,vertical_offset:150,show:function(m,h,j,n,c,k){var f,b,l,a,d,e,g;if(j==null){j=false}if(n==null){n=false}if(c==null){c=false}if(k==null){k=false}$$("#modal-content .error-message, #modal-content .error-removable").invoke("hide");c=c||Modal.width;if(FileQueue.uploading&&!k){alertd(_("You can't do this while uploading."));return false}assert(h,"Missing modal content!");d=Modal.vars._prev_scope;Modal.vars=j||{};Modal.vars._prev_scope=d;$("modal").setStyle({width:c+"px",margin:"0 0 0 "+Math.floor(-c/2).toString()+"px"});if(!k){if(FileQueue.num_files()){Upload.reset()}a=Util.childElement($("modal-content"),0);if(a&&a!==h){$("grave-yard").__sert(a)}b=new Element("div");b.update(h);g=Modal.vars.wit_group;if(!g){f=b.down();g=f&&f.id}if(g){WIT.add_group(b,g)}$("modal-content").__sert(b);if(h.show){h.show()}Element.show("modal")}Modal.fix_position();$("modal-overlay").setOpacity(0.6);$("modal-overlay").show();$("modal-behind").setStyle({width:(c+20)+"px",margin:"0 0 0 "+Math.floor(-c/2-10).toString()+"px"});$("modal-behind").setOpacity(0.2);$("modal-behind").show();if(n){$("modal-content").select("#"+n.id).first().focus()}else{if(!Util.ie){l=$("modal").down("input[type=submit]")||$("modal").down("input[type=button]");if(l){l.focus()}}}if(!Modal.track_id){Modal.track_resizes()}if(m){$("modal-title").update(m);$("modal-title").show();e=m.innerText||m.textContent||m;T("Modal.show:",e)}else{$("modal-title").hide();T("Modal.show")}ActAsBlock.register(false,"modal");document.observe("keydown",Modal.keydown);$("modal-content").style.height="auto";if(key.getScope()!==Modal.KEY_SCOPE){Modal.vars._prev_scope=key.getScope()}key.setScope(Modal.KEY_SCOPE);return false},fix_position:function(d){var c,b,a;a=document.viewport.getScrollOffsets().top+Modal.vertical_offset;b=parseInt($("modal").getStyle("height"),10);c=$("flash-upload-container")&&$("flash-upload-container").descendantOf("modal");if(!c&&b+Modal.vertical_offset<document.viewport.getHeight()){$("modal").setStyle({position:"fixed",top:Modal.vertical_offset+"px"});return $("modal-behind").setStyle({position:"fixed",height:(b+20)+"px",top:(Modal.vertical_offset-10)+"px"})}else{$("modal").setStyle({position:"absolute",top:a+"px"});return $("modal-behind").setStyle({position:"absolute",height:(b+20)+"px",top:(a-10)+"px"})}},keydown:function(d){var f,a,c,b;c=BrowseKeys.getKey(d);if(c===27||(c===8&&!Util.focus_in_input())){d.preventDefault();Modal.hide()}if(c===9&&!Util.focus_in_input()){a=$("modal").down("input[type=text]");b=$("modal").down(".modal-tabs");f=b;while(f&&f.next()){f=f.next();if(f.visible()){a=f.down("input[type=text]");break}}if(a){d.preventDefault();return a.focus()}}},icon_show:function(e,h,f,g,a,d,c){var b;b=new Element("div");if(e){b.__sert(Sprite.make("web",e,{"class":"modal-h-img"}))}b.__sert(h);return Modal.show(b,f,g,a,d,c)},show_loading:function(a,c){var b;b="<p style='margin: 3em 0; text-align: center;'><img src='/static/images/icons/ajax-loading-small.gif' alt=''/></p>";return Modal.icon_show(a,c,b)},shown:function(){return $("modal").visible()},hide:function(b,a){if(b){Event.stop(b)}if(Modal.onHide){Modal.onHide();return}Modal.onHide=null;Element.hide("modal-behind");Element.hide("modal-overlay");if(!a&&!FileQueue.num_files()){Element.hide("modal")}else{$("modal").style.marginLeft="-10000000px";if(FileQueue.uploading){InlineUploadStatus.show()}}if(Modal.track_id){clearInterval(Modal.track_id);Modal.track_id=false}document.stopObserving("keydown",Modal.keydown);if(document.activeElement&&[document,window,document.body].indexOf(document.activeElement)===-1){$(document.activeElement).blur()}key.setScope(Modal.vars._prev_scope);return T("Modal.hide")},track_resizes:function(){return Modal.track_id=setInterval(Modal.on_resize,150)},on_resize:function(){var a;a=$("modal").getHeight();if(Modal.old_height!==a||$("modal-behind").getHeight()<a){Modal.old_height=a;return Modal.fix_position()}},vars:{}};Tabs={init:function(){var j,e,k,g,l,f,b,c,d,h;g=$A(document.getElementsByClassName("tab")).concat($A(document.getElementsByClassName("subtab")));for(d=0,h=g.length;d<h;d++){k=g[d];j=k.down("a");b=j.href.split("/");if(k.hasClassName("subtab")){j.href="#"+b[b.length-1]}if(Util.ie6||Prototype.Browser.Opera){c=j.getWidth()-parseInt(j.getStyle("padding-left"),10)*2;c=c+2+(c%2);j.style.width=c+"px"}l=Sprite.make("web","rounded_tl",{"class":"rounded_tl"});f=Sprite.make("web","rounded_tr",{"class":"rounded_tr"});j.appendChild(l);j.appendChild(f)}e=20;$$(".events_bubble").each(function(m){var a;a=(-1*m.getWidth()/2)+"px";m.style.marginLeft=a;m.style.marginRight=a;m.style.right="6px";return m.parentNode.style.zIndex=e--});clearInterval(Tabs.check_interval);return Tabs.check_interval=setInterval(function(){return Tabs.check_url("")},300)},check_url:function(b){var a;a=Util.url_hash();if(!a||Tabs.last_shown===a){return}Tabs.last_shown=a;if(Util.url_hash()){return Tabs.showTab(Util.url_hash()+"-tab",Util.url_hash())}else{return Tabs.showTab(b+"-tab",b)}},showTab:function(k,c){var j,g,h,d,m,b,f,e,l,a;k=$(k);if(k){k.fire("db:tabshown")}b=document.getElementsByClassName("subtab");for(f=0,l=b.length;f<l;f++){m=b[f];m.removeClassName("selected")}j=document.getElementsByClassName("content-tab");for(e=0,a=j.length;e<a;e++){m=j[e];m.hide()}d=$(c+"-tab")||$$(".subtab").first();h=$(c+"-content")||$$(".content-tab").first();if(d){d.addClassName("selected")}if(h){h.show();Util.syncHeight();g=h.select("input[type=text]","textarea");if(g){Util.focus(g[0])}}return false}};TreeView={disable_shares:false,tv:{},loaded:false,set_params:function(a){return TreeView.ajax_params=a},init:function(c,a,d){var b;d=d||"treeview";TreeView.tv[d]={};b=TreeView.tv[d];b.autohide=(a===null?true:a);b.handler=c;b.viewdiv=$(d);return b.hidefunc=TreeView.hide.bindAsEventListener(this)},schedule_reset:function(){return TreeView.loaded=false},reset:function(a){return new Ajax.DBRequest("/ajax_subtreeview",{parameters:TreeView.ajax_params,onSuccess:function(d){var c,b;b=[];for(c in TreeView.tv){if(TreeView.tv.hasOwnProperty(c)){TreeView.tv[c].viewdiv.down(".treeview-folders").update(d.responseText);if(a&&a.onSuccess){b.push(a.onSuccess(d))}else{b.push(void 0)}}else{b.push(void 0)}}return b}})},toggle:function(c,b){var a;Event.stop(c);a=TreeView.tv[b||"treeview"];if(a.shown){a.shown=false;TreeView.hide(c,b)}else{a.shown=true;TreeView.show(c.target,b)}return false},hide:function(c,b){var a;a=TreeView.tv[b||"treeview"];if(!c||!$(c.target).descendantOf(a.viewdiv)){a.viewdiv.hide();Event.stopObserving(window,"click",a.hidefunc);return a.shown=false}},show:function(c,b){var d,a;a=TreeView.tv[b||"treeview"];c=$(c);c.blur();d=c.cumulativeOffset();a.viewdiv.setStyle({top:(d.top+c.getHeight())+"px",left:(d.left-4)+"px"});a.viewdiv.show();return Event.observe(window,"click",a.hidefunc)},toggleNode:function(b){var a;b=$(b);a=b.down("img");if(a.className.match("bullet_plus")){Sprite.replace(a,"web","bullet_plus","bullet_minus")}else{Sprite.replace(a,"web","bullet_minus","bullet_plus")}b.up().next("div").toggle();b.blur();return false},toggleNodeAjax:function(c,a){var b,d;if(c.fetched_children){return TreeView.toggleNode(c)}c=$(c);b=c.down("img");d=Sprite._get(b);b.src="/static/images/icons/ajax-loading-small.gif";new Ajax.DBRequest("/ajax_subtreeview"+a,{parameters:TreeView.ajax_params,onSuccess:function(e){var f;f=new Element("div",{style:"display: none;"}).update(e.responseText);c.up().__sert({after:f});c.fetched_children=true;Sprite._set(b,d);return TreeView.toggleNode(c)},cleanUp:function(e){if(/loading/.match(b.src)){return Sprite._set(b,d)}}});return false},handle:function(c,b){var d,a;d=$H(TreeView.tv).keys();a=$(b).ancestors().find(function(e){return d.include(e.id)});if(!a){return}a=TreeView.tv[a.id];$("modal").fire("db:treeview_selected",{path:c});if(a.handler){a.handler(c,b)}if(a.autohide){return TreeView.hide(a.id)}},move:function(c,d,b){var a;a=$(c);if(!TreeView.loaded){TreeView.reset({onSuccess:function(){TreeView.loaded=1;return TreeView.move(c,d,b)}})}else{if(b&&b.onSuccess){b.onSuccess()}}assert(a,"Couldn't find tree_id");assert($(d),"Couldn't find location_id");$(d).appendChild(a);return a.show()},enable_shared:function(e){var f,d,a,g,j,k,c,h,b;k=$(e);if(!k.share_disabled){return}k.share_disabled=false;j=k.select(".s_web_folder_user_gray");a=j.length;d=0;b=[];for(c=0,h=shared_folder_img.length;c<h;c++){f=shared_folder_img[c];Sprite.replace(f,"web","folder_user_gray","folder_user");g=f.up();b.push(g.onclick=g._onclick)}return b}};sprites_used=new SimpleSet();Sprite={SPACER:"/static/images/icons/icon_spacer.gif",CLASS_PREFIX:"s_",_make_class:function(b,a){sprites_used.add(a);return Sprite.CLASS_PREFIX+b+"_"+a},src:function(c,b,a){c=$(c);Sprite.clear(c);return c.addClassName(Sprite._make_class(b,a))},current:function(c){var a,b;b=$(c).classNames().findAll(function(d){return !d.indexOf(Sprite.CLASS_PREFIX)});if(!b.length){return}a=b[b.length-1];return a.substr(a.indexOf("_",2)+1)},replace:function(d,b,c,a){d.removeClassName(Sprite._make_class(b,c));return d.addClassName(Sprite._make_class(b,a))},clear:function(a){a=$(a);return a.className=a.classNames().reject(function(b){return !b.indexOf(Sprite.CLASS_PREFIX)}).join(" ")},make:function(c,b,a){a=Sprite._prep_attrs(c,b,a);return new Element("img",a)},html:function(d,b,a){var e,c;a=Sprite._prep_attrs(d,b,a);e=["<img "];for(c in a){e.push(c,'="',HTML._raw_escape(a[c]),'" ')}e.push("/>");return new HTML(e.join(""))},_prep_attrs:function(d,c,b){var a;assert(!c.endsWith("_blue"),"Tried to make invalid sprite "+c);b=b||{};b.src=b.src||Sprite.SPACER;a=Sprite._make_class(d,c);b["class"]="sprite sprite_"+d+" "+a+" "+(b["class"]||"");return b},_get:function(a){return a.className},_set:function(b,a){b.className=a;return b.src=Sprite.SPACER}};setTimeout((function(){if(sprites_used.items.length){return new Ajax.Request("/add_sprites_used",{parameters:{sprite:sprites_used.items}})}}),30*1000);Dropdown={init:function(){return $$("#tabs-container > ul > li").each(function(a){a.observe("mouseenter",Dropdown.over);return a.observe("mouseleave",Dropdown.out)})},over:function(a){var b;clearTimeout(Dropdown.timeout);$$("#tabs-container > ul > li.hover").invoke("removeClassName","hover");b=$(a.target);if(!b.match("#tabs-container > ul > li")){b=b.up("#tabs-container > ul > li")}return b.addClassName("hover")},out:function(a){var b;b=$(a.target);if(!b.match("#tabs-container > ul > li")){b=b.up("#tabs-container > ul > li")}return Dropdown.timeout=setTimeout(function(){return b.removeClassName("hover")},300)}};HotButton={make:function(b){var a,d,c;a=new Element("a");a.addClassName("hotbutton");a.addClassName("bigger");a.addClassName("rounded");c=new Element("span");c.addClassName("hotbutton-content");c.update(b);a.update(c);d=new Element("span");d.addClassName("shadow");return HotButton.register(a)},register:function(a){var b;b=a.select(".hotbutton-icon").pop();if(b){a._icon=b;a._sprite=Sprite.current(b)}a.observe("mouseenter",function(){return HotButton.mouseenter(a)});a.observe("mouseleave",function(){return HotButton.mouseleave(a)});a.observe("mousedown",function(c){return HotButton.mousedown(c,a)});a.observe("mouseup",function(){return HotButton.mouseup(a)});Util.disableSelection(a);return a},mouseenter:function(a){a.addClassName("hover");return a.style.zIndex=1},mouseleave:function(a){a.removeClassName("hover");a.removeClassName("down");a.style.zIndex=0;if(a._icon){return Sprite.src(a._icon,"web",a._sprite)}},mousedown:function(b,a){a.addClassName("down");return Event.stop(b)},mouseup:function(a){a.removeClassName("down");if(a._icon){return Sprite.src(a._icon,"web",a._sprite)}}};LiveSearch={search:function(f,e,c,a,b){var d;f=f.strip();if(f.length<3){$(e).__date();if(a.onEmpty){return a.onEmpty(f)}}else{d={search_string:f,"short":(b?1:"")};return new Ajax.Request(c,{parameters:d,method:"get",onSuccess:function(g){var h;h=g.responseText.strip();if(!h){if(a.onEmpty){a.onEmpty(f)}return}$(e).update(g.responseText);LiveSearch.highlight(e,f);if(a.onComplete){return a.onComplete(f)}}})}},highlight:function(c,b){var a;a=b.split(" ");return a.each(function(e){var d;if(e.length<4){return}d=new RegExp(RegExp.escape(e),"i");c=$(c);$$(".livesearch_result_a").each(function(f){return f.innerHTML=f.innerHTML.gsub(d,function(g){return"<strong>"+g[0]+"</strong>"})});return $$(".livesearch_result_p").each(function(f){return f.innerHTML=f.innerHTML.stripTags().gsub(d,function(g){return"<strong>"+g[0]+"</strong>"})})})},MAX_RESULTS:10};DBDropdown=Class.create({initialize:function(d,e,l){var h,b,f,k,j,a,c,g;this.options=l||{};this.container=$(d);assert(this.container,"Couldn't find element for DBDropdown "+d);this.container.style.position="relative";assert(e&&e.length,"Missing options_list: "+e);this.display_options=[];this.display_value={};for(c=0,g=e.length;c<g;c++){a=e[c];k=void 0;if(a.length>2){k=[a[1],a[2]]}else{k=[a[1]]}this.display_options.push(k);this.display_value[a[1]]=a[0]}b="";if(this.options.icon||this.options.prefix){b+="<span class='prefix'>";if(this.options.icon){b+=Sprite.html("web",this.options.icon,{className:"icon_no_hover"}).toHTML()}if(this.options.prefix){b+=this.options.prefix}b+="</span>"}f=void 0;if(this.options.initial_value){f=this.options.initial_value}else{f=this.display_options[0][0]}b+="<span class='dbdropdown-selected'>"+f+"</span>";h=l.arrow||"big-dropdown";b+=Sprite.html("web",h).toHTML();this.hotbutton=HotButton.make(b);this.hotbutton.addClassName("dbdropdown");this.hotbutton.name=$(d).identify();this.container.update(this.hotbutton);if(this.options.style){for(j in this.options.style){if(this.options.style.hasOwnProperty(j)){this.hotbutton.style[j]=this.options.style[j]}}}return this.observe()},observe:function(){this.hotbutton.observe("mouseup",(function(a){return this.mouseup(a)}).bind(this));return $(document.body).observe("mouseup",(function(a){if(!$(a.target).match(".dbdropdown, .dbdropdown *")){return this.hide_list()}}).bind(this))},mouseup:function(a){if(this.showing){this.hide_list()}else{this.show_list()}return a.preventDefault()},show_list:function(){var a,d,h,c,f,b,e,g=this;c=new Element("ul");Util.disableSelection(c);c.addClassName("dbdropdown-list");e=this.display_options;for(f=0,b=e.length;f<b;f++){d=e[f];a=new Element("li");a.addClassName("wit");a.name=d;a.update(d);a.observe("click",function(j){return j.preventDefault()});a.observe("mouseup",function(j){j.preventDefault();g.select(d);return g.hide_list()});a.observe("mouseenter",function(){return this.addClassName("over")});a.observe("mouseleave",function(){return this.removeClassName("over")});c.appendChild(a)}this.container.appendChild(c);c.clonePosition(this.hotbutton,{setTop:false,setHeight:false});c.style.width=parseInt(c.style.width,10)-2+"px";h=this.container.getHeight()-(Prototype.Browser.IE?2:0)+"px";if(this.options.show_above){c.style.bottom=h}else{c.style.top=h}return this.showing=true},hide_list:function(){var a;a=this.container.down(".dbdropdown-list");if(a){a.remove()}return this.showing=false},select:function(a){var c,b;b=this.display_value[a];assert(b,"Value is missing...");c=this.container.down(".dbdropdown-selected");assert(c,"select missing contentelm");c.update(a);if(this.options.on_change){return this.options.on_change(b)}}});LocaleSelector={init:function(){var a;a=$("locale-menu");if(!a){return}return a.on("click","a.locale-option",function(d,c){var b;d.preventDefault();b=c.readAttribute("data-locale");return LocaleSelector.set_locale(b)})},set_locale:function(a){var b;if(a===Constants.USER_LOCALE){return}b=new Element("form",{action:"https://"+Constants.WEBSERVER+"/set_locale",method:"post"});Forms.add_vars(b,{locale:a,locale_cont:window.location.href});document.body.appendChild(b);return b.submit()}};ModalLocaleSelector={init:function(){document.on("click",".modal-locale-link",ModalLocaleSelector.show_modal);return document.on("click","#modal-locale-selector a",ModalLocaleSelector.set_locale)},show_modal:function(b,a){b.preventDefault();return Modal.icon_show("globe32",_("Choose a language"),$("modal-locale-selector"),null,null,320)},set_locale:function(c,b){var a;c.preventDefault();Modal.hide();a=b.readAttribute("data-locale");return LocaleSelector.set_locale(a)}};UndoAction={init:function(){},set_undo_info:function(a){this.undo_info=a;return this.undoing=false},perform_undo:function(){if(!this.undoing){FileOps.do_rollback(this.undo_info);return this.undoing=true}}};Notify={init:function(){var a;a=$("notify-xclose");if(!a){return}return a.observe("click",function(b){Event.stop(b);return $("notify").hide()})},server_error:function(c,b,a){return Notify._show_div(c,b,a,false,_("There was a problem completing this request."))},server_success:function(d,c,b,a){return Notify._show_div(d,c,b,true,_("Your request completed successfully."),a)},_show_div:function(g,f,e,a,d,b){var c;Notify.clear_all();g=g||d;f=f||(b?30:10);if(b&&Constants.can_undo){g+='&nbsp;<a id="undo-link" href="#">Undo</a>';UndoAction.set_undo_info(b);(function(){return $("undo-link").observe("click",function(h){UndoAction.perform_undo();return Event.stop(h)})}).defer();Notify.preserve_last_msg=true}else{Notify.preserve_last_msg=false}c=$("notify");if(a){c.removeClassName("server-error");c.addClassName("server-success")}else{c.removeClassName("server-success");c.addClassName("server-error")}c.down("#notify-msg").update(g);new Effect.Appear(c,{duration:0.5,from:0,to:1});Notify.last_msg=g;Notify.last_fade=new Effect.Fade(c,{duration:1,from:1,to:0,delay:f});return Notify.cancel_on_reload=e},is_shown:function(){return $("notify").visible()},clear_all:function(){var a;if(Notify.last_fade){Notify.last_fade.cancel()}$("notify").hide();a=Effect.Queues.get("notify");a.effects=[];clearInterval(a.interval);return a.interval=null},clear_if:function(a){if(Notify.last_msg===a){return Notify.clear_all()}}};document.observe("dom:loaded",Notify.init);LoginDropdown={init:function(){var a;a=$("login-hover-link");if(!a){return}LoginDropdown.login_link=a;return LoginDropdown.register()},register:function(a){LoginDropdown.login_link.observe("click",LoginDropdown.click);LoginDropdown.login_link.observe("mouseenter",LoginDropdown.over);LoginDropdown.login_link.observe("mouseleave",LoginDropdown.out);LoginDropdown.login_link.observe("focus",LoginDropdown.click);$("login_email_elm").observe("focus",LoginDropdown.click);return $(document.body).observe("click",LoginDropdown.unclick)},over:function(a){return LoginDropdown.hover()},out:function(a){return LoginDropdown.unhover()},click:function(a){Event.stop(a);LoginDropdown.hover();LoginDropdown.down=true;LoginDropdown.login_link.up().addClassName("down");return $("login_email_elm").focus()},unclick:function(b){var a;a=$(b.target);if(a.match("#top-login-wrapper, #top-login-wrapper *")){return}LoginDropdown.down=false;LoginDropdown.unhover();return LoginDropdown.login_link.up().removeClassName("down")},hover:function(){var a;if(LoginDropdown.is_hover||LoginDropdown.down){return}LoginDropdown.is_hover=true;a=$("login-hover-dropdown-icon");return Sprite.replace(a,"web","big-dropdown-gray","big-dropdown")},unhover:function(){var a;if(!LoginDropdown.is_hover||LoginDropdown.down){return}LoginDropdown.is_hover=false;a=$("login-hover-dropdown-icon");return Sprite.replace(a,"web","big-dropdown","big-dropdown-gray")}};TranslationSuggest={record_msg_touch:function(c){var b,a;a=$("translation-msg-id");assert(a,"Missing translation msg_id field");assert(c,"Missing translation display");b=Constants.messages[c];if(b){a.value=b}return TranslationSuggest.finish_wizard(c,Constants.emessages[c]||"")},_autocomplete_highlight:function(a){a=new SimpleSet(a);return function(b){if(a.contains(b)){return"<strong>"+b+"</strong>"}else{return b}}},autocompleter:Class.create(Autocompleter.Local,{onClick:function($super,b){var a;a=Event.findElement(b,"LI");if(a&&a.className.indexOf("not-found")<0){return $super(b)}},onHover:function($super,b){var a;a=Event.findElement(b,"LI");if(a&&a.className.indexOf("not-found")<0){return $super(b)}},onBlur:function($super,a,b){if(b){return $super(a)}},close:function(){this.onBlur(null,true);return true},selectEntry:function($super){var a;a=this.index;$super();return TranslationSuggest.record_msg_touch(TranslationSuggest.msg_display[a])}}),attach_autocomplete:function(){var a;a=new TranslationSuggest.autocompleter("bad-i18n-text","bad-i18n-text-complete",false,{frequency:0.15,selector:function(t){var q,u,s,e,w,r,p,c,o,m,n,f,b,l,g,v,k,d,h;v=[];b=[];e=t.getToken();f=$H(Constants.messages).keys();n=f.length;q=10;g=true;l=3;r=true;c={};TranslationSuggest.msg_display=[];m=[];s=void 0;p=0;while(p<n&&v.length<q){s=f[p];w=s.toLowerCase().indexOf(e.toLowerCase());if(w!==-1){c[s]=true}while(w!==-1){if(w===0&&s.length!==e.length){v.push("<li><div><strong>"+s.substr(0,e.length)+"</strong>"+s.substr(e.length)+"</div></li>");TranslationSuggest.msg_display.push(s);break}else{if(e.length>=l&&g&&w!==-1){if(r||(/\s/.test(s.substr(w-1,1)))){b.push("<li><div>"+s.substr(0,w)+"<strong>"+s.substr(w,e.length)+"</strong>"+s.substr(w+e.length)+"</div></li>");m.push(s);break}}}w=s.toLowerCase().indexOf(e.toLowerCase(),w+1)}p++}if(b.length){v=v.concat(b.slice(0,t.options.choices-v.length));TranslationSuggest.msg_display=TranslationSuggest.msg_display.concat(m.slice(0,t.options.choices-v.length))}if(v.length<q){u={};k=$A(e.split(/\s/));k.each(function(j){var x;x=TranslationSuggest.word_index[j];if((j.length>=l||k.length>2)&&x){return $A(x).each(function(y){return u[y]=(u[y]||0)+1})}});u=$A($H(u));u.sort(function(j,z){return z[1]-j[1]});for(o=d=0,h=Math.min(u.length,q-v.length);0<=h?d<h:d>h;o=0<=h?++d:--d){s=u[o][0];if(!c[s]){v.push("<li><div>"+s.replace(/[^\s]+/g,TranslationSuggest._autocomplete_highlight(k))+"</div></li>");TranslationSuggest.msg_display.push(s)}}}if(v.length){v[v.length-1]=v[v.length-1].replace("<div>",'<div style="border: none">')}v=v.join("");if(!v.length){return'<ul style="border: 1px solid #bbb"><li class="not-found" style="background:#f5f5f5"><div style="text-align:left;border: none">%s</div></li></ul>'.format(_("That text was not found on this page."))}return"<ul>"+v+"</ul>"}});return TranslationSuggest.ac=a},submit_suggest:function(b){var a;a=$("translation-suggest-form");assert(a,"Missing translation suggest form");return Forms.ajax_submit(a,false,(function(){Notify.server_success(_("Thanks for suggesting an alternate translation!"));return Modal.hide()}),false,$("translation-back-button"))},start_wizard:function(b){var a;Event.stop(b);a=$("translation-suggest-form");TranslationSuggest.reset_form();a.down("input[name=locale]").setValue(Constants.USER_LOCALE);a.down("input[name=locale_url]").setValue(window.location.href);Modal.icon_show("alert_32",'%s <span class="step-number">%s</span>'.format(_("Report a translation problem"),_("&ndash; Step 1 of 2")),$("translate-div"),{},$("bad-i18n-text"));return Modal.onHide=TranslationSuggest.ac.close.bind(TranslationSuggest.ac)},show_select_error:function(a){Event.stop(a);return $("bad-i18n-text-error").show()},finish_wizard:function(b,a){var c;c=$("translation-suggest-form");assert(c,"Missing translation suggest form");$("modal-title").down("span").__date(new HTML("$ndash; ")).__sert(_("Step 2 of 2"));c.down("#part-one").hide();c.down("#translation-msg-display").__date(b.stripTags());c.down("#translation-orig-msg-display").__date(a.stripTags());c.down("#part-two").show();c.down("#part-two textarea").focus();return ActAsBlock.register(false,c)},reset_form:function(){var b,a;b=$("translation-suggest-form");a=$("translation-msg-id");assert(b,"Missing translation suggest form");assert(a,"Missing translation msg_id field");b.select("textarea").each(Form.Element.clear);b.down("#part-one").show();return b.down("#part-two").hide()},word_index:{},index_message:function(d){var c,f,e,b,a;c=d.blank_format().split(/\s/);a=[];for(e=0,b=c.length;e<b;e++){f=c[e];if(!(f in TranslationSuggest.word_index)){TranslationSuggest.word_index[f]=[]}a.push(TranslationSuggest.word_index[f].push(d))}return a},index_all:function(){var b,a;a=[];for(b in Constants.messages){if(Constants.messages.hasOwnProperty(b)){a.push(TranslationSuggest.index_message(b))}else{a.push(void 0)}}return a},update_i18n_messages:function(f){var b,a,c,e,d;for(a in f){if(f.hasOwnProperty(a)){c=f[a];if(c.s&&c.s.length){for(b=e=0,d=c.s.length;0<=d?e<d:e>d;b=0<=d?++e:--e){add_i18n_message(a,c.s[b],c.e[b])}}else{add_i18n_message(a,c.t,a)}}}},update_i18n_messages_from_req:function(e){var h,b,g,c,d,a,f;f="<!--msg:";b="-->";if(e.responseText.indexOf(f)===0){h=e.responseText.indexOf(":",f.length);assert(h!==-1,"malformed i18n message header");d=e.responseText.substr(f.length,h-f.length);c=Number(d);assert(!isNaN(c),"invalid json length "+d);a=e.responseText.substr(h+1,c);e.responseText=e.responseText.substr(h+1+c+b.length);g=a.evalJSON();return TranslationSuggest.update_i18n_messages(g)}}};DBCheckbox={register_all:function(){var e,d,a,b;b=$$(".checkbox");for(d=0,a=b.length;d<a;d++){e=b[d];DBCheckbox.register(e)}},register:function(a){a.addClassName("s_checkbox sprite");a.selected=false;return a},toggle:function(a){if(a.selected){return DBCheckbox.deselect(a)}else{return DBCheckbox.select(a)}},select:function(a){Sprite.replace(a,"web","checkbox","checkbox_checked");return a.selected=true},deselect:function(a){Sprite.replace(a,"web","checkbox_checked","checkbox");return a.selected=false}};document.observe("dom:loaded",DBCheckbox.register_all);Tooltip={attach:function(g,c,a,b){var f,e;g=$(g);a=(a?$(a):null);b=b||{};f=Bubble.make(c,g.tail_position,b.tail_position,b.width);f.setStyle({display:"none",position:"absolute"});$("floaters").__sert(f);if(g.match("#modal-content *")){f.style.zIndex="13001"}else{f.style.zIndex=""}if(g.tail_position==="right"){e=(Util.ie?32:12);f.style.marginLeft=-(f.getWidth()+g.getWidth()+e)+"px"}g.tooltip=f;g.out_target=(a?true:false);g.observe("mouseout",Tooltip.mouseout("target",g));g.observe("mouseover",Tooltip.mouseover("target",g));g.out_trigger=(a?false:true);if(a){a.observe("mouseout",Tooltip.mouseout("trigger",g));a.observe("mouseover",Tooltip.mouseover("trigger",g))}g.out_tooltip=true;f.observe("mouseout",Tooltip.mouseout("tooltip",g));return f.observe("mouseover",Tooltip.mouseover("tooltip",g))},update:function(b,a){if(b.tooltip){return $(b.tooltip).update(a)}},mouseover:function(a,b){return function(){return b["out_"+a]=false}},mouseout:function(a,b){return function(){b["out_"+a]=true;return Tooltip.hide_if_out.defer(b)}},show_by:function(b){var c,a;c=$(b.tooltip);c.show();a=Math.floor(c.getHeight()/2);return c.clonePosition(b,{setWidth:false,setHeight:false,offsetTop:Math.floor(b.getHeight()/2)-a,offsetLeft:b.getWidth()+1})},hide_if_out:function(a){var b;if(!a.out_target||!a.out_trigger||!a.out_tooltip){return}b=$(a.tooltip);return b.hide()},show:function(e,d,b,a,c){a=a||"left";e=$(e);if(!e.tail_position){e.tail_position=a}b=(b?$(b):null);if(!e.tooltip){Tooltip.attach(e,d,b,c)}return Tooltip.show_by(e)}};BrowseStyleRows={register_all:function(){$$(".bs-row").each(BrowseStyleRows.register);return Event.observe(document,"click",BrowseStyleRows.kill_current)},register:function(a){a=$(a);a.db_observe("mouseover",BrowseStyleRows.mouseover);a.db_observe("mouseout",BrowseStyleRows.mouseout);return a.db_observe("click",BrowseStyleRows.click)},mouseover:function(b,a){return a.addClassName("hover")},mouseout:function(b,a){return a.removeClassName("hover")},click:function(d,b){var a,c;if(d.target.tagName==="A"){return}Event.stop(d);BrowseStyleRows.kill_current(false);c=$(d.target);if(!c.match(".bs-actions-list *")){b.addClassName("selected")}a=(c.hasClassName("bs-row")?c:c.up(".bs-row"));if(Util.ie6){a.down(".bs-actions-list").style.position="absolute"}return a.style.zIndex=9},kill_current:function(a){return $$(".bs-row.selected").each(function(b){b.removeClassName("selected");return b.style.zIndex=""})}};SickInput={init:function(){return $$(".sick-input").each(function(a){return SickInput._create(a)})},_create:function(d){var c,a,b;c=d.identify();a=d.down("input")||d.down("textarea");a.observe("focus",function(){return d.addClassName("focused")});a.observe("blur",function(){return d.removeClassName("focused")});b=function(){if(d.hasClassName("populated")&&a.getValue()===""){d.removeClassName("populated")}else{if(!d.hasClassName("populated")&&a.getValue()!==""){d.addClassName("populated")}}if(c in SickInput._handler_map){return SickInput._handler_map[c]()}};SickInput.show_errors();b();return setInterval(b,100)},show_errors:function(d){var g,a,f,e,c,b;g=void 0;a=".error-bubble, .error-plain-text";if(d){g=d.select(a)}else{g=$$(a)}b=[];for(e=0,c=g.length;e<c;e++){f=g[e];if(f.down("span.error-message")){b.push(f.show())}else{b.push(void 0)}}return b},_handler_map:{},add_interval_handler:function(b,a){var c;c=b.identify();return SickInput._handler_map[c]=a}};document.observe("dom:loaded",SickInput.init);FreshbuttonIEHaxxx={submits:[],init:function(){if(IE7_OR_LESS){FreshbuttonIEHaxxx.submits=$$("input[type=submit]");return document.on("focusin","form",FreshbuttonIEHaxxx.wtvr)}},wtvr:function(b,a){return a.select("input[type=submit]").each(function(c){var e,d;d=FreshbuttonIEHaxxx.submits.indexOf(c);if(d!==-1){e=new Element("input",{type:"submit","class":"hidden-ie-submit"});c.__sert({before:e});return FreshbuttonIEHaxxx.submits.splice(d,1)}})}};document.observe("dom:loaded",FreshbuttonIEHaxxx.init);SuggestionInput={register:function(b){var a;b=$(b);a=b.up("form");if(SuggestionInput.defaulted(b)||b.getValue()===""){b.setValue(b.title)}else{b.addClassName("suggestion-input-unfaded")}b.observe("blur",SuggestionInput.blur);b.observe("focus",SuggestionInput.focus);b.observe("db:value_change",SuggestionInput.focus);if(a){if(!b.id){b.id="r_elm_id_"+Math.random().toString()}return a.observe("submit",SuggestionInput.blank(b.id))}},register_all:function(){return $$(".suggestion-input").each(SuggestionInput.register)},blank:function(a){return function(){var b;b=$(a);if(!b){return}if(SuggestionInput.defaulted(b)){return b.setValue("")}}},defaulted:function(a){a=$(a);return a.getValue()===a.title},do_blank:function(a){return SuggestionInput.blank(a)()},clear:function(a){var b;b={target:a};return SuggestionInput.focus(b)},focus:function(a){var b;b=$(a.target);if(!b){return}if(SuggestionInput.defaulted(b)){b.addClassName("suggestion-input-unfaded");return b.setValue("")}},blur_elm:function(a){if(a.getValue()===""){a.removeClassName("suggestion-input-unfaded");a.setValue(a.title)}return a.blur()},blur:function(a){var b;b=$(a.target);if(!b){return}return SuggestionInput.blur_elm(b)},reset:function(b){var a;a=$(b);if(!a){return}a.removeClassName("suggestion-input-unfaded");a.setValue(a.title);a.defaulted=true;return a.blur()},setValue:function(a,b){var c;c=$(a);if(!c){return}c.addClassName("suggestion-input-unfaded");c.setValue(b);return c.defaulted=false}};document.observe("dom:loaded",SuggestionInput.register_all);ULSelectMenu=(function(){var d,h,c,j,k,e,g,a,f,b,l;d=function(m){return m.removeClassName("shown")};l=function(m){return m.toggleClassName("shown")};g=function(){return this.removeClassName("hover")};e=function(){return this.addClassName("hover")};a=function(n,m){return m.each(function(o){return n.insert(o)})};j=function(o,m,n){a(o,n);if(o.firstChild!==m){return o.__sert({top:m})}};f=function(m,n){m.down(".selected").removeClassName("selected");return n.addClassName("selected")};b=function(m,n){return m.select("li").each(function(o){if(o.getAttribute("data-value")===n){return f(m,o)}})};k=function(m,o,n){return function(p){if(!m.hasClassName("selected")){f(o,m);o.fire("db:change",m.getAttribute("data-value"));return d(o)}else{j(o,m,n);return l(o)}}};h=function(o){var r,u,q,n,t,m,p,s;u=o.select("li");assert(u.length,"Empty list of options "+o.identify());q=void 0;if(u.length===1){o.addClassName("one")}else{for(p=0,s=u.length;p<s;p++){r=u[p];t=r.getAttribute("data-value");assert(t,r.identify()+" missing data value");r.observe("click",k(r,o,u));r.observe("mouseenter",e);r.observe("mouseleave",g);if(r.hasClassName("selected")){q=r}}$(document.body).observe("click",function(v){if($(v.target).up(".ul_select_menu")){return}return d(o)})}if(!q){q=u[0]}q.addClassName("selected");m=new Element("span");n=q.getDimensions();m.style.width=n.width+"px";m.style.height=n.height+"px";m.setStyle({width:n.width+"px",height:n.height+"px",position:"relative",display:"inline-block"});return o.wrap(m)};c=function(){return $$(".ul_select_menu").each(function(m){return h(m)})};document.observe("dom:loaded",c);return{init:function(m){return h(m)},set_selected_by_value:b}})();JumpWatcher={inverval:null,last_hash:null,last_page_offset:0,check:function(){if(window.location.href.endsWith("#")&&window.pageYOffset===0&&JumpWatcher.last_page_offset!==0){return JumpWatcher.report()}else{JumpWatcher.last_page_offset=window.pageYOffset;return JumpWatcher.last_hash=Util.url_hash()}},report:function(){clearInterval(JumpWatcher.interval);return assert(0.1+0.2===0.3,"Hash jump detected, last hash = "+JumpWatcher.last_hash)}};ToggleButton={init:function(){return $$(".toggle-button").each(ToggleButton.register)},register:function(a){return a.observe("click",ToggleButton.click)},on:function(a){return a.removeClassName("off")},off:function(a){return a.addClassName("off")}};TitleBubble=(function(){var a,b;b=function(k,l){var q,d,s,o,g,f,m,j,c,h,r,n,p;n=l.getAttribute("title");if(n&&n.length&&n!=="undefined"){l.setAttribute("data-title",n);l.removeAttribute("title")}s=new Element("div",{"class":"title_bubble_container force-no-break",style:"z-index: 1001"});if(l.hasClassName("white")){s.addClassName("white")}s.update(l.getAttribute("data-title"));h=new Element("div",{"class":"tail"});s.appendChild(h);document.body.appendChild(s);o=document.viewport.getDimensions();p=o.width;o=s.getDimensions();d=o.width;q=o.height;f=l.viewportOffset();m=l.getWidth()/2-s.getWidth()/2;g=void 0;r=0;if(f.left+m+d>p){g=p-f.left-d;r=m-g}else{g=m}j=void 0;c=6;if(f.top<q){s.addClassName("below");j=l.getHeight()+c}else{j=(-1*s.getHeight())-c}s.clonePosition(l,{setWidth:false,setHeight:false,offsetTop:j,offsetLeft:g});return h.style.marginLeft=r-4+"px"};a=function(c){return $$(".title_bubble_container").each(Element.remove)};return{init:function(){$(document.body).on("mouseover",".title_bubble",b);return $(document.body).on("mouseout",".title_bubble",a)},hide_all:function(){return a()}}})();Event.observe(window,"scroll",function(){return TitleBubble.hide_all()});Event.observe(document,"dom:loaded",function(){return TranslationSuggest.index_all()});document.observe("dom:loaded",function(){JumpWatcher.interval=setInterval(JumpWatcher.check,500);LocaleSelector.init();ModalLocaleSelector.init();LoginDropdown.init();TitleBubble.init();return Tabs.init()});var BulkUpload,CrossDomainUploader,FileQueue,InlineUploadStatus,Upload,UploadFile;Upload={QUEUE_EVT:"db:upload:queue",QUEUE_ERROR_EVT:"db:upload:queue_error",UPDATE_EVT:"db:upload:update",COMPLETE_EVT:"db:upload:complete",ERROR_EVT:"db:upload:error",CANCEL_EVT:"db:upload:cancel",SWFU:false,current_dest:null,init:function(c,d){var b,a;a={};a[Constants.tcn]=Upload.touch;b=Upload.initSWFU(a);if(!d){Event.observe(window,"load",b)}else{b()}Upload.current_dest=c;$$(".swfupload").each(function(e){if(e.observe){Util.freshbutton_overlay(e,$("choose-button"));return Util.freshbutton_overlay(e,$("add-button"))}});Upload.operaHack();return FileQueue.clear()},init_basic:function(){Util.freshbutton_overlay($("file-box"),$("basic-choose-button"));$("basic-choose-button").observe("mousemove",function(c){var b,a,d;b=$("modal").cumulativeOffset();d=c.clientY-b.top-3;a=c.clientX-b.left-$("file-box").getWidth()+3;return $("file-box").setStyle({top:d+"px",left:a+"px"})});return $("file-box").observe("change",function(){var d,b,e,c,a;Modal.hide=function(){};$("modal-x").hide();$("basic-upload-desc").hide();$("basic-upload-buttons").hide();$("file-box").hide();b=$("file-box").getValue().split("\\").pop();c=Sprite.make("web",FileOps.filename_to_icon(b));$("basic-upload-status").down(".icon").__date(c);d=_("Uploading %(filename)s").format({filename:b.em_snippet(25)});$("basic-upload-status").down(".file-desc").__date(d);$("basic-upload-status").show();$("basic-uploading-message").show();if(window.File&&window.FileList){e=$("file-box").files;if(e){a=e[0].lastModifiedDate;$("mtime").value=Math.round(Date.parse(a)/1000)||0}}return $("basic-upload-form").submit()})},initSWFU:function(a){return function(){var b;b=new SWFUpload({upload_url:(Constants.IS_PROD?"https://":"http://")+Constants.BLOCK_CLUSTER+"/upload",file_post_name:"file",file_size_limit:"307200",file_types:"*",file_types_description:_("All files"),file_upload_limit:"0",button_placeholder_id:"flash-upload-button-placeholder",button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_width:1000,button_height:1000,button_cursor:SWFUpload.CURSOR.HAND,swfupload_loaded_handler:Upload.flashLoaded,file_queued_handler:Upload.fileQueued,file_queue_error_handler:Upload.fileQueueError,upload_progress_handler:Upload.uploadProgress,upload_error_handler:Upload.uploadError,upload_success_handler:Upload.uploadSuccess,upload_complete_handler:Upload.uploadComplete,flash_url:"/static/swf/swfupload.swf",custom_settings:{progress_target:"fsUploadProgress",upload_successful:false},post_params:a,debug:Constants.upload_debug||false});return Upload.SWFU=b}},reset:function(){var a;if(FileQueue.uploading&&FileQueue.current_file){if(CrossDomainUploader.is_cross_domain(FileQueue.current_file)){CrossDomainUploader.current_req.transport.abort()}else{Upload.SWFU.cancelUpload()}}a=$$(".swfupload").first();if(a&&a.remove){a.remove()}delete Upload.SWFU;FileQueue.clear();return InlineUploadStatus.hide()},show_upload:function(){var a;$("upload-desc").hide();$("dnd-upload-desc").hide();$("upload-files-list").show();$("upload-start-buttons").hide();$("upload-running-buttons").show();$("hide-button").show();$("done-button").hide();a=$$(".swfupload").first();if(a){$("flash-upload-container").clonePosition($("add-button"));a.width=$("add-button").getWidth();a.height=$("add-button").getHeight()}if(!$("modal-overlay").visible()){return InlineUploadStatus.show()}},updatePostParams:function(c){var b,a;a=Upload.SWFU.getSetting("post_params");for(b in c){if(c.hasOwnProperty(b)){a[b]=c[b]}}return Upload.SWFU.setPostParams(a)},fileQueueError:function(d,b,c){var e,a;a=_("File too large");e=_('The upload limit online is 300MB. You can upload larger files with the <a id="install_link">Dropbox desktop application</a>.');e=e.replace('id="install_link"','href="/install" target="_blank"');switch(b){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:document.fire(Upload.QUEUE_ERROR_EVT,{file:d,message:a,tooltip_text:e});break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:if(d.size!=null){document.fire(Upload.QUEUE_ERROR_EVT,{file:d,message:_("Empty file"),tooltip_text:_("You can't upload an empty file.")})}else{document.fire(Upload.QUEUE_ERROR_EVT,{file:d,message:a,tooltip_text:e})}break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:document.fire(Upload.QUEUE_ERROR_EVT,{file:d,message:_("Invalid file type"),tooltip_text:_("This file does not have an allowed file type.")});break;default:document.fire(Upload.QUEUE_ERROR_EVT,{file:d});this.debug("Error code: "+b+", file name: "+d.name+", file size: "+d.size+", message: "+c)}return Upload.show_upload()},fileQueued:function(a){document.fire(Upload.QUEUE_EVT,{file:a});return Upload.show_upload()},uploadNext:function(){if(CrossDomainUploader.is_cross_domain(FileQueue.next())){CrossDomainUploader.upload_next()}else{Upload.updatePostParams({dest:FileQueue.next_dest(),t:Constants.TOKEN});Upload.SWFU.startUpload()}FileQueue.last_update_time=0;return FileQueue.last_update_size=0},pause:function(){return Upload.SWFU.stopUpload()},uploadProgress:function(c,b,a){if(!FileQueue.cancelled_files[c.id]){return document.fire(Upload.UPDATE_EVT,{file:c,percent_complete:b/a})}},uploadSuccess:function(b,a){if(a.strip()===""){return document.fire(Upload.ERROR_EVT,{file:b})}else{if(a==="quota"){return document.fire(Upload.ERROR_EVT,{file:b,message:_("Quota exceeded"),tooltip_text:_("Your upload failed because you are over quota.")})}else{if(a==="folder_exists"){return document.fire(Upload.ERROR_EVT,{file:b,message:_("Invalid file name"),tooltip_text:_("You can't upload a file with the same name as a folder in this folder.")})}else{return document.fire(Upload.UPDATE_EVT,{file:b,percent_complete:1})}}}},uploadComplete:function(a){if(!FileQueue.cancelled_files[a.id]&&!FileQueue.errored_files[a.id]){return document.fire(Upload.COMPLETE_EVT,{file:a})}},uploadError:function(e,b,d){var c,a;c=e;if(parseInt(b,10)!==-280){a=FlashDetect.major+"."+FlashDetect.revision;Util.report_exception("Uploader error: "+b+" "+d+" "+(Object.toJSON(e))+" FLASH VERSION: "+a,window.location.href)}switch(b){case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL:this.debug("Error code: No backend file, file name: "+c.name+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:this.debug("Error code: upload limit exceeded, file name: "+c.name+", file size: "+c.size+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:this.debug("Error code: HTTP error, file name: "+c.name+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:this.debug("Error code: upload failed, file name: "+c.name+", file size: "+c.size+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:this.debug("Error code: IO error, file name: "+c.name+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:this.debug("Error code: security error, file name: "+c.name+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:this.debug("Error code: upload cancelled, file name: "+c.name+", message: "+d);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:this.debug("Error code: upload stopped, file name: "+c.name+", message: "+d);break;default:this.debug("Error code: "+b+(", file name: "+c.name+", file size: "+c.size+", message: "+d))}if(FileQueue.files[e.id]){return document.fire(Upload.ERROR_EVT,{file:e,error_code:b})}},grabURL:function(){var a;a=$F("file-box");$("url").value=pathif(/(^http|^https|^ftp):\/\//.match(a));return true},set_dest:function(a){var b;Upload.current_dest=a;DomUtil.fillVal(a,"dest-folder");b=$("basic-uploader-url");if(b){return b.href=b.href.replace(/(\/upload)(.*)(\?basic=1)/,function(e,d,g,c){return d+Util.urlquote(a)+c})}},treeview_handler:function(b,a){Upload.set_dest(b);return FileQueue.clear()},new_folder:function(){TreeView.hide();Modal.show(_("Create new folder..."),DomUtil.fromElm("create-folder"),{action:Upload.do_new_folder,wit_group:"new-folder-confirm"});if(!Util.ie){return $("first-treeview-link").onclick()}},do_new_folder:function(){var b,a;if(!Modal.vars.selected_path){Notify.server_error(_("Please select a parent folder."));return}a=$F("entered-name");b=Modal.vars.selected_path;return new Ajax.DBRequest("/cmd/new"+Util.urlquote(b)+"?to_path="+Util.urlquote(a),{onSuccess:function(c){Upload.treeview_handler(Util.normalize(b)+"/"+a);return TreeView.schedule_reset()},cleanUp:function(){}})},flashLoaded:function(){var a;if($("upload-start-buttons").visible()){$("upload-loading").hide();$("choose-button").show();a=$$(".swfupload").first();if(a){$("flash-upload-container").clonePosition($("choose-button"));a.width=$("choose-button").getWidth();return a.height=$("choose-button").getHeight()}}},operaHack:function(){if(Prototype.Browser.Opera){return Upload.opera_tid=setInterval(function(){return $("opera-dummy-div").toggle()},200)}}};FileQueue={files:{},file_ids:[],uploading:false,num_left:0,queue_size:0,completed_size:0,completed_files:{},errors:0,errored_files:{},cancels:0,cancelled_files:{},all_cancelled:false,last_update_time:0,last_update_size:0,average_bps:0,formatted_time:null,init:function(){return FileQueue._listen()},_listen:function(){document.observe(Upload.QUEUE_EVT,FileQueue._file_queued);document.observe(Upload.QUEUE_ERROR_EVT,FileQueue._file_queue_errored);document.observe(Upload.UPDATE_EVT,FileQueue._file_updated);document.observe(Upload.COMPLETE_EVT,FileQueue._file_completed);document.observe(Upload.ERROR_EVT,FileQueue._file_errored);return document.observe(Upload.CANCEL_EVT,FileQueue._file_cancelled)},_file_queued:function(b){var a;a=b.memo.file;FileQueue.queue_size+=a.size;FileQueue.files[a.id]=a;FileQueue.file_ids.push(a.id);FileQueue.num_left++;if(!FileQueue.uploading){FileQueue._start_uploading()}return T("File queued:",a.name)},_file_queue_errored:function(a){FileQueue._file_queued(a);return setTimeout((function(){return FileQueue._file_errored(a)}),250)},_file_updated:function(k){var d,a,b,c,h,g,f,j,l;c=k.memo.file;g=k.memo.percent_complete;h=g*c.size;l=FileQueue.completed_size+h;b=new Date().getTime();if(FileQueue.last_update_time){f=(b-FileQueue.last_update_time)/1000;a=h-FileQueue.last_update_size;d=a/f;FileQueue.average_bps=((l-a)*FileQueue.average_bps+a*d)/l;j=(FileQueue.queue_size-l)/FileQueue.average_bps;FileQueue.formatted_time=Util.formatTime(j+FileQueue.num_left)}FileQueue.current_file=c;FileQueue.last_update_time=new Date().getTime();FileQueue.last_update_size=h;return FileQueue.totalPercentage=l/FileQueue.queue_size},_file_completed:function(b){var a;a=b.memo.file;FileQueue.num_left=Math.max(0,FileQueue.num_left-1);FileQueue.completed_files[a.id]=true;FileQueue.completed_size+=a.size;FileQueue.totalPercentage=FileQueue.completed_size/FileQueue.queue_size;T("File completed:",a.name);return FileQueue._check_if_finished(a)},_file_errored:function(b){var a;a=b.memo.file;FileQueue.errors=FileQueue.errors+1;FileQueue.errored_files[a.id]=true;FileQueue.num_left=Math.max(0,FileQueue.num_left-1);FileQueue.queue_size-=a.size;FileQueue.totalPercentage=FileQueue.completed_size/FileQueue.queue_size;BulkUpload.update_errors();InlineUploadStatus.update_errors();T("File errored:",a.name);return FileQueue._check_if_finished(a)},_file_cancelled:function(b){var a;a=b.memo.file;delete FileQueue.files[a.id];FileQueue.file_ids.splice(FileQueue.file_ids.indexOf(a.id),1);FileQueue.cancels=FileQueue.cancels+1;FileQueue.cancelled_files[a.id]=true;FileQueue.num_left=Math.max(0,FileQueue.num_left-1);FileQueue.queue_size-=a.size;FileQueue.totalPercentage=FileQueue.completed_size/FileQueue.queue_size;if(CrossDomainUploader.is_cross_domain(a)){if(FileQueue.current_file===a){CrossDomainUploader.current_req.transport.abort()}}else{Upload.SWFU.cancelUpload(a.id)}T("File cancelled:",a.name);return FileQueue._check_if_finished(a)},_start_uploading:function(){var a;Upload.uploadNext();FileQueue.uploading=true;FileQueue.all_cancelled=false;return window.onbeforeunload=a=function(){return _("Leaving this page will cancel your uploads.")}},_check_if_finished:function(a){if(FileQueue.empty()){if(FileQueue.uploading){return FileQueue._finished_uploading()}}else{if(!FileQueue.all_cancelled&&FileQueue.current_file&&a.id===FileQueue.current_file.id){return Upload.uploadNext()}}},_finished_uploading:function(){var b,c,a;FileQueue.uploading=false;if(!FileQueue.num_files()){BulkUpload.cancelled()}else{if(FileQueue.errors){BulkUpload.errored();InlineUploadStatus.errored()}else{BulkUpload.completed();InlineUploadStatus.completed()}}a=InlineUploadStatus.upload_box&&InlineUploadStatus.upload_box.visible();Browse.select_fq_paths=[];if(Browse.inside_dir){b=Browse.containing_fq_path();for(c in FileQueue.completed_files){Browse.select_fq_paths.push(b+"/"+FileQueue.files[c].name)}}Browse.force_reload();if(a){InlineUploadStatus.show()}Modal.onHide=null;return window.onbeforeunload=null},empty:function(){return !FileQueue.num_left},num_files:function(){return FileQueue.file_ids.length},next:function(){var a;if(FileQueue.num_left!==0){a=FileQueue.num_files()-FileQueue.num_left;return FileQueue.files[FileQueue.file_ids[a]]}},next_dest:function(){var b,a;a=FileQueue.next();b=a&&a.id;if(b&&$(b)){return $(b).readAttribute("data-dest")}else{return a.dest||Upload.current_dest}},clear:function(a){FileQueue.files={};FileQueue.file_ids=[];FileQueue.queue_size=0;FileQueue.cancels=0;FileQueue.cancelled_files={};FileQueue.all_cancelled=false;FileQueue.errors=0;FileQueue.errored_files={};FileQueue.num_left=0;FileQueue.completed_size=0;FileQueue.completed_files={};FileQueue.last_update_time=0;FileQueue.last_update_size=0;FileQueue.average_bps=0;FileQueue.formatted_time=null;FileQueue.uploading=false;window.onbeforeunload=null;return Modal.onHide=null}};UploadFile={FILENAME_SNIPPET_LENGTH:15,DEST_SNIPPET_LENGTH:13,_tmpl:null,init:function(){UploadFile._tmpl=HTML.tmpl("upload_list_item_tmpl");return UploadFile._listen()},_listen:function(){document.observe(Upload.QUEUE_EVT,UploadFile._file_queued);document.observe(Upload.QUEUE_ERROR_EVT,UploadFile._file_queue_errored);document.observe(Upload.UPDATE_EVT,UploadFile._file_updated);document.observe(Upload.COMPLETE_EVT,UploadFile._file_completed);document.observe(Upload.ERROR_EVT,UploadFile._file_errored);return document.observe(Upload.CANCEL_EVT,UploadFile._file_cancelled)},_file_queued:function(f){var j,b,a,h,g,k,c,d;b=f.memo.file;j=b.dest||Upload.current_dest;k=b.size!=null?Util.formatBytes(b.size,2,true):_("Too large");a=UploadFile._tmpl({file:b,icon:FileOps.filename_to_icon(b.name),filename_snippet:b.name.em_snippet(UploadFile.FILENAME_SNIPPET_LENGTH),size:k,dest:j,dest_snippet:("Dropbox"+j).em_snippet(UploadFile.DEST_SNIPPET_LENGTH,0)});$("upload-files-list").__sert(a);h=$(b.id);g=FileQueue.num_files()+FileQueue.cancels;c=$("upload-files-list");if(g<=6||IE7_OR_LESS){c.removeClassName("scroll")}else{c.addClassName("scroll");c.scrollTop=c.scrollHeight}h.down(".dest").observe("click",function(){Browse.reload_fqpath(h.readAttribute("data-dest"),true);return Modal.hide()});d=h.down(".status-col").down("a.small-x-button");d.stopObserving("click");d.observe("click",function(l){return document.fire(Upload.CANCEL_EVT,{file:b})});return h.down(".upload-progress-bar").setStyle({width:"0"})},_file_queue_errored:function(a){UploadFile._file_queued(a);return UploadFile._file_errored(a)},_file_updated:function(f){var c,g,b,a,d;c=f.memo.file;g=$(c.id);if(FileQueue.num_files()+FileQueue.cancels===1){if(FileQueue.formatted_time){a=_("%(time_left)s left").format({time_left:FileQueue.formatted_time});g.down(".time-col").__date(a)}}else{g.down(".time-col").__date()}b=parseInt(100*f.memo.percent_complete,10)+"%";if(b==="100%"){g.down(".time-col").__date();g.down(".status-col").__date(new Element("img",{src:"/static/images/icons/ajax-loading-small.gif"}))}else{d=g.down(".status-col").down("a.small-x-button");if(d){d.stopObserving("click");d.observe("click",function(h){return document.fire(Upload.CANCEL_EVT,{file:c})})}}return g.down(".upload-progress-bar").setStyle({width:b})},_file_completed:function(b){var a,c;a=b.memo.file;c=$(a.id);c.addClassName("complete");c.down(".time-col").__date();c.down(".status-col").__date(Sprite.make("web","synced"));return c.down(".upload-progress-bar").setStyle({width:"100%"})},_file_errored:function(f){var a,c,b,g,d;b=f.memo.file;g=$(b.id);g.addClassName("error");g.down(".dest-col").hide();g.down(".time-col").__date();g.down(".status-col").__date(Sprite.make("web","nosync"));g.down(".upload-progress-bar").setStyle({width:"100%"});c=f.memo.message||_("Flash error");a=void 0;if(f.memo.tooltip_text){a=f.memo.tooltip_text}else{if(parseFloat(Util.flash_version(),10)<10.32){a=_('Upload failed.  Please try upgrading to the latest version of <a id="adobe_link">Adobe Flash</a> and try again.');a=a.replace('id="adobe_link"','href="http://get.adobe.com/flashplayer/" target="_blank"')}else{a=_('Sorry, it looks like the advanced uploader is incompatible with your system. Please use the <a id="basic_link">basic uploader</a> to upload via the website');a=a.replace('id="basic_link"','onclick="FileOps.show_basic_upload(Browse.containing_fq_path()); return false;"')}}g.down(".error-msg").__date(c);d=g.down(".error-details");d.observe("mouseover",function(){return Tooltip.show(d,a)});return g.down(".error-col").show()},_file_cancelled:function(b){var a,c;a=b.memo.file;c=$(a.id);c.addClassName("cancelled");c.down(".dest-col").__date(_("Canceled"));c.down(".time-col").__date();c.down(".status-col").__date(Sprite.make("web","cancelsync"));return c.down(".upload-progress-bar").setStyle({width:"100%"})}};BulkUpload={init:function(){return BulkUpload._listen()},_listen:function(){document.observe(Upload.QUEUE_EVT,BulkUpload._file_queued);return document.observe(Upload.UPDATE_EVT,BulkUpload._file_updated)},_file_queued:function(c){var a,b;a=$("bulk-upload-status");a.removeClassName("error");a.removeClassName("complete");a.removeClassName("cancelled");b=new Element("a",{"class":"small-x-button"});b.observe("click",function(){var f,h,g,e,d;FileQueue.all_cancelled=true;f=FileQueue.file_ids.slice(0);d=[];for(g=0,e=f.length;g<e;g++){h=f[g];if(!FileQueue.completed_files[h]&&!FileQueue.errored_files[h]){d.push(document.fire(Upload.CANCEL_EVT,{file:FileQueue.files[h]}))}else{d.push(void 0)}}return d});return a.down(".status").__date(b)},_file_updated:function(h){var g,d,c,f,b,a;c=FileQueue.num_files();if(c+FileQueue.cancels>1){g=$("bulk-upload-status");f=ungettext("%d file","%d files",c).format(c);g.down(".num-files").__date(f);b=_("- %(size)s").format({size:Util.formatBytes(FileQueue.queue_size,2,true)});g.down(".size").__date(b);if(FileQueue.formatted_time){a=_("%(time_left)s left").format({time_left:FileQueue.formatted_time});g.down(".time-left").__date(a)}g.down(".upload-progress-bar").style.width=(100*FileQueue.totalPercentage||0).toFixed(2)+"%";g.show();d=$$(".swfupload").first();if(d){$("flash-upload-container").clonePosition($("add-button"));d.width=$("add-button").getWidth();return d.height=$("add-button").getHeight()}}},update_errors:function(){var a;a=ungettext("- %d error","- %d errors",FileQueue.errors).format(FileQueue.errors);return $("bulk-upload-status").down(".num-errors").__date(a)},completed:function(){var d,b,c,a;$("hide-button").hide();$("done-button").show();b=FileQueue.num_files();if(b+FileQueue.cancels>1){d=$("bulk-upload-status");d.addClassName("complete");c=ungettext("Uploaded %d file","Uploaded %d files",b).format(b);d.down(".num-files").__date(c);a=_("- %(size)s").format({size:Util.formatBytes(FileQueue.completed_size,2,true)});d.down(".size").__date(a);d.down(".num-errors").__date();d.down(".time-left").__date();d.down(".status").__date(Sprite.make("web","synced"));return d.down(".upload-progress-bar").style.width="100%"}},errored:function(){var d,e,b,c,a;$("hide-button").hide();$("done-button").show();b=FileQueue.num_files();if(b+FileQueue.cancels>1){d=$("bulk-upload-status");d.addClassName("error");c=ungettext("Uploaded %(num_completed)d of %(num_files)d file","Uploaded %(num_completed)d of %(num_files)d files",b).format({num_completed:b-FileQueue.errors,num_files:b});d.down(".num-files").__date(c);a=_("- %(size)s").format({size:Util.formatBytes(FileQueue.completed_size,2,true)});d.down(".size").__date(a);e=ungettext("- %d error","- %d errors",FileQueue.errors).format(FileQueue.errors);d.down(".num-errors").__date(e);d.down(".time-left").__date();d.down(".status").__date(Sprite.make("web","nosync"));return d.down(".upload-progress-bar").style.width="100%"}},cancelled:function(){var b,a;$("hide-button").hide();$("done-button").show();a=FileQueue.num_files();if(a+FileQueue.cancels>1){b=$("bulk-upload-status");b.addClassName("cancelled");b.down(".num-files").__date(_("All uploads canceled"));b.down(".size").__date();b.down(".num-errors").__date();b.down(".time-left").__date();b.down(".status").__date(Sprite.make("web","cancelsync"));return b.down(".upload-progress-bar").style.width="100%"}}};InlineUploadStatus={FILENAME_SNIPPET_LENGTH:30,upload_box:false,init:function(){return InlineUploadStatus._listen()},_listen:function(){document.observe(Upload.QUEUE_EVT,InlineUploadStatus._file_queued);return document.observe(Upload.UPDATE_EVT,InlineUploadStatus._file_updated)},_file_queued:function(c){var b,a;b=$("inline-upload-status");b.removeClassName("error");b.removeClassName("complete");b.down(".icon").__date(Sprite.make("web","syncing"));b.down(".file-desc").__date(_("Starting upload..."));b.down(".num-errors").__date();a=ungettext("%d file","%d files",FileQueue.num_left).format(FileQueue.num_left);b.down(".view-details").__date(a);b.down(".status").__date();return b.down(".inline-upload-progress").style.width="0%"},_file_updated:function(h){var d,f,c,g,b,a;d=h.memo.file;if($$("#right-content #inline-upload-status").length===0){InlineUploadStatus._build()}c=$("inline-upload-status");c.down(".icon").__date(Sprite.make("web","syncing"));f=_("Uploading %(filename)s").format({filename:d.name.em_snippet(InlineUploadStatus.FILENAME_SNIPPET_LENGTH)});c.down(".file-desc").__date(f);if(FileQueue.num_left>1){a=ungettext("%d file left","%d files left",FileQueue.num_left-1).format(FileQueue.num_left-1);c.down(".view-details").__date(a)}else{c.down(".view-details").__date(_("View details"))}if(FileQueue.formatted_time){b=_("%(time_left)s left").format({time_left:FileQueue.formatted_time});c.down(".status").__date(b)}g=(parseInt(100*FileQueue.totalPercentage,10)||0)+"%";return c.down(".inline-upload-progress").style.width=g},update_errors:function(){var a;a=ungettext("- %d error","- %d errors",FileQueue.errors).format(FileQueue.errors);return $("inline-upload-status").down(".num-errors").__date(a)},add_x_button:function(){var a;a=new Element("a",{"class":"small-x-button"});a.observe("click",function(){InlineUploadStatus.hide();return Upload.reset()});return $("inline-upload-status").down(".status").__date(a)},completed:function(){var b,a;a=$("inline-upload-status");a.addClassName("complete");a.removeClassName("error");a.down(".icon").__date(Sprite.make("web","synced"));b=void 0;if(FileQueue.num_files()>1){b=_("Uploaded %(num_files)d files").format({num_files:FileQueue.num_files()})}else{b=_("Uploaded %(filename)s").format({filename:FileQueue.current_file.name.em_snippet(InlineUploadStatus.FILENAME_SNIPPET_LENGTH)})}a.down(".file-desc").__date(b);a.down(".num-errors").__date();a.down(".view-details").__date(_("View details"));InlineUploadStatus.add_x_button();return a.down(".inline-upload-progress").style.width="100%"},errored:function(){var d,c,a,f,b,e;a=$("inline-upload-status");a.addClassName("error");a.removeClassName("complete");a.down(".icon").__date(Sprite.make("web","nosync"));b=FileQueue.num_files();d=void 0;if(b>1){d=_("Uploaded %(num_completed)d of %(num_files)d files").format({num_completed:b-FileQueue.errors,num_files:b});a.down(".file-desc").__date(d);f=ungettext("- %d error","- %d errors",FileQueue.errors).format(FileQueue.errors);a.down(".num-errors").__date(f)}else{c=(e=FileQueue.current_file)!=null?e.name.em_snippet(InlineUploadStatus.FILENAME_SNIPPET_LENGTH):void 0;d=c?_("Unable to upload %(filename)s").format({filename:c}):_("Unable to upload file");a.down(".file-desc").__date(d);a.down(".num-errors").__date()}a.down(".view-details").__date(_("View details"));InlineUploadStatus.add_x_button();return a.down(".inline-upload-progress").style.width="100%"},show:function(a){if(!InlineUploadStatus.upload_box){InlineUploadStatus._build(a)}return InlineUploadStatus.upload_box.show()},_build:function(){if(!InlineUploadStatus.upload_box){InlineUploadStatus.upload_box=$("inline-upload-status")}return $("browse").__sert({top:InlineUploadStatus.upload_box})},hide:function(){if(InlineUploadStatus.upload_box){return InlineUploadStatus.upload_box.hide()}}};CrossDomainUploader={CROSS_DOMAIN_PREFIX:"cross-domain-",_drop_indicators:false,_drop_dest_folder:null,file_counter:0,current_req:null,supported:function(){return Prototype.BrowserFeatures.DB_CORS},enabled:function(){return CrossDomainUploader.supported()&&Browse.inside_dir},browse_indicators_enabled:function(){var d,b,c,a;if(!CrossDomainUploader.enabled()){return false}b=["file-preview-modal","modal-overlay"];for(c=0,a=b.length;c<a;c++){d=b[c];if($(d).visible()){return false}}return true},modal_indicators_enabled:function(){return CrossDomainUploader.enabled()&&$("modal").down("#upload-modal-dropzone")},_show_border_drop_indicators:function(){return $$(".external-drop-indicator").each(function(a){return new Effect.Appear(a,{duration:0.5,from:0,to:0.6})})},_hide_border_drop_indicators:function(){return $$(".external-drop-indicator").invoke("hide")},show_drop_indicators:function(b){var a;if(!CrossDomainUploader._drop_indicators){if(CrossDomainUploader.modal_indicators_enabled()){a=$("upload-modal-dropzone");a.clonePosition($("modal"));a.style.lineHeight=a.getHeight()+"px";new Effect.Appear(a,{duration:0.5,from:0,to:1});CrossDomainUploader._show_border_drop_indicators()}else{if(CrossDomainUploader.browse_indicators_enabled()){BrowseDrag._add_drop_indicators(b)}else{return}}$("drag-status").removeClassName("active");return CrossDomainUploader._drop_indicators=true}},hide_drop_indicators:function(){if(CrossDomainUploader._drop_indicators){CrossDomainUploader._hide_border_drop_indicators();BrowseDrag._remove_drop_indicators();Notify.clear_all();$("upload-modal-dropzone").hide();$("drag-status").addClassName("active");return setTimeout((function(){CrossDomainUploader._drop_indicators=false;return CrossDomainUploader._drop_dest_folder=null}),500)}},folder_dragover:function(a){var b;if(CrossDomainUploader.browse_indicators_enabled()&&CrossDomainUploader._drop_indicators&&a!==CrossDomainUploader._drop_dest_folder){if(a===Browse.containing_fq_path()){b=_("Drop your file to upload to '%(folder_name)s'").format({folder_name:FileOps.filename(a).em_snippet(20).escapeHTML()});Notify.server_success(b,60);CrossDomainUploader._show_border_drop_indicators()}else{Notify.clear_all();CrossDomainUploader._hide_border_drop_indicators()}return CrossDomainUploader._drop_dest_folder=a}},is_cross_domain:function(a){return a.id.indexOf(CrossDomainUploader.CROSS_DOMAIN_PREFIX)!==-1},upload:function(b,d){var c,e,a;Upload.current_dest=b;if(!$("modal").visible()){FileOps.show_upload();Modal.hide(null,true)}for(e=0,a=d.length;e<a;e++){c=d[e];c.id=CrossDomainUploader.CROSS_DOMAIN_PREFIX+CrossDomainUploader.file_counter;c.dest=b;CrossDomainUploader.file_counter++;document.fire(Upload.QUEUE_EVT,{file:c})}return Upload.show_upload()},upload_next:function(){var b,a;b=FileQueue.next();a="//"+Constants.BLOCK_CLUSTER+"/upload_cross_domain?filename="+encodeURIComponent(b.name||b.fileName)+"&dest="+encodeURIComponent(FileQueue.next_dest())+"&t="+encodeURIComponent(Constants.TOKEN);FileQueue.current_file=b;return CrossDomainUploader.current_req=new Ajax.DBRequest(a,{method:"POST",contentType:b.type||"application/octet-stream",evalJS:false,evalJSON:false,no_watch:true,requestHeaders:{"If-Modified-Since":"Mon, 26 Jul 1997 05:00:00 GMT","Cache-Control":"no-cache","X-File-Name":b.name||b.fileName,"X-File-Size":b.size||b.fileSize,"X-File-Type":b.type},postBody:b,onCreate:CrossDomainUploader._onCreate.bind(null,b),onSuccess:CrossDomainUploader._onSuccess.bind(null,b),onFailure:CrossDomainUploader._onFailure.bind(null,b)})},_onCreate:function(a,c){var b;b=c.request.transport;b.upload.addEventListener("progress",(function(d){if(!FileQueue.cancelled_files[a.id]){return document.fire(Upload.UPDATE_EVT,{file:a,percent_complete:d.loaded/d.total})}}),false);return b.send=b.send.wrap(function(e,d){this.withCredentials="true";return e(d)})},_onSuccess:function(a,b){return document.fire(Upload.COMPLETE_EVT,{file:a})},_onFailure:function(a,b){if(!FileQueue.cancelled_files[a.id]){if(a.size){return document.fire(Upload.ERROR_EVT,{file:a,message:_("Upload error"),tooltip_text:_("Please try again. If this continues to fail, your browser might not support drag and drop uploads.")})}else{return document.fire(Upload.ERROR_EVT,{file:a,message:_("Invalid type"),tooltip_text:_("You can't upload folders or files of this type.")})}}}};var AccountExtras,BonusTable,Bromo,DowngradeReasons,Downloading,Eggs,EmailChange,EmailVerification,GetSpace,Help,Home,Hosts,Install,LoginAndRegister,News,PasswordChange,Restore,SecurityTab,TabController,Upgrade;Hosts={edit:function(g){var d,c,f,a,b,e;f=$("host"+g);if(f.editing){return false}f.editing=true;c=f.innerHTML.unescapeHTML();f.previous=c;e=c.escapeHTML().gsub('"',"&quot;");b=_("Save");d=_("Cancel");f.innerHTML='<input type="text" class="skinny-input" size="20" maxlength="256" style="word-wrap: break-word;" value="'+e+'">&nbsp;\n<input type="button" onclick="Hosts.doneEditing(\''+g+'\')" class="button" value="'+b+'">&nbsp;\n<input type="button" onclick="Hosts.cancelEditing(\''+g+'\')" class="button grayed" value="'+d+'">';a=f.down("input");Event.observe(a,"keydown",Hosts.checkKey(g));a.select();return false},doneEditing:function(c){var b,a;b=$("host"+c);a=b.down("input").value;return new Ajax.DBRequest("/computer_edit?host_id="+c+"&name="+Util.urlquote(a),{onSuccess:function(d){return Hosts.unedit(b,d.responseText)}})},cancelEditing:function(b){var a;a=$("host"+b);return Hosts.unedit(a,a.previous)},unedit:function(b,a){b.editing=false;return b.__date(a)},unlink:function(c,b,a){DomUtil.fillVal(b.escapeHTML(),"unlink-confirm-name");return Modal.icon_show("alert_32",_("Unlink computer?"),DomUtil.fromElm("unlink-confirm"),{host_id:c,plat:a,wit_group:"unlink-confirm"})},doUnlink:function(b,a){return new Ajax.DBRequest("/computer_edit?host_id="+b+"&unlink=yessir",{onSuccess:function(c){Hosts.killRow(b);return Hosts.dec_count(a)}})},dec_count:function(a){var c,b,e,d;b=$(a+"-count");if(!b){return}d=b.innerHTML.split(" ");c=parseInt(d.shift(),10);e=d.join(" ");if(!c){return}c--;if(c===1&&e.charAt(e.length-1)==="s"){e=e.substr(0,e.length-1)}else{if(c!==1&&e.charAt(e.length-1)!=="s"){e=e+"s"}}return b.innerHTML=c.toString()+" "+e},killRow:function(d){var b,a,c;a=$("host"+d).up("table");$("host"+d).up("tr").remove();if(Hosts.rowCount()===0){b=new Element("tr");c=new Element("td",{colspan:4});c.__date(HTML.tmpl("<center><%= text %></center>",{text:_("You no longer have any hosts linked.")}));a.__sert(b);return b.__sert(c)}},rowCount:function(){return $$(".host-row").length},checkKey:function(a){return function(b){b=b||window.event;if(b.keyCode===Event.KEY_RETURN){Hosts.doneEditing(a)}if(b.keyCode===Event.KEY_ESC){return Hosts.cancelEditing(a)}}}};Upgrade={card_toggle:function(a){return function(c){var b;b=$(c);if(c===a||!a){return b.removeClassName("cc-icon-off")}else{return b.addClassName("cc-icon-off")}}},highlightCardtype:function(){var c,e,b,a,d;e=$("ccn");if(Upgrade.last_val===e.value){return}Upgrade.last_val=e.value;b=e.value;d=b.substr(0,2);c=$A(["visa","mastercard","amex"]);a=null;if(b.charAt(0)==="4"){a="visa"}else{if(d==="34"||d==="37"){a="amex"}else{if(parseInt(d,10)>=51&&parseInt(d,10)<=55){a="mastercard"}}}return c.each(Upgrade.card_toggle(a))},runCardHighlighter:function(){return setInterval(Upgrade.highlightCardtype,200)},submitPaypal:function(){var a;if(!Forms.submitOnlyOnce()){return}a={plan:Forms.value("plan"),period:Forms.value("period")};if(Forms.value("packrat")){a.packrat="yes"}return location.href=Util.add_qstring("/paypal_upgrade",a)},upgradeViaLogin:function(){var a,b;if(!Forms.submitOnlyOnce()){return}a={plan:Forms.value("plan"),period:Forms.value("period")};if(Forms.value("packrat")){a.packrat="yes"}b=Util.add_qstring("/upgrade",a);return location.href=Util.add_qstring("/login",{cont:b})},setFormToObserveLogin:function(){return $("upgrade-login-button").observe("click",Upgrade.upgradeViaLogin)},setFormPaypalSubmitState:function(a){var b;b=$("upgrade-button");if(!b){return}if(a){return b.observe("click",Upgrade.submitPaypal)}else{return b.stopObserving("click")}},watchPaymentOptions:function(){var l,h,g,d,k,b,a,j,f,c,e;j=$$("a.toggle_paypal_link");for(h=0,k=j.length;h<k;h++){l=j[h];l.observe("click",function(){$("credit-card-info").addClassName("hidden_elem");$("submitted_cc").writeAttribute("value","false");$("paypal-info").removeClassName("hidden_elem");$("toggle_paypal_link_container").addClassName("hidden_elem");$("toggle_credit_card_link_container").removeClassName("hidden_elem");return Upgrade.setFormPaypalSubmitState(true)})}f=$$("a.toggle_credit_card_link");for(g=0,b=f.length;g<b;g++){l=f[g];l.observe("click",function(){var m;$("credit-card-info").removeClassName("hidden_elem");$("submitted_cc").setValue("true");m=$("paypal-info");if(m){$("paypal-info").addClassName("hidden_elem")}$("toggle_paypal_link_container").removeClassName("hidden_elem");$("toggle_credit_card_link_container").addClassName("hidden_elem");Upgrade.setFormPaypalSubmitState(false);return $("ccn").focus()})}c=$$("a.change_billing_information");e=[];for(d=0,a=c.length;d<a;d++){l=c[d];e.push(l.observe("click",function(){var u,r,v,t,m,x,w,q,o,s,p,n;$("toggle_paypal_link_container").removeClassName("hidden_elem");$("change_billing_information_container").addClassName("hidden_elem");$("upgrade-form").action="/upgrade";s=$$(".sick-input input");for(t=0,m=s.length;t<m;t++){v=s[t];v.writeAttribute("readOnly",false);v.removeClassName("gray")}$("country-list").removeClassName("hidden_elem");p=$$("[name='expmo']");for(q=0,x=p.length;q<x;q++){u=p[q];u.writeAttribute("disabled",false)}n=$$("[name='expyr']");for(o=0,w=n.length;o<w;o++){r=n[o];r.writeAttribute("disabled",false)}$("ccn").writeAttribute("value","");$("address").writeAttribute("value","");return $("ccode").writeAttribute("value","")}))}return e},plan_to_prices:{},plan_to_display_name:{},monthly_packrat_cost:0,yearly_packrat_cost:0,monthly_packrat_display_price:0,yearly_packrat_display_price:0,prorate_amount:0,has_packrat_already:false,plan_box_holder_ids:[],user_current_plan_size:0,user_current_billing_period:"",user_has_downgraded:false,initializeUpgradeForm:function(e,g,f,h,k,c,j,b,a,d){Upgrade.user_current_plan_size=e;Upgrade.user_current_billing_period=g;Upgrade.user_has_downgraded=f;Upgrade.monthly_packrat_cost=h;Upgrade.yearly_packrat_cost=k;Upgrade.monthly_packrat_display_price=c;Upgrade.yearly_packrat_display_price=j;Upgrade.prorate_amount=a;Upgrade.has_packrat_already=b;return Upgrade.setFormPaypalSubmitState(d)},registerPrice:function(c,a,b){return Upgrade.plan_to_prices[c]=[a,b]},registerPlanDisplayName:function(b,a){return Upgrade.plan_to_display_name[b]=[a]},registerPlanBoxHolderId:function(b,a){Upgrade.plan_box_holder_ids.push(b);return $(a).observe("click",function(){return Upgrade.updateSelectedPlanBoxHolder(b)})},updateSelectedPlanBoxHolder:function(d){var c,f,b,e,a;$(d).addClassName("selected-plan");e=Upgrade.plan_box_holder_ids;a=[];for(f=0,b=e.length;f<b;f++){c=e[f];if(c!==d){a.push($(c).removeClassName("selected-plan"))}else{a.push(void 0)}}return a},updateBillingForm:function(W){var C,S,A,D,b,s,w,e,a,G,R,F,u,c,O,E,l,B,v,I,d,z,y,V,U,Q,P,x,m,k,j,h,g,f,N,M,L,H,t,r,q,p,o,n,K,J;I=0;E=100;F=$("packrat");e=Upgrade.has_packrat_already||(F&&F.type==="checkbox"&&F.checked);G=_("month");R="$39.00";H=$$("[name='plan']");for(V=0,x=H.length;V<x;V++){s=H[V];if(s.checked){E=s.getValue();Upgrade.updateSelectedPlanBoxHolder("plan-"+E+"-holder")}}if(E===Upgrade.user_current_plan_size&&!Upgrade.user_has_downgraded){$("current-plan-desc").removeClassName("hidden_elem");$("billing-information").addClassName("hidden_elem")}else{$("current-plan-desc").addClassName("hidden_elem");$("billing-information").removeClassName("hidden_elem")}if($("period-month").checked){I=Upgrade.plan_to_prices[E][0];if(e){I+=Upgrade.monthly_packrat_cost}R=Upgrade.monthly_packrat_display_price;G=_("month");v="month"}if($("period-year").checked){I=Upgrade.plan_to_prices[E][1];if(e){I+=Upgrade.yearly_packrat_cost}R=Upgrade.yearly_packrat_display_price;G=_("year");v="year"}u=$("packrat-price");c=$("packrat-priceperiod");if(u&&c){u.__date(R);c.__date(G)}y=Upgrade.plan_to_prices[E][0]*12;if(e){y+=Upgrade.monthly_packrat_cost*12}w=Upgrade.plan_to_prices[E][1];if(e){w+=Upgrade.yearly_packrat_cost}B=y-w;O=B/y*100;O=Math.round(O);C=0;S=0;if(Upgrade.prorate_amount>=I){C=0;S=I}else{C=I-Upgrade.prorate_amount;S=Upgrade.prorate_amount}b=C;if(Upgrade.user_has_downgraded&&E===Upgrade.user_current_plan_size&&v===Upgrade.user_current_billing_period){b=0;S=0}b=b.toFixed(2);l=$("plan-name");if(l){l.__date(Upgrade.plan_to_display_name[E])}$("big-price").__date("$"+b);t=$$(".summary_price");for(U=0,m=t.length;U<m;U++){d=t[U];d.__date("$"+b)}r=$$(".monthly-price");for(Q=0,k=r.length;Q<k;Q++){a=r[Q];a.__date("$"+Upgrade.plan_to_prices[E][0].toFixed(2))}q=$$(".yearly-price");for(P=0,j=q.length;P<j;P++){z=q[P];z.__date("$"+Upgrade.plan_to_prices[E][1].toFixed(2))}$("savings-percentage").__date(O+"%");if(S){p=$$(".credit-holder");for(N=0,h=p.length;N<h;N++){D=p[N];D.removeClassName("hidden_elem")}o=$$(".credit-amount");K=[];for(M=0,g=o.length;M<g;M++){A=o[M];K.push(A.__date(S.toFixed(2)))}return K}else{n=$$(".credit-holder");J=[];for(L=0,f=n.length;L<f;L++){D=n[L];J.push(D.addClassName("hidden_elem"))}return J}},runPlanWatcher:function(){var d,e,h,f,c,b,g,a;g=$$("[name='plan']");for(h=0,c=g.length;h<c;h++){d=g[h];d.observe("click",Upgrade.updateBillingForm)}a=$$("[name='period']");for(f=0,b=a.length;f<b;f++){d=a[f];d.observe("click",Upgrade.updateBillingForm)}e=$("packrat");if(e){return e.observe("click",Upgrade.updateBillingForm)}}};Home={hide_promo:function(a){new Ajax.DBRequest(a);return $$(".bromo").invoke("remove")},showScreencast:function(g,k,c){var b,h,f,d,l,e,j,a;f="/static/images/cc_endframe.jpg";j=360/640;if(Constants.USER_LOCALE==="en"){f="/static/images/cc_endframe_en.jpg";j=353/640}c=c||532;l=j*c;l=parseInt(l,10);a=localized_path("http://scast.s3.amazonaws.com/cc/dropbox_intro.mp4",["es","fr","de","ja"]);h="commoncraft-embed";b=new Element("div",{id:h,style:"display: inline-block; border:1px solid #adcfea;background:#fff;"});$(g).__date(b);if(FlashDetect.versionAtLeast(9)){e={allowfullscreen:"true",wmode:"transparent"};d={file:a,skin:"/static/swf/bekle.swf",controlbar:"over",image:f};if(k){d.autostart="true"}swfobject.embedSWF("/static/swf/jwplayer-5.10-licensed.swf",h,c.toString(),l.toString(),"9",false,d,e)}else{Util.embed_video(a,h,c,k,l)}return MCLog.log("commoncraft_views")},hide:function(b,a){$(b).up("div").hide();return new Ajax.DBRequest("/hide/"+a)}};LoginAndRegister={init:function(){LoginAndRegister._one_submit_at_a_time();$("login-link").observe("click",function(){return $("login-and-register-container").removeClassName("show-register")});return $("register-link").observe("click",function(){return $("login-and-register-container").addClassName("show-register")})},invite_init:function(b,a){LoginAndRegister._one_submit_at_a_time();if(!a){return $("invite-register-page").on("click",".switch-form-link",function(){return $("invite-register-page").toggleClassName("show-login-form")})}},_one_submit_at_a_time:function(){var e,d,b,c,a;c=$$(".one-submit-at-a-time");a=[];for(d=0,b=c.length;d<b;d++){e=c[d];a.push(e.observe("click",function(f){return Forms.disable(e)}))}return a}};News={DEFAULT_TAB:"recent-news",init:function(){$("news-home").on("click","#nav a",function(b,c){var a;if(c.hasAttribute("data-div")){b.preventDefault();a=c.readAttribute("data-div");return DBHistory.push_state("/news/"+a)}});return DBHistory.add_callback("/news",News.history_change)},change_tab:function(a){var b;b=$$("#nav a[data-div="+a+"]").first();$$(".section").invoke("removeClassName","selected");$$("#nav a").invoke("removeClassName","selected");$(b).addClassName("selected");return $(a).addClassName("selected")},history_change:function(a){a=a||News.DEFAULT_TAB;return News.change_tab(a)}};Install={pingForLinkedHost:function(a){return new Ajax.Request("/host_linked",{method:"get",onSuccess:function(){return location.href="/share"+a},onFailure:function(){return setTimeout(Install.pingForLinkedHost.curry(a),3000)}})}};Eggs={init:function(){return key("ctrl+l+u",Eggs.lehigh)},lehigh:function(){if($("lehigh")){return new Effect.Appear("lehigh")}}};Eggs.init();Downloading={registerAll:function(){if(Prototype.Browser.IE){return $$(".downloading-link").each(Downloading.register)}},register:function(a){a=$(a);return a.observe("click",Downloading.clicked)},clicked:function(b){var a,c;Event.stop(b);c=$(b.target);if(c.nodeName==="SPAN"){c=c.up("a")}a=c.href.split("?").last();window.location="/download?"+a;return setTimeout((function(){return window.location="/downloading?"+a}),4000)}};document.observe("dom:loaded",Downloading.registerAll);Help={toggle_more_help:false,show_os:function(b,c,a){c=$(c);$$(".os-filter").invoke("removeClassName","selected");c.addClassName("selected");$$(".help-os-section").invoke("hide");$$(".help-os-"+a).invoke("show");return Event.stop(b)},vote:function(a,b){new Ajax.DBRequest("/help/"+a+"/vote/"+b);new Effect.Fade("help-vote-cont");return Notify.server_success(_("Thanks for your feedback!"))}};AccountExtras={prices:{},prices_value:{},watch_id:0,watch:function(){if(!AccountExtras.watch_id){return AccountExtras.watch_id=setInterval(AccountExtras.update_prices,200)}},show_detail:function(a,d,b){var c;c=_("What is %(feature_name)s?").format({feature_name:a});Modal.icon_show("alert_32",c,$(d+"-modal"),{},false);return false},register_price:function(e,a,d,c,b){AccountExtras.prices[e]=[a,d];return AccountExtras.prices_value[e]=[c,b]},update_prices:function(){var f,d,a,b,c,e;e=$("yearly").checked;d=(e?1:0);a=(e?_("year"):_("month"));b=0;for(f in AccountExtras.prices){if(AccountExtras.prices.hasOwnProperty(f)){$(f+"-price").__date(AccountExtras.prices[f][d]);$(f+"-priceperiod").__date(a)}if(AccountExtras.prices_value.hasOwnProperty(f)){if($(f).checked){c=AccountExtras.prices_value[f][d];b+=parseFloat(c)}}}return $(document).fire("widget:update_price",{price:b,period:a})}};DowngradeReasons={reasons:{},addReason:function(a,b){return DowngradeReasons.reasons[a]=b},change:function(d,b){var a,c;d=parseInt(d,10);a=$(b);assert(a,"Couldn't find container for DowngradeReason");if(DowngradeReasons.reasons[d]){a.show();c=Sprite.make("web","information",{});c.addClassName("text-img");a.__date(c);return a.__sert(DowngradeReasons.reasons[d])}else{return a.hide()}}};Restore={next:function(a,d){var c,b;b=$$("ul.selected")[0];c=b.next("ul");c.addClassName("selected");b.removeClassName("selected");if(c.next("ul")){Restore.show_next_link()}else{Restore.hide_next_link()}Restore.show_prev_link();return Restore.inc_page(1)},prev:function(a,d){var c,b;b=$$("ul.selected")[0];c=b.previous("ul");c.addClassName("selected");b.removeClassName("selected");if(c.previous("ul")){Restore.show_prev_link()}else{Restore.hide_prev_link()}Restore.show_next_link();return Restore.inc_page(-1)},inc_page:function(c){var b,a;b=parseInt($("page-num").innerHTML,10);a=b+c;return $("page-num").__date(a)},hide_next_link:function(){return $("next-page").__date()},show_next_link:function(){var b;b=new Element("a",{href:"#",onclick:"Restore.next(event, this); return false;"});b.__date(_("Next")).__sert(new HTML(" &raquo;"));return $("next-page").__date(b)},show_prev_link:function(){var b;b=new Element("a",{href:"#",onclick:"Restore.prev(event, this); return false;"});b.__date(new HTML("&laquo; ")).__sert(_("Prev"));return $("prev-page").__date(b)},hide_prev_link:function(){return $("prev-page").__date()}};TabController=Class.create({initialize:function(c,b){var a;a=$(c);assert(a,c+" is missing.");this.container=a;this.options={killEvent:true};Object.extend(this.options,b);return this.listen()},listen:function(){var f,c,e,b,d,a;c=this;d=this.container.select("a");a=[];for(e=0,b=d.length;e<b;e++){f=d[e];assert(f.id&&f.id.length>0,"Element is missing an id");a.push(f.observe("click",(function(g){return this.click(g)}).bindAsEventListener(c)))}return a},click:function(a){if(this.options.killEvent){Event.stop(a)}return this.toggle($(a.target))},toggle:function(b){var e,a,d,f,c;c=this.container.down("a.selected");if(c){f=$(c.id+"-content");if(f){f.hide()}}this.container.select(".selected").invoke("removeClassName","selected");a=false;if(!b){b=this.container.down("a");a=true}b.addClassName("selected");e=$(b.id+"-content");if(e){e.show()}if(this.options.onTabChange){this.options.onTabChange(b,c)}if(this.options.url_prefix){d=this.options.url_prefix;if(!a){d+="/"+b.id}return DBHistory.push_state(d)}}});EmailVerification={EMAIL_SENT_EVT:"db:verification_email_sent",send_email:function(){return new Ajax.DBRequest("/sendverifyemail",{onSuccess:function(){return $(document.body).fire(EmailVerification.EMAIL_SENT_EVT)}})},setup:function(){return document.observe("dom:loaded",function(){$("send-email-link").observe("click",function(a){a.preventDefault();return EmailVerification.send_email()});return $(document.body).observe(EmailVerification.EMAIL_SENT_EVT,function(){$("pre-resend").hide();$("post-resend").show();$("pre-resend-header").hide();return $("post-resend-header").show()})})}};EmailChange={show_change_email_modal:function(){return Modal.icon_show("email_add_32",_("Change email address"),$("change-email"),{},false,550)},submit_email_change:function(b){var a;a=$("change-email-form");return Forms.ajax_submit(a,false,(function(){if(window.location.pathname.indexOf("/account")===0){return window.location.reload()}else{return window.location.href="/home?send_verification_email=1"}}),false,$(b.target))}};PasswordChange={show_change_password_modal:function(){return Modal.icon_show("alert_32",_("Change password"),$("change-password"),{},false,550)},submit_password_change:function(b){var a;a=$("change-password-form");return Forms.ajax_submit(a,false,(function(){return window.location.reload()}),false,$(b.target))}};Bromo={init:function(){Event.observe(window,"resize",Bromo.check_sizing);return Event.observe(window,"load",Bromo.check_sizing)},check_sizing:function(){var f,e,d,a,c,b;d=$$(".bromo");if(!d.length){return}f=d[0];a=20;c=$("page-sidebar");b=c.cumulativeOffset().top+c.getLayout().get("height");f.show();e=f.cumulativeOffset().top;if(b+a>e){return f.hide()}}};BonusTable={_tmpl:null,_inited:null,_next_page:0,_fetching_page:false,init:function(){if(BonusTable._inited){return}BonusTable._inited=true;$("bonus-loading").show();BonusTable._tmpl=HTML.tmpl("bonus_row_tmpl");BonusTable.listen();return BonusTable.get_next_page()},_render:function(d){var b,e,c,a;b=[];for(c=0,a=d.length;c<a;c++){e=d[c];b.push(BonusTable._tmpl({row:e}))}return $("bonus-table").__sert(b)},get_next_page:function(){if(BonusTable._fetching_page){return}BonusTable._fetching_page=true;return new Ajax.DBRequest("/account/bonus_page/"+BonusTable._next_page,{onSuccess:function(j){var f,h,g,k,n,m,d,c,l,a,e,b;f=j.responseText.evalJSON();n=f.rows;k=f.has_more;BonusTable._render(n);e=$$(".reached-max-referral-bonus");for(d=0,l=e.length;d<l;d++){g=e[d];g.stopObserving("mouseenter")}b=$$(".reached-max-referral-bonus");for(c=0,a=b.length;c<a;c++){g=b[c];m=_("You've earned the maximum amount of referral space. Thanks for inviting people to Dropbox!");h=Bubble.make(m,"right","middle");g.observe("mouseenter",function(){h.absolutize();g.__sert(h);h.clonePosition(g,{setWidth:false,setHeight:false});h.style.width="200px";h.style.left=(parseInt(h.style.left,10)-210)+"px";return h.style.top=(parseInt(h.style.top,10)-55)+"px"});g.observe("mouseleave",function(){return h.remove()})}$("bonus-loading").hide();if(k){BonusTable._next_page+=1;$("load-more-bonus").show()}else{$("load-more-bonus").hide()}return BonusTable._fetching_page=false}})},listen:function(){return $("bonus-content").on("click","#load-more-bonus",BonusTable.get_next_page)}};GetSpace={_current_space:null,_why_msg:null,_twitter_url:null,init:function(b,a,c){GetSpace._current_space=b;GetSpace._why_msg=a;GetSpace._twitter_url=c;if($("why_like")&&$("twitter_post")){$("twitter_post").hide()}return $("space-actions").on("click",".space-action",GetSpace.perform_action)},perform_action:function(b){var c,a;a={contact_sales:GetSpace._contact_sales,contact_support:GetSpace._contact_support,upgrade:GetSpace._upgrade,refer:GetSpace._refer,get_started:GetSpace._get_started,fb_link:GetSpace._fb_link,twitter_link:GetSpace._twitter_link,twitter_follow:GetSpace._twitter_follow,why_like:GetSpace._why_like,twitter_post:GetSpace._twitter_post};c=$(b.target);if(!c.hasClassName("space-action")){c=c.up(".space-action")}return a[c.id]()},_contact_sales:function(){return window.location.href="mailto:sales@dropbox.com"},_contact_support:function(){return window.location.href="/support"},_upgrade:function(){return window.location.href="/plans"},_refer:function(){return window.location.href="/referrals"},_get_started:function(){return window.location.href="/gs"},_fb_link:function(){return FacebookOAuth.do_auth(function(){GetSpace._refresh_link_bonuses();return GetSpace._completed($("fb_link"))})},_twitter_link:function(){return Twitter.do_auth(function(){GetSpace._refresh_link_bonuses();Twitter.has_authed=1;return GetSpace._completed($("twitter_link"))})},_twitter_follow:function(){if(Twitter.has_authed){return GetSpace.follow_dropbox()}else{return Twitter.do_auth(GetSpace.follow_dropbox)}},_why_like:function(){Modal.icon_show("heart_32",_("Tell us why you love Dropbox"),$("why-i-like-modal"));$("why-i-like-input").focus();return Util._track_twitter_chars_left("why-i-like-input",90)},_twitter_post:function(){if(Twitter.has_authed){return GetSpace.start_twitter_post()}else{return Twitter.do_auth(GetSpace.start_twitter_post)}},follow_dropbox:function(){if(!Twitter.has_authed){GetSpace._refresh_link_bonuses();Twitter.has_authed=1}return Twitter.follow_dropbox({showWorking:function(){return $("twitter_follow").down(".title").__date(_("Following Dropbox on Twitter..."))},onFailure:function(){return $("twitter_follow").down(".title").__date(_("Follow Dropbox on Twitter"))},onSuccess:function(){if($("twitter_link")&&$("twitter_link").visible()){GetSpace._completed($("twitter_link"))}return GetSpace._completed($("twitter_follow"))}})},submit_why:function(){GetSpace._why_msg=$F("why-i-like-input");return Forms.ajax_submit($("why-i-like-form"),false,(function(){Modal.hide();GetSpace._completed($("why_like"));if($("twitter_post")){return setTimeout((function(){return new Effect.BlindFadeDown("twitter_post")}),2500)}}),false,$("why-i-like-submit"))},start_twitter_post:function(){Modal.onHide=function(){if(!Twitter.has_authed){GetSpace._refresh_link_bonuses();Twitter.has_authed=1}if($("twitter_link")&&$("twitter_link").visible()){GetSpace._completed($("twitter_link"))}delete Modal.onHide;return Modal.hide()};return Twitter.get_user_info(function(a){Modal.icon_show("tweet_32",_("Tweet about your love of Dropbox"),$("twitter-post-modal"));$("twitter-post-header").down(".profile-pic").__date(new Element("img",{src:a.profile_image_url_https}));$("twitter-post-header").down(".name").__date(a.name);$("twitter-post-header").down(".username").__date("@"+a.screen_name);GetSpace._update_display_twitter_post();$("twitter-post-input").setValue(GetSpace._why_msg);return Util._track_twitter_chars_left("twitter-post-input",90)})},show_edit_twitter_post:function(){$("display-twitter-post").hide();$("display-twitter-post-buttons").hide();$("edit-twitter-post").show();$("edit-twitter-post-buttons").show();$("twitter-post-input").observe("keypress",function(a){if(a.keyCode===13){return GetSpace.hide_edit_twitter_post()}});return $("twitter-post-input").focus()},hide_edit_twitter_post:function(){var a;a=$F("twitter-post-input");if(!a){Notify.server_error(_("Please enter a message"));return}else{if(a.length>90){Notify.server_error(_("Your post must be 90 characters or less"));return}}GetSpace._why_msg=a;GetSpace._update_display_twitter_post();$("edit-twitter-post").hide();$("edit-twitter-post-buttons").hide();$("display-twitter-post").show();return $("display-twitter-post-buttons").show()},do_twitter_post:function(){var a;Twitter.from_getspace=1;a=_("I love Dropbox because %(why_msg)s %(referral_link)s").format({why_msg:GetSpace._why_msg,referral_link:GetSpace._twitter_url});Twitter.custom_show_posting=function(){return Forms.add_loading($("twitter-post-submit"))};return Twitter.custom_post(a,function(){Modal.hide();return GetSpace._completed($("twitter_post"))})},_update_display_twitter_post:function(){var a;$("display-twitter-post").__date(_("I love Dropbox because %(why_msg)s ").format({why_msg:GetSpace._why_msg}));a=new Element("a",{href:GetSpace._twitter_url,target:"_blank"});a.__date(GetSpace._twitter_url);return $("display-twitter-post").__sert(a)},_completed:function(b){var a;b.addClassName("completed");b.down(".icon-col").__date(Sprite.make("web","check_36"));new Effect.Opacity(b.id,{from:0.5,to:1,duration:0.5});setTimeout((function(){return new Effect.BlindFadeUp(b.id)}),1500);a=parseInt(b.down(".space").readAttribute("data-space"),10);GetSpace._current_space+=a;$("current-space").__date(Util.formatBytes(GetSpace._current_space,2,true));$("current-space").addClassName("updated");return setTimeout((function(){return $("current-space").removeClassName("updated")}),5000)},_refresh_link_bonuses:function(){return new Ajax.DBRequest("/social_recheck")}};SecurityTab={init:function(){var d,b,c,a;b=$("show-change-password");if(b){b.on("click",function(f){$("newpass").value="";$("oldpass").value="";PasswordChange.show_change_password_modal();return f.preventDefault()})}c=$("security-email");if(c){d=$("new_api_app_linked");a=$("newhostlinked");if(d){new Form.Element.Observer(d,0.1,function(){return c.submit()})}if(a){return new Form.Element.Observer(a,0.1,function(){return c.submit()})}}}};var DBGallery,DBPhoto;DBPhoto=function(a){a.preloaded={};a.preload=function(b){if(a.preloaded[b]){return}b=b||"l";assert(b in a,"Photo doesn't have attr "+b);Util.preload_image(a[b]);return a.preloaded[b]=true};a.load_thumb=function(b){return b.src=a.thumbnail};return a};DBGallery={size:"large",index:0,playing:false,preloaded:false,thumb_width:64,thumb_margin:4,low_opacity:0.6,photos:[],set_url_hash:true,container_id:"db_gallery_master_container",add_photos:function(a){return a.each(function(b){return DBGallery.photos.push(DBPhoto(b))})},set_hash:function(){if(DBGallery.set_url_hash){return HashRouter.set_hash.apply(this,$A(arguments))}},observe:function(){Event.observe((document.onresize?document:window),"resize",DBGallery.resize);Event.observe(document.body,"mousewheel",DBGallery.wheel);Event.observe(document.body,"DOMMouseScroll",DBGallery.wheel);return document.observe("keydown",DBGallery.key)},unobserve:function(){Event.stopObserving((document.onresize?document:window),"resize",DBGallery.resize);Event.stopObserving(document.body,"mousewheel",DBGallery.wheel);Event.stopObserving(document.body,"DOMMouseScroll",DBGallery.wheel);return document.stopObserving("keydown",DBGallery.key)},resize:function(){var a,c,b,d;a=$("gallery_main_cont");d=document.viewport.getDimensions();a.style.height=d.height-99+"px";c=$("gallery_main_photo");b=d.height-99-10;c.style.maxHeight=Math.max(b,300)+"px";return c.style.maxWidth=Math.max(d.width,400)+"px"},key:function(b){var a;a=BrowseKeys.getKey(b);switch(a){case 27:return DBGallery.hide();case 32:return DBGallery.playpause();case 37:case 75:return DBGallery.prev();case 39:case 74:return DBGallery.next()}},wheel:function(a){var b;if(DBGallery.block_wheel){return}DBGallery.block_wheel=1;setTimeout((function(){return DBGallery.block_wheel=0}),80);b=0;if(a.wheelDelta){b=a.wheelDelta}else{if(a.detail){b=-a.detail}}if(b>0){return DBGallery.prev()}else{return DBGallery.next()}},playpause:function(){if(DBGallery.playing){return DBGallery.pause()}else{return DBGallery.play()}},play:function(){DBGallery.playing=true;DBGallery.interval=setInterval(function(){return DBGallery.next(true)},5000);return $("gallery_slideshow").__date(Sprite.html("web","white_pause")).__sert(_("Pause slideshow"))},pause:function(){DBGallery.playing=false;clearInterval(DBGallery.interval);return $("gallery_slideshow").__date(Sprite.html("web","white_play")).__sert(_("Play slideshow"))},next:function(a){var b;b=DBGallery.index+1;if(b!==DBGallery.photos.length){return DBGallery.select_photo(b,a)}},prev:function(){var a;if(DBGallery.playing){DBGallery.pause()}a=DBGallery.index-1;if(a!==-1){return DBGallery.select_photo(a)}},select_photo:function(m,o){var e,k,g,l,a,c,b,n,q,f,p,h,d;m=parseInt(m,10);if(!Util.isNumber(m)){return}DBGallery.set_hash("gallery",""+m);if(!o&&DBGallery.playing){DBGallery.pause()}DBGallery.index=m;if(!DBGallery.visible){DBGallery.show(m)}e=$$("#gallery_thumbs_container img.selected");if(e.length){c=e[0];c.setOpacity(DBGallery.low_opacity);c.removeClassName("selected")}k=$$("#gallery_thumbs_container img")[m];assert(k,"Couldn't find img at index");k.setOpacity(1);k.addClassName("selected");DBGallery.render_mainphoto(m);DBGallery.resize();b=$("gallery_thumbs_container");l=-1*m*(DBGallery.thumb_width+DBGallery.thumb_margin)-39;if(DBGallery.slide_in){DBGallery.slide_in.cancel()}if(Math.abs(l-parseInt(b.getStyle("margin-left"),10))>1200){b.style.marginLeft=l+"px"}else{DBGallery.slide_in=new Effect.Tween(b,parseInt(b.getStyle("margin-left"),10),l,{duration:0.3},function(j){return b.style.marginLeft=j+"px"})}n=b.select("img");assert(n.length===DBGallery.photos.length,"thumbslength != photoslength");q=Math.ceil(document.viewport.getDimensions().width/DBGallery.thumb_width);q+=q%2;g=Math.max(0,m-q/2);while(g<Math.min(DBGallery.photos.length,m+q/2)){DBGallery.photos[g].load_thumb(n[g]);g+=1}h=DBGallery.photos.slice(m,m+10);d=[];for(f=0,p=h.length;f<p;f++){a=h[f];d.push(a.preload(DBGallery.size))}return d},update_container_top:function(a){a=a||$(DBGallery.container_id);if(a){return a.style.top=document.viewport.getScrollOffsets()[1]+"px"}},show:function(b){var a;assert(!DBGallery.visible,"Tried to show a gallery when it was already up");if(document.viewport.getDimensions().height>768){DBGallery.size="extralarge"}else{DBGallery.size="large"}DBGallery.visible=true;b=b||DBGallery.index;assert(DBGallery.photos.length,"No photos in the photo gallery");a=new Element("div",{id:DBGallery.container_id});DBGallery.update_container_top(a);DBGallery.update_top_interval=setInterval(function(){return DBGallery.update_container_top()},200);document.body.appendChild(a);DBGallery.observe();DBGallery.render_backdrop(a);DBGallery.render_filmstrip(a);DBGallery.render_submenu(a);return DBGallery.render_bottom_menu(b,a)},hide:function(a){if(a){Event.stop(a)}assert(DBGallery.visible,"Tried to hide a gallery when it was already hidden");DBGallery.visible=false;DBGallery.pause();DBGallery.unobserve();DBGallery.hide_backdrop();DBGallery.hide_filmstrip();DBGallery.hide_bottom_menu();DBGallery.hide_mainphoto();$(DBGallery.container_id).remove();DBGallery.set_hash();return clearInterval(DBGallery.update_top_interval)},render_backdrop:function(a){var b,c;c="body";if(Prototype.Browser.IE){c="html, body"}$$(c).invoke("addClassName","full_no_overflow");b=new Element("div",{id:"gallery_backdrop"});b.setOpacity(0.8);return a.__sert(b)},hide_backdrop:function(){$$(".full_no_overflow").invoke("removeClassName","full_no_overflow");return $("gallery_backdrop").remove()},render_filmstrip:function(a){var j,d,h,g,f,e,c,b;d=new Element("div",{id:"gallery_filmstrip"});g=document.createDocumentFragment();g.appendChild(d);h=new Element("div",{id:"gallery_filmstrip_backdrop"});h.setOpacity(0.5);g.appendChild(h);b=new Element("div",{id:"gallery_thumbs_container"});e=0;DBGallery.photos.each(function(l){var k;k=new Element("img",{title:l.filename,src:"/static/images/icons/icon_spacer.gif"});k.setOpacity(DBGallery.low_opacity);k.observe("mouseover",function(m){return new Effect.Opacity(k,{to:1,duration:0.1})});k.observe("mouseout",function(m){if(!k.hasClassName("selected")){return new Effect.Opacity(k,{to:DBGallery.low_opacity,duration:0.1})}});k.observe("click",(function(m){return function(){return DBGallery.select_photo(m)}})(e));b.appendChild(k);return e+=1});c=new Element("div",{id:"gallery_selected_frame"});f=new Element("a",{id:"gallery_close",href:"#",style:"top: 120px; right: 10px;"});j=new Element("img",{src:"/static/images/photos_x.png"});f.__sert(j);f.observe("click",DBGallery.hide);g.appendChild(f);g.appendChild(c);g.appendChild(b);return a.appendChild(g)},render_submenu:function(a){var d,c,e,b;c=new Element("div",{id:"gallery_sub_menu"});e=new Element("div",{id:"gallery_index_text"});d=new Element("div",{id:"gallery_filename_text"});b=new Element("a",{id:"gallery_slideshow"});b.observe("click",DBGallery.playpause);c.__sert(b);c.__sert(e);c.__sert(d);a.appendChild(c);return DBGallery.pause()},render_bottom_menu:function(d,b){var c,a,e;c=new Element("div",{id:"gallery_bottom_menu"});a=new Element("a",{id:"gallery_full_size"});a.__date(Sprite.html("web","arrow_out_black")).__sert(_("Full size"));e=new Element("a",{id:"gallery_save"});e.__date(Sprite.html("web","picture_save")).__sert(_("Save"));c.__sert(a);c.__sert(e);return b.appendChild(c)},update_bottom_menu:function(b){var a;a=DBGallery.photos[b];$("gallery_full_size").href=a.original;return $("gallery_save").href=a.original+"?dl_name="+Util.urlquote(a.filename)},hide_bottom_menu:function(){return $("gallery_bottom_menu").remove()},hide_filmstrip:function(){$("gallery_filmstrip").remove();$("gallery_filmstrip_backdrop").remove();$("gallery_thumbs_container").remove();$("gallery_selected_frame").remove();$("gallery_close").remove();return $("gallery_sub_menu").remove()},render_mainphoto:function(f,b){var a,c,e,d,h,g;b=b||$(DBGallery.container_id);e=DBGallery.photos[f];c=Util.get_preloaded_image(e[DBGallery.size]);c.id="gallery_main_photo";c.title=e.filename;c.stopObserving("click");c.observe("click",function(k){var j;Event.stop(k);if(e.video_url){DBGallery.pause();$("gallery_main_photo_td").__date();j=(DBGallery.size==="extralarge"?1024:640);return Util.embed_flash_video(e.video_url,"gallery_main_photo_td",j,1)}else{return DBGallery.next()}});if(!$("gallery_main_cont")){a=new Element("table",{id:"gallery_main_cont"});a.observe("click",DBGallery.hide);d=new Element("tbody");a.__sert(d);g=new Element("tr");d.__sert(g);h=new Element("td");h.id="gallery_main_photo_td";g.__sert(h);h.__sert(c);b.appendChild(a)}else{$("gallery_main_cont").down("td").__date(c)}DBGallery.update_sub_menu(f);return DBGallery.update_bottom_menu(f)},update_sub_menu:function(a){$("gallery_index_text").__date(a+1+" of "+DBGallery.photos.length);return $("gallery_filename_text").__date(DBGallery.photos[a].filename)},hide_mainphoto:function(){return $("gallery_main_cont").remove()}};var BrowseUtil,UpdateEvents;UpdateEvents={ADD:"db:add_file_objects",REMOVE:"db:remove_file_objects",MOVE:"db:move_file_objects"};BrowseUtil={make_browsefile:function(b){var a;a=this.unpack_file_info(b);if(a.is_dir){a.ago="";a.ts=0}else{a.target_ns=false}return new BrowseFile(a)},unpack_file_info:function(a){return{is_dir:a[0],type:a[1],ns_id:a[2],ns_path:a[3],fq_path:a[4],target_ns:a[5],icon:a[6],thumbnail_url_tmpl:a[7],href:a[8],bytes:a[9],size:a[10],ts:a[11],ago:a[12],hash:a[13],tkey:a[14],sort_rank:a[15],sort_key:Util.decode_sort_key(a[16]),sjid:a[17],last_modified_fname:a[18],preview_type:a[19]}},filepreview_from_selected:function(f){var d,c,b,e,h,g,a;if(!f){e=BrowseSelection.get_selected_files();f=e&&e.first()}b=this.browsefile_to_filepreview(Browse.files);if(b.length){h=0;if(f){for(c=g=0,a=b.length;g<a;c=++g){d=b[c];if(d.filename===f.filename){h=c;break}}}FilePreviewModal.init(b,{start_index:h,include_delete:true,keep_url:false})}if(Tutorial.should_handle_event(Tutorial.events.browse_show_lightbox)){return Tutorial.handle_event(Tutorial.events.browse_show_lightbox,{init_file:f})}},browsefile_to_filepreview:function(e){var h,c,a,d,g,b;a=[];for(g=0,b=e.length;g<b;g++){h=e[g];if(h.bytes<0||h.dir){continue}if(h.preview_type==="photo"&&h.thumbnail_url_tmpl){c=new PhotoPreview(h.filename,h.fq_path,h.thumbnail_url_tmpl,h.href+"&dl=1",h.href);a.push(c)}else{if(h.preview_type==="video"&&h.thumbnail_url_tmpl&&!Constants.DISABLE_VIDEOS_IN_LIGHTBOX){d=new VideoPreview(h.filename,h.fq_path,h.thumbnail_url_tmpl,h.video_transcode_url(),h.href+"&dl=1");a.push(d)}}}return a},profile_files:function(b){var c,d,e,a;d={files:0,folders:0,shared_folders:0,deleted:0,public_folder:0,photos_folder:0,rejoinables:0,sandboxes:0,target_namespaces:0};for(e=0,a=b.length;e<a;e++){c=b[e];if(c.dir){d.folders+=1}else{d.files+=1}if(c.is_sandbox()){d.sandboxes+=1}if(c.is_share()){d.shared_folders+=1}if(c.bytes===-1){d.deleted+=1}if(c.target_ns){d.target_namespaces+=1}if(c.fq_path==="/Public"){d.public_folder=1}if(c.fq_path==="/Photos"){d.photos_folder=1}}return d},profile_summary:function(b){var c,a;c=ungettext("%d file","%d files",b.files).format(b.files);a=ungettext("%d folder","%d folders",b.folders).format(b.folders);if(b.files&&b.folders){return _("%(x_files)s and %(y_folders)s").format({x_files:c,y_folders:a})}else{if(b.files){return c}else{if(b.folders){return a}else{return""}}}},BROWSE_MODE:"browse",SEARCH_MODE:"search",SPECIAL_MODES:["search"],set_browse_mode:function(){var d,c,a,b;b=this.SPECIAL_MODES;for(c=0,a=b.length;c<a;c++){d=b[c];$("browse").removeClassName(d);$("browse-root-actions").removeClassName(d);$("browse-sort").removeClassName(d)}$("browse-sort").removeClassName("cathywu");return $("browse-root-actions").removeClassName("cathywu")},set_special_mode:function(b){var e,d,a,c;assert(this.SPECIAL_MODES.indexOf(b)!==-1,"unknown mode");if($("browse").hasClassName(b)){assert($("browse-root-actions").hasClassName(b),"inconsistent modes");assert($("browse-sort").hasClassName(b),"inconsistent modes");return}c=this.SPECIAL_MODES;for(d=0,a=c.length;d<a;d++){e=c[d];if(e!==b){$("browse").removeClassName(e);$("browse-root-actions").removeClassName(e);$("browse-sort").removeClassName(e)}}$("browse").addClassName(b);$("browse-root-actions").addClassName(b);$("browse-sort").addClassName(b);if(b===this.SEARCH_MODE){$("browse-sort").addClassName("cathywu");return $("browse-root-actions").addClassName("cathywu")}},get_mode:function(){var e,a,d,b,c;a=this.BROWSE_MODE;c=this.SPECIAL_MODES;for(d=0,b=c.length;d<b;d++){e=c[d];if($("browse").hasClassName(e)){a=e}}return a},load_visible_thumbs:function(){var m,b,g,o,p,k,a,h,e,n,d,l,f,c;a=this.get_files_in_view();m=a[1]-a[0];k=[Math.max(a[0]-m,0),a[0]];p=[Math.min(a[1],Browse.files.length),Math.min(a[1]+m,Browse.files.length)];n=Util.calc_thumb_prep_size();f=[a,p,k];c=[];for(d=0,l=f.length;d<l;d++){o=f[d];g=o[0],e=o[1];c.push((function(){var s,q,j,r;j=Browse.files.slice(g,e+1||9000000000);r=[];for(s=0,q=j.length;s<q;s++){b=j[s];h=b.get_div().down("img");r.push(Util.thumb_load(h,n))}return r})())}return c},get_files_in_view:function(){var c,d,b,a,f,e;f=Util.viewport_dimensions().height;e=Util.scroll_offsets().top;c=this._get_top_file_y_offset();d=this._get_elm_height();if(!c||!d){return[0,Browse.files.length]}b=Math.floor((e-c)/d);b=Math.max(b,0);a=b+Math.ceil(f/d);a=Math.min(a,Browse.files.length);return[b,a]},_get_top_file_y_offset:function(){if(Browse.files.length===0){return null}return Browse.files[0].get_div().cumulativeOffset().top},_get_elm_height:function(){var a;if(Browse.files.length<3){return null}a=Browse.files[1].get_div();return a.getLayout().get("margin-box-height")}};var FlexColumn,Sort;Sort=(function(){var g,a,d,f,e,c,b;d=function(j){var h;h=j?1:-1;return function(k,l){return h*Util.sort_by_rank_or_key(k,l)}};f=function(j){var h;h=j?1:-1;return function(k,l){if(k.bytes>l.bytes){return h}else{if(k.bytes<l.bytes){return -h}else{return h*Sort.FILES_BY_NAME(k,l)}}}};g=function(j){var h;h=j?1:-1;return function(k,l){return h*(k.fq_path.toLowerCase()>l.fq_path.toLowerCase()?1:-1)}};a=function(j){var h;h=j?1:-1;return function(l,m){var k;k=l.ts===m.ts?0:l.ts>m.ts?1:-1;return h*k}};c=function(h){return function(l){var k,j;j=h(l);k=d(true);return function(m,n){if(m.dir^n.dir){return(m.dir?1:0)-(n.dir?1:0)}else{return j(m,n)||k(m,n)}}}};e=function(h){return function(l){var j,k;if(!Sort.FOLDERS_FIRST){return h(l)}k=h(l);j=l?1:-1;return function(n,o){var m;if(n.dir^o.dir){m=(n.dir?0:1)-(o.dir?0:1);return j*m}else{return k(n,o)}}}};b=function(h){return function(l){var j,k;k=Sort.FILES_BY_NAME(l);j=l?1:-1;return function(n,o){var m;if(n.is_deleted^o.is_deleted){return(n.is_deleted?1:0)-(o.is_deleted?1:0)}m=0;if(h){if(n.get_category()!==o.get_category()){m=n.get_category()<o.get_category()?-1:1}else{if(n.get_extension()!==o.get_extension()){m=n.get_extension()<o.get_extension()?-1:1}}}else{if(n.get_extension()!==o.get_extension()){m=n.get_extension()<o.get_extension()?-1:1}else{if(n.get_category()!==o.get_category()){m=n.get_category()<o.get_category()?-1:1}}}return(j*m)||k(n,o)}}};return{FILES_BY_NAME:e(d),FILES_BY_SIZE:c(f),FILES_BY_LOCATION:c(g),FILES_BY_KIND:c(b(true)),FILES_BY_EXTENSION:c(b(false)),FILES_BY_MODIFIED:c(a),FOLDERS_FIRST:!Util.is_mac()}})();FlexColumn=(function(){var j,c,m,g,d,h,b,a,l,e,k,f;j=[["FILES_BY_KIND",Sort.FILES_BY_KIND,_("Kind"),true],["FILES_BY_EXTENSION",Sort.FILES_BY_EXTENSION,_("Extension"),true],["FILES_BY_SIZE",Sort.FILES_BY_SIZE,_("Size"),false]];c={};m={};d=[];g=[];for(e=0,k=j.length;e<k;e++){f=j[e],l=f[0],b=f[1],h=f[2],a=f[3];d.push(b);c[l]=h;m[l]=a;g.push(l)}return{SORT_FUNCTIONS:d,DISPLAY:c,IS_ASC:m,LABELS:g}})();var FileSearch;FileSearch={MAX_RESULTS:100,SHORT_PREFIX_LEN:2,SHORT_PREFIX_DELAY_TIME:250,_cache:{},_cache_ts:{},CACHE_TIME:60000,last_state:false,last_fq_path:null,init:function(){var a,l,j,c,g,f,m,b,h,e,d,k=this;j=$("browse-search");l=$("browse-search-input");this.warmup();SickInput.add_interval_handler(j,this.search_with_delay.bind(this));$("advanced-search-box").observe("submit",function(n){k.search();return Event.stop(n)});$("exit-search-xclose").observe("click",function(){return k.exit_search()});key("/",Browse.KEY_SCOPE,function(){if(BrowseJump.is_active()){return}if(!j.hasClassName("focused")){l.focus();return false}});key("escape",Browse.KEY_SCOPE,function(){if(Browse.in_search_mode()){k.exit_search();return false}if(l.getValue().strip()===""){l.blur();return false}});key("tab",Browse.KEY_SCOPE,function(n){if(document.activeElement===l){n.preventDefault();l.blur();if(Browse.files.length){BrowseSelection.set_selected_files(Browse.files[0])}else{if(Browse.in_search_mode()){k.toggle_advanced()}}return false}});c="#advanced-search-link, #advanced-search-exit, #advanced-search-cancel";document.body.on("click",c,this.toggle_advanced.bind(this));document.observe(FileEvents.RENAME,function(){return k.clear_cache()});h=[FileEvents.DELETE,FileEvents.COPY,FileEvents.MOVE,FileEvents.PURGE,FileEvents.RESTORE,FileEvents.UPLOAD,FileEvents.SF_NEW,FileEvents.SF_LEAVE,FileEvents.SF_UNSHARE,FileEvents.SF_REJOIN,FileEvents.SF_IGNORE,FileEvents.LINKS_REMOVE];for(g=0,m=h.length;g<m;g++){a=h[g];document.observe(a,function(n){if(!Browse.inside_dir){return k.force_reload()}})}e=[UpdateEvents.ADD,UpdateEvents.MOVE,UpdateEvents.REMOVE];d=[];for(f=0,b=e.length;f<b;f++){a=e[f];d.push(document.observe(a,function(n){return k._update_number_results(Browse.files.length)}))}return d},get_state:function(){var c,f,b,e,a,d;f={is_advanced:!$("browse-search").visible()};if(f.is_advanced){d=["all_terms","any_terms","excluded_terms","exact"];for(e=0,a=d.length;e<a;e++){c=d[e];b=$(c).getValue();if(b){f[c]=b}}f.include_files=$("include_files").checked;f.include_folders=$("include_folders").checked;f.include_deleted=$("include_deleted").checked}else{f.query_unnormalized=this.get_basic_query();f.query=f.query_unnormalized.toLowerCase().strip().split(RegExp(" +")).join(" ")}return f},set_state:function(e){var b,d,a,c;if(e.is_advanced){c=["all_terms","any_terms","excluded_terms","exact"];for(d=0,a=c.length;d<a;d++){b=c[d];if(e[b]){$(b).setValue(e[b])}}$("include_files").checked=e.include_files;$("include_folders").checked=e.include_folders;$("include_deleted").checked=e.include_deleted;this.show_advanced();return this.search()}else{this.set_basic_query(e.query_unnormalized);this.show_basic();return this.search()}},state_changed:function(){var b,a;b=this.get_state();a=this.last_state;if(a===false){return !!b.query}return(b.is_advanced!==a.is_advanced)||(b.query!==a.query)},get_basic_query:function(){var a;a=$("browse-search-input");return a.getValue()},set_basic_query:function(a){if(a===this.get_basic_query()){return}$("browse-search-input").setValue(a);$("browse-search").show();return $("advanced-search-link").__date(_("Advanced search"))},set_title:function(){var a,b;a=this.get_state();b=_("Search - Dropbox");if(a.query_unnormalized){b=""+a.query_unnormalized+" - "+b}return document.title=b},_pending_search_q:"",search_with_delay:function(){var b,a;a=this.get_state();if(a.is_advanced){return}b=a.query;if(b.length===0&&Browse.in_search_mode()){this.search();return}if(b.length<=this.SHORT_PREFIX_LEN){if(b!==this._pending_search_q){this._pending_search_q=b;clearTimeout(this._pending_search_timer);return this._pending_search_timer=setTimeout(this.search.bind(this),this.SHORT_PREFIX_DELAY_TIME)}}else{this._pending_search_q="";if(this.state_changed()){return this.search()}}},search:function(){var b,a;a=this.get_state();b=""===this.get_basic_query();if(!a.is_advanced&&b){if(Browse.in_search_mode()){this._clear_on_reload=false;this.exit_search()}return}this.last_state=a;this._clear_on_reload=true;if(!Browse.in_search_mode()){BrowseSelection.deselect_all();Browse.clear();BrowseUtil.set_special_mode("search")}if(Browse.inside_dir){this.last_fq_path=Browse.containing_fq_path();DBHistory.push_state("/search")}this._prune_cache();this.set_title();if(a.is_advanced){this.ask_server_advanced()}else{if(a.query in this._cache){this.update_results()}else{if(!this.attempt_cache_filter()){this.ask_server()}}}return T("search")},_prune_cache:function(){var c,d,f,e,b,a;c=new Date();d=[];for(f in this._cache_ts){if(c-this._cache_ts[f]>this.CACHE_TIME){d.push(f)}}a=[];for(e=0,b=d.length;e<b;e++){f=d[e];delete this._cache[f];a.push(delete this._cache_ts[f])}return a},show_empty:function(){$("search-empty").show();return $(document.documentElement).removeClassName("earthrise")},hide_empty:function(){$("search-empty").hide();return $(document.documentElement).addClassName("earthrise")},exit_search:function(){var b,c,e,a,d;d=$$("#advanced-search-box .sick-input input");for(e=0,a=d.length;e<a;e++){b=d[e];b.setValue("");b.blur()}$("advanced-search-box").hide();$("browse").removeClassName("pending-search");this.hide_empty();c=$("browse-search");c.show();Browse.first_load=true;return Browse.reload_fqpath(this.last_fq_path,true)},clear_cache:function(){this._cache={};return this._cache_ts={}},force_reload:function(){this.clear_cache();return this.search()},ask_server:function(){var a,b=this;a=this.get_state();assert(!a.is_advanced,"expected to be in basic search mode");$("web-search-results").__date(_("Searching..."));$("browse").addClassName("pending-search");return new Ajax.DBRequest("/ajax_search",{no_watch:true,evalJSON:false,parameters:{query:a.query},log_timing:true,onSuccess:function(c){var d;if(!Browse.in_search_mode()){return}d=Util.from_json(c.responseText);b._cache[a.query]=d;b._cache_ts[a.query]=new Date();if(!b.last_state.is_advanced&&(b.last_state.query===a.query)){return b.update_results()}},cleanUp:function(){return $("browse").removeClassName("pending-search")}})},ask_server_advanced:function(){var a,b=this;a=this.get_state();assert(a.is_advanced,"expected to be in advanced search mode");assert(!a.query,"expected advanced search params only");delete a.is_advanced;$("web-search-results").__date(_("Searching..."));$("browse").addClassName("pending-search");return new Ajax.DBRequest("/ajax_advanced_search",{no_watch:true,evalJSON:false,parameters:a,log_timing:true,onSuccess:function(c){if(!Browse.in_search_mode()){return}b.advanced_results=Util.from_json(c.responseText);return b.update_results()},cleanUp:function(c){return $("browse").removeClassName("pending-search")}})},attempt_cache_filter:function(){var a,d,b,h,c,g,f,e;g=this.get_state().query;h=this._query_to_regex(g);b=function(j){return h.match(FileOps.filename(j[3]).toLowerCase())};if(g.length<=1){return false}for(c=f=e=g.length-1;e<=1?f<=1:f>=1;c=e<=1?++f:--f){d=g.substr(0,c).strip();if(d in this._cache){if(this._cache[d].file_info.length<this.MAX_RESULTS){a=Object.clone(this._cache[d]);a.file_info=a.file_info.findAll(b);this.update_results(a);return true}else{return false}}}return false},_query_to_regex:function(a){return new RegExp(RegExp.escape(a).split(new RegExp(" +")).join(".*"))},update_results:function(a){var d,c,b;Browse.reset_state();Browse.reset_sort();b=this.get_state();if(!a&&b.is_advanced){a=this.advanced_results}if(!a){c="the only way to get to advanced is through basic -- expected last_state to exist and not be advanced!";assert(this.last_state&&!this.last_state.is_advanced,c);assert(this.last_state.query in this._cache,("update() called w/o a cache entry: q="+this.last_state.query)+(a=this._cache[this.last_state.query]))}Browse.update(a);Browse.set_selection_from_fq_paths_or_index(FileSearch);this._update_number_results(a.file_info.length);d=b.is_advanced?_("Basic search"):_("Advanced search");$("advanced-search-link").__date(d);if(Browse.files.length){return this.hide_empty()}else{return this.show_empty()}},_update_number_results:function(b){var d,a,c;c=b===0?_("No results"):(d=ungettext("Search - %s result","Search - %s results",b),a=b+(b>=this.MAX_RESULTS?"+":""),d=d.format(a));return $("web-search-results").__date(c)},show_advanced:function(){$("browse").addClassName("advanced-search");$("browse-search").hide();$("advanced-search-link").__date(_("Basic search"));$("advanced-search-box").show();return $("all_terms").focus()},show_basic:function(a){$("browse").removeClassName("advanced-search");$("advanced-search-box").hide();$("advanced-search-link").__date(_("Advanced search"));$("browse-search").show();if(!a){return $("browse-search-input").focus()}},toggle_advanced:function(){var a,b;b=$("advanced-search-link");b.toggleClassName("selected");if(b.hasClassName("selected")){$("all_terms").setValue(this.get_basic_query());return this.show_advanced()}else{a=$("all_terms").getValue();if(a){this.set_basic_query(a);return this.show_basic()}else{console.log("advanced exit");return this.exit_search()}}},history_change_handler:function(){var a;if(!this.last_state){BrowseURL.set_path_url(Constants.root_ns,"");return}if(this.state_changed()){this.set_state(this.last_state)}key.setScope(Browse.KEY_SCOPE);if(BrowseSelection.get_selected_files().length){a=BrowseSelection.get_selected_files()[0].get_div();return Browse.scrollToWithPadding(a,a.getHeight()*2)}},clear_searchbox:function(){return $("browse-search-input").setValue("")},warmup:function(){if(!this.warm){this.warm=true;return new Ajax.DBRequest("/search/warmup",{noAutonotify:true,no_watch:true})}}};var BrowseKeys;BrowseKeys={_handlers:{},init:function(){},init_advanced:function(){var c,a,b,d=this;b=this.advanced_dict;for(a in b){c=b[a];key(c.key,Browse.KEY_SCOPE,c.onPress)}this.customize_chart();if(Util.is_mac()&&Prototype.Browser.Gecko){return document.observe("keypress",function(f){if(f.charCode===63&&!Util.focus_in_input()){return d.advanced_dict.help.onPress()}})}},getKey:function(a){return a.keyCode||a.which||a.charCode},customize_chart:function(){var d,b,c,a;d=(Util.is_mac()?".key-windows":".key-macos");c=0;b=void 0;a=[];while(true){b=$("keys-chart").down(d,c++);if(!b){break}a.push(b.hide())}return a},toggle_chart:function(){if($("keys-chart").style.display==="none"){return this.show_chart()}else{return this.hide_chart()}},show_chart:function(){var a,b;a=$("keys-chart");a.style.position="fixed";b=$("browse-sort");if(b.getStyle("display")==="none"){b=$("browse-root-actions")}a.clonePosition(b,{setHeight:false});a.style.top=b.cumulativeOffset()[1]+b.getHeight()+"px";a.setOpacity(0.85);return a.show()},hide_chart:function(){return $("keys-chart").hide()},advanced_dict:{rename:{title:_("Rename selected files"),key:"f2",onPress:function(b,c){var a;a=BrowseSelection.get_selected_files();if(a.length){return a.first().edit()}}},"delete":{title:_("Delete selected files"),key:"delete, command+backspace, backspace",onPress:function(d,f){var a,c,b;Event.stop(d);b=BrowseSelection.get_selected_files();if(b.length===1){a=b.first();if(a.is_deleted){return FileOps.show_purge(a.fq_path,a.dir)}else{return FileOps.show_delete(a.fq_path,a.dir)}}else{if(b.length>1){c=BrowseUtil.profile_files(b);if(c.deleted===b.length){return FileOps.show_bulk_purge(b)}else{if(c.deleted===0){return FileOps.show_bulk_delete(b)}}}}}},help:{title:_("Show/hide keyboard shorcuts"),key:"shift+/, "+(key.main_modifier())+"+/",onPress:function(){return BrowseKeys.toggle_chart()}},close_help:{title:_("Hide keyboard shorcuts"),key:"escape",onPress:function(){return BrowseKeys.hide_chart()}},up_dir:{title:_("Up a folder"),key:"left",onPress:function(){var a,b;Browse.keyboard_nav=true;if(!Browse.reloading){if(Browse.inside_dir){if(!Browse.containing_ns_path()&&Browse.containing_ns_id()!==Constants.root_ns){b=Constants.root_ns;a=Util.normalize(Util.parentDir(Browse.containing_fq_path()))}else{b=Browse.containing_ns_id();a=Util.normalize(Util.parentDir(Browse.containing_ns_path()))}if(Browse.containing_ns_path()!==a||Browse.containing_ns_id()!==b){Browse.select_fq_paths=[Browse.containing_fq_path()];return BrowseURL.set_path_url(b,a)}else{return BrowseSelection.flicker_selected()}}else{return BrowseSelection.flicker_selected()}}}},open_file:{title:_("Open highlighted file"),key:"enter",onPress:function(){var a,b;b=BrowseSelection.get_selected_files();if(b.length===1){a=b[0];if(a.dir){if(Browse.keyboard_nav){Browse.select_index=0}Browse.open_folder(a)}else{if(a.preview_type==="photo"||a.preview_type==="video"){BrowseUtil.filepreview_from_selected(a)}else{if(a.preview_type){window.location.href="/preview"+Util.urlquote(a.fq_path)}else{UserActivityLogger.log("web","file_view",Object.toJSON({mode:"get"}));window.open(a.href,"_blank")}}}}return false}},open_dir:{title:_("Open highlighted folder"),key:"right",onPress:function(){var a,b;Browse.keyboard_nav=true;b=BrowseSelection.get_selected_files();if(b.length===1){a=b[0];if(a.dir){Browse.select_index=0;Browse.open_folder(a)}else{BrowseSelection.flicker_selected()}}return false}},undo:{title:_("Undo recent move/copy/rename/delete"),key:""+(key.main_modifier())+"+z",onPress:function(){if(Constants.can_undo&&$("undo-link")){UndoAction.perform_undo()}return false}}}};var BrowseURL;BrowseURL={_DEFAULTS:{d:false,select:false},_get_helper:function(a){var b;b=DBHistory.deconstruct_url().qargs;if(a in b){return !!b[a]}else{assert(a in this._DEFAULTS,"bad query param in BrowseURL");return this._DEFAULTS[a]}},get_del:function(){return this._get_helper("d")},ns_to_fq_path:function(a,c){var b;if(a!==Constants.root_ns&&(!(a in Browse.ns_id_to_mount_point))){a=Constants.root_ns}if(a===Constants.root_ns){return c}else{b=Browse.ns_id_to_mount_point[a];return b+c}},_make_url:function(a,h,g){var f,e,b,d,c;if(g==null){g={}}if(!a){a=Constants.root_ns}assert(typeof a==="number","expected ns_id as a number");assert(typeof h==="string","expected explicit ns_path string");f=this.ns_to_fq_path(a,h);d="/home"+Util.urlquote(f);b=DBHistory.deconstruct_url().qargs;for(e in g){c=g[e];if(e in this._DEFAULTS&&!!c!==this._DEFAULTS[e]){b[e]=c}}for(e in b){if(!(e in this._DEFAULTS)){delete b[e]}}return DBHistory.construct_url(d,b)},set_path_url:function(a,f,d){var e,c,b;if(!a){a=Constants.root_ns}else{c=parseInt(a,10);a=!isNaN(c)?c:Constants.root_ns}f=Util.normalize(f);b=d!=null?this._make_url(a,f,{d:d?1:0}):this._make_url(a,f);e=DBHistory.deconstruct_url(b);return DBHistory.push_state(e.path,e.qargs)},set_del_url:function(a){var c,d,b;b=DBHistory.deconstruct_url();c=b.path;d=b.qargs;if(a){d.d="1"}else{delete d.d}return DBHistory.push_state(c,d)},_first_load:true,_last_path:null,_last_qargs:null,history_change_handler:function(h,g){var f,a,b,j,d,c,e;key.setScope(Browse.KEY_SCOPE);h=Util.normalize(h);d=g.ns;j=this._last_path;b=(e=this._last_qargs)!=null?e.ns:void 0;c=false;if(!this._first_load){c=(!Browse.inside_dir)||(h!==j)||(d!==b)}f=false;if((g.d==="1")!==(Browse.deleted_shown===true)){f=true;Browse.deleted_shown=g.d==="1"}if(this._first_load||c||f){Browse.reload(d,h,true)}FileSearch.show_basic(true);this._first_load=false;this._last_path=h;this._last_qargs=g;if(BrowseSelection.get_selected_files().length){a=BrowseSelection.get_selected_files()[0].get_div();if(a){return Browse.scrollToWithPadding(a,a.getHeight()*2)}}},parse_b2_hash:function(e){var c,b,d,a,f;a=e.split(":");if(a.length!==4){return false}d=a[0];c=a[2]==="1";b=a[3];f=!b||Util.isNumber(b);if(!f){return false}b=parseInt(b,10)||Constants.root_ns;return{ns_id:b,ns_path:d,deleted:c}}};var BrowseFile,FileTypes;FileTypes={FILE:1,FOLDER:2,PACKAGE:3,SHARED_FOLDER:4,SANDBOX:5};BrowseFile=Class.create({initialize:function(b){var c,a;c=Browse.inside_dir?BROWSE_SNIPPET_LEN:SEARCH_SNIPPET_LEN;a=FileOps.filename(b.fq_path);this.icon=b.icon;this.filename=a;this.caption=a.em_snippet(c);this.ns_id=b.ns_id;this.ns_path=b.ns_path;this.fq_path=b.fq_path;this.hash=b.hash;this.href=b.href;this.size=b.size!=="None"?b.size:"";this.bytes=b.bytes;this.is_deleted=this.bytes===-1;this.ago=b.ago;this.ts=b.ts;this.dir=b.is_dir?1:0;this.tkey=b.tkey;this.target_ns=b.target_ns;this.sort_rank=b.sort_rank||0;this.sort_key=b.sort_key||[""];this.sjid=b.sjid;this.thumbnail_url_tmpl=b.thumbnail_url_tmpl;this.thumbnail=b.thumbnail_url_tmpl?b.thumbnail_url_tmpl+"?size=32bf":null;this.type=b.type;this.preview_type=b.preview_type;if(b.last_modified_fname){this.last_modified_fname=b.last_modified_fname.em_snippet(LAST_MODIFIED_FNAME_SNIPPET)}Browse.add_file(this);return BrowseFile._file_index[this.to_key()]=this},is_share:function(){return this.type===FileTypes.SHARED_FOLDER},is_sandbox:function(){return this.type===FileTypes.SANDBOX},video_transcode_url:function(){assert(this.fq_path,"video_transcode_url: expected a non-root fq_path");return"https://"+Constants.LIVE_TRANSCODE_SERVER+"/transcode_video/w/"+(this.hash+Util.urlquote(this.fq_path))},get_div:function(){return $("f_"+(this.to_key()))},rename:function(e,d,h,a,b){var c,g,f;c=Browse.inside_dir?BROWSE_SNIPPET_LEN:SEARCH_SNIPPET_LEN;g=this.fq_path;Browse.pre_action_selection=[g];this.filename=FileOps.filename(e);this.caption=this.filename.em_snippet(c);this.fq_path=e;this.ns_path=d;this.hash=h;this.sort_key=a;this.sort_rank=null;this.last_modified_fname=null;if(!this.dir){f=this.href.split("/");f[f.length-1]=Util.urlquote(this.filename)+("?w="+h);this.href=f.join("/");this.icon=b}else{this.href="/home"+Util.urlquote(e);if(this.target_ns){Browse.ns_id_to_mount_point[this.target_ns]=e}}Browse.update_file_pos(this);return document.fire(FileEvents.RENAME,{old_fq_path:g,file:this})},edit:function(){var b,a,c,d=this;this.editing=true;Browse.selectable();c=function(k){var f,e,m,j,n,l,h,g;g=k.responseText.evalJSON(true);m=g.new_browse_file.fq_path;j=g.new_browse_file.hash;h=Util.decode_sort_key(g.new_browse_file.sort_key);n=g.new_browse_file.icon;l=g.new_browse_file.ns_path;f=g.changesets;e=_("Rename complete.");Notify.server_success(e,null,null,f);d.rename(m,l,j,h,n);BrowseSelection.set_selected_files([d]);d.get_div().smoothScrollIntoView();BrowseUtil.load_visible_thumbs();return Subscriber.set_ns_map(g.ns_map)};a="/cmd/rename"+(Util.urlquote(this.fq_path))+"?long_running}";b=new Ajax.InPlaceEditor(this.get_div().down(".filename-col a"),a,{htmlResponse:false,okControl:false,cancelControl:false,highlightColor:"transparent",highlightEndColor:"transparent",clickToEditText:"",cols:25,ajaxClass:Ajax.DBRequest,submitOnBlur:true,initialText:this.filename,cancelIfSame:true,clickToEdit:false,onComplete:function(){return d.editing=false},onFailure:function(){},savingText:_("Saving..."),ajaxOptions:{method:"POST",onCreate:Notify.clear_all,onSuccess:c,onUninitialized:Browse.unselectable},callback:function(e,f){return{to_path:f||"",folder:(d.dir?"yes":"")}}});return b.enterEditMode()},to_key:function(){return""+this.ns_id+"_"+this.sjid},get_category:function(){var b,a;if(this.dir){if(Browse.inside_dir&&Browse.containing_fq_path()===""){if(this.filename.toLowerCase()==="public"){b="PUBLIC_FOLDER"}if(this.filename.toLowerCase()==="photos"){b="PHOTOS_FOLDER"}}if(b==null){if(this.type===FileTypes.FOLDER){b="FOLDER"}else{if(this.type===FileTypes.PACKAGE){b="FOLDER"}else{if(this.type===FileTypes.SHARED_FOLDER){b="SHARED_FOLDER"}else{if(this.type===FileTypes.SANDBOX){b="SANDBOX"}else{if(this.target_ns){b="SHARED_FOLDER"}else{b="FOLDER"}}}}}}}if(b==null){b=BrowseFile.EXTENSION_TO_CATEGORY[this.get_extension()]||"FILE"}a=this.is_deleted?BrowseFile.CATEGORY_TO_DELETED_TRANSLATION[b]:BrowseFile.CATEGORY_TO_TRANSLATION[b];assert(a,"CATEGORY MISSING FOR "+b);return a},get_extension:function(){if(this.dir||this.filename.indexOf(".")===-1){return}return FileOps.file_extension(this.filename).toLowerCase()},is_shmodelable:function(){return !this.is_deleted&&FileOps.is_shmodelable(this.fq_path)}});BrowseFile._CATEGORIES={IMAGE:"ai bmp cr2 eps gif ico jpeg jpg nef png psd tif tiff",VIDEO:"3gp 3gpp 3gpp2 avi dv flv m2t m4v mkv mov mp4 mpeg mpg mts ts vob wmv",AUDIO:"aif flac m4a m4p mp3 ogg wav wma",DOCUMENT:"cdr csv doc docx fla indd keynote numbers otf pages pdf ppt pptx ps rtf swf txt wpd xls xlsx",COMPRESSED_FILE:"7z bz2 gz gzip rar tar zip",CODE:"ccp cs css cxx h html java js php py rb vs xml",DISK_IMAGE:"dmg iso",EXECUTABLE:"exe",SHORTCUT:"lnk",LINK:"url webloc",FONT:"ttf"};BrowseFile.EXTENSION_TO_CATEGORY={};BrowseFile.CATEGORY_TO_TRANSLATION={FILE:_("file"),FOLDER:_("folder"),SHARED_FOLDER:_("shared folder"),PUBLIC_FOLDER:_("folder"),PHOTOS_FOLDER:_("folder"),IMAGE:_("image"),VIDEO:_("video"),AUDIO:_("audio"),DOCUMENT:_("document"),COMPRESSED_FILE:_("archive"),CODE:_("code"),DISK_IMAGE:_("disk image"),EXECUTABLE:_("executable"),SHORTCUT:_("shortcut"),LINK:_("link"),FONT:_("font"),SANDBOX:_("app folder")};BrowseFile.CATEGORY_TO_DELETED_TRANSLATION={FILE:_("deleted file"),FOLDER:_("deleted folder"),SHARED_FOLDER:_("deleted shared folder"),PUBLIC_FOLDER:_("deleted folder"),PHOTOS_FOLDER:_("deleted folder"),IMAGE:_("deleted image"),VIDEO:_("deleted video"),AUDIO:_("deleted audio"),DOCUMENT:_("deleted document"),COMPRESSED_FILE:_("deleted archive"),CODE:_("deleted code"),DISK_IMAGE:_("deleted disk image"),EXECUTABLE:_("deleted executable"),SHORTCUT:_("deleted shortcut"),LINK:_("deleted link"),FONT:_("deleted font"),SANDBOX:_("deleted app folder")};(function(){var c,e,b,d,a;d=BrowseFile._CATEGORIES;a=[];for(c in d){b=d[c];a.push((function(){var j,g,f,h;f=b.trim().split(" ");h=[];for(j=0,g=f.length;j<g;j++){e=f[j];h.push(BrowseFile.EXTENSION_TO_CATEGORY[e]=c)}return h})())}return a})();BrowseFile._file_index={};BrowseFile.from_key=function(a){return BrowseFile._file_index[a]};BrowseFile.from_elem=function(b){var a;if(!b){return}a=b.readAttribute("data-identity");if(a){return BrowseFile.from_key(a)}else{return BrowseFile.from_elem(b.up("[data-identity]"))}};var BrowseActions,BrowseActionsBasic,BrowseActionsContext,GlobalActions,GlobalActionsBasic,GlobalActionsContext;BrowseActions=Class.create({initialize:function(a){return this._set_files(a)},get_actions:function(){var a;a=this.get_files();if(a.length<2){return this._get_actions_single(a.first())}else{return this._get_actions_multi(a)}},get_icon:function(a){return BrowseActions.option_dict[a].icon},get_text:function(a){var b;b=BrowseActions.option_dict[a];if(typeof b.text==="function"){return b.text.call(this)}else{return b.text}},get_href:function(a){var b;b=BrowseActions.option_dict[a];if(b.href){return b.href.call(this)}else{return""}},get_files:function(){return this._files},_set_files:function(a){return this._files=$A(a)},_get_actions_single:function(d){var e,a,f,b,j,c,g,k,h;e=[];if(!d){return[]}f=d.fq_path.toLowerCase().startsWith("/public/");g=d.fq_path.toLowerCase()==="/public";c=d.fq_path.toLowerCase()==="/photos";b=d.target_ns;a=d.ns_id!==Constants.root_ns;h=d.type===FileTypes.SHARED_FOLDER;k=d.type===FileTypes.SANDBOX;j=d.type===FileTypes.PACKAGE;if(d.is_deleted){e=e.concat(["restore","purge"]);if(!d.dir){e.push("revisions")}}else{if(d.dir){if(k){e.push("app_info")}else{if(h){e.push("sharing_options")}else{if(!(a||b||f||g||c)){e.push("share")}}}if(d.is_shmodelable()){e.push("token_share")}e.push("download");if(!(g||c)){e=e.concat(["delete","rename","move"]);if(!(j||b)){e.push("copy")}}}else{if(d.is_shmodelable()){e.push("token_share")}if(f||Browse.public_app_token){e.push("copy_url")}e.push("download");e=e.concat(["delete","rename","move","copy","revisions"])}}return e},_get_actions_multi:function(c){var a,b;a=["download","delete","move","copy","restore","purge"];b=BrowseUtil.profile_files(c);if(b.deleted>0||b.public_folder>0||b.photos_folder>0){a.removeItem("move");a.removeItem("copy");a.removeItem("delete")}if(b.shared_folders>0){a.removeItem("copy")}if(b.deleted>0){a.removeItem("delete");a.removeItem("download")}if(!Browse.inside_dir){a.removeItem("download")}if(b.deleted!==c.length){if(b.rejoinables!==c.length){a.removeItem("restore")}a.removeItem("purge")}return a}});Object.extend(BrowseActions,{PUBLIC_FOLDER_PATH_LENGTH:7,showCopyPublicUrlModal:function(a){var b;Modal.icon_show("alert_32",_("Copy public link"),DomUtil.fromElm("copy-public-url"),{wit_group:"copy_public_link"});Modal.onHide=function(){$("flash_copy_container").remove();delete Modal.onHide;return Modal.hide()};BrowseActions.addCopyUrlFlash(a);b=$("modal-content").down("#public_url");assert(b,"Text element not found for copy pulic link");b.setValue(a);return b.select()},clipboard_copy_done:function(){Notify.server_success(_("Link copied to clipboard!"));return Modal.hide()},shortenPublicLink:function(){var a;Util.shorten_url($F("public_url"),BrowseActions.updatePublicLink);a=new Element("img",{id:"publink_loading",src:"/static/images/icons/ajax-loading-small.gif",className:"right"});return $("modal-content").down("a").__date(a)},updatePublicLink:function(a){$("public_url").setValue(a);$("public_url").select();$("publink_loading").remove();$("flash_copy_container").remove();return BrowseActions.addCopyUrlFlash(a)},addCopyUrlFlash:function(b,c){var a;if(c==null){c="real_copy"}a=Util.copy_to_clipboard_swf(b,c,"BrowseActions.clipboard_copy_done");return $(a).up().style.zIndex="1001"},option_dict:{new_folder:{icon:"folder_add",text:_("New folder"),click_handler:function(a){return Browse.new_folder()}},global_restore:{icon:"restore",text:function(){assert(Browse.inside_deleted_dir,"Global restore from not a deleted dir");if(Browse.inside_deleted_shared_folder){return _("Rejoin shared folder")}else{if(Browse.inside_deleted_sandbox){return _("Restore app folder")}else{return _("Restore folder")}}},click_handler:function(){var c,b,a;c=Browse.containing_fq_path();if(Browse.inside_deleted_sandbox){assert(Browse.old_path_to_ns_id[c],"Deleted sandbox missing nsid");return Apps.restore_sandbox(c,Browse.old_path_to_ns_id[c])}else{if(Browse.inside_deleted_shared_folder){assert(Browse.old_path_to_ns_id[c],"Deleted shared folder missing nsid");return Sharing.rejoin(c,Browse.old_path_to_ns_id[c])}else{a=Util.urlquote(c);b=encodeURIComponent(location.href);return window.location.href="/restore"+a+"?prev="+b}}}},restore:{icon:"restore",text:function(){var b,a;b=this.get_files();a=BrowseUtil.profile_files(b);if(a.shared_folders===b.length){return ungettext("Rejoin shared folder","Rejoin shared folders",b.length)}else{return _("Restore")}},click_handler:function(){var b,e,a,f,d,c;e=this.get_files();if(e.length===0){}else{if(e.length===1){b=e.first();if(!b.is_deleted){return}f=b.fq_path;a=f.toLowerCase();if(b.type===FileTypes.SANDBOX){assert(Browse.old_path_to_ns_id[a],"Restore missing ns");Apps.restore_sandbox(f,Browse.old_path_to_ns_id[a])}else{if(b.type===FileTypes.SHARED_FOLDER){assert(Browse.old_path_to_ns_id[a],"Rejoin missing ns");Sharing.rejoin(f,Browse.old_path_to_ns_id[a])}else{if(b.dir){c=Util.urlquote(b.fq_path);d=encodeURIComponent(location.href);window.location="/restore"+c+"?prev="+d}else{FileOps.show_undelete(b)}}}}else{return FileOps.show_bulk_restore(e)}}}},global_share:{icon:"rainbow_16",text:function(){if(Browse.inside_shared_folder){return _("Shared folder options")}else{if(Browse.containing_fq_path()===""){return _("Share a folder")}else{return _("Share this folder")}}},click_handler:function(a){if(Browse.containing_fq_path()===""){Sharing.start_wizard(a)}else{if(Browse.inside_shared_folder){Sharing.get_sharing_options(Browse.containing_mount_point())}else{Sharing.show_share_existing_modal(Browse.containing_fq_path())}}if(Tutorial.should_handle_event(Tutorial.events.show_share_modal)){return Tutorial.handle_event(Tutorial.events.show_share_modal)}}},sharing_options:{icon:"rainbow_16",text:_("Shared folder options"),click_handler:function(a){return Sharing.get_sharing_options(this.get_files().first().fq_path)}},view_token:{icon:"link",text:_("Get link"),click_handler:function(){var b,a;b=this.get_files().first();a="/s/"+b.tkey;if(!b.dir){a+="/"+Util.urlquote(FileOps.filename(b.fq_path))}return window.location.href=a}},remove_share:{icon:"link_delete",text:_("Disable link"),click_handler:function(){var a;a=this.get_files().first();return SharingModel.confirm_remove(FileOps.filename(a.fq_path),a.tkey)}},share_new:{icon:"rainbow_16",text:_("Share a folder"),click_handler:function(a){return Sharing.start_wizard(a)}},share:{icon:"rainbow_16",text:_("Invite to folder"),click_handler:function(a){return Sharing.show_share_existing_modal(this.get_files().first().fq_path)}},share_invite_more:{icon:"group",text:_("Invite more people"),click_handler:function(a){return Sharing.show_invite_more_modal(this.get_files().first().fq_path)}},share_leave:{icon:"folder_user_delete",text:_("Leave shared folder"),click_handler:function(a){var b;b=this.fq_path;return Sharing.show_leave_modal(this.get_files().first().fq_path)}},share_unshare:{icon:"link_break",text:_("Unshare this folder"),click_handler:function(a){var b;b=this.get_files().first().fq_path;return Sharing.show_unshare_modal(b)}},revisions:{icon:"previousversions",click_handler:function(){return window.location.href="/revisions"+Util.urlquote(this.get_files().first().fq_path)},text:_("Previous versions")},token_share:{icon:"link",text:_("Get link"),click_handler:function(b){var a;a=this.get_files().first().fq_path;assert(a,"token_share: expected non-root fq_path");return Sharing.shmodel(a)}},global_token_share:{icon:"link",text:_("Get link"),click_handler:function(a){return Sharing.shmodel(Browse.containing_fq_path())}},copy_url:{icon:"world_link",text:_("Copy public link"),click_handler:function(c){var a,b;AMC.log("site_action",{action:"publink_create",webserver:Constants.WEBSERVER});a=this.get_files().first();b=Browse.public_app_token?"/spa/"+Browse.public_app_token+Util.urlquote(a.ns_path):"/u/"+Constants.uid+Util.urlquote(a.fq_path.substring(BrowseActions.PUBLIC_FOLDER_PATH_LENGTH));return BrowseActions.showCopyPublicUrlModal("http://"+Constants.PUBSERVER+b)}},download:{icon:"download",text:function(){return _("Download")},click_handler:function(){var h,b,c,f,e,g,a,d;c=this.get_files();AMC.log("file_action",{action:"download",num_files:c.length,webserver:Constants.WEBSERVER});if(c.length===1&&!c[0].dir){b=c.first();d=[Constants.protocol,Constants.block,Util.urlquote(b.fq_path),b.hash],g=d[0],h=d[1],e=d[2],f=d[3];a=""+g+"://"+h+"/get"+e+"?w="+f+"&dl=1";return window.location=a}else{return FileOps.do_bulk_download(c)}}},view:{href:function(){var f,a,d,c,e,b;a=this.get_files().first();b=[Constants.protocol,Constants.block,Util.urlquote(a.fq_path),a.hash],e=b[0],f=b[1],c=b[2],d=b[3];return""+e+"://"+f+"/get"+c+"?w="+d},icon:"page_white_magnify",text:_("View file")},a_photo:{href:function(){return"/photoshow"+Util.urlquote(this.get_files().first().fq_path.substring(7))},icon:"pictures",text:_("Gallery view")},ignore:{click_handler:function(){return Sharing.ignore(this.get_files().first().fq_path)},icon:"folder_user_delete",text:_("Permanently remove")},show_del:{click_handler:function(a){return Browse.toggle_deleted()},icon:"show-deleted",text:_("Show deleted files")},hide_del:{click_handler:function(a){return Browse.toggle_deleted()},icon:"hide-deleted",text:_("Hide deleted files")},copy:{icon:"copy",text:_("Copy"),click_handler:function(c){var a,b;b=this.get_files();if(b.length===1){a=b.first();return FileOps.show_copy(a.fq_path,a.dir)}else{if(b.length>1){return FileOps.show_copy_bulk(b)}}}},move:{icon:"move_16",text:_("Move"),click_handler:function(c){var a,b;b=this.get_files();if(b.length===1){a=b.first();return FileOps.show_move(a.fq_path,a.dir)}else{if(b.length>1){return FileOps.show_move_bulk(b)}}}},rename:{icon:"rename",text:_("Rename"),click_handler:function(){return this.get_files().first().edit()}},"delete":{icon:"delete_16",text:_("Delete"),click_handler:function(c){var a,b;b=this.get_files();if(b.length>1){return FileOps.show_bulk_delete(b)}else{if(b.length===1){a=b.first();return FileOps.show_delete(a.fq_path,a.dir)}}}},global_purge:{icon:"permdelete",text:_("Permanently delete folder"),click_handler:function(){return FileOps.show_purge(Browse.containing_fq_path(),true)}},purge:{icon:"permdelete",text:_("Permanently delete"),click_handler:function(c){var a,b;b=this.get_files();if(b.length===1){a=b.first();return FileOps.show_purge(a.fq_path,a.dir)}else{return FileOps.show_bulk_purge(b)}}},upload:{icon:"upload_16",text:_("Upload"),click_handler:function(a){return FileOps.show_upload()}},app_info:{icon:"application_double",text:_("Application info"),click_handler:function(a){return window.location.href="/account/applications"}},more_actions:{icon:"big-dropdown",text:function(){return _("More")},click_handler:Prototype.emptyFunction},preview_folder:{icon:"magnifier2",text:function(){return _("Preview folder")},click_handler:function(){return BrowseUtil.filepreview_from_selected(this)}},more_global_actions:{icon:"arrow_down_grey_small",text:_("More actions"),click_handler:function(){GlobalActionsBasic.show_secondary();return document.body.observe("click",GlobalActionsBasic.hide_secondary)}}}});BrowseActionsContext=Class.create(BrowseActions,{initialize:function($super,a){$super(a);return this._listen()},_listen:function(){$("context-menu-container").stopObserving("click");$("context-menu-container").stopObserving("contextmenu");$("context-menu-container").on("click",".action button",this._click.bind(this));return $("context-menu-container").on("contextmenu",".action button",this._click.bind(this))},_click:function(d,b){var c,a;c=b.readAttribute("data-value");a=BrowseActions.option_dict[c];d.stop();ContextMenu.hide();return a.click_handler.call(this)}});BrowseActionsBasic=Class.create(BrowseActions,{initialize:function($super){var a;a=BrowseSelection.get_selected_files();$super(a);this._render();return this._listen()},_listen:function(){var a;this.bound_update=this._update.bind(this);this.bound_disable=this._disable.bind(this);this.bound_enable=this._enable.bind(this);this.bound_click=this._click.bind(this);document.observe(BrowseSelection.UPDATED_EVT,this.bound_update);document.observe(ContextMenu.SHOW_EVT,this.bound_disable);document.observe(ContextMenu.HIDE_EVT,this.bound_enable);a=$("browse-root-actions");a.stopObserving("click");return a.on("click",".action button",this.bound_click)},unlisten:function(){document.stopObserving(BrowseSelection.UPDATED_EVT,this.bound_update);document.stopObserving(ContextMenu.SHOW_EVT,this.bound_disable);document.stopObserving(ContextMenu.HIDE_EVT,this.bound_enable);return $("browse-root-actions").stopObserving("click",this.bound_click)},_update:function(){this._set_files(BrowseSelection.get_selected_files());return this._render()},_disable:function(){$("browse-root-actions").stopObserving("click");if($("browse-root-actions").down(".secondary")){$("browse-root-actions").down(".secondary").addClassName("disabled")}return $$("#browse-root-actions .action *").invoke("setStyle",{cursor:"default"})},_enable:function(){$("browse-root-actions").stopObserving("click");$("browse-root-actions").on("click",".action button",this._click.bind(this));if($("browse-root-actions").down(".secondary")){$("browse-root-actions").down(".secondary").removeClassName("disabled")}return $$("#browse-root-actions .action *").invoke("setStyle",{cursor:"pointer"})},_render:function(){var u,p,h,s,v,w,o,q,k,e,f,g,r,d,m,b,j,l,n,c,a,t;e=this.get_files();h=this.get_actions();u=14;q="";f="";if(e.length===1){q=e[0].filename.em_snippet(u);if(!e[0].dir&&e[0].bytes>=0){f=e[0].size}}else{if(1<e.length){b=BrowseUtil.profile_files(e);r=[];if(b.files){d=ungettext("%d file","%d files",b.files).format(b.files);r.push(d)}if(b.folders){d=ungettext("%d folder","%d folders",b.folders).format(b.folders);r.push(d)}q=Util.nice_list(r)}}v=$("browse-root-actions");s=v.getLayout().get("width");g=v.getStyle("font-size");assert(g.endsWith("px"),"Invalid font size "+g);g=parseInt(g,10);k=new Emstring(q).length*g;l=new Emstring(f).length*g;s-=k+l;n=[];j=[];s-=10;for(a=0,t=h.length;a<t;a++){p=h[a];c=new Emstring(this.get_text(p)).length*g;w=c+16+8+10+9;if(s>w){n.push(p)}else{if(j.length===0){m=n.pop();j.push(m)}j.push(p)}s-=w}o=HTML.tmpl("actions_bar_tmpl",{context:this,description:q,filesize:f,has_actions:!!h.length,standard_actions:n,secondary_actions:j});return $("browse-root-actions").__date(o)},_click:function(d,b){var c,a;c=b.readAttribute("data-value");assert(c);a=BrowseActions.option_dict[c];assert(a,"Action info is missing for "+c);d.preventDefault();return a.click_handler.call(this)}});Object.extend(BrowseActionsBasic,{STANDARD_ACTIONS:["share","sharing_options","app_info","token_share","copy_url","download","delete","rename","restore","purge"]});GlobalActions=Class.create(BrowseActions,{initialize:function($super){return $super()},get_actions:function(){var a;if(!Browse.inside_dir){return[]}a=[];if(!Browse.inside_deleted_dir){a=a.concat(["upload","new_folder"]);if(!Browse.inside_sandbox){a.push("global_share")}if(Browse.containing_fq_path()&&FileOps.is_shmodelable(Browse.containing_fq_path())){a.push("global_token_share")}a.push((Browse.deleted_shown?"hide_del":"show_del"))}else{a=a.concat(["global_restore"])}return a}});GlobalActionsBasic=Class.create(GlobalActions,{initialize:function($super){$super();this._listen();return this._render()},_listen:function(){$("global-actions").stopObserving("click");$("global-actions").on("click","a",this._click.bind(this));document.observe(ContextMenu.SHOW_EVT,this._disable.bind(this));return document.observe(ContextMenu.HIDE_EVT,this._enable.bind(this))},_render:function(){var d,b,c,a;d=this.get_actions();a=d.intersect(GlobalActionsBasic.STANDARD_ACTIONS);c=d.without.apply(d,GlobalActionsBasic.STANDARD_ACTIONS);if(c.length===1){a=d;c=[]}if(c.length){a.push("more_global_actions")}b=HTML.tmpl("global_actions_tmpl",{context:this,standard_actions:a,secondary_actions:c});return $("global-actions").__date(b)},_disable:function(){$("global-actions").stopObserving("click");$$("#global-actions .action a").invoke("removeClassName","title_bubble");return $$("#global-actions .action a").invoke("addClassName","disabled")},_enable:function(){$("global-actions").stopObserving("click");$("global-actions").on("click","a",this._click.bind(this));$$("#global-actions .action a").invoke("removeClassName","disabled");return $$("#global-actions .action a").invoke("addClassName","title_bubble")},_click:function(d,b){var c,a;c=b.readAttribute("data-value");assert(c);a=BrowseActions.option_dict[c];assert(a,"Action info is missing for "+c);d.stop();GlobalActionsBasic.hide_secondary();BrowseSelection.deselect_all();return a.click_handler.call(this)}});Object.extend(GlobalActionsBasic,{STANDARD_ACTIONS:["upload","new_folder","global_share","global_token_share","global_restore","global_purge"],show_secondary:function(){var a,b;b=$("secondary-actions");a=$("more_global_actions_button");b.show();return a.addClassName("down")},hide_secondary:function(){var a,b;b=$("secondary-actions");if(!b){return}a=$("more_global_actions_button");b.hide();return a.removeClassName("down")}});GlobalActionsContext=Class.create(GlobalActions,{initialize:function($super,a){$super(a);return this._listen()},_listen:function(){$("context-menu-container").stopObserving("click");$("context-menu-container").stopObserving("contextmenu");$("context-menu-container").on("click",".action button",this._click.bind(this));return $("context-menu-container").on("contextmenu",".action button",this._click.bind(this))},_click:function(d,b){var c,a;c=b.readAttribute("data-value");a=BrowseActions.option_dict[c];d.stop();BrowseSelection.deselect_all();ContextMenu.hide();return a.click_handler.call(this)}});var BrowseClipboard;BrowseClipboard=(function(){var j,f,c,g,e,l,n,h,b,a,k,d,m;j=0;f=1;e=[];c=null;m=function(){var q,s,p,t,r,o;if(Util.focus_in_input()){return}p=BrowseSelection.get_selected_files();if(p&&p.length){for(r=0,o=p.length;r<o;r++){s=p[r];if(s.bytes<0){Notify.server_error(_("Deleted files cannot be added to the clipboard"));return false}else{if(s.target_ns){t=_("'%(filename)s' cannot be added to the clipboard");t=t.format({filename:s.filename.escapeHTML()});Notify.server_error(t);return false}}}e=p;q=p.length;t=ungettext("Added %d item to clipboard","Added %d items to clipboard",q).format(q);Notify.server_success(t);return true}};l=function(){if(m()){c=j;return false}};n=function(){if(m()){c=f;return false}};h=function(r){var p,s,q,o;assert(typeof r!=="undefined","BrowseClipboard _paste got an undefined path");if(e.length){Browse.select_fq_paths=[];for(q=0,o=e.length;q<o;q++){p=e[q];Browse.select_fq_paths.push(""+r+"/"+p.filename)}s=c===j?FileOps.do_bulk_copy:FileOps.do_bulk_move;s(e,r);return true}};d=function(o){var p;if(Util.focus_in_input()||Browse.in_search_mode()||Browse.inside_deleted_dir){return}p=h(Browse.containing_fq_path());if(p){return false}};g=function(){return e=[]};a=function(v){var u,q,s,t,r,p,o;s=v.memo.files;for(t=0,p=s.length;t<p;t++){q=s[t];for(r=0,o=e.length;r<o;r++){u=e[r];if(u.fq_path===q.fq_path||u.fq_path.startsWith(q.fq_path+"/")){g();return}}}};b=function(o){assert((o.memo.file!=null)&&!(o.memo.files!=null));o.memo.files=[o.memo.file];return a(o)};k=function(){var s,o,r,p,q;document.observe(FileEvents.RENAME,b);q=[FileEvents.DELETE,FileEvents.MOVE];for(r=0,p=q.length;r<p;r++){s=q[r];document.observe(s,a)}o=key.main_modifier();key(""+o+"+c",Browse.KEY_SCOPE,l);key(""+o+"+x",Browse.KEY_SCOPE,n);return key(""+o+"+v",Browse.KEY_SCOPE,d)};return{init:function(){return k()}}})();var BrowseSelection;BrowseSelection=(function(){var w,A,z,v,f,e,x,l,d,q,a,b,m,r,B,n,j,o,h,u,g,t,s,c,y,k,p;g=[];v=null;d=null;x=null;e=[];y=function(){$$("#browse-files li.browse-file.file-select").invoke("removeClassName","file-select");return BrowseSelection.get_selected_files().invoke("get_div").findAll(function(C){return C}).invoke("addClassName","file-select")};k=function(){if(x){return}$$("#browse-files li.browse-file[draggable]").invoke("writeAttribute","draggable",false);return BrowseSelection.get_selected_files().filter(function(C){return !C.editing}).invoke("get_div").findAll(function(C){return C}).invoke("writeAttribute","draggable","true")};p=function(C){C.apply(null,$A(arguments).slice(1));return document.fire(BrowseSelection.UPDATED_EVT)};t=function(E,D){var F,C;C=g.length;g=(E instanceof BrowseFile?[E]:$A(E));if(g.length!==C){T("Selected",g.length,"files")}F=D||g.last();assert(!F||F instanceof BrowseFile,"Invalid anchor type"+F);return v=F};t=t.wrap(p);w=function(D,C){if(D){g.push(D)}return v=C||D};w=w.wrap(p);j=function(C){var D;D=g.indexOf(C);if(D===-1){return}return g.splice(D,1)};j=j.wrap(p);o=function(){return g=[]};o=o.wrap(p);s=function(C){e=C;$$("#browse-files li.browse-file.context-select").invoke("removeClassName","context-select");return C.invoke("get_div").findAll(function(D){return D}).invoke("addClassName","context-select")};a=function(L){var I,G,F,H,O,E,N,P,C,K,M,J,D;J=$(L.target);P=J.match("li.browse-file")?J:J.up("li.browse-file");I=J.match("a")?J:J.up("a");F=BrowseFile.from_elem(P);if(L.isRightClick()||!P||I){return}Browse.keyboard_nav=false;if(e.length){return}E=Util.is_mac();if((E&&L.metaKey)||(!E&&L.ctrlKey)){if(g.indexOf(F)===-1){return w(F)}else{return j(F)}}else{if(L.shiftKey){G=Browse.files.indexOf(v);D=Browse.files.indexOf(F);N=Browse.files.indexOf(g.last());K=g.slice(0);O=N<G?-1:1;H=G;while(H!==N){H+=O;M=K.indexOf(Browse.files[H]);if(M!==-1){K.splice(M,1)}}O=D<G?-1:1;H=G;while(H!==D){H+=O;C=K.indexOf(Browse.files[H]);if(C!==-1){K.splice(C,1)}K.push(Browse.files[H])}return t(K,v)}else{return t(F)}}};b=function(H){var L,E,K,I,D,C,G,F,J;if(H.isRightClick()||e.length||Util.in_scrollbar(H.pointerX())){return}I=$(H.target);if(Element.match(I,"object")){I=I.parentNode}G=["browse-box","context-menu-container","modal","modal-overlay"];D=false;for(F=0,J=G.length;F<J;F++){C=G[F];if(I.descendantOf(C)||I.match("#"+C)){D=true;break}}if(!D){t();return}K=I.match("li.browse-file")?I:I.up("li.browse-file");E=BrowseFile.from_elem(K);L=I.match("[draggable]")||I.up("[draggable]");if(E&&!L){d=v;if(!H.shiftKey){if(E){d=E}else{if(I.match("#browse-files")){d=Browse.files.last()}}}x=[];if(H.metaKey||H.ctrlKey){return x=BrowseSelection.get_selected_files()}}};c=function(F){var D,C,E;E=$(F.target);C=E.match("li.browse-file")?E:E.up("li.browse-file");D=BrowseFile.from_elem(C);F.preventDefault();if(D){return Sharing.shmodel(D.fq_path)}};f=function(F){var D,C,E;E=$(F.target);C=E.match("li.browse-file")?E:E.up("li.browse-file");D=BrowseFile.from_elem(C);if(D){return a(F)}};m=function(I){var F,E,D,H,K,C,G,J;$("browse-files").addClassName("mouse-active");if(!BrowseSelection.is_selecting()){return}Browse.keyboard_nav=false;F=Browse.files.indexOf(d);C=Browse.files.indexOf(BrowseFile.from_elem(I.target));assert(F<Browse.files.length&&F>=0,"anchor_index: "+F+" "+d);assert(C<Browse.files.length&&C>=0,"target_index: "+C);E=Browse.files.slice(Math.min(F,C),Math.max(F,C)+1);D=x.slice(0);for(G=0,J=E.length;G<J;G++){K=E[G];H=D.indexOf(K);if(H===-1){D.push(K)}else{D.splice(H,1)}}return t(D)};l=function(C){d=null;return x=null};n=function(E){var C,D;Browse.keyboard_nav=true;if(E){Event.extend(E).preventDefault()}$("browse-files").removeClassName("mouse-active");D=g.length?g.last()===Browse.files.first()?Browse.files.first():(C=Browse.files.indexOf(g.last())-1,Browse.files[C]):Browse.files.last();t(D);if(D){return Browse.scrollTo(D.get_div())}};r=function(E){var C,D;Browse.keyboard_nav=true;if(E){Event.extend(E).preventDefault()}$("browse-files").removeClassName("mouse-active");D=g.length?g.last()===Browse.files.last()?Browse.files.last():(C=Browse.files.indexOf(g.last())+1,Browse.files[C]):Browse.files.first();t(D);if(D){return Browse.scrollTo(D.get_div())}};z=function(K){var C,D,I,J,F,G,H,E;Browse.keyboard_nav=true;if(K){Event.extend(K).preventDefault()}$("browse-files").removeClassName("mouse-active");if(g.length>0){J=Browse.files.indexOf(g.last());C=Browse.files.indexOf(v);if(v===g.last()||C>J){if(J>0){E=[];for(I=G=H=J-1;H<=0?G<=0:G>=0;I=H<=0?++G:--G){D=Browse.files[I];F=g.indexOf(D);w(D,v);if(F!==-1){E.push(g.splice(F,1))}else{Browse.scrollTo(D.get_div());break}}return E}}else{j(g.last());return Browse.scrollTo(g.last().get_div())}}else{return n()}};A=function(L){var C,D,J,K,G,H,I,F,E;Browse.keyboard_nav=true;if(L){Event.extend(L).preventDefault()}$("browse-files").removeClassName("mouse-active");if(g.length>0){K=Browse.files.indexOf(g.last());C=Browse.files.indexOf(v);if(v===g.last()||C<K){E=[];for(J=H=I=K+1,F=Browse.files.length;I<=F?H<F:H>F;J=I<=F?++H:--H){D=Browse.files[J];G=g.indexOf(D);w(D,v);if(G!==-1){E.push(g.splice(G,1))}else{Browse.scrollTo(D.get_div());break}}return E}else{j(g.last());return Browse.scrollTo(g.last().get_div())}}else{return r()}};h=function(){t(Browse.files);return false};u=function(C){return t(Browse.find_file(C.memo.fq_path))};q=function(){$$(".file-select").invoke("removeClassName","file-select");return setTimeout(y,100)};B=function(C){return C.memo.files.each(function(D){var E;E=g.indexOf(D[0]);if(E!==-1){g.splice(E,1);return w(D[1])}})};document.observe(UpdateEvents.REMOVE,function(C){return C.memo.files.each(j)});document.observe(UpdateEvents.MOVE,B);return{UPDATED_EVT:"db:select:updated",init:function(){var C;document.observe("click",f);document.observe("mousedown",b);document.observe("mouseup",l);document.observe("dragend",l);document.observe("mouseup",k);$("browse-files").on("mouseover","li.browse-file",m);$("browse-files").on("click",".shmodel-file",c);document.observe(BrowseSelection.UPDATED_EVT,y);document.observe(BrowseSelection.UPDATED_EVT,k);document.observe(Browse.RENDER_EVT,y);document.observe(Browse.RENDER_EVT,k);document.observe(Browse.UPDATE_EVT,t.bind(null,null,null));document.observe(FilePreviewModal.EXIT_SELECT_EVT,u);C=key.main_modifier();key("up",Browse.KEY_SCOPE,n);key("down",Browse.KEY_SCOPE,r);key(C+"+a",Browse.KEY_SCOPE,h);key("escape",Browse.KEY_SCOPE,t.bind(null,null,null));key("shift+up",Browse.KEY_SCOPE,z);return key("shift+down",Browse.KEY_SCOPE,A)},set_selected_files:function(C){return t(C)},get_selected_files:function(){return g.slice(0)},get_selected_fq_paths:function(){return g.map(function(C){return C.fq_path})},is_selected:function(C){return g.indexOf(C)!==-1},is_selecting:function(){return !!d},deselect_all:o,set_context_selected:function(C){return s(C)},flicker_selected:q}})();var BrowseDrag,BrowseDragScroll;BrowseDrag={_BODY_DRAG_CLASS:"external_drag",_STATUS_CLASS:"dragging",_STATUS_OFFSET:10,_SELECTION_CONST:"SELECTION",_current_item_key:null,_drag_from_window:false,init:function(){if(!Modernizr.draganddrop){return}return this.listen()},listen:function(){document.observe(Browse.UPDATE_EVT,this._update_body_data.bind(this));document.body.on("dragleave","[dropzone]",this._dropzone_dragleave.bind(this));document.body.on("dragend",this._body_dragend.bind(this));document.body.on("dragover","[dropzone]",this._dropzone_dragover.bind(this));if(Prototype.Browser.IE){document.body.on("dragenter","[dropzone]",this._dropzone_dragover.bind(this));document.body.on("mousedown",this._ie_start_drags.bind(this));document.body.on("mouseover","a.filename-link",this._ie_mouseover.bind(this))}document.body.observe("dragover",this._body_dragover.bind(this));document.body.observe("dragleave",this._body_dragleave.bind(this));document.body.observe("dragstart",this._body_dragstart.bind(this));document.body.observe("mousemove",this._body_mousemove.bind(this));document.body.on("dragstart","li.browse-file",this._file_dragstart.bind(this));document.observe(BrowseSelection.UPDATED_EVT,this._build_selected_drag_icon.bind(this));document.observe(Browse.RENDER_EVT,this._build_selected_drag_icon.bind(this));document.body.on("mousedown","li.browse-file",this._build_file_drag_icon.bind(this));return document.body.on("drop","[dropzone]",this._drop.bind(this))},_file_mousemove:function(b){var a;if(!window.event||window.event.button!==1){return}a=b.findElement("[draggable]");if(a&&a!==document&&a.dragDrop){a.dragDrop();return BrowseDrag._ie_end_drags()}},_ie_start_drags:function(a,b){if(b.tagName!=="OBJECT"&&$(b).match("[draggable]")){return $("browse-files").observe("mousemove",this._file_mousemove)}},_ie_end_drags:function(){return $("browse-files").stopObserving("mousemove")},_update_body_data:function(){var b,a;b=Browse.inside_dir?"copy move":false;a=Browse.inside_dir?Browse.containing_fq_path():false;$(document.documentElement).writeAttribute("dropzone",b);return $(document.documentElement).writeAttribute("data-fq_path",a)},_body_dragover:function(d){var b,c,a;b=this._get_event_browse_files();if(b.length){return this._update_status_position(d,b)}else{if(!this._drag_from_window&&((c=d.dataTransfer)!=null?(a=c.types)!=null?a.contains("Files"):void 0:void 0)){return CrossDomainUploader.show_drop_indicators(d)}}},_body_dragleave:function(c){var b,a,d;a=c.x||c.clientX;d=c.y||c.clientY;b=Util.viewport_dimensions();if(!((0<a&&a<b.width)&&(0<d&&d<b.height))){return CrossDomainUploader.hide_drop_indicators()}},_body_dragstart:function(){return this._drag_from_window=true},_body_dragend:function(){if($("breadcrumb-dropdown")){$("breadcrumbs-box").removeClassName("down");$("breadcrumb-dropdown").hide()}this._clear_event_browse_files();this._remove_drop_indicators();CrossDomainUploader.hide_drop_indicators();BrowseDragScroll.end();return this._drag_from_window=false},_body_mousemove:function(){return CrossDomainUploader.hide_drop_indicators()},_ie_mouseover:function(b,a){return a.focus()},_dropzone_dragover:function(f,a){var b,c,d;c=this._get_event_browse_files();d=this._target_fq_path(a);if(!c.pluck("fq_path").indexOf(d===-1)){return}if(!this._can_drop(f,a)){a.addClassName("drag_nodrop");return}if(Util.is_mac()){f.dataTransfer.dropEffect="copyMove"}else{f.dataTransfer.dropEffect="move"}f.preventDefault();b=$$(".dragover");b.removeItem(a);b.invoke("removeClassName","dragover");a.addClassName("dragover");return CrossDomainUploader.folder_dragover(d)},_dropzone_dragleave:function(b,a){return this._clear_hover_state(a)},_file_dragstart:function(h,l){var m,b,n,g,d,f,j,c;Util.clear_selected();if(BrowseSelection.is_selecting()){return h.preventDefault()}h.dataTransfer.effectAllowed="copyMove";h.dataTransfer.setData("URL","about:blank");g=BrowseFile.from_elem(l);this._set_event_browse_files(g);d=this._get_event_browse_files();if(d.length<=1&&!g.dir){c=g.href;f=(g.filename||_("file")).replace(/:/g,"-");j="application/octet-stream";try{h.dataTransfer.setData("DownloadURL",[j,f,c].join(":"))}catch(k){}}n=new Element("img",{src:"/static/images/icons/icon_spacer.gif",width:1,height:1});m=true;try{h.dataTransfer.setDragImage(n,150,150)}catch(a){m=Util.ie8}this._add_drop_indicators(h);BrowseDragScroll.start();if(m){this._update_status_position(h,d);b=$("drag-status");b.removeClassName("rotatein").removeClassName("fadein").removeClassName("selection");if(d.length>1){b.addClassName("rotatein")}if(this._is_dragging_selection()){b.addClassName("selection")}return b.addClassName("fadein")}},_add_drop_indicators:function(f){var g,d,b,c,a;$(document.body).addClassName(this._STATUS_CLASS);c=$$('[dropzone="copy move"]');a=[];for(d=0,b=c.length;d<b;d++){g=c[d];if(this._can_drop(f,g)){a.push(g.addClassName("can_drop"))}else{a.push(void 0)}}return a},_remove_drop_indicators:function(){this._clear_hover_state();$(document.body).removeClassName(this._STATUS_CLASS);return $$(".can_drop").invoke("removeClassName","can_drop")},_build_selected_drag_icon:function(){var a,d,j,c,g,k,h,b,e,l,f;b=BrowseSelection.get_selected_files();j=new Element("div",{id:"drag-selection-status"});f=b.slice(0,4);for(g=e=0,l=f.length;e<l;g=++e){d=f[g];a=d.get_div();if(!a){continue}h=a.down(".icon");h.stopObserving("load");h.observe.bind(h).defer("load",BrowseDrag._build_selected_drag_icon);k=h.cloneNode(false);Element.addClassName(k,"icon icon"+g);j.__sert(k)}c=new Element("span",{className:"badge"});c.__date(b.length);j.appendChild(c);return $("drag-selection-status").replace(j)},_build_file_drag_icon:function(f,a){var b,g,d,c;b=BrowseFile.from_elem(a);c=b.get_div().down(".icon").cloneNode(false);Element.addClassName(c,"icon icon0");d=new Element("span",{className:"badge"});d.__date("1");g=new Element("div",{id:"drag-file-status"});g.__date(c).__sert(d);return $("drag-file-status").replace(g)},_drop:function(h,d){var a,c,f,g,b;h.preventDefault();c=this._get_event_browse_files();b=h.dataTransfer.files;f=null;g=BrowseFile.from_elem(d);a=d.readAttribute("data-fq_path");if(g){f=g.fq_path}else{if(a||a===""){f=a}}if(b&&b.length){if(!CrossDomainUploader.supported()){Notify.server_error(_("Drag and drop not supported. Please try the simple uploader."))}else{if(!CrossDomainUploader.browse_indicators_enabled()&&!CrossDomainUploader.modal_indicators_enabled()){Notify.server_error(_("You can't drag and drop upload right now."))}else{CrossDomainUploader.upload(f,b)}}}else{if(c.length){if((h.dataTransfer.dropEffect==="copy")||(h.dataTransfer.effectAllowed==="copy")){if(Constants.can_undo){FileOps.do_bulk_copy(c,f)}else{FileOps.show_dragdrop_confirm(c,f,false)}}else{if(!Browse.inside_dir||Browse.containing_fq_path()!==f){if(Constants.can_undo){FileOps.do_bulk_move(c,f)}else{FileOps.show_dragdrop_confirm(c,f,true)}}}}}this._remove_drop_indicators();return CrossDomainUploader.hide_drop_indicators()},_set_event_browse_files:function(a){var b;b=BrowseSelection.is_selected(a);return this._current_item_key=b?this._SELECTION_CONST:a.to_key()},_clear_event_browse_files:function(){return this._current_item_key=null},_get_event_browse_files:function(){var c,b;try{b=this._current_item_key;if(this._is_dragging_selection()){return BrowseSelection.get_selected_files()}else{if(b){c=BrowseFile.from_key(b);return(c?[c]:[])}}}catch(a){console.log(a)}return[]},_is_dragging_selection:function(){return this._current_item_key&&this._current_item_key===this._SELECTION_CONST},_can_drop:function(d,b){var a,c;a=this._target_fq_path(b);c=this._get_event_browse_files();if(c.length){return !FileOps.bulk_move_error(c,a)}else{if($A(d.dataTransfer.types).indexOf("Files")!==-1){return CrossDomainUploader.supported()}else{return false}}},_target_fq_path:function(a){var b;b=BrowseFile.from_elem(a);if(b){return b.fq_path}else{return a.readAttribute("data-fq_path")}},_clear_hover_state:function(b){var e,d,a,c;c=$$("#browse .dragover");for(d=0,a=c.length;d<a;d++){e=c[d];if(e!==b){e.removeClassName("dragover")}}return $$("#browse .drag_nodrop").invoke("removeClassName","drag_nodrop")},_update_status_position:function(a){a=Event.extend(a);return Util.scry("drag-status").setStyle({left:(a.pointerX()-Util.scroll_offsets().left+this._STATUS_OFFSET)+"px",top:(a.pointerY()-Util.scroll_offsets().top+this._STATUS_OFFSET)+"px"})}};BrowseDragScroll=(function(){var h,g,f,c,a,d,b,e;b=null;f=0;a=40;d=50;c=function(l){var k,j;j=$(l.target);if(j.descendantOf("browse-location")||j.match("#browse-location")){return f=0}else{k=l.pointerY();return f=k-Util.scroll_offsets().top}};g=function(){d=$("browse-header").getHeight();document.observe("mousemove",c);return document.observe("dragover",c)};e=function(){document.stopObserving("mousemove",c);return document.stopObserving("dragover",c)};h=function(){var j;j=0;if(f<d){j=-1*a}else{if(f>Util.viewport_dimensions().height-d){j=a}}if(j){return Util.scroll_to(Util.scroll_offsets().left,Util.scroll_offsets().top+j)}};return{start:function(){g();return b=setInterval(h,100)},end:function(){e();return clearInterval(b)}}})();var BrowseJump;BrowseJump={_active:"",_listening:false,_RESET_WAIT:1000,_RESET_TIMER_ID:null,_CODEPOINTS:null,_BLACKLIST:["/","\\",":","?","*","<",">","|"].map(function(a){return a.charCodeAt(0)}),update:function(){var c,f,b,e,a,d;if(!BrowseJump._listening){BrowseJump.listen();BrowseJump._listening=true}c=[];d=Browse.files;for(e=0,a=d.length;e<a;e++){b=d[e];f=BrowseJump.to_codepoint_list(b.filename);c.push([f,b])}c.sort(function(h,g){return BrowseJump.cmp_codepoints(h[0],g[0])});return BrowseJump._CODEPOINTS=c},reset:function(){return BrowseJump._active=""},is_active:function(){return BrowseJump._active},jump:function(a){BrowseSelection.set_selected_files([a]);return Browse.scrollTo(a.get_div())},listen:function(){var e,d,b,c,a;document.observe("keypress",function(g){var f;if(key.getScope()!==Browse.KEY_SCOPE){return}if(Util.focus_in_input()||g.metaKey||g.altKey||g.altGraphKey||g.ctrlKey){return}f=g.charCode||g.keyCode;if(f<32){return}if((33<=f&&f<=40)){return}if(f===32){if(BrowseJump._active){g.preventDefault()}else{return}}if(BrowseJump._BLACKLIST.indexOf(f)!==-1){return}clearTimeout(BrowseJump._RESET_TIMER_ID);BrowseJump._active+=String.fromCharCode(f).toLowerCase();BrowseJump.jump(BrowseJump.nearest_file(BrowseJump._active));return BrowseJump._RESET_TIMER_ID=setTimeout(BrowseJump.reset,BrowseJump._RESET_WAIT)});c=[FileEvents.DELETE,FileEvents.COPY,FileEvents.MOVE,FileEvents.RENAME,FileEvents.PURGE,FileEvents.RESTORE,FileEvents.UPLOAD,FileEvents.SF_NEW,FileEvents.SF_LEAVE,FileEvents.SF_UNSHARE,FileEvents.SF_REJOIN,FileEvents.SF_IGNORE,FileEvents.LINKS_REMOVE,UpdateEvents.ADD,UpdateEvents.REMOVE,UpdateEvents.MOVE];a=[];for(d=0,b=c.length;d<b;d++){e=c[d];a.push(document.observe(e,function(f){return BrowseJump.update()}))}return a},nearest_file:function(g){var h,d,c,f,b,e,a;h=BrowseJump.to_codepoint_list(g);e=BrowseJump._CODEPOINTS;for(f=0,b=e.length;f<b;f++){a=e[f],c=a[0],d=a[1];if(BrowseJump.cmp_codepoints(h,c)<1){return d}}return BrowseJump._CODEPOINTS.last()[1]},cmp_codepoints:function(e,d){var a,c,b;assert(e.length>0&&d.length>0,"bad input to cmp_codepoints");for(a=c=0,b=e.length;0<=b?c<b:c>b;a=0<=b?++c:--c){if(!(d[a]!=null)){return 1}if(e[a]!==d[a]){return(e[a]<d[a]?-1:1)}}if(d.length>e.length){return -1}else{return 0}},to_codepoint_list:function(b){var c,a,e,d;b=b.toLowerCase();a=[];for(c=e=0,d=b.length;0<=d?e<d:e>d;c=0<=d?++e:--e){a.push(b.charCodeAt(c))}return a}};var ContextMenu;ContextMenu={KEY_SCOPE:"context",SHOW_EVT:"db:contextmenu:show",HIDE_EVT:"db:contextmenu:hide",_prev_key_scope:null,listen:function(){document.observe("click",this.hide_on_click);return document.observe(Browse.UPDATE_EVT,this.hide_on_click)},unlisten:function(){return document.stopObserving("click",this.hide_on_click)},hide_on_click:function(a){if(!a.isRightClick()){return ContextMenu.hide()}},show_for_file:function(c,b){var d,a;Browse.keyboard_nav=false;this.hide();d=BrowseFile.from_elem(b);a=BrowseSelection.is_selected(d)?BrowseSelection.get_selected_files():[d];BrowseSelection.set_context_selected(a);return this._show(c,new BrowseActionsContext(a))},show_global:function(a){this.hide();return this._show(a,new GlobalActionsContext())},show_shmodel:function(f){var d,a,b,c;d=["get_original"];this.hide();b=f.findElement("img");c={get_original:{icon:"download",text:_("Download Original"),href:b.readAttribute("data-original-href")}};a=Class.create({get_actions:function(){return d},get_icon:function(e){return c[e].icon},get_text:function(e){return c[e].text},get_href:function(e){return c[e].href}});return this._show(f,new a())},show_photos:function(f,b){var d,a,c;d=["get_link","delete","show_in_folder"];this.hide();c={get_link:{icon:"link",text:_("Get link"),click_handler:function(){return Sharing.shmodel(b.path)}},"delete":{icon:"delete_16",text:_("Delete"),click_handler:function(){return FileOps.show_delete(b.path,false,true)}},show_in_folder:{icon:"folder",text:_("Show in folder"),href:"/home"+(Util.urlquote(Util.normalize(Util.parentDir(b.path))))+"?select="+(Util.urlquote(b.filename))}};a=Class.create({initialize:function(){return this._listen()},_listen:function(){$("context-menu-container").stopObserving("click");$("context-menu-container").stopObserving("contextmenu");$("context-menu-container").on("click",".action button",this._click.bind(this));return $("context-menu-container").on("contextmenu",".action button",this._click.bind(this))},_click:function(l,h){var k,g,j;k=h.readAttribute("data-value");g=c[k];l.stop();ContextMenu.hide();return(j=g.click_handler)!=null?j.call(this):void 0},get_actions:function(){return d},get_icon:function(e){return c[e].icon},get_text:function(e){return c[e].text},get_href:function(e){return c[e].href}});return this._show(f,new a())},_show:function(m,g){var q,h,k,s,d,n,p,l,r,a,f,o,j,c,b;r=((m!=null?(j=m.target)!=null?j.tagName:void 0:void 0)==="INPUT")&&((m!=null?(c=m.target)!=null?c.type:void 0:void 0)==="TEXT")||((m!=null?(b=m.target)!=null?b.tagName:void 0:void 0)==="TEXTAREA");if((m!=null?m.shiftKey:void 0)||r){return}else{Event.stop(m)}k=["main-nav","page-footer","account-header","browse-global-actions-bar","modal","modal-overlay","file-preview-modal"];l=$(m.target);for(f=0,o=k.length;f<o;f++){h=k[f];if(l.descendantOf(h)||l.match("#"+h)){return}}if(l.match("#context-menu")){return}if(this._context_menu_tmpl==null){this._context_menu_tmpl=HTML.tmpl("context_menu_tmpl")}q=Event.pointer(m);if(!g.get_actions().length){return}$("context-menu-container").__date(this._context_menu_tmpl({context:g,actions:g.get_actions()}));a=Util.viewport_dimensions();p=Util.scroll_offsets();d=parseInt($("context-menu").getStyle("width"),10);s=parseInt($("context-menu").getStyle("height"),10);n=15;if(q.x+d>a.width+p.left-n){$("context-menu").setStyle({left:(q.x-p.left-d)+"px"})}else{$("context-menu").setStyle({left:(q.x-p.left)+"px"})}if(q.y+s>a.height+p.top-n){$("context-menu").setStyle({top:(a.height-s-n)+"px"})}else{$("context-menu").setStyle({top:(q.y-p.top)+"px"})}$("context-menu-container").show();this.listen();this._prev_key_scope=key.getScope();key.setScope(this.KEY_SCOPE);return document.fire(this.SHOW_EVT)},hide:function(){if(!$("context-menu-container").empty()){this.unlisten();BrowseSelection.set_context_selected([]);$("context-menu-container").__date();if(key.getScope()===this.KEY_SCOPE){key.setScope(this._prev_key_scope)}return document.fire(this.HIDE_EVT)}}};var Subscriber;Subscriber={SUBSCRIBE_CHILLOUT:5*1000,INITIAL_BACKOFF:15*1000,MAX_BACKOFF:4*60*1000,SWF_URL:"/static/swf/crossdomain_loader.swf",SWF_MIN_VERSION:"6.0.65",init:function(){var a,b;window.crossdomain_loader_loaded=function(){Subscriber._swf_object=$(Subscriber._swf_id);return Subscriber._swf_object.setCallbacks("Subscriber.subscribe_success","Subscriber.subscribe_failure")};a=new Element("div",{id:"crossdomain_flash_container"});a.setStyle({position:"absolute",bottom:"1px",right:"1px",height:"1px",width:"1px",overflow:"hidden"});b=new Element("div");a.update(b);document.body.appendChild(a);Subscriber._swf_id=b.identify();swfobject.embedSWF(Subscriber.SWF_URL,Subscriber._swf_id,"100%","100%",this.SWF_MIN_VERSION);return this.start()},_long_poll:function(a){a=a||0;clearTimeout(this._subscribe_timeout_id);return this._subscribe_timeout_id=setTimeout(this._do_subscribe.bind(Subscriber),a)},_do_subscribe:function(){if(this._is_stopped||this._is_running||!this._get_list_info){return}if(!this._ns_map||!this._swf_object){this._long_poll(this.SUBSCRIBE_CHILLOUT);return}this._is_running=true;return this._swf_object.load("http://"+Constants.NOTSERVER+"/subscribe?host_int=0&ns_map="+(this._get_ns_map_params())+"&ts=0")},subscribe_success:function(a){var b;a=a.responseText||a;b=Util.from_json(a);if(b.ret==="new"){return this._do_list.bind(this).defer()}else{this._is_running=false;this._long_poll();return assert(b.ret==="punt","Invalid response from subscribe: "+a.responseText)}},subscribe_failure:function(){this._is_running=false;return this._long_poll(this.SUBSCRIBE_CHILLOUT)},_do_list:function(){var e,c,a,b,d=this;if(this._is_stopped||!this._get_list_info){this._is_running=false;return}if(Ajax.activeRequestCount!==0){this._is_running=false;this._long_poll(this.SUBSCRIBE_CHILLOUT);return}b=this._get_list_info(),e=b[0],a=b[1],c=b[2];if(c==null){c={}}c=Object.extend(c,{ns_map:this._get_ns_map_params()});return new Ajax.DBRequest(a,{no_watch:true,noAutonotify:true,parameters:c,onSuccess:function(f){var h;h=Util.from_json(f.responseText);d._is_running=false;d._failure_backoff=d.INITIAL_BACKOFF;d._ns_map=h.ns_map;try{e(h)}catch(g){}return d._long_poll()},onFailure:function(){setTimeout(d._do_list.bind(Subscriber),d._failure_backoff);return d._failure_backoff=Math.min(d._failure_backoff*2,d.MAX_BACKOFF)}})},_get_ns_map_params:function(){var a,b;b=[];for(a in this._ns_map){b.push(a+"_"+this._ns_map[a])}return b.join(",")},start:function(){this._is_stopped=false;return this._long_poll()},stop:function(){return this._is_stopped=true},_reset:function(){this._failure_backoff=this.INITIAL_BACKOFF;this._is_running=false;this._get_list_info=false;this._is_stopped=true;this._ns_map=false;this._subscribe_timeout_id=0;this._swf_object=false;return this._swf_id-false},subscribe:function(a){this._get_list_info=a;if(!this._is_stopped){return this._long_poll()}},set_ns_map:function(a){return this._ns_map=a}};Subscriber._reset();var BROWSE_SNIPPET_LEN,Browse,BrowseUpdate,LAST_MODIFIED_FNAME_SNIPPET,SEARCH_SNIPPET_LEN;BROWSE_SNIPPET_LEN=25;SEARCH_SNIPPET_LEN=20;LAST_MODIFIED_FNAME_SNIPPET=5;Browse={KEY_SCOPE:"browse",RENDER_EVT:"db:browse:render",UPDATE_EVT:"db:browse:update",SCROLL_DURATION:0.5,msg:false,files:[],reloading:false,creating_folder:false,first_load:true,last_sort:[Sort.FILES_BY_NAME,true],folder_loading_notification:null,keyboard_nav:false,init:function(){this.unselectable();this.listen();return Util.viewport_dimensions()},setup:function(b){var f,c,e,a,d;this.ns_id_to_mount_point=b.ns_id_to_mount_point;this.old_path_to_ns_id=b.old_path_to_ns_id;this.compiled_tmpl=HTML.tmpl("list_item_tmpl");this.render_timeout=null;this.inside_dir=b.inside_dir;this.inside_deleted_dir=b.inside_deleted_dir;this.inside_shared_folder=b.inside_shared_folder;this.inside_sandbox=b.inside_sandbox;this.public_app_token=b.public_app_token;this.inside_deleted_sandbox=b.inside_deleted_sandbox;this.inside_deleted_shared_folder=b.inside_deleted_shared_folder;f="inside_deleted_dir";if(this.inside_deleted_dir){$("browse").addClassName(f)}else{$("browse").removeClassName(f)}this.block_hash=b.block_hash;this.block_hash_param=b.block_hash_param;if(this.inside_dir){$("advanced-search-box").hide();$("advanced-search-link").removeClassName("selected");this._containing_ns_id=b.containing_ns_id;this._containing_ns_path=b.containing_ns_path;this._containing_fq_path=b.containing_fq_path;this._containing_mount_point=b.containing_mount_point;BrowseURL.set_path_url(this._containing_ns_id,this._containing_ns_path);this.breadcrumb();if(this.browse_actions_basic){this.browse_actions_basic.unlisten();delete this.browse_actions_basic}this.browse_actions_basic=new BrowseActionsBasic();new GlobalActionsBasic();if(!b.file_info){this.show_message(_('<h3>This folder is empty</h3> Add files using the <a href="/install">desktop application</a> or the upload button above.'))}}d=b.file_info;for(e=0,a=d.length;e<a;e++){c=d[e];BrowseUtil.make_browsefile(c)}BrowseJump.update();return Subscriber.set_ns_map(b.ns_map)},_get_helper:function(a){assert(this.inside_dir,"accessed "+a+", but not inside a directory");return Browse[a]},containing_ns_id:function(){return this._get_helper("_containing_ns_id")},containing_ns_path:function(){return this._get_helper("_containing_ns_path")},containing_fq_path:function(){return this._get_helper("_containing_fq_path")},containing_mount_point:function(){return this._get_helper("_containing_mount_point")},listen:function(){var b,f,o,j,h,e,m,c,a,n,k,g,d,l=this;$("browse-files").on("click","li.browse-file",this.click.bind(this));$("browse-files").on("dblclick","li.browse-file",this.dblclick.bind(this));$("browse-files").on("contextmenu","li.browse-file",ContextMenu.show_for_file.bind(ContextMenu));this.enable_sorting();f="#browse-sort a.sortable-column-header";Util.add_sort_arrow_mouseover($("name-sorter"),true,f,false);Event.observe(window,"scroll",this.window_scroll.bind(this));Event.observe(window,"resize",this.updateOffset.bind(this));document.body.on("click","a.crumb",this.crumb_click.bind(this));$("browse-files").on("click","a.parent-dir",this.parent_click.bind(this));document.observe("contextmenu",ContextMenu.show_global.bind(ContextMenu));document.observe(BrowseSelection.UPDATED_EVT,this.selection_handler.bind(this));document.observe(FilePreviewModal.PHOTO_DELETE_EVT,function(p){return FileOps.do_delete(p.memo.fq_path)});document.observe(FileEvents.COPY,function(p){if(l.inside_dir&&p.memo.to_fq_path===l.containing_fq_path()){return l.force_reload()}});k=[FileEvents.MOVE,FileEvents.RESTORE,FileEvents.UPLOAD,FileEvents.SF_NEW,FileEvents.SF_REJOIN,FileEvents.SF_IGNORE,FileEvents.LINKS_REMOVE];for(j=0,m=k.length;j<m;j++){b=k[j];document.observe(b,function(p){if(l.inside_dir){return l.force_reload()}})}g=[FileEvents.SF_LEAVE,FileEvents.SF_UNSHARE];for(h=0,c=g.length;h<c;h++){b=g[h];document.observe(b,function(p){if(l.inside_dir){if(p.memo.target_ns_id===l.containing_ns_id()){if(p.memo.folder_deleted){return l.reload_fqpath("")}else{return l.reload_fqpath(l.containing_fq_path())}}else{return l.force_reload()}}})}d=[FileEvents.DELETE,FileEvents.PURGE];for(e=0,a=d.length;e<a;e++){b=d[e];document.observe(b,function(x){var u,w,q,v,p,s,t,r;if(l.inside_dir){if(x.eventName===FileEvents.PURGE||(x.eventName===FileEvents.DELETE&&!BrowseURL.get_del())){for(w=v=t=l.files.length-1;t<=0?v<=0:v>=0;w=t<=0?++v:--v){if(x.memo.files.indexOf(l.files[w])===-1){q=l.files[w]}else{break}}BrowseSelection.deselect_all();r=x.memo.files;for(s=0,p=r.length;s<p;s++){u=r[s];u.get_div().remove();l.files.removeItem(u)}if(l.files.length){if(l.keyboard_nav){if(q!=null){return BrowseSelection.set_selected_files(q)}else{return BrowseSelection.set_selected_files(l.files.last())}}}else{return l.show_empty()}}else{if(l.keyboard_nav){l.select_fq_paths=[l.containing_fq_path()+"/"+x.memo.files.last().filename]}if(FilePreviewModal.shown){return FilePreviewModal.reload=true}else{return l.force_reload()}}}})}document.observe(ContextMenu.SHOW_EVT,this.disable_sorting.bind(this));document.observe(ContextMenu.HIDE_EVT,this.enable_sorting.bind(this));n=function(){var q,p;q=$("browse-header");p=q.cumulativeOffset().top+q.getHeight();return Util.viewport_dimensions().height-p};key("pagedown",this.KEY_SCOPE,function(p){Event.extend(p).preventDefault();return window.scrollBy(0,n())});key("pageup",this.KEY_SCOPE,function(p){Event.extend(p).preventDefault();return window.scrollBy(0,-1*n())});o=function(){var p;p=Browse.in_search_mode()?FileSearch:Browse;if(Browse.files.length===0){return p.show_empty()}else{return p.hide_empty()}};document.observe(UpdateEvents.ADD,function(r){var q,p,t,s;s=r.memo.files;for(p=0,t=s.length;p<t;p++){q=s[p];l.insert_file(q,true)}return o()});document.observe(UpdateEvents.REMOVE,function(r){var q,p,t,s;s=r.memo.files;for(p=0,t=s.length;p<t;p++){q=s[p];l.remove_file(q)}return o()});return document.observe(UpdateEvents.MOVE,function(s){var w,v,q,u,t,r,p;t=s.memo.files;p=[];for(q=0,u=t.length;q<u;q++){r=t[q],w=r[0],v=r[1];l.remove_file(w);p.push(l.insert_file(v))}return p})},disable_sorting:function(){$("browse-sort").stopObserving("click");return $$("#browse-sort *").invoke("setStyle",{cursor:"default"})},enable_sorting:function(){$("browse-sort").stopObserving("click");$("browse-sort").on("click","#browse-sort a.sortable-column-header",this.sort_handler.bind(this));return $$("#browse-sort *").invoke("setStyle",{cursor:"pointer"})},click:function(b,c){var a;a=$(b.target);if(a.match("a.filename-link")||a.match("img.icon")){return this._click(b,c)}},dblclick:function(a,b){if($(a.target).match("a")){return}return this._click(a,b)},_click:function(b,c){var a;this.keyboard_nav=false;a=BrowseFile.from_elem(c);if(a.editing){return}else{if(a.dir){if((b.which===2)||(Util.is_mac()&&b.metaKey)){this.open_folder_in_new_window(a)}else{this.open_folder(a)}b.preventDefault()}else{if(a.bytes>0&&a.preview_type&&!b.metaKey&&!((a.preview_type==="video")&&Constants.DISABLE_VIDEOS_IN_LIGHTBOX)){b.preventDefault();if(a.preview_type==="photo"||a.preview_type==="video"){BrowseUtil.filepreview_from_selected(a)}else{window.location.href="/preview"+Util.urlquote(a.fq_path)}}else{b.preventDefault();UserActivityLogger.log("web","file_view",Object.toJSON({mode:"get"}));window.open(a.href,"_blank")}}}},crumb_click:function(d,a){var c,b;this.keyboard_nav=false;d.preventDefault();b=a.readAttribute("data-fq_path");c=this.details_from_fq_path(b);return BrowseURL.set_path_url(c.ns_id,c.ns_path)},parent_click:function(d,c){var a,b;this.keyboard_nav=false;d.preventDefault();b=c.readAttribute("data-parent_ns_path");a=parseInt(c.readAttribute("data-parent_ns_id"),10);return BrowseURL.set_path_url(a,b)},selection_handler:function(){if(BrowseSelection.get_selected_files().length){return $("browse-box").addClassName("selected")}else{return $("browse-box").removeClassName("selected")}},POST_SCROLL_WAIT:100,_last_scroll_timeout:null,window_scroll:function(){clearTimeout(this._last_scroll_timeout);return this._last_scroll_timeout=setTimeout(BrowseUtil.load_visible_thumbs.bind(BrowseUtil),this.POST_SCROLL_WAIT)},updateOffset:function(){if(!this.div_parent){return}this._cumulativeOffset=this.div_parent.cumulativeOffset();return this.viewportOffset()},reset_sort:function(){var b,a;this.last_sort=[Sort.FILES_BY_NAME,true];a="#browse-sort a.sortable-column-header";b=$$(a)[0];Util.add_sort_arrow_mouseover(b,true,a,false);$("kind-sorter-label").__date(FlexColumn.DISPLAY.FILES_BY_KIND);return Sprite.src(b.down("img"),"web","sort-uptick-off")},sort_handler:function(h,j){var d,a,g,f,b,k,c;j=$(j);j.blur();d=j.readAttribute("data-sort");f=this.last_sort[0]===Sort[d]?j.readAttribute("data-ascending")==="false":true;if(FlexColumn.LABELS.indexOf(d)!==-1){k=FlexColumn.SORT_FUNCTIONS.indexOf(this.last_sort[0])!==-1;if(k){g=(FlexColumn.LABELS.indexOf(d)+1)%FlexColumn.LABELS.length;d=FlexColumn.LABELS[g];a=FlexColumn.DISPLAY[d];$("kind-sorter-label").__date(a)}j.writeAttribute("data-sort",d);f=FlexColumn.IS_ASC[d]}else{j.writeAttribute("data-ascending",(f?"true":"false"))}c="#browse-sort a.sortable-column-header";Util.add_sort_arrow_mouseover(j,f,c,true);b=Sort[d];this.sort(b,f);if(h){return h.stop()}},toggle_deleted:function(){var a;a=!BrowseURL.get_del();return BrowseURL.set_del_url(a)},new_folder:function(){var f,s,h,b,g,p,l,d,k,o,c,q,m,j,a,r,e,n=this;if(this.reloading||this.creating_folder){return}this.hide_empty();this.selectable();s=_("New folder");g=[];e=this.files;for(a=0,r=e.length;a<r;a++){p=e[a];if(p.dir&&p.filename.indexOf(s)!==-1){g.push(p.filename)}}d=s;f=1;while(true){if(g.indexOf(d)===-1){break}d=s+" ("+f+")";f++}j=HTML.tmpl("new_folder_tmpl",{name:d});l=-1;if(this.files.length){m=Util.scroll_offsets();if(m.top>0){q=this.files[0].get_div().getLayout().get("margin-box-height");l=Math.floor(m.top/q)}}if(l>0){this.files[l].get_div().__sert({after:j})}else{$("browse-files").__sert({top:j})}k=$$("#browse-files .browse-new-folder .name").first();assert(k!=null,"expected new_folder_name to be defined");h=this.containing_fq_path();c=function(v){var u,t,w;w=v.responseText.evalJSON(true);u=FileOps.filename(w.new_browse_file.fq_path);t=_("Created folder '%(folder_name)s'");t=t.format({folder_name:u.snippet().escapeHTML()});Notify.server_success(t);n.select_fq_paths=[w.new_browse_file.fq_path];return n.force_reload()};o=function(u){var t;t=$$("#browse-files li.browse-new-folder").first();if(t){t.remove()}return n.creating_folder=false};b=new Ajax.InPlaceEditor(k,"/cmd/new"+(Util.urlquote(h))+"?long_running",{htmlResponse:false,okControl:false,cancelControl:false,highlightColor:"transparent",highlightEndColor:"transparent",clickToEditText:"",cols:25,ajaxClass:Ajax.DBRequest,submitOnBlur:true,onFailure:function(){},onComplete:o,savingText:_("Creating folder..."),onLeaveEditMode:this.unselectable,ajaxOptions:{method:"POST",onSuccess:c},callback:function(t,u){n.creating_folder=true;return{to_path:u||"",folder:"yes"}}});return b.enterEditMode()},open_folder:function(c){var b,a,d,e=this;assert(c.dir,"Only open directories, not files");if(!(BrowseSelection.get_selected_files().length===1&&BrowseSelection.get_selected_files().indexOf(c)===0)){BrowseSelection.deselect_all();c.get_div().addClassName("file-select")}clearTimeout(this.folder_loading_notification);b=function(){var f;f=_("Loading %(filename)s...");f=f.format({filename:c.filename.em_snippet(50).escapeHTML()});return Notify.server_success(f,60,true)};this.folder_loading_notification=setTimeout(b,1000);if(c.target_ns){a=c.target_ns;d=""}else{a=c.ns_id;d=c.ns_path}if(c.is_deleted){return BrowseURL.set_path_url(a,d,true)}else{return BrowseURL.set_path_url(a,d)}},open_folder_in_new_window:function(a){return window.open(BrowseURL._make_url(a.ns_id,a.ns_path),"_blank")},show_message:function(c){var b,a;if((typeof c)!==(typeof"string")){a=$("browse-files").down(".browse-message");if(a){a.show()}return}this.msg=c;b=new Element("div",{"class":"browse-message"});b.__date(c);return $("browse-files").__sert(b)},sort:function(a,d,c){var b;if(!c&&a===this.last_sort[0]&&d===this.last_sort[1]){return}this.last_sort=[a,d];b=a(d);this.files.sort(b);this.smartfill();return BrowseUtil.load_visible_thumbs()},resort:function(){var c,a,b;a=this.last_sort;b=a[0];c=a[1];return this.sort(b,c,true)},in_search_mode:function(){return $("browse").hasClassName("search")},flex_column:function(){return $("kind-sorter").readAttribute("data-sort")},smartfill:function(){var b,d,c,f,a,e;b=$("browse-files");c=[];e=this.files;for(f=0,a=e.length;f<a;f++){d=e[f];c.push(this.compiled_tmpl({file:d,in_search_mode:this.in_search_mode(),flex_column:this.flex_column()}))}b.__date(c);return document.fire(this.RENDER_EVT)},add_file:function(a){this.files.push(a);if(a.target_ns){Browse.ns_id_to_mount_point[a.target_ns]=a.fq_path}if(a.bytes<0){return this.deleted_shown=true}},insert_file:function(c,b){var a;b=b||0;a=this.find_file(c.fq_path);if(a&&a!==c){this.remove_file(a)}this.update_file_pos(c);if(b){c.get_div().setStyle({display:"none"})}return document.fire(this.RENDER_EVT)},get_file_pos:function(a){var b;b=this.files.indexOf(a);assert(b!==-1,"file not present in @files");assert(a.to_key() in BrowseFile._file_index,"file not present in BrowseFile._file_index");return b},remove_file:function(a){var b;b=this.files.indexOf(a);if(b!==-1){this.files.splice(b,1);delete BrowseFile._file_index[a.to_key()];return a.get_div().remove()}},update_file_pos:function(f){var a,j,d,e,g,c,b,h;h=this.files.indexOf(f);if(h!==-1){this.files.splice(h,1)}delete f.sort_rank;c=this.last_sort[0];g=this.last_sort[1];e=Util.bsearch(this.files,f,c(g),true);this.files.splice(e,0,f);d=f.get_div();a=$("browse-files");if(d){d.remove()}b=this.compiled_tmpl({file:f,in_search_mode:this.in_search_mode(),flex_column:this.flex_column()});j=a.childElements();if(e<j.length){return a.childElements()[e].__sert({before:b})}else{return a.__sert(b)}},find_file:function(a){return this.files.find(function(b){return b.fq_path.toLowerCase()===a.toLowerCase()})},reset_state:function(){this.msg=false;this.dragging=false;this.files=[];this.selected_files=[];this.selection=[];BrowseFile._file_index={};return BrowseDrag._body_dragend()},clear:function(){$("browse-files").__date();return this.hide_empty()},show_empty:function(){$("browse-empty").show();return $(document.documentElement).removeClassName("earthrise")},hide_empty:function(){$("browse-empty").hide();return $(document.documentElement).addClassName("earthrise")},update:function(a){$("browse-box").show();$("browse-files").__date();if(typeof a==="string"){this.setup(Util.from_json(a))}else{this.setup(a)}this.resort();return document.fire(this.UPDATE_EVT)},reload_fqpath:function(b,a){return this.reload(null,Util.urlquote(b),a)},force_reload:function(){return this.reload(this.containing_ns_id(),Util.urlquote(this.containing_ns_path()),true)},set_title:function(){var a;a=this.containing_fq_path();return document.title=a?FileOps.filename(a)+" - Dropbox":_("Home")+" - Dropbox"},set_selection_from_fq_paths_or_index:function(j){var c,b,g,f,a,d,e,h;a=j.select_fq_paths;d=j.select_index;if(a||d>-1){b=[];if(a){for(e=0,h=a.length;e<h;e++){g=a[e];f=this.find_file(g);if(f){b.push(f)}}}if(!b.length&&d>-1){c=this.files[d];if(c){b.push(c)}}if(b.length){BrowseSelection.set_selected_files(b);this.scrollToWithPadding(b.first().get_div(),100)}j.select_fq_paths=false;return j.select_index=-1}else{return window.scrollTo(0,0)}},reload:function(a,e,d){var b,g,f,c,h=this;g="Browse.reload ns_path contains an invalid character: # ; ? : @ & = + $ (ns_path = "+e+")";assert(e.search(DBHistory.URL_ESCAPE_REGEX)===-1,g);a=a!=null?a:a=Constants.root_ns;e=Util.normalize(e);if(BrowseUtil.get_mode()!==BrowseUtil.BROWSE_MODE){this.clear();BrowseUtil.set_browse_mode()}if(FileSearch._clear_on_reload){FileSearch.clear_searchbox()}if(!FileQueue.uploading){InlineUploadStatus.hide()}if(this.reloading){return}if(this.inside_dir&&e===this.containing_ns_path()&&a===this.containing_ns_id()&&!d){return}c=this.first_load?Constants.referrer:"";b=this.deleted_shown?"?show_deleted=yes":"";f={ns_id:a,referrer:c};f=Object.extend(f,this.extra_reload_args);T("Browse.reload:",e);this.reloading=true;new Ajax.DBRequest("/browse"+e+b,{parameters:f,log_timing:true,onSuccess:function(j){h.reset_state();h.update(j.responseText);(h.files.length?h.hide_empty.bind(h):h.show_empty.bind(h))();clearTimeout(h.folder_loading_notification);if(Notify.cancel_on_reload){Notify.clear_all();Notify.cancel_on_reload=false}Util.force_delete_cached_scroll_offsets();h.set_selection_from_fq_paths_or_index(Browse);h.set_title();if(Tutorial.should_handle_event(Tutorial.events.browse_reload)){return Tutorial.handle_event(Tutorial.events.browse_reload)}},onFailure:function(){if(h.first_load){h.reload.bind(h).defer(Constants.root_ns,"")}return clearTimeout(h.folder_loading_notification)},cleanUp:function(){h.first_load=false;return h.reloading=false},no_feed_reload:true,evalJSON:false});return true},unload:function(){var a;this.reset_state();a=$("dropdown");if(a){return Util.yank(a)}},can_get_details_from_fq_path:function(c){var b,a;b=this.containing_fq_path();a=this.containing_mount_point();return(a&&c.startsWith(a))||b.startsWith(c)},details_from_fq_path:function(d){var e,b,a,c;assert(this.can_get_details_from_fq_path(d));b=this.containing_mount_point();if(b&&d.startsWith(b)){a=this.containing_ns_id();c=d.slice(b.length);e=FileOps.filename(d)}else{a=Constants.root_ns;c=d;e=FileOps.filename(d)}return{ns_id:a,ns_path:c,fq_path:d,folder_name:e||"Dropbox",url:"/home"+d,icon:(d.length?"folder_32":"dropbox_32")}},_make_breadcrumbs_data:function(){var f,g,b,e,a,d,c;g=this.containing_fq_path();f=[];a=g.split("/");for(b=d=0,c=a.length;0<=c?d<c:d>c;b=0<=c?++d:--d){e=Util.normalize(a.slice(0,b+1).join("/"));f.push(this.details_from_fq_path(e))}return f},_MAX_BREADCRUMB_WIDTH:17,_CONNECT_WIDTH:1.64,breadcrumb:function(){var k,b,d,l,g,j,a,h,c,e,f;b=this._make_breadcrumbs_data();c=b.collect(function(m){return new Emstring(m.fq_path?m.folder_name:"").length});h=0;d=0;assert(b.length>0,"expected at least one breadcrumb");for(g=e=f=b.length-1;f<=0?e<=0:e>=0;g=f<=0?++e:--e){h+=c[g];if(h>this._MAX_BREADCRUMB_WIDTH){break}d+=1;h+=this._CONNECT_WIDTH}l=b.slice(0,b.length-Math.max(1,d));b=b.slice(l.length,b.length);if(!l.length&&b.length>1){b.shift()}j=b.pop();k=HTML.tmpl("breadcrumb_tmpl",{breadcrumbs:b,dropdown:l,containing_fq_path:this.containing_fq_path()});a=j.folder_name.em_snippet(this._MAX_BREADCRUMB_WIDTH);$("browse-location").__date(k);$("browse-location").__sert(" "+a);if(l.length>1){return this._render_breadcrumbs_dropdown(l)}},_render_breadcrumbs_dropdown:function(f){var a,c,b,e,d=this;a=$("breadcrumbs-box");f.reverse();b=HTML.tmpl("breadcrumb_li_tmpl",{breadcrumbs:f});$("browse-location").__sert(b);c=$("breadcrumb-dropdown");e=function(g){g.stopPropagation();c.show();return c.clonePosition(a,{setWidth:0,setHeight:0,offsetTop:a.getHeight(),offsetLeft:parseInt(a.getStyle("padding-left"),10)})};a.observe("click",e);a.observe("dragover",e);return document.observe("click",function(){a.removeClassName("down");return c.hide()})},viewportOffset:function(){var a,c,b;if(!this.files.length){return}if(!this.div_parent){c=this.files[0].get_div().offsetParent;if(!c){return}this._viewportOffset={};this.div_parent=$(c);this._cumulativeOffset=this.div_parent.cumulativeOffset()}a=Util.scrollLeft(this.div_parent);b=Util.scrollTop(this.div_parent);if(!this.scrollTop||!this.scrollLeft||this.scrollTop!==b||this.scrollLeft!==a){this._viewportOffset.top=this._cumulativeOffset.top-b;this._viewportOffset.left=this._cumulativeOffset.left-a;this.scrollLeft=a;this.scrollTop=b}return this._viewportOffset},selectable:function(){return Util.enableSelection($("browse-files"))},unselectable:function(){return Util.disableSelection($("browse-files"))},_header_offset:(function(){var a;a=$("browse-header");return a.getHeight()+a.cumulativeOffset().top}).cached(1000),scrollTo:function(a){return this.scrollToWithPadding(a,3)},scrollToWithPadding:function(d,f){var c,g,b,e,a;if(!d){return}e=Util.viewport_dimensions();a=Util.scroll_offsets();g=d.cumulativeOffset().top-a.top;c=d.getHeight();b=this._header_offset();if(g<b){Util.scroll_to(0,a.top+g-b-f)}else{if(g+c>e.height){Util.scroll_to(0,a.top+g+c-e.height+f)}}if($("modal-overlay").visible()&&$("modal").getStyle("position")==="absolute"){return Modal.fix_position()}}};BrowseUpdate=(function(){var f,g,e,c,d,b,a;b=function(j){var k,l,h;if(!Browse.inside_dir){return}l=j.parent_changes;if(l.change_to_fq_path!=null){if(l.change_type==="moved"){if(l.is_changing_view){k=_("The folder '%s' has been moved. <a href=\"/home%s\">View</a>");k=k.format(l.old_fq_path.escapeHTML(),Util.urlquote(l.new_fq_path))}else{k=_("This folder has been moved")}}else{if(l.change_type==="renamed"){if(l.is_changing_view){k=_("The folder '%s' has been renamed. <a href=\"/home%s\">View</a>");k=k.format(l.old_fq_path.escapeHTML(),Util.urlquote(l.new_fq_path))}else{k=_("This folder has been renamed to '%s'.");h=l.change_to_fq_path.split("/");k=k.format(h[h.length-1].escapeHTML())}}else{k=_("The folder '%s' has been deleted.");k=k.format(l.old_fq_path.escapeHTML())}}if(l.is_changing_view){Notify.server_error(k)}else{if(l.old_fq_path===Browse.containing_fq_path()){Notify.server_success(k)}}Browse.reload_fqpath(l.change_to_fq_path);return}return d(j)};a=function(n){var j,q,p,h,s,o,l,r,m,k;q=[];o=[];if(!Browse.in_search_mode()){return}FileSearch.clear_cache();for(h in Browse.ns_id_to_mount_point){if(!(h in n.mount_points)){n.mount_points[h]=null}}m=n.mount_points;for(h in m){p=m[h];h=parseInt(h,10);s=Browse.ns_id_to_mount_point[h];if(p===s){continue}if(p){Browse.ns_id_to_mount_point[h]=p}else{delete Browse.ns_id_to_mount_point[h]}k=Browse.files;for(l=0,r=k.length;l<r;l++){j=k[l];if(j.fq_path.indexOf(s)===0&&j.target_ns!==h){if(p){j.fq_path=p+j.fq_path.slice(s.length);j.href="/home"+p+j.href.slice(5+s.length);q.push([j,j])}else{o.push(j)}}}}return d(n,[],o,q)};d=function(z,q,v,p){var u,w,s,t,n,l,j,h,x,A,y,r,o,m,k;if(q==null){q=[]}if(v==null){v=[]}if(p==null){p=[]}r=z.added;for(l=0,x=r.length;l<x;l++){w=r[l];q.push(BrowseUtil.make_browsefile(w))}o=z.removed;for(j=0,A=o.length;j<A;j++){s=o[j];v.push(Browse.find_file(s))}m=z.moved;for(h=0,y=m.length;h<y;h++){k=m[h],t=k[0],n=k[1];p.push([Browse.find_file(t),BrowseUtil.make_browsefile(n)])}document.fire(UpdateEvents.ADD,{files:q});document.fire(UpdateEvents.MOVE,{files:p});BrowseUtil.load_visible_thumbs();u=f(q,v,p);if(Tutorial.should_handle_event(Tutorial.events.browse_folder_update_start)){Tutorial.handle_event(Tutorial.events.browse_folder_update_start,{added:q,moved:p,removed:v})}return new Effect.Parallel(u,{afterFinish:function(){document.fire(UpdateEvents.REMOVE,{files:v});if(Tutorial.should_handle_event(Tutorial.events.browse_folder_update_done)){return Tutorial.handle_event(Tutorial.events.browse_folder_update_done,{added:q,moved:p,removed:v})}}})};f=function(s,r,t){var k,l,v,p,w,o,n,m,u,j,h,q;p=!IE7_OR_LESS&&(s.length+r.length)<=10;k=[];for(o=0,u=s.length;o<u;o++){l=s[o];k.push(e(l));if(p){k.push(g(l))}else{l.get_div().setStyle({display:""})}}for(n=0,j=r.length;n<j;n++){l=r[n];if(!(l&&l.get_div())){continue}k.push(e(l));if(p){k.push(c(l))}}for(m=0,h=t.length;m<h;m++){q=t[m],v=q[0],w=q[1];k.push(e(w))}return k};e=function(h){return new Effect.HighlightForcedWithAlpha(h.get_div(),{sync:true,startcolor:BrowseSelection.is_selected(h)?"#83B8DC":"#CCEAFF",afterFinish:function(){return h.get_div().setStyle({backgroundImage:"",backgroundColor:""})}})};c=function(h){return new Effect.BlindUpComprehensive(h.get_div(),{sync:true,scaleMode:{originalHeight:35,originalWidth:788}})};g=function(h){return new Effect.BlindDownComprehensive(h.get_div(),{sync:true,scaleMode:{originalHeight:35,originalWidth:788}})};return{init:function(){var h;h=function(){var n,m,k,l,j;k=Browse.in_search_mode();n=k?a:b;j=k?"/update/list_search":"/update/list_dir";if(k){l=FileSearch.get_state();if(l.is_advanced){m=l}else{m={all_terms:l.query}}}else{m={fq_dir:Browse.containing_fq_path(),show_deleted:Browse.deleted_shown}}return[n,j,m]};return Subscriber.subscribe(h)}}})();var FileEvents,FileOps,Job,ModalProgress,NOTIFICATION_SNIPPET_LEN,ProgressBar,ProgressWatcher;FileEvents={DELETE:"db:bulk_delete",COPY:"db:bulk_copy",MOVE:"db:bulk_move",RENAME:"db:bulk_rename",PURGE:"db:bulk_purge",RESTORE:"db:bulk_restore",UPLOAD:"db:upload",SF_NEW:"db:sf_new",SF_LEAVE:"db:sf_leave",SF_UNSHARE:"db:sf_unshare",SF_REJOIN:"db:sf_rejoin",SF_IGNORE:"db:sf_ignore",LINKS_REMOVE:"db:link_remove"};NOTIFICATION_SNIPPET_LEN=40;FileOps={is_shmodelable:function(a){var b;if(!Constants.can_shmodel||Browse.public_app_token){return false}b=a.toLowerCase();return !b.startsWith("/public/")},filename_to_icon:function(a){var b,c;c=FileOps.file_extension(a).toLowerCase();b={exe:"page_white_gear",dll:"page_white_gear",xls:"page_white_excel",xlsx:"page_white_excel",ods:"page_white_tux",c:"page_white_c",h:"page_white_c",php:"page_white_php",mp3:"page_white_sound",wav:"page_white_sound",m4a:"page_white_sound",wma:"page_white_sound",aiff:"page_white_sound",au:"page_white_sound",ogg:"page_white_sound",doc:"page_white_word",docx:"page_white_word",odt:"page_white_tux",ppt:"page_white_powerpoint",pptx:"page_white_powerpoint",odp:"page_white_tux",txt:"page_white_text",rtf:"page_white_text",sln:"page_white_visualstudio",vcproj:"page_white_visualstudio",html:"page_white_code",htm:"page_white_code",psd:"page_white_paint",pdf:"page_white_acrobat",fla:"page_white_actionscript",swf:"page_white_flash",gif:"page_white_picture",png:"page_white_picture",jpg:"page_white_picture",jpeg:"page_white_picture",tiff:"page_white_picture",tif:"page_white_picture",bmp:"page_white_picture",odg:"page_white_picture",py:"page_white_code",gz:"page_white_compressed",tar:"page_white_compressed",rar:"page_white_compressed",zip:"page_white_compressed",iso:"page_white_dvd",css:"page_white_code",xml:"page_white_code",tgz:"page_white_compressed",bz2:"page_white_compressed",rb:"page_white_ruby",cpp:"page_white_cplusplus",java:"page_white_cup",cs:"page_white_csharp",ai:"page_white_vector"};return b[c]||"page_white"},file_extension:function(a){return a.split(".").last()},filename:function(c,b){var a;if(b==null){b=_("Dropbox")}c=Util.normalize(c);c=c.split("/");a=c.pop();if(a===""){return b}else{return a}},dir_handler:function(d,c){var b,a;if(typeof c==="string"){c=$(c)}b=$$(".treeview .highlight")[0];if(b){b.removeClassName("highlight")}a=c.up("div");a.addClassName("highlight");Modal.selected_div=a;if(Modal.shown()){c.blur()}document.fire("db:dir_click",{path:d});return Modal.vars.selected_path=d},show_folder_pick:function(h,f,e,g,a){var b,d,c;DomUtil.fillVal(FileOps.filename(f).escapeHTML(),"folder-pick-file");TreeView.move("copy-move-treeview","folder-pick-treeview");TreeView.enable_shared("copy-move-treeview");c=(a?"page_white_go_32":"page_white_copy_32");b=(a?_("Move"):_("Copy"));DomUtil.fillVal(b,"folder-pick-action-text");Modal.icon_show(c,h,$("folder-pick"),{fq_path:f,action:e,folder:g});d=$("first-treeview-link");return d.onclick()},show_bulk_folder_pick:function(h,e,a,f){var b,j,c,g,d;d=BrowseUtil.profile_files(a);j=BrowseUtil.profile_summary(d);DomUtil.fillVal(j,"bulk-folder-pick-file");TreeView.move("copy-move-treeview","bulk-folder-pick-treeview");TreeView.enable_shared("copy-move-treeview");g=(e==="move"?"page_white_go_32":"page_white_copy_32");b=(e==="move"?_("Move"):_("Copy"));DomUtil.fillVal(b,"bulk-folder-pick-action-text");Modal.icon_show(g,h,$("bulk-folder-pick"),{files:a,action:f});c=$("first-treeview-link");return c.onclick()},show_copy:function(a,b){var c;c=(b?_("Copy folder to..."):_("Copy file to..."));return FileOps.show_folder_pick(c,a,FileOps.do_copy,b,false)},show_dragdrop_confirm:function(a,k,b){var c,h,e,g,d,j;h=FileOps.filename(k)||"Dropbox";j=void 0;d=void 0;c=void 0;g=void 0;e=void 0;if(b){j=ungettext("Move %(item_count)s item","Move %(item_count)s items",a.length).format({item_count:a.length});c="Move";d=ungettext("Are you sure you want to move %(item_count)s item to '%(destination)s'?","Are you sure you want to move %(item_count)s items to '%(destination)s'?",a.length).format({item_count:a.length,destination:h});g="page_white_go_32";e=FileOps.do_bulk_move}else{j=ungettext("Copy %(item_count)s item","Copy %(item_count)s items",a.length).format({item_count:a.length});c="Copy";d=ungettext("Are you sure you want to copy %(item_count)s item to %(destination)s?","Are you sure you want to copy %(item_count)s items to %(destination)s?",a.length).format({item_count:a.length,destination:h});g="page_white_copy_32";e=FileOps.do_bulk_copy}DomUtil.fillVal(c,"dragdrop-folder-pick-action-text");Modal.icon_show(g,j,$("dragdrop-confirm-modal"),{files:a,to:k,action:e});return $("dropdown-confirm-text").__date(d)},show_copy_bulk:function(a){var b;b=ungettext("Copy %(item_count)s item to...","Copy %(item_count)s items to...",a.length).format({item_count:a.length});return FileOps.show_bulk_folder_pick(b,"copy",a,FileOps.do_bulk_copy)},show_move_bulk:function(a){var b;b=ungettext("Move %(item_count)s item to...","Move %(item_count)s items to...",a.length).format({item_count:a.length});return FileOps.show_bulk_folder_pick(b,"move",a,FileOps.do_bulk_move)},show_move:function(a,b){var c;c=(b?_("Move folder to..."):_("Move file to..."));return FileOps.show_folder_pick(c,a,FileOps.do_move,b,true)},show_delete:function(b,c,a){var d,e;DomUtil.fillVal("'"+FileOps.filename(b).escapeHTML()+"'","delete-filename");d=void 0;if(a){d=function(){return FileOps.do_nonbrowse_delete([b])}}else{d=FileOps.do_delete}e=(c?_("Delete folder?"):_("Delete file?"));return Modal.icon_show("delete_32",e,DomUtil.fromElm("delete-file"),{fq_path:b,action:d,folder:c,wit_group:"delete-confirm"})},show_bulk_delete:function(b){var c,a;c=ungettext("%(item_count)s item","%(item_count)s items",b.length).format({item_count:b.length});DomUtil.fillVal(c,"delete-filename");a=ungettext("Delete %(item_count)s item?","Delete %(item_count)s items?",b.length).format({item_count:b.length});return Modal.icon_show("delete_32",a,DomUtil.fromElm("delete-file"),{files:b,action:FileOps.do_bulk_delete,wit_group:"delete-bulk-confirm"})},show_purge:function(a,b){var c;DomUtil.fillVal("'"+FileOps.filename(a).escapeHTML()+"'","purge-filename");c=(b?_("Permanently delete folder?"):_("Permanently delete file?"));return Modal.icon_show("alert_32",c,DomUtil.fromElm("purge-file"),{fq_path:a,action:FileOps.do_purge,folder:b,wit_group:"purge-file-confirm"})},show_bulk_purge:function(b){var c,a;c=ungettext("%(item_count)s item","%(item_count)s items",b.length).format({item_count:b.length});DomUtil.fillVal(c,"purge-filename");a=ungettext("Permanently delete %d item?","Permanently delete %d items?",b.length).format(b.length);return Modal.icon_show("alert_32",a,DomUtil.fromElm("purge-file"),{files:b,action:FileOps.do_bulk_purge,wit_group:"purge-bulk-confirm"})},show_bulk_restore:function(b){var c,a;c=ungettext("%(item_count)s item","%(item_count)s items",b.length).format({item_count:b.length});DomUtil.fillVal(c,"restore-filename");a=ungettext("Restore %d item...","Restore %d items...",b.length).format(b.length);return Modal.icon_show("alert_32",a,DomUtil.fromElm("restore-file"),{files:b,action:FileOps.do_bulk_restore,wit_group:"restore-bulk-confirm"})},show_upload:function(a,b){var d,c;a=a||Browse.containing_fq_path();if(!FlashDetect.versionAtLeast(9)){FileOps.show_basic_upload(a);$("enhanced-upload-toggle").hide();return}d=FileOps.filename(a);DomUtil.fillVal("'"+d.escapeHTML()+"'","upload-foldername");DomUtil.fillVal("'"+d.em_snippet(14).escapeHTML()+"'","dnd-upload-foldername");if($("upload-desc").visible()&&CrossDomainUploader.supported()){$("upload-desc").hide();$("dnd-upload-desc").show()}c=_("Upload to '%(folder_name)s'").format({folder_name:d.em_snippet(20)});Modal.icon_show("upload_32",c,DomUtil.fromElm("advanced-upload-modal"),{fq_path:a,action:FileOps.do_upload,wit_group:"advanced-uploader"},false,false,FileQueue.num_files()&&!b);if(!FileQueue.num_files()||b){Upload.init(Util.normalize(a),true)}else{Upload.set_dest(Util.normalize(a))}return InlineUploadStatus.hide()},show_basic_upload:function(a){var c,b;c=FileOps.filename(a);DomUtil.fillVal("'"+c.escapeHTML()+"'","basic-upload-foldername");b=_("Upload to '%(folder_name)s'").format({folder_name:c.em_snippet(20)});Modal.icon_show("upload_32",b,$("basic-upload-modal"),{},false);Upload.set_dest(Util.normalize(a));return Upload.init_basic()},show_undelete:function(a){var b,c,d;DomUtil.fillVal(a.filename.escapeHTML(),"undelete-filename");b=Sprite.make("web",a.icon,{});b.addClassName("link-img");b.style.backgroundColor="transparent";c="/revisions"+Util.urlquote(a.fq_path)+"?undelete=1";$$(".undelete-icon").invoke("update",b);$$(".undelete-other-versions")[0].href=c;$$(".undelete-link")[0].href=c;$("undelete-form").action="/revisions"+Util.urlquote(a.fq_path);d=_("Restore file?");return Modal.icon_show("alert_32",d,$("undelete-modal"),{file:a})},do_undelete:function(f){var c,b,d,a;b=Modal.vars.file;d=$("undelete-form");a=_("Restored '%(file_name)s'").format({file_name:b.filename});c=_("Error, unable to restore '%(file_name)s'").format({file_name:b.filename});Forms.ajax_submit(d,false,(function(){Modal.hide();Notify.server_success(a);return document.fire(FileEvents.RESTORE,{files:[b]})}),(function(){return Notify.server_error(c)}),f.target);return false},do_copy:function(c,b){var a;c=c||Modal.vars.fq_path;b=b||Modal.vars.selected_path;a=Browse.find_file(c);assert(a,"Trying to copy a file we couldn't find.");return FileOps.do_bulk_copy([a],b)},do_bulk_copy:function(f,b){var d,e,c,g,a;Browse.pre_action_selection=BrowseSelection.get_selected_fq_paths();f=f||Modal.vars.files;assert(f.length>0,"Tried to copy 0 files");if(typeof b==="undefined"){if(typeof Modal.vars.selected_path==="undefined"){Notify.server_error(_("You need to select a destination for the file."));return}else{b=Modal.vars.selected_path}}b=Util.normalize(b);c=0;for(g=0,a=f.length;g<a;g++){d=f[g];if(d.dir){if((b+"/").indexOf(d.fq_path+"/")===0){Notify.server_error(_("You cannot copy a folder into itself."));return}}}e=f.pluck("fq_path");Notify.clear_all();return new Ajax.DBRequest("/cmd/copy",{parameters:{files:e,to_path:b},job:true,progress_text:_("Copying..."),onSuccess:function(l){var k,j,h,m;k=l.responseText.evalJSON().changesets;j=e.length;h=FileOps.filename(b).em_snippet(NOTIFICATION_SNIPPET_LEN).escapeHTML();m=ungettext("Copied %(count)d item to '<a id=\"reload-link\">%(location)s</a>'.","Copied %(count)d items to '<a id=\"reload-link\">%(location)s</a>'.",j);m=m.format({count:j,location:h});Notify.server_success(m,null,null,k);$("reload-link").observe("click",function(){return Browse.reload_fqpath(b)});TreeView.schedule_reset();return document.fire(FileEvents.COPY,{files:f,to_fq_path:b})}})},bulk_move_error:function(a,j){var g,d,k,e,l,f,b,c,h;k=Browse.find_file(j);e=BrowseUtil.profile_files(a);c=void 0;f=void 0;h=void 0;if(k){f=k.dir;c=k.fq_path;h=k.target_ns||k.ns_id}else{if(Browse.inside_dir&&Browse.can_get_details_from_fq_path(j)){d=Browse.details_from_fq_path(j);f=true;c=d.fq_path;h=d.ns_id}else{f=true;c=j;h=void 0}}l=a.pluck("fq_path").collect(Util.normalize);if(-1!==l.indexOf(Util.normalize(c))){return _("You cannot copy a folder into itself.")}g=b=function(m){var n;n=Util.parentDir(m.fq_path);return n===(c||"/")};if(a.all(g)){return ungettext("That file already exists in that folder.","Those files already exist in that folder.",a.length)}if(!f){return _("You cannot put files inside one another.")}if(e.target_namespaces>0&&h&&h!==Constants.root_ns){if(e.sandboxes>0){return _("You're not allowed to put an application folder inside a special folder.")}else{if(e.shared_folders>0){return _("You're not allowed to put a shared folder inside a special folder.")}else{return _("You're not allowed to nest special folders.")}}}if(c==="/Public"&&e.target_namespaces>0){return _("You're not allowed to move shared folders to your Public folder.")}if(e.public_folder>0){return _("You're not allowed to move your Public folder.")}if(e.photos_folder>0){return _("You're not allowed to move your Photos folder.")}if(e.deleted>0){return _("Moving deleted folders or files is not allowed.")}},do_move:function(c,b){var a;c=c||Modal.vars.fq_path;b=b||Modal.vars.selected_path;a=Browse.find_file(c);assert(a,"Trying to move a file we couldn't find.");return FileOps.do_bulk_move([a],b)},do_bulk_move:function(d,e){var b,c,a;Browse.pre_action_selection=BrowseSelection.get_selected_fq_paths();d=d||Modal.vars.files;if(!d){return}assert(d.length>0,"Tried to move 0 files");a=e||Modal.vars.selected_path||"";a=Util.normalize(a);b=FileOps.bulk_move_error(d,a);if(b){Notify.server_error(b);return}c=d.pluck("fq_path");Notify.clear_all();return new Ajax.DBRequest("/cmd/move",{parameters:{files:c,to_path:a},job:true,progress_text:_("Moving..."),onSuccess:function(j){var h,g,f,k;if(j.responseText==="dropquest"){window.location.href="/dropquest2012/chapter19";return}h=j.responseText.evalJSON().changesets;g=c.length;f=FileOps.filename(a).em_snippet(NOTIFICATION_SNIPPET_LEN).escapeHTML();k=ungettext("Moved %(count)d item to '<a id=\"reload-link\">%(location)s</a>'.","Moved %(count)d items to '<a id=\"reload-link\">%(location)s</a>'.",g);k=k.format({count:g,location:f});Notify.server_success(k,null,null,h);$("reload-link").observe("click",function(){return Browse.reload_fqpath(a)});TreeView.schedule_reset();return document.fire(FileEvents.MOVE,{files:d,to_fq_path:a})}})},do_rollback:function(a){return new Ajax.DBRequest("/cmd/rollback",{parameters:{ns_to_cs:Util.to_json(a)},job:true,progress_text:_("Undoing..."),onSuccess:function(b){var c;c=_("Undo complete.");Notify.server_success(c);assert(Browse.pre_action_selection instanceof Array,"Expected a selection from before the action to be undone");if(Browse.in_search_mode()){FileSearch.select_fq_paths=Browse.pre_action_selection;FileSearch.force_reload()}else{Browse.select_fq_paths=Browse.pre_action_selection;Browse.force_reload()}return Browse.pre_action_selection=false}})},do_bulk_delete:function(b){var a;Browse.pre_action_selection=BrowseSelection.get_selected_fq_paths();b=b||Modal.vars.files;assert(b.length>0,"Tried to delete 0 files");a=b.collect(function(c){return c.fq_path});Notify.clear_all();return new Ajax.DBRequest("/cmd/delete",{parameters:{files:a},job:true,progress_text:_("Deleting..."),onSuccess:function(c){var e,d;d=c.responseText.evalJSON();e=ungettext("Deleted %d item.","Deleted %d items.",a.length).format(a.length);Notify.server_success(e,null,null,d.changesets);TreeView.schedule_reset();Subscriber.set_ns_map(d.ns_map);return document.fire(FileEvents.DELETE,{files:b})}})},do_delete:function(b){var a;a=Browse.find_file(b||Modal.vars.fq_path);assert(a,"Trying to delete a file we couldn't find.");return FileOps.do_bulk_delete([a])},do_nonbrowse_delete:function(a){return new Ajax.DBRequest("/cmd/delete",{parameters:{files:a},onSuccess:function(b){Notify.server_success(_("Deleted 1 item"));return document.fire(FileEvents.DELETE,{fq_paths:a})}})},do_purge:function(){var a;a=Browse.find_file(Modal.vars.fq_path);assert(a,"Trying to purge a file we couldn't find.");return FileOps.do_bulk_purge([a])},do_bulk_purge:function(b){var a,c;b=b||Modal.vars.files;assert(b.length>0,"Tried to purge 0 files");a=b.collect(function(d){return d.fq_path});c=ungettext("Permanently deleted %d item","Permanently deleted %d items",a.length).format(a.length);return new Ajax.DBRequest("/cmd/purge",{parameters:{files:a},job:true,progress_text:_("Deleting..."),onSuccess:function(d){Notify.server_success(c);TreeView.schedule_reset();return document.fire(FileEvents.PURGE,{files:b})}})},do_bulk_restore:function(b){var a,c;b=b||Modal.vars.files;assert(b.length>0,"Tried to restore 0 files");a=b.collect(function(d){return d.fq_path});c=ungettext("Restored %d item","Restored %d items",a.length).format(a.length);return new Ajax.DBRequest("/cmd/restore",{parameters:{files:a},job:true,progress_text:_("Restoring..."),onSuccess:function(d){Notify.server_success(c);TreeView.schedule_reset();return document.fire(FileEvents.RESTORE,{files:b})}})},do_upload:function(){$("dest-folder").value=Modal.vars.fq_path;$("upload-form").submit();return frames["upload-frame"].onload=function(a){var b;b=a.target.documentElement.textContent;if(b==="winner!"){Notify.server_success(_("Uploaded file successfully"));return document.fire(FileEvents.UPLOAD,{to_fq_path:Modal.vars.fq_path})}else{return Notify.server_error(_("Upload error, please try again"))}}},do_bulk_download:function(c){var e,b,d,a;e=new Element("form",{action:"https://"+Constants.BLOCK_CLUSTER+"/zip_batch",method:"post"});for(d=0,a=c.length;d<a;d++){b=c[d];Forms.add_vars(e,{files:b.fq_path})}Forms.add_vars(e,{parent_path:Browse.block_hash_param||"/",w:Browse.block_hash});$(document.body).__sert(e);return e.submit()}};ProgressBar={MAGIC:42,make:function(a,b,c){var k,h,j,e,g,d,f;if(b==null){b=300}f=b.toString()+"px";c=(typeof c!=="undefined"?c:"0%");j=new Element("div",{"class":"outer-progress-bar",style:"width: "+f});k=new Element("div",{"class":"inner-progress-bar",id:"pb_"+a,style:"width: "+f});g=new Element("div",{"class":"under-pb progress-bar",style:"width: "+f});e=new Element("div",{style:"display: none","class":"over-pb progress-bar",id:"pb_"+a+"_over"});d=new Element("div",{"class":"pb-percentage",id:"pb_"+a+"_upct",style:"width: "+f});d.update(c);h=new Element("div",{"class":"pb-percentage",id:"pb_"+a+"_opct",style:"width: "+f});h.update(c);g.__sert(d);e.__sert(h);k.__sert(g);k.__sert(e);j.__sert(k);e.progress_width=b;return j},reset:function(a){return ProgressBar.set(a,0)},set:function(e,a,d){var c,b;a=Math.min(a,1);d=(typeof d!=="undefined"&&d!==false?d:Math.floor(a*100).toString()+"%");c=$("pb_"+e+"_over");if(!c){return}b=c.progress_width*a;c.show();c.makeClipping().setStyle({width:b.toString()+"px",backgroundColor:"#348DD3"});$("pb_"+e+"_upct").innerHTML=d;return $("pb_"+e+"_opct").innerHTML=d}};ModalProgress={show:function(c,a){var b;if(!c){return}a=$(a||"browse-box");b=$("modal-progress-overlay");b.clonePosition(a);if(!b.getWidth()){return}$("modal-progress-text").__date(c);$("modal-progress-bar").setOpacity(1);$("modal-progress-bar").__date(ProgressBar.make("modal-progress",150,""));Effect.Appear(b,{to:0.7,duration:0.25});return Effect.Appear("modal-progress-content",{duration:0.25})},update:function(a){var b;if(a.indexOf("/")>0){b=a.split("/");a=Number(b[0])/Number(b[1])}if(a){return ProgressBar.set("modal-progress",a,"")}},hide:function(){Effect.Fade("modal-progress-overlay",{duration:0.25});return Effect.Fade("modal-progress-content",{duration:0.25})}};Job={complete:{},handled:function(a){var b;if(!a){return false}b=!!Job.complete[a];Job.complete[a]=true;return b},peek:function(a){if(!a){return false}return !!Job.complete[a]}};ProgressWatcher={job_info:{},INIT_POLL_INT:1000,FAILS_MEAN_FAIL:3,MODAL_WAIT_MS:1000,watch:function(a){var b;ProgressWatcher.job_info[a.job_id]={};b=ProgressWatcher.job_info[a.job_id];b.req=a;b.poll_int=ProgressWatcher.INIT_POLL_INT;b.poll_count=0;b.int_id=setInterval(ProgressWatcher.update_for(a.job_id),b.poll_int);b.failures=0;return b.start_time=Util.time()},update_for:function(a){return function(){return ProgressWatcher.update(a)}},backoff:function(b){var a;a=ProgressWatcher.job_info[b];clearInterval(a.int_id);a.poll_int=Math.min(Math.floor(a.poll_int*1.5),30000);return a.int_id=setInterval(ProgressWatcher.update_for(b),a.poll_int)},update:function(c){var a,b;b=ProgressWatcher.job_info[c];if(Job.peek(c)){return ProgressWatcher.done(c)}b.poll_count++;if(b.poll_count%10===0){ProgressWatcher.backoff(c)}if(!b.modaled&&Util.time()-b.start_time>ProgressWatcher.MODAL_WAIT_MS){a=b.req.options;ModalProgress.show(a.progress_text,a.cover_this);a.onProgress=ModalProgress.update;b.modaled=true}return new Ajax.Request("/job_status/"+c,{method:"post",t:Constants.TOKEN,onSuccess:function(e){var f,d;f=ProgressWatcher.job_info[c];d=e.responseText;if(d.indexOf("err")===0){ProgressWatcher.done(c);ModalProgress.hide();if(f.req.options.onFailure&&!Job.handled(c)){f.req.options.onFailure(e)}return}if(d.indexOf("done")===0){f.req.options.job=false;if(!Job.handled(c)){new Ajax.Request("/job_results/"+c,{onSuccess:function(h){if(Job.handled(c)){return}Notify.clear_if(RequestWatcher.working_msg);if(f.req.options.onSuccess){return f.req.options.onSuccess(h)}},onFailure:function(h){if(Job.handled(c)){return}Notify.clear_if(RequestWatcher.working_msg);if(f.req.options.onFailure){return f.req.options.onFailure(h)}}})}ProgressWatcher.done(c);return ModalProgress.hide()}else{try{if(f.req.options.onProgress){return f.req.options.onProgress(e.responseText)}}catch(g){}}},onFailure:function(d){var e;e=ProgressWatcher.job_info[c];e.failures++;if(e.failures>=ProgressWatcher.FAILS_MEAN_FAIL){if(e.req.options.onFailure){e.req.options.onFailure(d,true)}RequestWatcher.remove(e.req);ProgressWatcher.done(c);return ModalProgress.hide()}}})},done:function(b){var a;a=ProgressWatcher.job_info[b];clearInterval(a.int_id);delete ProgressWatcher.job_info[b];return ModalProgress.hide()}};var Forms,__hasProp={}.hasOwnProperty;Forms={submitOnlyOnce:function(){var a;a=Forms.submitted!==true;Forms.submitted=true;return a},disable:function(a){if(a){return setTimeout((function(){return a.disabled=true}),0)}},enable:function(a){if(a){return setTimeout((function(){return a.disabled=false}),0)}},add_vars:function(c,d){var e,b,a;c=$(c);a=[];for(b in d){if(!__hasProp.call(d,b)){continue}e=new Element("input",{type:"hidden",name:b});e.setValue(d[b]);e.addClassName("added-vars");a.push(c.__sert(e))}return a},clear_added_vars:function(a){return $$("#"+a+" .added-vars").each(Element.remove)},mirror:function(c,b){var a;c=$(c);b=$(b);a=function(e,d){d.setValue($F(e));return d.fire("db:value_change")};if(c&&b){c.observe("keyup",function(){return a(c,b)});c.observe("db:autocompleted",function(){return a(c,b)});b.observe("keyup",function(){return a(b,c)});return b.observe("db:autocompleted",function(){return a(b,c)})}},collect_form_vars:function(d){var g,c,b,f,e,a;d=d||$(document.body);c=d.select("input").concat(d.select("textarea")).concat(d.select("select"));b={};for(e=0,a=c.length;e<a;e++){g=c[e];if(g.name&&g.name!=="t"){f=g.getValue();if(f){if(typeof f!=="string"){f=f.join(",")}if(b[g.name]!=null){if(typeof b[g.name]==="string"){b[g.name]=[b[g.name],f]}else{b[g.name].push(f)}}else{b[g.name]=f}}}}return b},add_loading:function(b){var a;if(b){b=$(b);a=new Element("img",{src:"/static/images/icons/ajax-loading-small.gif"});a.addClassName("text-img ajax_submit_loading");return b.__sert({before:a})}},remove_loading:function(a){return $$(".ajax_submit_loading").each(function(b){return Util.yank(b)})},ajax_submit:function(d,b,g,e,c,a){var f;if(d.ajax_submitted){return false}d.ajax_submitted=true;d.select(".suggestion-input").each(function(h){return SuggestionInput.blank(h.identify())()});if(c){Forms.add_loading(c)}f=Forms.collect_form_vars(d);if(a){f=$H(f).update(a).toObject()}new Ajax.DBRequest(b||d.action,{noAutonotify:true,parameters:f,evalJSON:false,onSuccess:function(h){if(g&&typeof g==="function"){return g(h)}},onFailure:function(k){var h,j;if(k){if(k.responseText.indexOf("err:")===0){h=k.responseText.substr(4);if(h.indexOf("{")===0){j=h.evalJSON(true);Forms.fill_errors(d,j)}else{Notify.server_error(h)}}else{Notify.server_error()}if(e&&typeof e==="function"){return e(k)}}},onComplete:function(h){d.ajax_submitted=false;return Forms.remove_loading()}});return false},clear_errors:function(a){a=a||$(document.body);return a.select(".error-removable").invoke("remove")},fill_errors:function(d,c){var b,f,a,e;c=c||{};d=d||$(document.body);Forms.clear_errors(d);for(e in c){if(!__hasProp.call(c,e)){continue}f=d.down("[data-error-field-name='"+e+"']")||d.down("[name='"+e+"']");if(f){b=new Element("br",{"class":"error-removable"});a=new Element("span",{"class":"error-message error-removable"});a.update(c[e]);f.__sert({before:a});f.__sert({before:b})}}return SickInput.show_errors(d)},value:function(d){var c,b,f,e,a;b=$$('input[name="'+d+'"]');f=null;for(e=0,a=b.length;e<a;e++){c=b[e];f=$(c).getValue()||f}return f},postRequest:function(c,d,a){var b;if(d==null){d={}}if(a==null){a={}}assert(c!=null,"postRequest missing action");d.t=Constants.TOKEN;b=new Element("form",{action:c,method:"POST"});if(a.target){b.target=a.target}document.body.appendChild(b);Forms.add_vars(b,d);return b.submit()}};var HOTMAIL_SUFFIXES,Invitations,Referral;HOTMAIL_SUFFIXES=["hotmail.com","msn.com","hotmail.fr","hotmail.it","hotmail.de","hotmail.co.jp","hotmail.co.uk","hotmail.com.ar","hotmail.co.th","hotmail.com.tr","hotmail.es","msnhotmail.com","hotmail.jp","hotmail.se","hotmail.com.br","live.com.ar","live.com.au","live.at","live.be","live.ca","live.cl","live.cn","live.dk","live.fr","live.de","live.hk","live.ie","live.it","live.jp","live.co.kr","live.com.my","live.com.mx","live.nl","live.no","live.ru","live.com.sg","live.co.za","live.se","live.co.uk","live.com","windowslive.com"];Referral={select_all:1,show_login_modal:function(a){return Modal.show(_("Invite contacts from your email address book"),$("cli-login"),a||{})},get_selected_emails:function(){var a;a=[];$$("#contact-list input").each(function(b){if(b.checked){return a.push(b.value)}});return a.join(", ")},send_invites:function(a){var b;b=Referral.get_selected_emails();Invitations.do_send(b,false,a,true);return Modal.hide()},show_error:function(a){Referral.hide_captcha();$("contact-info-error").__date(a);return $("contact-info-error").show()},error_messages:[N_("Bad user name or password"),N_("Bad user name"),N_("Bad password"),N_("Captcha challenge was raised"),N_("Captcha challenge raised"),N_("Captcha challenge was issued. Please login through Yahoo mail manually."),N_("AOL requires you to answer some security questions"),N_("Email address has not been verified"),N_("Account closed by system operator"),N_("Account deleted"),N_("Account disabled"),N_("Service disabled"),N_("Authorization required"),N_("Unknown gmail error"),N_("Gmail terms not agreed"),N_("Google contacts service unavailable. Try again later.")],show_captcha:function(a){Referral.hide_captcha();a=a.evalJSON(true);$("captcha-row").hide();$("contact-info-captcha-image").src=a.image.replace("http://","https://");$("contact-info-captcha-image").hide();Element.observe("contact-info-captcha-image","load",function(){return $("contact-info-captcha-image").show()});$("contact-info-captcha-id").value=a.id;$("contact-info-captcha-answer").value="";$("captcha-row").show();$("captcha-answer-row").show();$("contact-info-error").__date(_("Captcha required"));return $("contact-info-error").show()},hide_captcha:function(){$("contact-info-captcha-id").value="";$("contact-info-captcha-answer").value="";$("captcha-row").hide();return $("captcha-answer-row").hide()},parse_contacts:function(a){return a.substr(9)},fetch_contacts:function(b){var c,a,d;Event.stop(b);d=$F("username");c="";if(d.indexOf("@")>0){a=d.split("@");d=a.first();c=a.last()}return Referral.fetch_and_show_contacts(b,d,c,$F("email-password"),$F("contact-info-captcha-id"),$F("contact-info-captcha-answer"))},fetch_and_show_contacts:function(d,f,h,k,a,j){var b,l,c,g;for(c=0,g=HOTMAIL_SUFFIXES.length;c<g;c++){l=HOTMAIL_SUFFIXES[c];if(h===l){Notify.server_error(_("We can't import contacts from "+h+" accounts right now, but we're working on fixing this!"));return}}if(d){Event.stop(d)}$("contact-info-error").hide();Referral.show_loading_modal(h.split(".")[0]);f=(h!==""?f+"@"+h:f);b={email:f,password:k,select_all:(Referral.select_all?1:0)};if(a&&j){Object.extend(b,{captcha_id:a,captcha_answer:j})}return new Ajax.DBRequest("/import_contacts",{noAutonotify:true,parameters:b,onSuccess:function(e){var m;m=Referral.parse_contacts(e.responseText);return Referral.show_select_contacts(m)},onFailure:function(m){var e;if(m.responseText.indexOf("err:")===0){e=m.responseText.substr(4);if(e.indexOf("captcha:")!==0){if(Referral.hide_on_error){Modal.hide()}else{Referral.show_login_modal()}return Referral.show_error(_(e))}else{if(Referral.hide_on_error){Modal.hide()}else{Referral.show_login_modal()}return Referral.show_captcha(e.substr(8))}}else{Referral.show_error(_("Unexpected server error."));if(Referral.hide_on_error){return Modal.hide()}else{return Referral.show_login_modal()}}},cleanUp:function(){return $("modal-title").show()}})},show_loading_modal:function(a){var b;b=["gmail","yahoo","aol","hotmail","live","msn"];if(b.indexOf(a)>-1){$("email-provider-img").src="/static/images/referrals_"+a+".png";$("email-provider-img").show()}else{$("email-provider-img").hide()}Modal.show("Loading contacts",$("loading-contacts-modal"),{},"");return $("modal-title").hide()},show_select_contacts:function(j){var d,g,k,h,a,l,f,b,e,c;if(j.length){$("contact-list").innerHTML=j;SuggestionInput.reset("contact-filter");k=$$("#contact-list img").length;if(k===0){$("dropbox-users-text").style.visibility="hidden"}g=$$(".contact-row").length;a=ungettext("Good news! We've found %d contact. Select the contact if you'd like to invite them.","Good news! We've found %d contacts. Select the contacts you'd like to invite.",g).format(g);$("contact-import-msg").__date(a);Referral.contact_container=document.getElementById("contact-list");Referral.contact_rows=Referral.contact_container.childNodes;c=Referral.contact_rows;for(b=0,e=c.length;b<e;b++){l=c[b];l.search_text=l.childNodes[1].firstChild.innerHTML+l.childNodes[2].firstChild.innerHTML;d=$(l.firstChild.firstChild);d.observe("click",Referral.checkbox_clicked)}Referral.fresh=true;Referral.update_invite_count()}h=(j.length?"select-contacts-modal":"no-contacts-modal");f=(j.length?_("Choose contacts"):_("Oops! No contacts here."));Modal.icon_show("email_32",f,$(h),{action:Referral.action},null);return Referral.filter_observer=new Form.Element.Observer("contact-filter",0.5,function(m,n){if(!SuggestionInput.defaulted(m)){return Referral.filter(n)}})},checkbox_clicked:function(a){Referral.fresh=false;return Referral.update_invite_count()},update_invite_count:function(b){var f,e,d,a,c;if(!b&&Referral.contact_rows){b=0;c=Referral.contact_rows;for(d=0,a=c.length;d<a;d++){e=c[d];if(e.firstChild.firstChild.checked){b+=1}}}f=ungettext("Invite %d friend","Invite %d friends",b).format(b);return $("select-contacts-modal").down("input[type=button]").setValue(f)},select_no_contacts:function(){$$(".contact-check input").each(function(a){return a.checked=false});Referral.update_invite_count(0);return false},filter:function(h){var g,f,b,c,e,a,d;if(h===Referral.last_search||(!(Referral.last_search!=null)&&h==="")){return}if(Referral.fresh){Referral.fresh=false;Referral.select_no_contacts()}Referral.last_search=h;b=0;g=new RegExp(RegExp.escape(h.strip()).split(/[;,\s]+/).join(".*"),"i");Referral.contact_container.style.display="none";d=Referral.contact_rows;for(e=0,a=d.length;e<a;e++){f=d[e];c=f.style;if(g.test(f.search_text)){if(b%2===0){c.background="#ffffff"}else{c.background="#f4faff"}c.display="";b+=1}else{c.display="none"}}Referral.update_invite_count();return Referral.contact_container.style.display=""},do_submit:function(a){assert(Referral.action&&typeof Referral.action==="function","Finished with contact list importer but have no callback");return Referral.action(a)},hide:function(b,a){b=$(b);assert(b,"Referral elm doesn't exist");assert(Util.isNumber(a),"Referral id is not a number");Modal.hide();return new Ajax.DBRequest("/account/hide_referral",{parameters:{referral_id:a},onSuccess:function(c){var d;d=b.up("tr");return new Effect.Fade(d)}})}};Invitations={submit:function(a){a=a||window.event;if(a.keyCode===Event.KEY_RETURN){return Invitations.send()}},send:function(b,a){var c;c=$("invite-recip");return Invitations.do_send($F(c),c,b,a)},do_send:function(c,e,b,a){var f,d;f=c.strip().split(/[;,\s]+/).length;if(!f||c===""){Notify.server_error(_("Please enter an e-mail address."));return}if(c!==$("invite-recip").title){d={emails:c,referral_src:b};if(Referral.source){d.source=Referral.source}new Ajax.DBRequest("/send_invite",{parameters:d,onSuccess:function(g){if(Invitations.custom_on_success){Invitations.custom_on_success(g.responseText,a)}else{Notify.server_success(g.responseText.substr(5))}if(Referral.on_success){Referral.on_success(g.responseText)}if(e){return e.setValue("")}},onFailure:function(g){if(g.responseText.startsWith("err:")){return Notify.server_error(g.responseText.substr(4))}else{return Notify.server_error()}},noAutonotify:true})}else{Notify.server_error(_("Please enter an email address."))}return false},addCustomMessage:function(b){var c,a;Event.stop(b);c=(b.target.tagName==="A"?$(b.target):$(b.target).up("a"));c.addHTML=c.innerHTML;c.update(Sprite.make("web","email_delete",{"class":"link-img"}));c.appendChild(document.createTextNode(_("Remove custom message")));c.stopObserving("click");c.observe("click",Invitations.hideCustomMessage);a=new Element("textarea",{title:_("Enter a custom message here"),name:"custom_message","class":"custom-message suggestion-input act_as_block textinput",rows:3,cols:25,style:"margin-top: 0.75em;"});a.setValue(Invitations.custom_message||a.title);SuggestionInput.register(a);c.up().previous("div").__sert({bottom:a});SuggestionInput.register(a);ActAsBlock.resize(a);return false},hideCustomMessage:function(b){var a,c;Event.stop(b);c=(b.target.tagName==="A"?$(b.target):$(b.target).up("a"));c.stopObserving("click");c.observe("click",Invitations.addCustomMessage);c.update(c.addHTML);a=c.up().up().select(".custom-message")[0];Invitations.custom_message=$F(a);a.parentNode.removeChild(a);return false}};var EventBubble,Feed;EventBubble={make:function(b){var a;a='<table class="ebubble">\n  <tr>\n    <td class="tl"></td>\n    <td class="t"></td>\n    <td class="tr"></td>\n  </tr>\n  <tr>\n    <td class="l"></td>\n    <td class="c">\n      <%= content %>\n    </td>\n    <td class="r"></td>\n  </tr>\n  <tr>\n    <td class="bl"></td>\n    <td class="b">\n      <img src="/static/images/events_bubble_tail.gif" alt="" class="events_bubble_tail" />\n    </td>\n    <td class="br"></td>\n  </tr>\n</table>';return HTML.tmpl(a,{content:b})}};Feed={firstTime:true,feedPages:{},page_num:0,ns_id:false,update_pages:function(a){(a&&Feed.page_num?Element.show:Element.hide)("newolddivider");(a?Element.show:Element.hide)("older-events");return(Feed.page_num?Element.show:Element.hide)("newer-events")},older:function(){return Feed.set_url({page_num:(parseInt(Feed.page_num,10)||0)+1})},newer:function(){if(!Feed.page_num){return}return Feed.set_url({page_num:parseInt(Feed.page_num,10)-1})},showLoading:function(h,a,g,f){var c,b,e,d;g=true;e=$("feed-loading");a=$(a);if(!e){e=new Element("div",{id:"feed-loading"});c=new HTML('<table style="height: 100%; width: 100%; background:#fff;">\n  <tr>\n  <td valign="top">\n    <div id="feed-loading-text" style="padding-top: 16px;text-align:center;"></div>\n  </td>\n  </tr>\n</table>');e.__date(c);document.body.appendChild(e)}e.clonePosition(a);if(e.getWidth()===0){return}if(Util.ie){e.style.left=a.getBoundingClientRect().left+"px"}e.setOpacity(0.9);b=$("feed-loading-text");if(h){b.__date()}else{d=new Element("img",{src:"/static/images/icons/ajax-loading.gif",style:"vertical-align: bottom;"});b.__date(d);if(!g){b.__sert(_("Loading..."))}}$("feed-loading").show();if(f){return e.style.zIndex="1001"}},hideLoading:function(){return $("feed-loading").hide()},changeDate:function(a,b){Feed.date=a;Feed.nice_date=Util.niceDate(a);if(!b){return Feed.getPage(0)}},getPage:function(a){var b;a=a||0;Feed.page_num=parseInt(a,10);if(Feed.feedPages[Feed.get_key(a)]){Feed.show(a)}else{Feed.showLoading(false,$("events-content"));b=Feed.ns_id!=null?"&ns_id="+(Feed.ns_id.toString()):"&is_home=yes";new Ajax.DBRequest("/next_events?cur_page="+a+b,{parameters:{date:Feed.nice_date?Feed.nice_date:""},log_timing:true,onSuccess:function(c){Feed.feedPages[Feed.get_key(a)]=new HTML(c.responseText);return Feed.show(a)}})}return false},show:function(a){var b;Feed.hideLoading();$("events-content").__date(Feed.feedPages[Feed.get_key(a)]);b=$("add-comment-button");if(b){return HotButton.register(b)}},url_check:function(b,c,a){var d;c=c||0;b=b||false;d=(Feed.ns_id!==b)||(Feed.page_num!==c)||(Feed.nice_date!==a);Feed.ns_id=b||Feed.ns_id;Feed.page_num=parseInt((c!=null?c:Feed.page_num),10);if(a){Feed.changeDate(new Date(a.gsub("-","/")),true)}if(d){ULSelectMenu.set_selected_by_value($("namespace-list"),Feed.ns_id);if(a){EventDatePicker.change_date(Feed.date)}return Feed.getPage(Feed.page_num)}},set_url:function(c){var b,a,d,e;a=(c.ns_id!=null?c.ns_id:Feed.ns_id);d=(c.page_num!=null?c.page_num:Feed.page_num);b=(c.date!=null?c.date:Feed.nice_date);e={ns:a,n:d,d:b};return DBHistory.push_state("/events",e)},get_key:function(a){return""+Feed.ns_id+"_"+Feed.date+"_"+a+"_"+Feed.nice_date},show_rss_modal:function(){var a,b;a=Feed.ns_id||Constants.root_ns;b=Feed.rss_url;Modal.icon_show("feed_32",_("Subscribe to this RSS feed"),$("rss-modal"));$("rss_url").setValue(b);BrowseActions.addCopyUrlFlash(b);$("copy_success").__date();$("reset-rss-link").writeAttribute("href","/reset_rss/"+a);return $("rss_url").select()}};var DBCalendar,EventDatePicker,TextInputDatePicker,Timezone;Timezone={check_timezone:function(){var a;if(!Constants.uid){return}a=Timezone.get_current_timezone();if(!(Constants.auto_timezone_offset!=null)||Constants.auto_timezone_offset!==a){return Timezone.update(a)}},get_current_timezone:function(){var d,c,a,b;c=new Date();c.setSeconds(0);c.setMilliseconds(0);b=c.toGMTString();d=new Date(b.substring(0,b.lastIndexOf(" ")-1));a=(c-d)/(1000*60*60);return a},update:function(a){assert(typeof a==="number","Timezone offset was not a number: "+a);return new Ajax.DBRequest("/set_timezone",{parameters:{offset:a},noAutonotify:true})},on_change:function(){var a,b;a=[];b=[$("timezone_area"),$("timezone_location"),$("timezone_city")];b.each(function(c){if(c){return a.push($F(c))}});return Timezone.update_form(a)},update_form:function(m){var h,a,n,c,e,j,d,l,b,g,f,k;m=m||["America"];assert(Timezone.tree,"Timezone tree missing...");$("tz").__date();a=["timezone_area","timezone_location","timezone_city"];e=Timezone.tree;b=Math.max(m.length+1,2);for(h=g=0;0<=b?g<b:g>b;h=0<=b?++g:--g){d=m[h];n=Object.keys(e);if(!n.length){break}l=new Element("select",{id:a[h],name:a[h]});l.observe("change",Timezone.on_change);for(f=0,k=n.length;f<k;f++){c=n[f];j=new Element("option");j.value=c;j.update(c);if(c===d){j.selected=true}l.appendChild(j)}$("tz").appendChild(l);e=e[d]}return Util.syncHeight()},auto:function(){var a;a=$F("timezone_auto");if(a){return $("tz").__date()}else{return Timezone.update_form()}},build_tree:function(b){var a;a={};b.each(function(e){var d,c;c=e.split("/");d=a;return c.each(function(f){if(!d[f]){d[f]={}}return d=d[f]})});return Timezone.tree=a}};document.observe("dom:loaded",Timezone.check_timezone);DBCalendar=Class.create({initialize:function(b,a){this.options=a||{};this.container=$(b);assert(this.container,"Couldn't find the element");this.today=new Date();if(this.options.disable_future){this.options.last_day=Util.start_of_day(this.options.last_day||this.today)}if(this.options.disable_past){this.options.first_day=Util.start_of_day(this.options.first_day||this.today)}this.view_date=Util.start_of_day(this.options.selected_date||this.today);this.selected_date=Util.start_of_day(this.options.selected_date||this.today);return this.render()},_change_month:function(b,a){Event.stop(b);this.view_date.setMonth(a);return this.render()},is_valid_date:function(d,f,e,c,a){var b;d=parseInt(d,10);f=parseInt(f,10);e=parseInt(e,10);c=parseInt(c,10);a=parseInt(a,10);c=c||1970;a=a||(new Date()).getFullYear()+1;f+=1;if(e<c){return false}if(e>a){return false}if(f<1||f>12){return false}if(d<=0){return false}if(f===2){b=((e%4)===0)&&(((e%100)!==0)||((e%400)===0));if(b){return d<=29}else{return d<=28}}else{if(f===4||f===6||f===9||f===11){return d<=30}else{return d<=31}}},change_date:function(a,d,b){var c;if(!this.is_valid_date(a,d,b)){return}c=b!==this.view_date.getFullYear()||d!==this.view_date.getMonth();this.selected_date.setDate(a);this.selected_date.setMonth(d);this.selected_date.setFullYear(b);if(c){this.view_date.setMonth(d);this.view_date.setFullYear(b);this.render()}else{this.container.select(".selected").invoke("removeClassName","selected");$$("a#day"+a+"-"+d)[0].addClassName("selected")}if(this.options.onDateChange){return this.options.onDateChange(this.selected_date)}},render:function(){var d,e,a,b,c;e=this.render_days();this._next_month=(function(f){return this._change_month(f,this.view_date.getMonth()+1)}).bind(this);this._prev_month=(function(f){return this._change_month(f,this.view_date.getMonth()-1)}).bind(this);b=new Element("a");b.addClassName("changemonth next");b.update(Sprite.make("web","arrowright",{}));Event.observe(b,"click",this._next_month);c=new Element("a");c.addClassName("changemonth prev");c.update(Sprite.make("web","arrowleft",{}));Event.observe(c,"click",this._prev_month);d=new Element("div");d.addClassName("calendar clearfix");a=new Element("h5");a.update(_("%(month)s %(year)s").format({month:Util.month_name(this.view_date.getMonth()),year:this.view_date.getFullYear()}));d.__sert(b);d.__sert(c);d.__sert(a);d.__sert(e);return this.container.__date(d)},render_days:function(){var h,g,a,f,b,e,d,c;g=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1);d=g.getDay();h=new Element("div");h.addClassName("days");for(a=c=d;d<=0?c<0:c>0;a=d<=0?++c:--c){e=new Date(g.getFullYear(),g.getMonth(),g.getDate());e.setDate(e.getDate()-a);h.__sert(this.render_day(e,true))}f=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1);while(f.getMonth()===this.view_date.getMonth()){h.__sert(this.render_day(f));f=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),f.getDate()+1)}b=new Date(this.view_date.getFullYear(),this.view_date.getMonth()+1,0);while(b.getDay()!==6){b=new Date(b.getFullYear(),b.getMonth(),b.getDate()+1);h.__sert(this.render_day(b,true))}return h},render_day:function(c,d){var b;if(this.options.last_day){d=d||c>this.options.last_day}if(this.options.first_day){d=d||c<this.options.first_day}b=void 0;if(d){b=new Element("span")}else{b=new Element("a")}b.update(c.getDate());b.addClassName("date");b.writeAttribute("id","day"+c.getDate()+"-"+c.getMonth());if(this.selected_date.getDate()===c.getDate()&&this.selected_date.getMonth()===c.getMonth()&&this.selected_date.getFullYear()===c.getFullYear()){b.addClassName("selected")}if(d){b.addClassName("inactive")}else{this._handler=(function(f){var a;a=f.target.identify().substr(3).split("-");return this.change_date(a[0],this.view_date.getMonth(),this.view_date.getFullYear())}).bind(this);Event.observe(b,"click",this._handler)}return b}});EventDatePicker={show_calendar:function(a){var b,c;if(EventDatePicker.shown){return}Event.extend(a).preventDefault();if(!EventDatePicker.calendar){b=new Element("div",{id:"cal_container"});b.observe("click",function(d){return d.preventDefault()});$(document.body).__sert(b);EventDatePicker.calendar=new DBCalendar("cal_container",{onDateChange:function(e){return EventDatePicker.change_date(e,0)},disable_future:true,first_day:EventDatePicker.first_event});b.absolutize();c=$("cal_date");b.clonePosition(c,{setWidth:false,setHeight:false,offsetTop:c.getHeight(),offsetLeft:c.getWidth()-b.down().getWidth()})}$("cal_container").show();$(document.body).observe("click",EventDatePicker.hide_calendar);return EventDatePicker.shown=true},hide_calendar:function(a){if($(a.target).up("#cal_date")){return}Event.stop(a);$("cal_container").hide();$(document.body).stopObserving("click",EventDatePicker.hide_calendar);return EventDatePicker.shown=false},change_date:function(a,b){var c;if(b!=null){Feed.page_num=0}c=$("cur_date_text");c.update(a.localize());return Feed.set_url({date:Util.niceDate(a)})}};TextInputDatePicker=Class.create({initialize:function(d,c){var e,b,a;this.options={include_seconds:true,choose_eod:false};Object.extend(this.options,c||{});this.input=$(d);assert(this.input,"Couldn't find the element "+d.toString());b=new Date();a=(this.input.value?Util.from_mysql_date(this.input.value):false);e=new Date(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate());this.cal_icon=Sprite.make("web","calendar_view_month",{align:"absmiddle"});this.cal_container=new Element("div",{id:"cal_container_"+d,style:"display: none; position: absolute; z-index: 1"});this.calendar=new DBCalendar(this.cal_container,{onDateChange:this.onDateChange.bind(this),last_day:e,selected_date:a});this.input.__sert({after:this.cal_icon});this.cal_icon.observe("click",this.toggle_cal.bindAsEventListener(this));this.cal_container.clonePosition(this.input,{setWidth:false,setHeight:false,offsetTop:this.input.getHeight()+10});return this.cal_icon.__sert({after:this.cal_container})},toggle_cal:function(a){if(a){Event.stop(a)}return this.cal_container.toggle()},hide_cal:function(a){if(a){Event.stop(a)}return this.cal_container.hide()},onDateChange:function(a){if(this.options.choose_eod){a.setTime(Util.start_of_day(a).getTime()+86399999)}this.input.value=Util.to_mysql_date(a,true);return this.hide_cal()}});var AppDirectory,AppReview,Apps;Apps={confirm_disable:function(d,c,b){var e,a;e=(b?_("Are you sure you want to disable '%(app-name)s'?"):_("Are you sure you want to delete '%(app-name)s'?"));DomUtil.fillVal(e.format({"app-name":d.escapeHTML()}),"app-disable-text");Modal.icon_show("application_delete_32",(b?_("Confirm disable"):_("Confirm delete")),$("app-disable-modal"));a="/developers/disable_app/"+c;$("app-disable-modal").down("form").action=a;return $("disable-app-button").setValue((b?_("Disable"):_("Delete")))},enable_app:function(b){var a;a="/developers/enable_app/"+b;return window.location.href=a},show_app_limit_reached:function(){return Modal.icon_show("application_add_32",_("Developer app limit reached"),$("app-limit-modal"))},show_create:function(){Modal.icon_show("application_add_32",_("Create a new app"),$("create-app"),{});return ActAsBlock.register(false,$("modal-content"))},do_create:function(b){var a;if(b){Event.stop(b)}a=$("create-app-form");assert(a,"Missing form for Apps.do_create");return Forms.ajax_submit(a,false,(function(c){if(c&&c.responseText&&c.responseText!=="ok"){return window.location.href=c.responseText}else{return window.location.reload()}}),false,b&&b.target)},do_edit:function(b){var a;if(b){Event.stop(b)}a=$("update-app-form");assert(a,"Missing form for Apps.do_edit");return Forms.ajax_submit(a,false,(function(){return window.location.reload()}),false,b&&b.target)},show_about:function(g,f,d,a,c,b){if(g){Event.stop(g)}$$(".app-name")[0].__date(f);$$(".app-description")[0].__date(d);Modal.show(f,$("about-app"),{"force-icon":c});return $("application-link").href=b},show_uninstall:function(f,d,c,a,b){var g;if(f){Event.stop(f)}Modal.vars={token_id:c,delete_row_type:"inst-app",action:"uninstall_app"};g=$("delete-"+a+"-app-confirm");if(b){g.select(".app_folder")[0].__date(b)}else{if(a==="sandbox"){return Apps.do_action()}}g.select(".app_name")[0].__date(d);Modal.icon_show("application_delete_32",_("Remove %(app_name)s?").format({app_name:d.em_snippet(22)}),g,Modal.vars);return null},do_uninstall:function(){new Ajax.DBRequest("/api/uninstall_app",{parameters:{id:Modal.vars.token_id,keep_sandbox_files:$F("keep_sandbox_files")},onSuccess:function(a){Notify.server_success(a.responseText);$("inst-app-"+Modal.vars.token_id+"-row").hide().removeClassName("active_app");if($$(".active_app").length===0){$("applications-table-container").__date(_("You're not using any Dropbox API apps."));return $("applications-explanation").remove()}}});return Modal.hide()},do_action:function(){return new Ajax.DBRequest("/api/"+Modal.vars.action,{parameters:{id:Modal.vars.token_id},onSuccess:function(a){Notify.server_success(a.responseText);if(Modal.vars.delete_row_type){return $(Modal.vars.delete_row_type+"-"+Modal.vars.token_id.toString()+"-row").hide()}else{return window.location.reload()}}})},enable_users_in_dev:function(a){Modal.icon_show("teams",_("Enable additional users"),$("confirm-users-in-dev-modal"),{enable:function(){return new Ajax.DBRequest("/developers/enable_users_in_dev/"+a,{onSuccess:function(b){$("enable-users-in-dev").remove();$("none-linked").show();return Modal.hide()}})}});return false},remove_user:function(c,b,a){new Ajax.DBRequest("/developers/remove_user/"+c+"/"+b,{onSuccess:function(e){var d;d=$(a).up("table");$(a).up("tr").remove();if(d.down("tr").id==="none-linked"){$("none-linked").show();return $("apply-for-more").hide()}}});return false},show_add_key_confirm:function(c,b,a){if(c){Event.stop(c)}$$(".app-name")[0].__date(b);Modal.show(_("Confirm key creation"),$("add-key-confirm"),{app_id:a});return 0},do_add_key:function(a){return new Ajax.DBRequest("/api/create_app_token",{parameters:{id:Modal.vars.app_id},onSuccess:function(b){var c,d;Notify.server_success(_("Key created successfully."));d="<tr id=\"token-#{id}-row\"><td>#{key}</td><td>#{secret}</td><td><a href=\"#\" onclick=\"Apps.show_del_key_confirm(event, '#{key}', '#{secret}', '#{id}');\">"+Sprite.html("web","x")+"</a></td></tr>";c=b.responseText.evalJSON(true);c.id=Number(c.id);c.key=c.key.replace("'","");c.secret=c.secret.replace("'","");d=d.interpolate(c);return $("api-key-last-row").insert({before:d})}})},show_del_key_confirm:function(d,b,a,c){if(d){Event.stop(d)}$$(".token-key")[0].__date(b);$$(".token-secret")[0].__date(a);Modal.show(_("Confirm key removal"),$("del-key-confirm"),{token_id:c});return 0},do_del_key:function(a){return new Ajax.DBRequest("/api/delete_app_token",{parameters:{id:Modal.vars.token_id},onSuccess:function(c){var b;Notify.server_success(_("Key removed successfully."));b=c.responseText.evalJSON(true);return $("token-"+b.id+"-row").hide()}})},restore_sandbox:function(b,a){var d,c;d=$("restore-sandbox");Modal.icon_show("folder_app_32",_("Restore app folder '%(filename)s'").format({filename:FileOps.filename(b).em_snippet(17)}),d);c=$("restore-sandbox-form");return Forms.add_vars(c,{ns_id:a})},submit_restore_sandbox:function(b){var a;Event.stop(b);a=$("restore-sandbox-form");Forms.ajax_submit(a,false,(function(c){Modal.hide();Notify.server_success(_("Restored app folder"));if(c.responseText.length){return Browse.reload_fqpath(c.responseText)}else{return Browse.reload("","",true)}}),false,b.target);return false},developer_support:function(){var a;a=$("dev-support-modal");return Modal.icon_show("alert_32",_("Dropbox developer support"),a)},submit_developer_support:function(b){var a;a=$("dev-support-form");assert(a,"Form is missing in submit_developer_support");return Forms.ajax_submit(a,false,(function(){Modal.hide();return Notify.server_success(_("Thanks for your help request.  We'll get back to you soon."))}),false,b&&b.target)},submit_app_info:function(c,a){var b;try{b=$("update-app-form");return Forms.ajax_submit(b,"/developers/app_info/%s".format(a),(function(d){return b.submit()}),false,c&&c.target)}finally{return false}},delete_screenshot:function(a,b,c){return new Ajax.DBRequest("/developers/delete_screenshot/%s".format(b),{parameters:{screenshot_id:c},onSuccess:function(d){return Effect.Fade(a)}})},add_screenshot_form:function(){var a;a=new Element("input",{type:"file",name:"screenshots"});return $("screenshots-container").appendChild(a)},show_need_users_modal:function(a){Event.stop(a);Modal.icon_show("alert_32",_("Please test this app"),$("app-need-users-modal"));return false},show_name_branding_modal:function(a){Event.stop(a);Modal.icon_show("alert_32",_("Please rename this app"),$("app-name-branding-modal"));return false}};AppDirectory={click:function(a){a=Object.toQueryString(a);AppDirectory.get_page(a);return HashRouter._set_hash(a)},get_page:function(a){Feed.showLoading(true,"list-content");return new Ajax.Request("/apps/list?"+a,{onSuccess:function(b){return $("list-content").update(b.responseText)},onComplete:function(){return Feed.hideLoading()}})},hash_change:function(b){var a;a=b.memo.hash;return AppDirectory.get_page(a)},platform_change:function(){var b,a;b=Object.clone(AppDirectory.filter_state);a=[];$$(".platform input").each(function(c){if(c.checked){return a.push(c.value)}});b.page=0;b.platform=a.join(",");return AppDirectory.click(b)},set_order:function(a){var b;b=Object.clone(AppDirectory.filter_state);b.order_by=a;b.page=0;return AppDirectory.click(b)},set_page:function(a){var b;b=Object.clone(AppDirectory.filter_state);b.page=a;return AppDirectory.click(b)}};AppReview={page:0,get_page:function(a,b){Feed.showLoading(true,$("reviews").down("div"));return new Ajax.Request("/apps/reviews",{parameters:{page:b,app_id:a},onSuccess:function(c){AppReview.update(c.responseText);AppReview.page=parseInt(b,10);HashRouter.set_hash("review",a,b.toString());return $("reviews").scrollTo()},onComplete:function(){return Feed.hideLoading()}})},update:function(a){return $("reviews").update(a)},check_hash:function(a,b){b=b||0;b=parseInt(b,10);if(b!==AppReview.page){return AppReview.get_page(a,b)}},add_review:function(c,a){var b;Event.stop(c);b=$("app-review-form");return Forms.ajax_submit(b,false,(function(d){AppReview.get_page(a,0);return b.down("textarea").setValue("")}),false,c.target)}};var FacebookOAuth,Twitter;Twitter={get_progress_container:function(){var a;assert(Twitter.progress_container,"Twitter is missing progress_container");a=$(Twitter.progress_container);assert(a,"Missing progress_container elm");return a},follow_dropbox:function(a){var b;if(a.showWorking){a.showWorking()}b=function(){if(a.onFailure){return a.onFailure()}else{return window.location.reload()}};return new Ajax.DBRequest("/twitter/follow_us",{onSuccess:function(c){if(!c.responseText.startsWith("ok")){return b()}else{if(a.onSuccess){return a.onSuccess()}}},onFailure:function(){return b()}})},do_auth:function(a){window.open("/twitter/request_token","twitter_auth","width=800,height=400");if(a){return Twitter.onLoginSuccessCallback=a}},show_login:function(a){if(a){Twitter.onLoginSuccessCallback=a}return DomUtil.updateFromElm(Twitter.get_progress_container(),"inline-twitter-auth")},show_posting:function(){Modal.hide();return Twitter.get_progress_container().update(DomUtil.fromElm("sharing-progress"))},show_complete:function(b){var a;a=Twitter.get_progress_container();return Twitter.show_complete_into(b,a)},show_complete_into:function(g,a){var d,e,c,f,b;a.update(DomUtil.fromElm("sharing-posted"));d="twitter";f=_("View tweet");b=void 0;if(g.startsWith("ok")){b="http://www.twitter.com/"}else{b=g}e=a.down("#view-post");e.href=b;e.update(f);c=Sprite.make("web",d);return e.__sert({top:c})},post:function(c,e,b){var d,a;assert(c,"Twitter message is empty");d={message:c,from_referrals:Twitter.from_referrals,from_getspace:Twitter.from_getspace};new Ajax.DBRequest("/twitter_post",{parameters:d,onSuccess:function(f){var g,h;if(f.responseText==="login"){Twitter.onLoginSuccessCallback=function(){return Twitter.post(c)};g=Twitter.custom_show_auth||Twitter.show_login;return g()}else{Modal.hide();h=Twitter.onPostSuccessCallback||Twitter.show_complete;return h(f.responseText)}}});a=Twitter.custom_show_posting||Twitter.show_posting;return a()},custom_post:function(a,b){if(b){Twitter.onPostSuccessCallback=b}if(!a){return}assert(a,"Twitter message doesn't exist");if(!Constants.uid){return window.open("http://www.twitter.com/home?status="+encodeURI(a))}else{return Twitter.post(a)}},get_user_info:function(a){return new Ajax.DBRequest("/twitter/user_info",{parameters:{},onSuccess:function(b){return a(Util.from_json(b.responseText))}})}};FacebookOAuth={get_progress_container:function(){var a;assert(FacebookOAuth.progress_container,"Facebook is missing progress_container");a=$(FacebookOAuth.progress_container);assert(a,"Missing progress_container elm");return a},do_auth:function(a){window.open("/fb/access_token","fb_auth","width=600,height=450");if(a){return FacebookOAuth.onLoginSuccessCallback=a}},show_posting:function(){Modal.hide();return FacebookOAuth.get_progress_container().update(DomUtil.fromElm("sharing-progress"))},show_auth:function(a){if(a){FacebookOAuth.onLoginSuccessCallback=a}return DomUtil.updateFromElm(FacebookOAuth.get_progress_container(),"inline-facebook-auth")},show_complete:function(){var a,d,e,c,f,b;a=FacebookOAuth.get_progress_container();a.update(DomUtil.fromElm("sharing-posted"));d="facebook";f="View Post";b="http://www.facebook.com/profile.php?v=wall";e=a.down("#view-post");e.href=b;e.update(f);c=Sprite.make("web",d);return e.__sert({top:c})},post:function(e,d,c,b,f){var a;if(!Constants.uid){window.open("http://www.facebook.com/sharer.php?u="+encodeURI(d)+"&t="+encodeURI(c));return}a=FacebookOAuth.custom_show_posting||FacebookOAuth.show_posting;a();return new Ajax.DBRequest("/fb/post",{parameters:{message:e,link:d,link_name:c,description:b,from_referrals:FacebookOAuth.from_referrals,from_getspace:FacebookOAuth.from_getspace,picture:(f?f:"")},onSuccess:function(g){var h,j;if(g.responseText.startsWith("ok")){j=FacebookOAuth.custom_show_complete||FacebookOAuth.show_complete;return j()}else{h=FacebookOAuth.custom_show_auth||FacebookOAuth.show_auth;h();return FacebookOAuth.onLoginSuccessCallback=function(){return FacebookOAuth.post(e,d,c,b)}}}})}};var FilePreview,FilePreviewModal,JWPlayerError,PhotoPreview,VideoPreview,fp_vid_player,fp_vid_player_error,fp_vid_player_loading,fp_vid_thumbnail_hidden,playerReady,player_error_handler,render_video_error;FilePreview=Class.create({initialize:function(a,d,c,b,e){this.fq_path=d;this.filename=a;this.thumbnail_url_tmpl=c;this.dl_url=b;return this.display_time=e||null},preload:function(){},render:function(){},activate:function(){},image_size:function(){var a;a=document.viewport.getDimensions();return Util.dimensions_to_imagesize(a.width,a.height)},actions:function(){return[]},global_actions:function(c){var e,d,b,f,a;b=this.actions();d=new Element("a",{id:"lightbox_download_link",href:this.dl_url,"class":"title_bubble white",title:_("Download")});d.__date(Sprite.make("web","download_arrow_white"));e=new Element("a",{href:"#",id:"lightbox_delete_link","class":"title_bubble white",title:_("Delete")}).__date(Sprite.make("web","white-trash"));e.observe("click",function(g){g.preventDefault();return FilePreviewModal.toggle_delete()});if(Constants.can_shmodel){f=new Element("a",{id:"lightbox_shmodel_link","class":"title_bubble white"});if(this instanceof PhotoPreview){f.writeAttribute("title",_("Get link to photo"))}else{if(this instanceof VideoPreview){f.writeAttribute("title",_("Get link to video"))}else{assert(false,"preview needs to be a photo or video")}}f.__date(Sprite.make("web","link_white"));if(this.shmodel_link){f.writeAttribute("href",this.shmodel_link)}else{f.writeAttribute("href","#");a=(function(g){g.preventDefault();return Forms.postRequest("/sm/create"+Util.urlquote(this.fq_path),{},{target:"_blank"})}).bind(this);f.observe("click",a)}b=b.concat([f,d])}else{b=b.concat([d])}if(c.include_delete){b.push(e)}return b}});PhotoPreview=Class.create(FilePreview,{initialize:function($super,a,e,c,b,d,f,g){$super(a,e,c,b,f);this.original_url=d;this.fail_image_src="/static/images/preview_fail.png";this.shmodel_link=g;if(this.is_gif()){return this.thumbnail_url_tmpl=d}},show_fail:function(b){var a;a=new Element("div").__sert(_("Unable to preview this item."));return b.__sert(a)},fallback:function(b){var a,c;a=$(b.target);a.writeAttribute({src:this.fail_image_src,width:128,height:128});c=a.up("div.content-item");if(c){return this.show_fail(c)}},is_gif:function(){return"gif"===FileOps.file_extension(this.filename).toLowerCase()},preload:function(){var b,a;a=Util.add_qstring(this.thumbnail_url_tmpl,{size:this.image_size()});if(this.is_gif()){a=this.thumbnail_url_tmpl}Util.preload_image(a,this.fallback.bind(this));b=$(Util.preloaded_images[a]);b.writeAttribute("class","thumbnail");return b},render:function(){var b,c,a,d;b=this.preload();d=new Element("div").__sert(b);c=b.getAttribute("src").length;a=b.getAttribute("src").substring(c-this.fail_image_src.length,c);if(a===this.fail_image_src){this.show_fail(d)}return d},actions:function(b){var a;a=new Element("a",{id:"view_original",href:this.original_url,"class":"title_bubble white",title:_("View original"),target:"_blank"});a.__date(Sprite.make("web","fullscreen"));return[a]},advance_on_click:true});fp_vid_player=null;fp_vid_player_loading=null;fp_vid_player_error=null;fp_vid_thumbnail_hidden=null;render_video_error=function(b,d){var a,c;b.down("div.video-player").remove();a=new Element("img",{src:"/static/images/preview_fail.png","class":"video-preview-fail"});c=new Element("div",{"class":"video-preview-fail"});if(d==="no_flash"){c.__sert(_("Please enable Flash to preview this video."))}else{c.__sert(_("Unable to preview this item."))}if(!fp_vid_thumbnail_hidden){a.hide();c.hide()}b.__sert(a);return b.__sert(c)};JWPlayerError="db:jwplayer:error";player_error_handler=function(b){var a;document.fire(JWPlayerError,b);fp_vid_player_error=true;a=fp_vid_player.up("div.content-item");if(a){fp_vid_player=null;return render_video_error(a,b.message)}};playerReady=function(a){fp_vid_player_loading=null;fp_vid_player=document.getElementById(a.id);fp_vid_player.addModelListener("error","player_error_handler");fp_vid_player.sendEvent("play","true");return fp_vid_player.sendEvent("play","false")};VideoPreview=Class.create(FilePreview,{initialize:function($super,a,e,d,b,c,f,g){$super(a,e,d,c,f);this.preview_url=b;this.thumbnail_div=null;return this.shmodel_link=g},preload:function(){var f,b,e,c,a,d;if(this.preloaded){return}a=Util.add_qstring(this.thumbnail_url_tmpl,{size:this.image_size()});f=function(g){return $(g.target).writeAttribute("src",Sprite.SPACER)};Util.preload_image(a,f);b=$(Util.preloaded_images[a]);b.writeAttribute("class","thumbnail");c=new Element("img");c.writeAttribute("src","/static/images/playbutton2.png");c.setStyle({position:"absolute",top:"50%",left:"50%",marginTop:"-58px",marginLeft:"-58px"});e=new Element("img",{"class":"video-player-loading"});e.writeAttribute("src","/static/images/bigspinner.gif");e.setStyle({position:"absolute",top:"50%",left:"50%",marginTop:"-16px",marginLeft:"-16px",display:"none"});d=new Element("div",{"class":"video_thumbnail"});d.__sert(c);d.__sert(e);d.__sert(b);this.thumbnail_div=d;return this.preloaded=true},render:function(){var d,b,c,a;this.preload();fp_vid_player_loading=true;fp_vid_player_error=null;fp_vid_thumbnail_hidden=false;this.rendered_div=null;a=new Element("div",{"class":"video-player"});c=this.image_size().split("x")[0]*0.8;b=false;if(FlashDetect.installed){Util.embed_flash_video.defer(this.preview_url,a,c,0)}else{b=true}a.setStyle({position:"absolute",left:"-5000px"});d=new Element("div");d.__sert(this.thumbnail_div);d.__sert(a);this.rendered_div=d;if(b){fp_vid_player_loading=false;fp_vid_player_error=true;render_video_error(d,"no_flash")}this.preloaded=false;return d},play_video:function(){if(fp_vid_player_loading||!this.rendered_div){if(this.rendered_div){this.thumbnail_div.down("img.video-player-loading").show()}return setTimeout(this.play_video.bind(this),100)}else{if(!fp_vid_thumbnail_hidden){this.thumbnail_div.remove();fp_vid_thumbnail_hidden=true;if(fp_vid_player_error){this.rendered_div.down("img.video-preview-fail").show();return this.rendered_div.down("div.video-preview-fail").show()}else{this.rendered_div.down("div.video-player").setStyle({position:"absolute",top:"50%",left:"50%",marginTop:-fp_vid_player.getHeight()/2+"px",marginLeft:-fp_vid_player.getWidth()/2+"px"});fp_vid_player.sendEvent("play","true");return $(fp_vid_player).observe("click",function(a){return Event.stop(a)})}}}},show_or_play_pause:function(){if(fp_vid_thumbnail_hidden){if(fp_vid_player){return fp_vid_player.sendEvent("play")}}else{return this.play_video()}},activate:function(){return this.show_or_play_pause()}});FilePreviewModal=(function(){var J,t,B,D,v,r,G,g,o,m,f,j,d,x,c,E,q,C,A,l,z,I,b,h,n,e,y,w,u,H,k,a,p,s,F;B=[];J=0;D=false;a=void 0;r="lightbox";G=/^\d+\-\d+\-\d+\s+\d+\.\d+\.\d+/;v=false;z=void 0;d=void 0;q=function(K){return K.complete!==false};H=function(){var K;if($$("#file-preview-modal .loading-image").length){return}K=new Element("img",{"class":"loading-image",src:"/static/images/icons/ajax-loader-black.gif"});return $$("#file-preview-modal .preview-content").first().__sert(K)};c=function(){return $$("#file-preview-modal .loading-image").invoke("remove")};n=function(){var P,O,M,K,N,L;O=$$("#file-preview-modal .content-item").first().down("img.thumbnail");if(!O||!q(O)){return}K=$$("#file-preview-modal .preview").first().getDimensions();P=void 0;if(!O.naturalHeight){P=O.getDimensions();O.naturalHeight=P.height;O.naturalWidth=P.width}else{P={width:O.naturalWidth,height:O.naturalHeight}}M=P.width/K.width;L=P.height/K.height;N=Math.max(M,L);O.style.visibility="";if(N<1){O.style.width="";return O.style.height=""}else{O.style.width=Math.floor(P.width/N)+"px";return O.style.height=Math.floor(P.height/N)+"px"}};g=void 0;j=void 0;A=function(){var M,L,K,O,N;L=0;M=1.5;K=$("file-preview-modal");N=K.down(".menu");O=K.down(".header");return g=new Effect.Parallel([new Effect.Opacity(N,{sync:true,to:L}),new Effect.Opacity(O,{sync:true,to:L})],{duration:M})};k=function(){var K;if(j){clearTimeout(j)}if(g){g.cancel()}K=$("file-preview-modal");K.down(".header").setOpacity(1);return K.down(".menu").setOpacity(1)};e=function(L){var K;k();K=L&&$(L.target).descendantOf("file-preview-menu");if(!v&&!K){return j=setTimeout(A,3112)}};E=function(L){var K;K=B.length;return(K+(J+L)%K)%K};I=function(K){if(z.no_preload){return}return B[K].preload()};b=function(){var N,M,P,L,O,K;M=[1,-1,2,-2,3,-3,4,-4];N=0;O=[1,-1,2,-2,3,-3,4,-4];K=[];for(P=0,L=O.length;P<L;P++){M=O[P];if(Math.abs(M)<B.length){K.push(I(E(M)))}else{K.push(void 0)}}return K};u=function(){TitleBubble.hide_all();$$("#file-preview-modal .delete-file-prompt").first().show();$("lightbox-delete-photo").focus();k();return v=true};x=function(){if(v){$$("#file-preview-modal .delete-file-prompt").first().hide();e();v=false;return document.activeElement.blur()}};p=function(){return(v?x:u)()};y=function(K){if(!z.filename_in_url){return}if(K!=null){return HashRouter.replace_hash("f",K)}else{return HashRouter.replace_hash("")}};w=function(){var N,P,K,L,M,O;UserActivityLogger.log("web","file_view",Object.toJSON({mode:"lightbox"}));fp_vid_player=null;assert(J<B.length,"Invalid index "+J);M=B[J];P=M.render();P.addClassName("content-item");L=$("file-preview-modal");O=L.down(".preview-content");O.__date(P);y(M.filename);L.down(".current_index").__date(J+1);L.down(".total").__date(z.num_previews||B.length);if(M.display_time){if(M.filename.match(G)){L.down(".filename").__date(M.display_time)}else{L.down(".filename").__date(M.filename.snippet(20)+" - "+M.display_time)}}else{L.down(".filename").__date(M.filename.snippet(40))}L.down(".filename").writeAttribute("title",M.filename);if(B.length===1){L.down(".prev").hide();L.down(".next").hide()}else{if(J===0&&z.no_wrap){L.down(".prev").hide();L.down(".next").show()}else{if(J===B.length-1&&z.no_wrap){L.down(".prev").show();L.down(".next").hide()}else{L.down(".prev").show();L.down(".next").show()}}}N=M.global_actions(z);K=document.createDocumentFragment();N.each(function(Q){return K.appendChild(Q)});L.down(".actions").__date();L.down(".actions").appendChild(K);b();document.fire(FilePreviewModal.ACTIONS_ADDED);P=P.down("img.thumbnail");if(!q(P)){P.hide();H();P.observe("load",function(){c();P.style.visibility="hidden";P.show();return n()})}else{P.show();n()}return document.fire(FilePreviewModal.PHOTO_CHANGE_EVT,M)};l=function(K){if(K){K.stop()}if(J===B.length-1&&z.no_wrap){return}J=E(1);if(J===0){e()}return w()};h=function(K){if(K){K.stop()}if(J===0&&z.no_wrap){return}J=E(-1);return w()};m=function(K){if(K){K.stop()}if(v){return x()}else{if(B[J].advance_on_click){return l()}else{return B[J].activate()}}};f=function(Q){var N,M,P,R,O,L,K;N=B.dict_by("fq_path");R=void 0;if(Q.memo.files){R=Q.memo.files.collect(function(S){return S.fq_path})}else{R=Q.memo.fq_paths}K=[];for(O=0,L=R.length;O<L;O++){P=R[O];if(N[P]){M=B.indexOf(N[P]);B.splice(M,1);if(z.num_previews){z.num_previews--}if(!z.num_previews&&!B.length){K.push(d())}else{if(M===B.length){K.push(h())}else{K.push(w())}}}else{K.push(void 0)}}return K};s=function(){Event.stopObserving(document,"mousemove",e);Event.stopObserving(document,"click",e);document.stopObserving(FileEvents.DELETE,f);return clearInterval(a)};d=function(L){var K;if(L){L.preventDefault()}if(!FilePreviewModal.shown){return}K=$("file-preview-modal");K.hide();if(fp_vid_player&&fp_vid_player.sendEvent){fp_vid_player.sendEvent("stop")}K.down(".preview-content").__date();document.body.removeClassName("full_no_overflow");s();y();FilePreviewModal.shown=0;if(FilePreviewModal.reload){return Browse.force_reload()}};t="db:filepreview:exitselect";o=function(K){if(z.keep_url){d()}else{window.history.go(-1)}Event.extend(K).stop();return document.fire(t,B[J])};C=function(){var K;if(!D){K=$("file-preview-modal");K.on("click",".next",l);K.on("click",".prev",h);K.on("click",".close",o);K.on("click",".preview-container",m);key("esc",r,function(L){return(v?x:o)(L)});key("left, k",r,function(L){return h()});key("right, j",r,function(L){l();return false});key("up, down",r,function(L){return false});key("space",r,function(L){m(L);return false});if(z.include_delete){key("delete, command+backspace, backspace",r,function(L){Event.extend(L).preventDefault();return FilePreviewModal.toggle_delete()})}$("lightbox-delete-photo").observe("click",function(L){return document.fire(FilePreviewModal.PHOTO_DELETE_EVT,B[J])});$("lightbox-delete-cancel").observe("click",function(){return x()});DBHistory.add_exit_callback("/lightbox",function(){return d()});Util.disableSelection(K.down(".preview-container"));Util.disableSelection(K.down(".header"));document.observe(FilePreviewModal.PHOTO_CHANGE_EVT,x);D=true}Event.observe(document,"mousemove",e);Event.observe(document,"click",e);document.observe(FileEvents.DELETE,f);key.setScope(r);return a=setInterval(n,500)};F=function(){return document.observe("dom:loaded",function(){return HashRouter.watch("f",function(K){var N,O,Q,P,M,L;N=decodeURIComponent(K);L=[];for(O=P=0,M=B.length;P<M;O=++P){Q=B[O];if(Q.filename.toLowerCase()===N.toLowerCase()){J=O;if(!FilePreviewModal.shown){L.push(FilePreviewModal.show())}else{L.push(w())}}else{L.push(void 0)}}return L})})};return{init:function(K,L){if(FilePreviewModal.shown){return}L=L||{};z={include_delete:L.include_delete||false,keep_url:L.keep_url||false,num_previews:L.num_previews||null,filename_in_url:L.filename_in_url||false,no_wrap:L.no_wrap||false,no_preload:L.no_preload||false};assert(!z.filename_in_url||z.keep_url,"filename_in_url cannot be used with keep_url off");B=K;if(L.start_index!=null){FilePreviewModal.show(L.start_index)}if(z.filename_in_url){return F()}},show:function(K){var L;if(FilePreviewModal.shown){return}assert(B&&B.length,"FilePreviewModal.show() requires file preview objects to show");C();if(K!=null){J=K}assert(!FilePreviewModal.shown,"Trying to reshow file preview modal");$("file-preview-modal").show();$(document.body).addClassName("full_no_overflow");w();FilePreviewModal.shown=1;if(!z.keep_url){L=DBHistory.deconstruct_url(DBHistory.get_url());DBHistory.push_state("/lightbox"+L.path,L.qargs)}return e()},jump_to:function(K){assert(FilePreviewModal.shown,"Lightbox should be showing");J=K;w();return e()},set_no_wrap:function(K){return z.no_wrap=K},toggle_delete:p,PHOTO_CHANGE_EVT:"db:lightbox:photo_change",PHOTO_DELETE_EVT:"db:lightbox:photo_delete",ACTIONS_ADDED:"db:lightbox:actions_added",EXIT_SELECT_EVT:t,reload:false}})();var Tour;Tour=(function(){var d,c,f,g,l,j,k,h,e,m,b,a;c=6;d=0;b=function(n){var w,v,u,p,o,q,s,t,r;$$(".page-end").each(Element.remove);o=n;s=c-n-1;w=document.createDocumentFragment();for(v=t=0;0<=o?t<o:t>o;v=0<=o?++t:--t){p=new Element("img",{src:"/static/images/page-left.png","class":"page-end-left page-end"});p.style.left=(28-v*5)+"px";p.style.zIndex=c-v;w.appendChild(p)}for(u=r=0;0<=s?r<s:r>s;u=0<=s?++r:--r){q=new Element("img",{src:"/static/images/page-right.png","class":"page-end-right page-end"});q.style.right=(31-u*5)+"px";q.style.zIndex=c-u;w.appendChild(q)}return $("book").appendChild(w)};a=function(n){(n>0?Element.show:Element.hide)("tour-page-back");return(n+1<c?Element.show:Element.hide)("tour-page-forward")};e=function(n){$$(".pages").invoke("hide");return $("page-"+n).show()};f=function(n){a(n);b(n);e(n);return d=n};h=function(o){var n;Event.extend(o).preventDefault();n=d-1;if(n<0){return}f(n);return DBHistory.push_state("/tour/"+n)};j=function(o){var n;Event.extend(o).preventDefault();n=d+1;if(n>=c){return}f(n);return DBHistory.push_state("/tour/"+n)};m=function(o,p){var n;o.preventDefault();n=parseInt(p.href.split("/").last(),10);f(n);return DBHistory.push_state("/tour/"+n)};l=function(){$("tour-page-back").observe("click",h);$("tour-page-forward").observe("click",j);key("right",j);key("left",h);return $("toc").on("click","a",m)};g=function(o,p){var n;n=parseInt(o,10)||0;return f(n)};k=function(){var r,q,o,p,n;p=$$(".page-right img");n=[];for(q=0,o=p.length;q<o;q++){r=p[q];n.push(Util.preload_image(r.src))}return n};return{setup:function(n){return document.observe("dom:loaded",function(){if(n){c=7}DBHistory.add_callback("/tour",g);l();return k()})}}})();Event.observe(window,"load",function(){var b,a;b=$("footer");if(b){a=(b.getStyle("display")==="none")||(b.getWidth()<900);if(!a){return assert(false,"HTML Broken on "+window.location.pathname)}}});window.LoadedJsSuccessfully=true;var Photos,PhotosSelection;Photos={SIZE_Q:"?size=cu_154",THUMBS_PER_ROW:5,SCROLL_OFFSET:2000,LIGHTBOX_OFFSET:30,POST_SCROLL_WAIT:100,POST_SCROLL_MAX_WAIT:300,DUPLICATES_SNIPPET_LENGTH:30,PHOTO_FILTER:"photos",VIDEO_FILTER:"videos",LOADING_SPINNER:new HTML('<div id="cu-loading"><img src="/static/images/icons/ajax-loading-small.gif" /></div>'),THUMBS_BATCH_SIZE:10,MAX_URL_LENGTH:2000,_photos:[],_key_to_photos:{},_preview_objs:[],_num_total:null,_selected_index:-1,_cursor:null,_current_filter:null,_last_scroll_timeout:null,_start_scroll_time:-1,_prev_date:null,_getting_more:false,_tmpl:null,_cu_duplicate_tmpl:null,_flow:false,_more_endpoint:"",_count_endpoint:"",_batch_thumb_endpoints:[],_batch_thumb_endpoint_index:0,_photo_grid:{},init:function(g,c,f,d,b,e,a){if(e){Photos._more_endpoint="/more_pm";Photos._count_endpoint="/pm_count"}else{Photos._more_endpoint="/more_cu";Photos._count_endpoint="/cu_count"}Photos._batch_thumb_endpoints=a;Photos._flow=b;if(b){Photos.SIZE_Q="?size=l"}return document.observe("dom:loaded",function(){Photos._tmpl=HTML.tmpl("cu_list_item_tmpl");Photos._cu_duplicate_tmpl=HTML.tmpl("cu_duplicate_list_item_tmpl");if(c){Photos._cursor=f}else{Photos._cursor=null}if(d===Photos.PHOTO_FILTER||d===Photos.VIDEO_FILTER){Photos._set_filter(d)}if(!HTML5_HISTORY&&!Util.url_hash()){DBHistory.push_state("/camera",{})}Photos._render(g);Photos._listen();return Photos._get_num_total()})},_listen:function(){document.body.on("click",".cu-thumb",Photos._thumb_click);document.body.on("dblclick",".cu-thumb",Photos._thumb_double_click);if(Constants.ADMIN){document.body.on("contextmenu",".cu-thumb",function(b){var a;a=Photos._photos[$$(".cu-thumb").indexOf($(b.target).up(".cu-thumb"))];return ContextMenu.show_photos(b,a)})}document.observe(FilePreviewModal.PHOTO_CHANGE_EVT,Photos._lightbox_event);document.observe(FilePreviewModal.PHOTO_DELETE_EVT,Photos._lightbox_delete);document.observe(FilePreviewModal.EXIT_SELECT_EVT,Photos._lightbox_exit);document.observe(FileEvents.DELETE,Photos._remove);Event.observe(window,"scroll",Photos._window_scroll);DBHistory.add_callback("/camera",Photos._history_change_handler);$("share-selected").observe("click",Photos._share_selected);$("clear-selected").observe("click",Photos._clear_selected);document.on("click",".filter-option",function(c,b){var a;c.preventDefault();a=b.readAttribute("data-filter");return Photos._filter(a)});$("cu-duplicate-files").on("click","button.delete-cu-duplicate",function(b,a){FileOps.do_nonbrowse_delete([a.readAttribute("data-path")]);return Modal.hide()});if(Constants.can_photo_share){return PhotosSelection.listen()}},_render:function(f){var d,b,a,e,c;if(!f.length){a=void 0;if(Photos._current_filter===Photos.PHOTO_FILTER){a=_("photos")}else{if(Photos._current_filter===Photos.VIDEO_FILTER){a=_("videos")}else{a=_("photos or videos")}}DomUtil.fillVal(a,"file-types");$("cu-empty").show();return}b=[];c=void 0;d=void 0;e=void 0;Photos._update_key_to_photos(f);if(Photos._prev_date){c=Photos._prev_date}else{c=new Date(f[0].time_taken);b.push(Photos._generate_month_header(c))}f.each(function(g){e=Photos._get_newest(g.uniqueness_key);if(Photos._photos.indexOf(e)===-1){d=new Date(e.time_taken);if(d.getMonth()!==c.getMonth()||d.getFullYear()!==c.getFullYear()){b.push(Photos._generate_month_header(d))}b.push(Photos._tmpl({photo:e,display_date:Util.niceDateWithMonthName(d,d.getFullYear()<new Date().getFullYear())}));Photos._photos.push(e);Photos._preview_objs.push(Photos._get_preview_obj(e));return c=d}});Photos._prev_date=c;if(Photos._cursor){b.push(Photos.LOADING_SPINNER)}$("photos-list").__sert(b);Photos._update_grid();if(Photos._num_total){Photos._set_lightbox_wrap()}Photos._load_visible_thumbs();if(Photos._flow){return $$(".cu-thumb").each(function(g){return g.setStyle({width:"auto"})})}},_update_grid:function(){var b,m,a,q,h,l,n,p,k,j,f,e,o,g,d,c;a=$("photos-list").childElements();p=$$(".cu-thumb");k=p.first().getLayout().get("margin-box-height");n=$$(".cu-month-header").first().getLayout().get("margin-box-height");q=p.first().cumulativeOffset();j=q.top;l=q.left;b=0;h=void 0;Photos._photo_grid.thumb_height=k;Photos._photo_grid.height_to_photo={};Photos._photo_grid.photo_heights=[];Photos._photo_grid.left_offsets=[];for(h=f=0,g=Photos.THUMBS_PER_ROW;0<=g?f<=g:f>=g;h=0<=g?++f:--f){Photos._photo_grid.left_offsets.push(l+k*h)}Photos._photo_grid.height_to_photo[j]=null;Photos._photo_grid.photo_heights.push(j);d=a.slice(1);c=[];for(e=0,o=d.length;e<o;e++){m=d[e];if(m.hasClassName("cu-month-header")){b=0;j+=n;Photos._photo_grid.height_to_photo[j]=null;Photos._photo_grid.photo_heights.push(j)}else{if(m.hasClassName("cu-thumb")){if(b===0){j+=k;b++;Photos._photo_grid.height_to_photo[j]={uniqueness_key:m.id,num_photos:1};Photos._photo_grid.photo_heights.push(j)}else{b++;Photos._photo_grid.height_to_photo[j].num_photos++;if(b>=Photos.THUMBS_PER_ROW){b=0}}}}c.push(h++)}return c},_reset:function(){Photos._photos=[];Photos._key_to_photos={};Photos._preview_objs=[];Photos._num_total=null;Photos._cursor=null;Photos._set_filter(null);Photos._last_scroll_timeout=null;Photos._start_scroll_time=-1;Photos._prev_date=null;Photos._getting_more=false;PhotosSelection.clear();$("photos-list").__date();return $("cu-empty").hide()},_get_thumb_elm_for_photo:function(a){return $(a.uniqueness_key)},_get_photo_for_thumb_elm:function(a){if(!a.hasClassName("cu-thumb")){a=a.up(".cu-thumb")}if(a){return Photos._get_newest(a.identify())}else{return null}},_update_key_to_photos:function(a){return a.each(function(b){if(Photos._key_to_photos[b.uniqueness_key]){return Photos._key_to_photos[b.uniqueness_key].push(b)}else{return Photos._key_to_photos[b.uniqueness_key]=[b]}})},_get_newest:function(c){var f,g,b,e,a,d;g=Photos._key_to_photos[c];if(g.length===0){}else{if(g.length===1){return g[0]}else{b=g[0];d=g.slice(1);for(e=0,a=d.length;e<a;e++){f=d[e];if(f.mtime>b.mtime){b=f}}return b}}},_thumb_click:function(b){var a;a=Photos._get_photo_for_thumb_elm($(b.target));if(!Constants.can_photo_share||$(b.target).hasClassName("magnify")||$(b.target).up(".magnify")){return Photos._preview(Photos._photos.indexOf(a))}else{return PhotosSelection.photo_click(b,a)}},_thumb_double_click:function(a){return Photos._preview(Photos._photos.indexOf(Photos._get_photo_for_thumb_elm($(a.target))))},_preview:function(a){if(Photos._num_total){return FilePreviewModal.show(a)}else{return setTimeout((function(){return Photos._preview(a)}),100)}},_share_selected:function(){var a;a=PhotosSelection.get().collect(function(b){return b.path});Forms.postRequest("/sm/collection",{fq_paths:Util.to_json(a)},{target:"_blank"});return PhotosSelection.clear()},_clear_selected:function(){return PhotosSelection.clear()},_get_num_total:function(){return new Ajax.DBRequest(Photos._count_endpoint,{parameters:{filter:Photos._current_filter},onSuccess:function(a){Photos._num_total=a.responseText;FilePreviewModal.init(Photos._preview_objs,{include_delete:true,num_previews:Photos._num_total});return Photos._set_lightbox_wrap()}})},_set_lightbox_wrap:function(){if(Photos._cursor){return FilePreviewModal.set_no_wrap(true)}else{return FilePreviewModal.set_no_wrap(false)}},_window_scroll:function(){var d,a,c,b;a=new Date().getTime();if(Photos._start_scroll_time===-1||a-Photos._start_scroll_time<Photos.POST_SCROLL_MAX_WAIT){clearTimeout(Photos._last_scroll_timeout)}if(Photos._start_scroll_time===-1){Photos._start_scroll_time=a}Photos._last_scroll_timeout=setTimeout(Photos._load_visible_thumbs,Photos.POST_SCROLL_WAIT);if(Photos._cursor){b=Util.scroll_offsets().top;c=Util.viewport_dimensions().height;d=document.body.getHeight();if(b+c+Photos.SCROLL_OFFSET>=d){return Photos._get_more()}}},_load_visible_thumbs:function(r){var l,q,p,b,m,o,n,k,c,s,g,f,h,a,v,u,d,t,j;Photos._start_scroll_time=-1;if(!Photos._photos.length){return}h=$$(".cu-thumb");u=Util.scroll_offsets().top;v=Util.viewport_dimensions().height;m=void 0;c=void 0;o=void 0;s=void 0;p=void 0;k=void 0;j=Photos._photo_grid.photo_heights;for(d=0,t=j.length;d<t;d++){n=j[d];q=Photos._photo_grid.height_to_photo[n];if(q!==null){a=h.indexOf($(q.uniqueness_key));if(n>u-v&&n<u){if(!(m!=null)){m=a}c=a+q.num_photos-1}else{if(n>u&&n<u+v){if(!(o!=null)){o=a}s=a+q.num_photos-1}else{if(n>u+v&&n<u+3*v){if(!(p!=null)){p=a}k=a+q.num_photos-1}}}}}f=Util.calc_thumb_prep_size();g=function(e){return function(){return h[e].addClassName("thumb-loaded")}};l=[];b=true;[[o,s],[p,k],[m,c]].each(function(A){var y,x,z,e,B,w;w=[];for(y=z=e=A[0],B=A[1];e<=B?z<=B:z>=B;y=e<=B?++z:--z){x=h[y].down("img");if(Prototype.BrowserFeatures.DB_CORS&&Photos._batch_thumb_endpoints.length){l.push({elt:x,callback:g(y)});if(l.length===Photos.THUMBS_BATCH_SIZE){Photos._batch_load_thumbs(l,b);l=[];w.push(b=false)}else{w.push(void 0)}}else{w.push(Util.thumb_load(x,f,g(y)))}}return w});if(l.length){return Photos._batch_load_thumbs(l)}},_lightbox_event:function(a){Photos._selected_index=Photos._preview_objs.indexOf(a.memo);if(Photos._cursor&&Photos._selected_index>Photos._preview_objs.length-Photos.LIGHTBOX_OFFSET){return Photos._get_more()}},_lightbox_delete:function(a){var d,c,b;d=Photos._preview_objs.indexOf(a.memo);c=Photos._photos[d];b=Photos._key_to_photos[c.uniqueness_key];assert(b.length,"No key_to_photos entry for cu photo");if(b.length===1){return FileOps.do_nonbrowse_delete([c.path])}else{return Photos._show_duplicates_delete_modal(b)}},_lightbox_exit:function(a){return key.setScope("all")},_history_change_handler:function(b,c){var a;a=c.filter;if(a===Photos.PHOTO_FILTER||a===Photos.VIDEO_FILTER){if(a!==Photos._current_filter){Photos._reset();Photos._set_filter(a);Photos._get_more()}}else{if(Photos._current_filter){Photos._reset();Photos._set_filter(null);Photos._get_more()}}if(Photos._selected_index>-1){Photos._scroll_to_thumb(Photos._selected_index);return Photos._selected_index=-1}},_show_duplicates_delete_modal:function(d){var c,b,a;d.sort(function(f,e){return e.mtime-f.mtime});b=$("cu-duplicate-files");a=[];c=void 0;d.each(function(e){c="Dropbox"+Util.normalize(Util.parentDir(e.path));return a.push(Photos._cu_duplicate_tmpl({small_thumbnail_url:e.thumbnail_url+"?size=32bf",filename_snippet:e.filename.em_snippet(Photos.DUPLICATES_SNIPPET_LENGTH),path_snippet:c.em_snippet(Photos.DUPLICATES_SNIPPET_LENGTH,0),full_path:e.path,delete_str:_("Delete")}))});b.__date(a);if(d.length>=5){b.addClassName("scroll")}else{b.removeClassName("scroll")}FilePreviewModal.toggle_delete();return Modal.icon_show("delete_32",_("Choose file to delete"),$("cu-delete-modal"),{photos:d})},delete_all_duplicates:function(){var a;a=Modal.vars.photos.collect(function(b){return b.path});return FileOps.do_nonbrowse_delete(a)},_remove:function(b){var d,a,c;c=b.memo.fq_paths;if(c.length===1){a=c[0];d=false;if(Modal.vars.photos){Modal.vars.photos.each(function(e){if(e.path===a){Photos._remove_photo_with_duplicates(e);return d=true}})}if(!d){return Photos._remove_photo(a)}}else{return c.each(function(e){return Photos._remove_photo(e)})}},_remove_photo:function(f){var c,b,e,a,d;d=Photos._photos;for(c=e=0,a=d.length;e<a;c=++e){b=d[c];if(b.path===f){Photos._photos.splice(c,1);$$(".cu-thumb")[c].remove();return}}},_remove_photo_with_duplicates:function(a){var e,c,d,b;e=Photos._key_to_photos[a.uniqueness_key];e.removeItem(a);assert(e.length,"Photo has no duplicates");c=Photos._photos.indexOf(a);if(c!==-1){d=Photos._get_newest(a.uniqueness_key);b=new HTML('<img src="'+d.thumbnail_url+Photos.SIZE_Q+'" class="cu-thumb" />');Photos._photos[c]=d;$$(".cu-thumb")[c].__sert({after:b});$$(".cu-thumb")[c].remove();Photos._preview_objs.splice(c,0,Photos._get_preview_obj(d));if(Photos._preview_objs.length===Photos._photos.length){return FilePreviewModal.jump_to(c)}else{return FilePreviewModal.jump_to(c+1)}}},_set_filter:function(b){var a;Photos._current_filter=b;a=void 0;if(b===Photos.PHOTO_FILTER){a=_("Photos only")}else{if(b===Photos.VIDEO_FILTER){a=_("Videos only")}else{a=_("Photos and videos")}}return $$(".current-filter")[0].__date(a)},_filter:function(b){var a;a=DBHistory.deconstruct_url();if(b===Photos.PHOTO_FILTER||b===Photos.VIDEO_FILTER){a.qargs.filter=b}else{delete a.qargs.filter}return DBHistory.push_state(a.path,a.qargs)},_get_more:function(){if(Photos._getting_more){return}Photos._getting_more=true;return new Ajax.DBRequest(Photos._more_endpoint,{parameters:{cursor:Photos._cursor,filter:Photos._current_filter},onSuccess:function(a){var b;if($("cu-loading")){$("cu-loading").remove()}b=Util.from_json(a.responseText);if(b.more){Photos._cursor=b.cursor}else{Photos._cursor=null}Photos._render(b.photos);Photos._getting_more=false;if(!Photos._num_total){return Photos._get_num_total()}}})},_batch_load_thumbs:function(a,b){var g,f,e,h,d,c;f=[];e=[];a.each(function(j){var k;if(j.elt.hasAttribute("data-src")){k=j.elt.readAttribute("data-src");k=k.replace(/https?:\/\/[^\/]+\//,"/");f.push(k);return e.push({elt:j.elt,callback:j.callback})}});if(!f.length){return}g=Photos._batch_thumb_endpoints[Photos._batch_thumb_endpoint_index];Photos._batch_thumb_endpoint_index=(Photos._batch_thumb_endpoint_index+1)%Photos._batch_thumb_endpoints.length;c=g+Photos.SIZE_Q+encodeURIComponent(Util.to_json(f));h=(c.length<Photos.MAX_URL_LENGTH?"get":"post");d=function(k){var j;j=k.responseText.split("\n");if(j.length<2){return}j.splice(j.length-1);return e.each(function(m,l){if(j.length>l&&m.elt.hasAttribute("data-src")){m.elt.writeAttribute("src",j[l]);m.elt.removeAttribute("data-src");return m.callback()}})};return new Ajax.DBRequest(g+Photos.SIZE_Q,{method:h,parameters:{image_urls:Util.to_json(f)},log_timing:b,withCredentials:true,onInteractive:d,onSuccess:d})},_get_preview_obj:function(a){if(a.preview_type==="photo"&&a.thumbnail_url){return new PhotoPreview(a.filename,a.path,a.thumbnail_url,a.href+"&dl=1",a.href,a.display_time_taken)}else{if(a.preview_type==="video"&&a.thumbnail_url&&!Constants.DISABLE_VIDEOS_IN_LIGHTBOX){return new VideoPreview(a.filename,a.path,a.thumbnail_url,"https://"+Constants.LIVE_TRANSCODE_SERVER+"/transcode_video/w/"+a.block_hash+(Util.urlquote(a.path)),a.href+"&dl=1",a.display_time_taken)}}return null},_generate_month_header:function(a){return new HTML('<h1 class="cu-month-header">'+_("%(month)s %(year)s").format({month:Util.month_name(a.getMonth()),year:a.getFullYear()})+"</h1>")},_scroll_to_thumb:function(b){var a;a=$$(".cu-thumb")[b];if(!a){return}Util.scroll_to_thumb(a);return Photos._load_visible_thumbs()},reflow:function(){var g,c,n,p,q,d,m,b,a,f,l,k,o,e,h;n=800;g=10;c=150;f=$$(".cu-thumb");p=[];d=0;q=void 0;h=[];for(l=0,o=f.length;l<o;l++){q=f[l];if(d+q.width+g>n){if(d-n<q.width/2){p.push(q);d+=q.width+g;b=c*(n-g*p.length)/(d-g*p.length)-1;m=0;for(k=0,e=p.length;k<e;k++){a=p[k];a.setStyle({height:b+"px"})}p=[];h.push(d=0)}else{Photos._adjust_row_height(p,d);p=[q];h.push(d=q.width+g)}}else{p.push(q);h.push(d+=q.width+g)}}return h}};PhotosSelection={SHIFT_KEY_CODE:16,DRAG_STATUS_OFFSET:15,_selected:[],_highlighted:[],_dehighlighted:[],_last_selected:null,_last_mouseover:null,_drag_select:{},_marquee:{},_drag_drop:{},listen:function(){document.body.on("keydown",function(a){if(a.keyCode===PhotosSelection.SHIFT_KEY_CODE?PhotosSelection._last_mouseover:void 0){return PhotosSelection._highlight_range(PhotosSelection._last_selected,PhotosSelection._last_mouseover)}});document.body.on("keyup",function(a){if(a.keyCode===PhotosSelection.SHIFT_KEY_CODE){return PhotosSelection.clear_highlighted()}});document.body.on("mouseover",".cu-thumb",PhotosSelection._photo_mouseover);document.body.on("mouseout",".cu-thumb",PhotosSelection._photo_mouseout);document.body.on("mouseover",".photo-collection",PhotosSelection._collection_mouseover);document.body.on("mouseup",".photo-collection",PhotosSelection._collection_mouseup);document.body.on("mouseout",".photo-collection",PhotosSelection._collection_mouseout);document.body.on("mousedown",PhotosSelection._body_mousedown);document.body.on("mousemove",PhotosSelection._body_mousemove);document.body.on("mouseup",PhotosSelection._body_mouseup);return document.body.on("dblclick",PhotosSelection._body_double_click)},get:function(){return PhotosSelection._selected},clear:function(){PhotosSelection._selected=[];PhotosSelection._last_selected=null;$$(".cu-thumb.selected").invoke("removeClassName","selected");return $("selected-actions").hide()},clear_highlighted:function(){PhotosSelection._highlighted=[];PhotosSelection._dehighlighted=[];$$(".cu-thumb.highlighted").invoke("removeClassName","highlighted");return $$(".cu-thumb.dehighlighted").invoke("removeClassName","dehighlighted")},photo_click:function(b,a){if(b.isRightClick()){return}if(b.shiftKey){return PhotosSelection._select_highlighted()}else{if(PhotosSelection._contains(a)){return PhotosSelection._remove(a)}else{return PhotosSelection._add(a)}}},_photo_mouseover:function(b){var a;a=Photos._get_photo_for_thumb_elm($(b.target));PhotosSelection._last_mouseover=a;if(PhotosSelection._drag_select.active){return PhotosSelection._highlight_range(PhotosSelection._drag_select.anchor,a)}else{if(b.shiftKey){return PhotosSelection._highlight_range(PhotosSelection._last_selected,PhotosSelection._last_mouseover)}}},_photo_mouseout:function(a){if(!PhotosSelection._marquee.active){PhotosSelection.clear_highlighted();return PhotosSelection._last_mouseover=null}},_body_mousedown:function(c){var a,b;if(c.isRightClick()){return}a=Photos._get_photo_for_thumb_elm($(c.target));if(a){if(PhotosSelection._contains(a)){PhotosSelection._drag_drop.active=true;PhotosSelection._build_drag_status(a);return PhotosSelection._update_drag_status_position(c)}else{PhotosSelection._drag_select.active=true;return PhotosSelection._drag_select.anchor=a}}else{b=Util.scroll_offsets();PhotosSelection._marquee.active=true;PhotosSelection._marquee.start_x=c.clientX+b.left;PhotosSelection._marquee.start_y=c.clientY+b.top;PhotosSelection._update_marquee_x_bounds(PhotosSelection._marquee.start_x);return PhotosSelection._update_marquee_y_bounds(PhotosSelection._marquee.start_y)}},_body_mousemove:function(b){var a;if(PhotosSelection._marquee.active){a=Util.scroll_offsets();PhotosSelection._marquee.end_x=b.clientX+a.left;PhotosSelection._marquee.end_y=b.clientY+a.top;return PhotosSelection._draw_marquee()}else{if(PhotosSelection._drag_drop.active){PhotosSelection._update_drag_status_position(b);return $("photos-drag-status").addClassName("active")}}},_body_mouseup:function(a){if(PhotosSelection._drag_select.active){PhotosSelection._drag_select.active=false;PhotosSelection._select_highlighted()}if(PhotosSelection._marquee.active){PhotosSelection._marquee.active=false;$("marquee").hide();PhotosSelection._select_highlighted()}if(PhotosSelection._drag_drop.active){PhotosSelection._drag_drop.active=false;return $("photos-drag-status").removeClassName("active")}},_body_double_click:function(a){if(!Photos._get_photo_for_thumb_elm($(a.target))){return PhotosSelection.clear()}},_collection_mouseover:function(b){var a;if(PhotosSelection._drag_drop.active){a=$(b.target);if(!a.hasClassName("photo-collection")){a=a.up(".photo-collection")}return a.addClassName("hovered")}},_collection_mouseout:function(b){var a;if(PhotosSelection._drag_drop.active){a=$(b.target);if(!a.hasClassName("photo-collection")){a=a.up(".photo-collection")}return a.removeClassName("hovered")}},_collection_mouseup:function(c){var a,f,d,b,g=this;if(PhotosSelection._drag_drop.active){b=$(c.target);if(!b.hasClassName("photo-collection")){b=b.up(".photo-collection")}b.removeClassName("hovered");if(b.identify()==="new-collection-text"){f=PhotosSelection.get().collect(function(e){return e.path});b.__sert({after:new Element("li",{id:"new-added-collection","class":"photo-collection"})});d=function(h){var e,j;PhotosSelection.clear();e=h.responseText;$("new-added-collection").__date((new Element("a")).__date(e.em_snippet(9,1)));$("new-added-collection").removeAttribute("id");j=ungettext("Moved %(num_photos)s photos into %(collection_name)s","Moved %(num_photos)s photos into %(collection_name)s",f.length).format({num_photos:f.length,collection_name:e});Notify.server_success(j);return a.dispose()};a=new Ajax.InPlaceEditor($("new-added-collection"),"/sm/collection",{htmlResponse:false,okControl:false,cancelControl:false,highlightColor:"transparent",highlightEndColor:"transparent",clickToEditText:"",cols:11,ajaxClass:Ajax.DBRequest,submitOnBlur:true,onFailure:function(){},savingText:"<a>"+_("Creating...</a>"),ajaxOptions:{method:"POST",onSuccess:d},callback:function(e,h){return{collection_name:h,fq_paths:Util.to_json(f),redirect:false}}});return a.enterEditMode()}else{return PhotosSelection._add_selected_to_collection(b.readAttribute("data-name"))}}},_draw_marquee:function(){var a,e,d,c,b;b=Math.abs(PhotosSelection._marquee.start_x-PhotosSelection._marquee.end_x);a=Math.abs(PhotosSelection._marquee.start_y-PhotosSelection._marquee.end_y);d=Math.min(PhotosSelection._marquee.start_y,PhotosSelection._marquee.end_y);e=Math.min(PhotosSelection._marquee.start_x,PhotosSelection._marquee.end_x);$("marquee").setStyle({width:b+"px",height:a+"px",top:d+"px",left:e+"px"});$("marquee").show();c=false;if(PhotosSelection._marquee.end_x>=PhotosSelection._marquee.x_max_boundary||PhotosSelection._marquee.end_x<=PhotosSelection._marquee.x_min_boundary){PhotosSelection._update_marquee_x_bounds(PhotosSelection._marquee.end_x);c=true}if(PhotosSelection._marquee.end_y>=PhotosSelection._marquee.y_max_boundary||PhotosSelection._marquee.end_y<=PhotosSelection._marquee.y_min_boundary){PhotosSelection._update_marquee_y_bounds(PhotosSelection._marquee.end_y);c=true}if(c){return PhotosSelection._update_marquee_highlight(d,e,b,a)}},_update_marquee_highlight:function(r,k,u,s){var C,l,o,v,w,m,x,n,y,d,t,q,g,e,c,b,B,E,D,A,z,a,p,j,h,f;o=[];w=Photos._photo_grid.left_offsets.length;p=Photos._photo_grid.left_offsets.slice(0,w-1);for(v=g=0,B=p.length;g<B;v=++g){m=p[v];if(m<=k+u&&Photos._photo_grid.left_offsets[v+1]>=k){o.push(v)}}l=void 0;q=void 0;C=-1;t=-1;if(!((PhotosSelection._marquee.start_y<=Photos._photo_grid.photo_heights.first()&&PhotosSelection._marquee.end_y<=Photos._photo_grid.photo_heights.first())||(PhotosSelection._marquee.start_y>Photos._photo_grid.photo_heights.last()&&PhotosSelection._marquee.end_y>Photos._photo_grid.photo_heights.last()))){if(PhotosSelection._marquee.start_y<=Photos._photo_grid.photo_heights.first()){l=1;C=0}else{if(PhotosSelection._marquee.start_y>Photos._photo_grid.photo_heights.last()){l=Photos._photo_grid.photo_heights.length-1}else{j=Photos._photo_grid.photo_heights;for(v=e=0,E=j.length;e<E;v=++e){s=j[v];if(s>PhotosSelection._marquee.start_y){if(Photos._photo_grid.height_to_photo[s]===null){C=v;if(PhotosSelection._marquee.start_y<PhotosSelection._marquee.end_y){l=v+1;break}else{l=v-1;break}}else{l=v;break}}}}}if(PhotosSelection._marquee.end_y<=Photos._photo_grid.photo_heights.first()){q=1;t=0}else{if(PhotosSelection._marquee.end_y>Photos._photo_grid.photo_heights.last()){q=Photos._photo_grid.photo_heights.length-1}else{h=Photos._photo_grid.photo_heights;for(v=c=0,D=h.length;c<D;v=++c){s=h[v];if(s>PhotosSelection._marquee.end_y){if(Photos._photo_grid.height_to_photo[s]===null){t=v;if(PhotosSelection._marquee.start_y<PhotosSelection._marquee.end_y){q=v-1;break}else{q=v+1;break}}else{q=v;break}}}}}}if(q<l){y=q;q=l;l=y}d=[];if(!(t!==-1&&t!==-1&&t===C)){f=Photos._photo_grid.photo_heights.slice(l,q+1||9000000000);for(b=0,A=f.length;b<A;b++){x=f[b];if((x in Photos._photo_grid.height_to_photo)&&Photos._photo_grid.height_to_photo[x]!==null){for(a=0,z=o.length;a<z;a++){n=o[a];if(n<Photos._photo_grid.height_to_photo[x].num_photos){d.push(Photos._photos[Photos._photos.indexOf(Photos._get_newest(Photos._photo_grid.height_to_photo[x].uniqueness_key))+n])}}}}}return PhotosSelection._highlight_list(d)},_update_marquee_x_bounds:function(a){var d,g,h,f,c,e,b;g=$(document.body).getWidth();if(a<Photos._photo_grid.left_offsets.first()){PhotosSelection._marquee.x_min_boundary=-1;return PhotosSelection._marquee.x_max_boundary=Photos._photo_grid.left_offsets.first()}else{if(a>Photos._photo_grid.left_offsets.last()){PhotosSelection._marquee.x_min_boundary=Photos._photo_grid.left_offsets.last();return PhotosSelection._marquee.x_max_boundary=g}else{e=Photos._photo_grid.left_offsets;b=[];for(d=f=0,c=e.length;f<c;d=++f){h=e[d];if(h>a){PhotosSelection._marquee.x_min_boundary=Photos._photo_grid.left_offsets[d-1];PhotosSelection._marquee.x_max_boundary=h;break}else{b.push(void 0)}}return b}}},_update_marquee_y_bounds:function(h){var a,e,d,g,c,f,b;d=$(document.body).getHeight();e=void 0;if(h<Photos._photo_grid.photo_heights.first()){PhotosSelection._marquee.y_min_boundary=-1;return PhotosSelection._marquee.y_max_boundary=Photos._photo_grid.photo_heights.first()}else{if(h>Photos._photo_grid.photo_heights.last()){PhotosSelection._marquee.y_min_boundary=Photos._photo_grid.photo_heights.last();return PhotosSelection._marquee.y_max_boundary=d}else{f=Photos._photo_grid.photo_heights;b=[];for(g=0,c=f.length;g<c;g++){a=f[g];if(a>h){PhotosSelection._marquee.y_min_boundary=Photos._photo_grid.photo_heights[e-1];PhotosSelection._marquee.y_max_boundary=a;break}else{b.push(void 0)}}return b}}},_build_drag_status:function(c){var a,b;a=Photos._get_thumb_elm_for_photo(c);b=a.down("img.thumb-content").cloneNode(false);$("photos-drag-status").down(".thumb").__date(b);return $("photos-drag-status").down(".count").__date(PhotosSelection._selected.length)},_update_drag_status_position:function(a){return $("photos-drag-status").setStyle({left:(a.pointerX()-Util.scroll_offsets().left+PhotosSelection.DRAG_STATUS_OFFSET)+"px",top:(a.pointerY()-Util.scroll_offsets().top+PhotosSelection.DRAG_STATUS_OFFSET)+"px"})},_highlight_range:function(j,h){var g,b,e,f,a,d,c;PhotosSelection.clear_highlighted();b=Photos._photos.indexOf(j);a=Photos._photos.indexOf(h);f=void 0;g=PhotosSelection._contains(h)&&!PhotosSelection._contains(j);c=[];for(e=d=b;b<=a?d<=a:d>=a;e=b<=a?++d:--d){f=Photos._photos[e];if(PhotosSelection._contains(f)){if(g){c.push(PhotosSelection._dehighlight(f))}else{c.push(void 0)}}else{if(!g){c.push(PhotosSelection._highlight(f))}else{c.push(void 0)}}}return c},_highlight_list:function(d){var c,e,b,a;PhotosSelection.clear_highlighted();a=[];for(e=0,b=d.length;e<b;e++){c=d[e];if(!PhotosSelection._contains(c)){a.push(PhotosSelection._highlight(c))}else{a.push(void 0)}}return a},_select_highlighted:function(){var d,g,e,c,b,f,a;f=PhotosSelection._highlighted;for(g=0,c=f.length;g<c;g++){d=f[g];PhotosSelection._add(d)}a=PhotosSelection._dehighlighted;for(e=0,b=a.length;e<b;e++){d=a[e];PhotosSelection._remove(d)}return PhotosSelection.clear_highlighted()},_add_selected_to_collection:function(a){var b;b=PhotosSelection.get().collect(function(c){return c.path});return new Ajax.DBRequest("/sm/collection_add",{parameters:{collection_name:a,fq_paths:Util.to_json(b)},onSuccess:function(c){var d;PhotosSelection.clear();d=ungettext("Moved %(num_photos)s photos into %(collection_name)s","Moved %(num_photos)s photos into %(collection_name)s",b.length).format({num_photos:b.length,collection_name:a});return Notify.server_success(d)}})},_contains:function(a){return PhotosSelection._selected.indexOf(a)!==-1},_highlight:function(b){var a;a=Photos._get_thumb_elm_for_photo(b);PhotosSelection._highlighted.push(b);return a.addClassName("highlighted")},_dehighlight:function(b){var a;a=Photos._get_thumb_elm_for_photo(b);PhotosSelection._dehighlighted.push(b);return a.addClassName("dehighlighted")},_add:function(b){var a;a=Photos._get_thumb_elm_for_photo(b);PhotosSelection._selected.push(b);a.addClassName("selected");PhotosSelection._last_selected=b;DomUtil.fillVal(PhotosSelection._selected.length,"num-selected");return $("selected-actions").show()},_remove:function(b){var a;a=Photos._get_thumb_elm_for_photo(b);PhotosSelection._selected.splice(PhotosSelection._selected.indexOf(b),1);a.removeClassName("selected");PhotosSelection._last_selected=b;if(PhotosSelection._selected.length){return DomUtil.fillVal(PhotosSelection._selected.length,"num-selected")}else{return $("selected-actions").hide()}}};var PhotoEvent,PhotosTimeline,PhotosTimelineSelection,__slice=[].slice;PhotosTimeline={SIZE_Q:"?size=cu_154",THUMB_SIZE:158,HEADER_HEIGHT:51,THUMBS_PER_ROW:5,LIGHTBOX_OFFSET:100,POST_SCROLL_WAIT:100,POST_SCROLL_MAX_WAIT:1000,DUPLICATES_SNIPPET_LENGTH:30,PHOTO_FILTER:"photos",VIDEO_FILTER:"videos",THUMBS_BATCH_SIZE:10,MAX_THUMB_BATCH_REQUESTS:24,MAX_URL_LENGTH:2000,_photos:[],_key_to_photo:{},_key_to_duplicates:{},_preview_objs:[],_num_total:0,_selected_index:-1,_current_filter:null,_last_scroll_timeout:null,_start_scroll_time:-1,_tmpl:null,_cu_duplicate_tmpl:null,_batch_thumb_endpoints:[],_batch_thumb_endpoint_index:0,_photo_events:null,_grid:{},_batch_load_thumbs_queue:[],_num_batch_requests:0,init:function(d,e,b,c,a){PhotosTimeline._batch_thumb_endpoints=a;return document.observe("dom:loaded",function(){PhotosTimeline._tmpl=HTML.tmpl("cu_list_item_tmpl");PhotosTimeline._cu_duplicate_tmpl=HTML.tmpl("cu_duplicate_list_item_tmpl");if(c===PhotosTimeline.PHOTO_FILTER||c===PhotosTimeline.VIDEO_FILTER){PhotosTimeline._set_filter(c)}if(!HTML5_HISTORY&&!Util.url_hash()){DBHistory.push_state("/timeline",{})}PhotosTimeline._render_empty_grid(d,e,b);return PhotosTimeline._listen()})},_listen:function(){document.body.on("click",".cu-thumb",PhotosTimeline._thumb_click);document.body.on("dblclick",".cu-thumb",PhotosTimeline._thumb_double_click);if(Constants.ADMIN){document.body.on("contextmenu",".cu-thumb",function(b){var a;a=PhotosTimeline._key_to_photo[$(b.target).up(".cu-thumb").identify()];return ContextMenu.show_photos(b,a)})}document.observe(FilePreviewModal.PHOTO_CHANGE_EVT,PhotosTimeline._lightbox_photo_change);document.observe(FilePreviewModal.PHOTO_DELETE_EVT,PhotosTimeline._lightbox_delete);document.observe(FilePreviewModal.EXIT_SELECT_EVT,PhotosTimeline._lightbox_exit);document.observe(FileEvents.DELETE,PhotosTimeline._remove);Event.observe(window,"scroll",PhotosTimeline._window_scroll);DBHistory.add_callback("/timeline",PhotosTimeline._history_change_handler);$("share-selected").observe("click",PhotosTimeline._share_selected);$("clear-selected").observe("click",PhotosTimeline._clear_selected);document.on("click",".filter-option",function(c,b){var a;c.preventDefault();a=b.readAttribute("data-filter");return PhotosTimeline._filter(a)});$("cu-duplicate-files").on("click","button.delete-cu-duplicate",function(b,a){FileOps.do_nonbrowse_delete([a.readAttribute("data-path")]);return Modal.hide()});if(Constants.can_photo_share){return PhotosTimelineSelection.listen()}},_reset:function(){PhotosTimeline._photos=[];PhotosTimeline._key_to_photo={};PhotosTimeline._key_to_duplicates={};PhotosTimeline._preview_objs=[];PhotosTimeline._num_total=0;PhotosTimeline._set_filter(null);PhotosTimeline._last_scroll_timeout=null;PhotosTimeline._start_scroll_time=-1;PhotosTimeline._batch_load_thumbs_queue=[];PhotosTimeline._num_batch_requests=0;PhotosTimelineSelection.clear();$("photos-list").__date();return $("cu-empty").hide()},_render_empty_grid:function(o,c,h){var f,g,e,q,d,r,l,a,k,n,m,j,p,b;if(o.length<1){PhotosTimeline._photo_events=new SuperDictionary([],{});return}PhotosTimeline._grid.photo_row_offsets=[];a=[];e={};k=$("photos-list");d=0;for(m=0,p=o.length;m<p;m++){g=o[m];r=new PhotoEvent(g,c[g],h[g],d);r.add_html_elements_to(k);a.push(g);e[g]=r;d+=h[g]}PhotosTimeline._photo_events=new SuperDictionary(a,e);f="h_"+o.first();n=$(f).cumulativeOffset().top;PhotosTimeline._grid.header_top_to_unique_id={};for(j=0,b=a.length;j<b;j++){l=a[j];r=e[l];r.top_offset=n;PhotosTimeline._grid.header_top_to_unique_id[n]=l;r.create_global_row_heights();n+=r.height}q=function(){var u,t,v,w,s;PhotosTimeline._grid.photo_col_offsets=[];t=$$(".cu-thumb").first().cumulativeOffset().left;s=[];for(u=v=0,w=PhotosTimeline.THUMBS_PER_ROW;0<=w?v<=w:v>=w;u=0<=w?++v:--v){s.push(PhotosTimeline._grid.photo_col_offsets.push(t+PhotosTimeline.THUMB_SIZE*u))}return s};PhotosTimeline._photo_events.valueAtIndex(0).render(q);PhotosTimeline._num_total=d;FilePreviewModal.init(PhotosTimeline._preview_objs,{include_delete:true,num_previews:PhotosTimeline._num_total,no_wrap:true,no_preload:true});return PhotosTimeline._render()},_render:function(){var a,c,b,d,f,e;if(!PhotosTimeline._photo_events.length()){a=void 0;if(PhotosTimeline._current_filter===PhotosTimeline.PHOTO_FILTER){a=_("photos")}else{if(PhotosTimeline._current_filter===PhotosTimeline.VIDEO_FILTER){a=_("videos")}else{a=_("photos or videos")}}DomUtil.fillVal(a,"file-types");$("cu-empty").show();return}d=Util.get_viewport();for(c=f=0,e=PhotosTimeline._photo_events.length();0<=e?f<e:f>e;c=0<=e?++f:--f){b=PhotosTimeline._photo_events.valueAtIndex(c);if(!(b.top_offset>d.top+d.height||b.top_offset+b.height<d.top)){b.render()}}return PhotosTimeline._load_visible_thumbs()},_load_visible_thumbs:function(g){var b,c,f,d,a;if(PhotosTimeline._photo_events.length()<1){return}c=Util.get_viewport();a=[];for(b=f=0,d=PhotosTimeline._photo_events.length();0<=d?f<d:f>d;b=0<=d?++f:--f){a.push(PhotosTimeline._photo_events.valueAtIndex(b).load_visible_thumbs(c.top,c.top+c.height))}return a},_refresh_photo_events:function(){var a=this;return new Ajax.DBRequest("/timeline_month_events",{parameters:{filter:PhotosTimeline._current_filter},onSuccess:function(b){var c;c=Util.from_json(b.responseText);return PhotosTimeline._render_empty_grid(c.header_ids,c.header_id_to_name,c.header_id_to_num_photos)}})},_load_duplicates:function(){var d,a,b,c=this;b=arguments[0],d=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[];if(d==null){d=null}return new Ajax.DBRequest("/timeline_get_duplicates",{parameters:{uniqueness_keys:Util.to_json([b])},onSuccess:function(f){var e;e=Util.from_json(f.responseText);PhotosTimeline._key_to_duplicates[b]=e;if(d){return d.apply(null,a)}}})},_batch_load_thumbs:function(){var f,e,a,d,h,c,b,g=this;a=PhotosTimeline._batch_load_thumbs_queue.first();PhotosTimeline._batch_load_thumbs_queue=PhotosTimeline._batch_load_thumbs_queue.slice(1);e=[];d=[];a.each(function(j){var k;if(j.elt.hasAttribute("data-src")){k=j.elt.readAttribute("data-src");j.elt.removeAttribute("data-src");j.elt.writeAttribute("loading-src",k);k=k.replace(/https?:\/\/[^\/]+\//,"/");e.push(k);return d.push({elt:j.elt})}});if(!e.length){return}f=PhotosTimeline._batch_thumb_endpoints[PhotosTimeline._batch_thumb_endpoint_index];PhotosTimeline._batch_thumb_endpoint_index=(PhotosTimeline._batch_thumb_endpoint_index+1)%PhotosTimeline._batch_thumb_endpoints.length;b=f+PhotosTimeline.SIZE_Q+encodeURIComponent(Util.to_json(e));h=(b.length<PhotosTimeline.MAX_URL_LENGTH?"get":"post");c=function(l){var k,j;k=l.responseText.split("\n");if(k.length<2){return}j=[];k.splice(k.length-1);d.each(function(n,m){if(k.length>m&&n.elt.hasAttribute("loading-src")){if(k[m]){n.elt.writeAttribute("src",k[m]);return n.elt.removeAttribute("loading-src")}else{n.elt.writeAttribute("data-src",n.elt.readAttribute("loading-src"));n.elt.removeAttribute("loading-src");return j.push(n)}}});if(j.length){PhotosTimeline._batch_load_thumbs_queue.push(j)}if(PhotosTimeline._batch_load_thumbs_queue.length){return PhotosTimeline._batch_load_thumbs()}};PhotosTimeline._num_batch_requests++;new Ajax.DBRequest(f+PhotosTimeline.SIZE_Q,{method:h,parameters:{image_urls:Util.to_json(e)},withCredentials:true,onInteractive:c,onSuccess:c,onComplete:function(){PhotosTimeline._num_batch_requests--}});if(PhotosTimeline._num_batch_requests<PhotosTimeline.MAX_THUMB_BATCH_REQUESTS&&PhotosTimeline._batch_load_thumbs_queue.length){return PhotosTimeline._batch_load_thumbs()}},_get_thumb_elm_for_photo:function(a){return $(a.uniqueness_key)},_get_photo_for_thumb_elm:function(a){if(!a.hasClassName("cu-thumb")){a=a.up(".cu-thumb")}if(a){return PhotosTimeline._key_to_photo[a.identify()]}else{return null}},_scroll_to_photo_with_key:function(a){var b;b=$(a);if(!b){return}Util.scroll_to_thumb(b);return PhotosTimeline._load_visible_thumbs()},_set_filter:function(b){var a;PhotosTimeline._current_filter=b;if(b===PhotosTimeline.PHOTO_FILTER){a=_("Photos only")}else{if(b===PhotosTimeline.VIDEO_FILTER){a=_("Videos only")}else{a=_("Photos and videos")}}return $$(".current-filter")[0].__date(a)},_filter:function(b){var a;a=DBHistory.deconstruct_url();if(b===PhotosTimeline.PHOTO_FILTER||b===PhotosTimeline.VIDEO_FILTER){a.qargs.filter=b}else{delete a.qargs.filter}return DBHistory.push_state(a.path,a.qargs)},_thumb_click:function(b){var a;a=PhotosTimeline._get_photo_for_thumb_elm($(b.target));if(!Constants.can_photo_share||$(b.target).hasClassName("magnify")||$(b.target).up(".magnify")){return PhotosTimeline._preview(PhotosTimeline._photos.indexOf(a))}else{return PhotosTimelineSelection.photo_click(b,a)}},_thumb_double_click:function(a){return PhotosTimeline._preview(PhotosTimeline._photos.indexOf(PhotosTimeline._get_photo_for_thumb_elm($(a.target))))},_share_selected:function(){var a;a=PhotosTimelineSelection.get().collect(function(b){return b.path});Forms.postRequest("/sm/collection",{fq_paths:Util.to_json(a)},{target:"_blank"});return PhotosTimelineSelection.clear()},_clear_selected:function(){return PhotosTimelineSelection.clear()},_remove:function(d){var g,c,f,b,a;f=d.memo.fq_paths;if(f.length===1){c=f[0];a=void 0;if(Modal.vars.photos){Modal.vars.photos.each(function(e){if(e.path===c){return a=e.uniqueness_key}})}if(!a){return PhotosTimeline._remove_photo(c)}else{if(PhotosTimeline._key_to_photo[a].path===c){g=PhotosTimeline._key_to_photo[a];b=Modal.vars.photos[1];return PhotosTimeline._remove_photo_replace_with_duplicate(g,b)}else{return delete PhotosTimeline._key_to_duplicates[a]}}}else{return f.each(function(e){return PhotosTimeline._remove_photo(e)})}},_remove_photo:function(h){var f,a,j,c,d,g,e,b;e=PhotosTimeline._photos;b=[];for(f=d=0,g=e.length;d<g;f=++d){a=e[f];if(typeof a==="object"&&a.path===h){c=PhotosTimeline._get_thumb_elm_for_photo(a).up("div").identify().slice(2);j=PhotosTimeline._photo_events.valueFromKey(c);b.push(j.remove_photo(a))}else{b.push(void 0)}}return b},_remove_photo_replace_with_duplicate:function(d,c){var a,b;b=$(d.uniqueness_key).up("div").identify().slice(2);a=PhotosTimeline._photo_events.valueFromKey(b);return a.replace_photo(d,c)},_window_scroll:function(){var a;PhotosTimeline._batch_load_thumbs_queue=[];a=new Date().getTime();if(PhotosTimeline._start_scroll_time===-1||a-PhotosTimeline._start_scroll_time<PhotosTimeline.POST_SCROLL_MAX_WAIT){clearTimeout(PhotosTimeline._last_scroll_timeout)}if(PhotosTimeline._start_scroll_time===-1){PhotosTimeline._start_scroll_time=a}return PhotosTimeline._last_scroll_timeout=setTimeout(PhotosTimeline._render,PhotosTimeline.POST_SCROLL_WAIT)},_preview:function(a){return FilePreviewModal.show(a)},_get_preview_obj:function(a){if(a.preview_type==="photo"&&a.thumbnail_url){return new PhotoPreview(a.filename,a.path,a.thumbnail_url,a.href+"&dl=1",a.href,a.display_time_taken)}else{if(a.preview_type==="video"&&a.thumbnail_url&&!Constants.DISABLE_VIDEOS_IN_LIGHTBOX){return new VideoPreview(a.filename,a.path,a.thumbnail_url,"https://"+Constants.LIVE_TRANSCODE_SERVER+"/transcode_video/w/"+a.block_hash+Util.urlquote(a.path),a.href+"&dl=1",a.display_time_taken)}}return null},_lightbox_delete:function(a){var d,c,b;d=PhotosTimeline._preview_objs.indexOf(a.memo);c=PhotosTimeline._photos[d];b=PhotosTimeline._key_to_duplicates[c.uniqueness_key];if(!b){PhotosTimeline._load_duplicates(c.uniqueness_key,PhotosTimeline._lightbox_delete,a);return}if(b.length===1){return FileOps.do_nonbrowse_delete([c.path])}else{return PhotosTimeline._show_duplicates_delete_modal(b)}},_show_duplicates_delete_modal:function(c){var b,a;c.sort(function(e,d){return d.mtime-e.mtime});b=$("cu-duplicate-files");a=[];c.each(function(d){var e;e="Dropbox"+Util.normalize(Util.parentDir(d.path));return a.push(PhotosTimeline._cu_duplicate_tmpl({small_thumbnail_url:d.thumbnail_url+"?size=32bf",filename_snippet:d.filename.em_snippet(PhotosTimeline.DUPLICATES_SNIPPET_LENGTH),path_snippet:e.em_snippet(PhotosTimeline.DUPLICATES_SNIPPET_LENGTH,0),full_path:d.path,delete_str:_("Delete")}))});b.__date(a);if(c.length>=5){b.addClassName("scroll")}else{b.removeClassName("scroll")}FilePreviewModal.toggle_delete();return Modal.icon_show("delete_32",_("Choose file to delete"),$("cu-delete-modal"),{photos:c})},delete_all_duplicates:function(){var a;a=Modal.vars.photos.collect(function(b){return b.path});return FileOps.do_nonbrowse_delete(a)},_lightbox_photo_change:function(b){var a;PhotosTimeline._selected_index=PhotosTimeline._preview_objs.indexOf(b.memo);if(typeof PhotosTimeline._preview_objs[PhotosTimeline._selected_index+PhotosTimeline.LIGHTBOX_OFFSET]!=="object"){a=1;while(typeof PhotosTimeline._preview_objs[PhotosTimeline._selected_index+a]==="object"){a++}return PhotosTimeline._photo_events.valueFromKey(PhotosTimeline._preview_objs[PhotosTimeline._selected_index+a]).render()}},_lightbox_exit:function(a){return key.setScope("all")},_history_change_handler:function(b,c){var a;a=c.filter;if(a===PhotosTimeline.PHOTO_FILTER||a===PhotosTimeline.VIDEO_FILTER){if(a!==PhotosTimeline._current_filter){PhotosTimeline._reset();PhotosTimeline._set_filter(a);PhotosTimeline._refresh_photo_events()}}else{if(PhotosTimeline._current_filter){PhotosTimeline._reset();PhotosTimeline._set_filter(null);PhotosTimeline._refresh_photo_events()}}if(PhotosTimeline._selected_index>-1){PhotosTimeline._scroll_to_photo_with_key(PhotosTimeline._photos[PhotosTimeline._selected_index].uniqueness_key);return PhotosTimeline._selected_index=-1}}};PhotosTimelineSelection={SHIFT_KEY_CODE:16,DRAG_STATUS_OFFSET:15,SCROLL_BAR_WIDTH:10,_selected:[],_highlighted:[],_dehighlighted:[],_last_selected:null,_last_mouseover:null,_drag_select:{},_marquee:{},_drag_drop:{},listen:function(){document.body.on("keydown",function(a){if(a.keyCode===PhotosTimelineSelection.SHIFT_KEY_CODE&&PhotosTimelineSelection._last_mouseover){return PhotosTimelineSelection._highlight_range(PhotosTimelineSelection._last_selected,PhotosTimelineSelection._last_mouseover)}});document.body.on("keyup",function(a){if(a.keyCode===PhotosTimelineSelection.SHIFT_KEY_CODE&&!PhotosTimelineSelection._marquee.active){return PhotosTimelineSelection.clear_highlighted()}});document.body.on("mouseover",".cu-thumb",PhotosTimelineSelection._photo_mouseover);document.body.on("mouseout",".cu-thumb",PhotosTimelineSelection._photo_mouseout);document.body.on("mouseover",".photo-collection",PhotosTimelineSelection._collection_mouseover);document.body.on("mouseup",".photo-collection",PhotosTimelineSelection._collection_mouseup);document.body.on("mouseout",".photo-collection",PhotosTimelineSelection._collection_mouseout);document.body.on("mousedown",PhotosTimelineSelection._body_mousedown);document.body.on("mousemove",PhotosTimelineSelection._body_mousemove);document.body.on("mouseup",PhotosTimelineSelection._body_mouseup);return document.body.on("dblclick",PhotosTimelineSelection._body_double_click)},get:function(){return PhotosTimelineSelection._selected},clear:function(){PhotosTimelineSelection._selected=[];PhotosTimelineSelection._last_selected=null;$$(".cu-thumb.selected").invoke("removeClassName","selected");return $("selected-actions").hide()},clear_highlighted:function(){PhotosTimelineSelection._highlighted=[];PhotosTimelineSelection._dehighlighted=[];$$(".cu-thumb.highlighted").invoke("removeClassName","highlighted");return $$(".cu-thumb.dehighlighted").invoke("removeClassName","dehighlighted")},photo_click:function(b,a){if(b.isRightClick()){return}if(b.shiftKey){return PhotosTimelineSelection._select_highlighted()}else{if(PhotosTimelineSelection._contains(a)){return PhotosTimelineSelection._remove(a)}else{return PhotosTimelineSelection._add(a)}}},_photo_mouseover:function(a){PhotosTimelineSelection._last_mouseover=PhotosTimeline._get_photo_for_thumb_elm($(a.target));if(a.shiftKey){return PhotosTimelineSelection._highlight_range(PhotosTimelineSelection._last_selected,PhotosTimelineSelection._last_mouseover)}else{if(PhotosTimelineSelection._drag_select.active){return PhotosTimelineSelection._highlight_range(PhotosTimelineSelection._drag_select.anchor,PhotosTimelineSelection._last_mouseover)}}},_photo_mouseout:function(a){if(!PhotosTimelineSelection._marquee.active){PhotosTimelineSelection.clear_highlighted();return PhotosTimelineSelection._last_mouseover=null}},_body_mousedown:function(c){var a,b;if(c.isRightClick()){return}a=PhotosTimeline._get_photo_for_thumb_elm($(c.target));if(a){if(PhotosTimelineSelection._contains(a)){PhotosTimelineSelection._drag_drop.active=true;PhotosTimelineSelection._build_drag_status(a);return PhotosTimelineSelection._update_drag_status_position(c)}else{PhotosTimelineSelection._drag_select.active=true;return PhotosTimelineSelection._drag_select.anchor=a}}else{b=Util.scroll_offsets();if(c.clientX+b.left>=$(document.body).getWidth()-PhotosTimelineSelection.SCROLL_BAR_WIDTH){return}PhotosTimelineSelection._marquee.active=true;PhotosTimelineSelection._marquee.start_x=c.clientX+b.left;PhotosTimelineSelection._marquee.start_y=c.clientY+b.top;PhotosTimelineSelection._update_marquee_x_bounds(PhotosTimelineSelection._marquee.start_x);return PhotosTimelineSelection._update_marquee_y_bounds(PhotosTimelineSelection._marquee.start_y)}},_body_mousemove:function(b){var a;if(PhotosTimelineSelection._marquee.active){a=Util.scroll_offsets();PhotosTimelineSelection._marquee.end_x=b.clientX+a.left;PhotosTimelineSelection._marquee.end_y=b.clientY+a.top;return PhotosTimelineSelection._draw_marquee()}else{if(PhotosTimelineSelection._drag_drop.active){PhotosTimelineSelection._update_drag_status_position(b);return $("photos-drag-status").addClassName("active")}}},_body_mouseup:function(a){if(PhotosTimelineSelection._drag_select.active){PhotosTimelineSelection._drag_select.active=false;PhotosTimelineSelection._select_highlighted()}if(PhotosTimelineSelection._marquee.active){PhotosTimelineSelection._marquee.active=false;$("marquee").hide();PhotosTimelineSelection._select_highlighted()}if(PhotosTimelineSelection._drag_drop.active){PhotosTimelineSelection._drag_drop.active=false;return $("photos-drag-status").removeClassName("active")}},_body_double_click:function(a){if(!PhotosTimeline._get_photo_for_thumb_elm($(a.target))){return PhotosTimelineSelection.clear()}},_collection_mouseover:function(b){var a;if(PhotosTimelineSelection._drag_drop.active){a=$(b.target);if(!a.hasClassName("photo-collection")){a=a.up(".photo-collection")}return a.addClassName("hovered")}},_collection_mouseout:function(b){var a;if(PhotosTimelineSelection._drag_drop.active){a=$(b.target);if(!a.hasClassName("photo-collection")){a=a.up(".photo-collection")}return a.removeClassName("hovered")}},_collection_mouseup:function(c){var a,f,d,b,g=this;if(PhotosTimelineSelection._drag_drop.active){b=$(c.target);if(!b.hasClassName("photo-collection")){b=b.up(".photo-collection")}b.removeClassName("hovered");if(b.identify()==="new-collection-text"){f=PhotosTimelineSelection.get().collect(function(e){return e.path});b.__sert({after:new Element("li",{id:"new-added-collection","class":"photo-collection"})});d=function(h){var e,j;PhotosTimelineSelection.clear();e=h.responseText;$("new-added-collection").__date((new Element("a")).__date(e.em_snippet(9,1)));$("new-added-collection").removeAttribute("id");j=ungettext("Moved %(num_photos)s photos into %(collection_name)s","Moved %(num_photos)s photos into %(collection_name)s",f.length).format({num_photos:f.length,collection_name:e});Notify.server_success(j);return a.dispose()};a=new Ajax.InPlaceEditor($("new-added-collection"),"/sm/collection",{htmlResponse:false,okControl:false,cancelControl:false,highlightColor:"transparent",highlightEndColor:"transparent",clickToEditText:"",cols:11,ajaxClass:Ajax.DBRequest,submitOnBlur:true,onFailure:function(){},savingText:"<a>"+_("Creating...</a>"),ajaxOptions:{method:"POST",onSuccess:d},callback:function(e,h){return{collection_name:h,fq_paths:Util.to_json(f),redirect:false}}});return a.enterEditMode()}else{return PhotosTimelineSelection._add_selected_to_collection(b.readAttribute("data-name"))}}},_draw_marquee:function(){var a,e,d,c,b;b=Math.abs(PhotosTimelineSelection._marquee.start_x-PhotosTimelineSelection._marquee.end_x);a=Math.abs(PhotosTimelineSelection._marquee.start_y-PhotosTimelineSelection._marquee.end_y);d=Math.min(PhotosTimelineSelection._marquee.start_y,PhotosTimelineSelection._marquee.end_y);e=Math.min(PhotosTimelineSelection._marquee.start_x,PhotosTimelineSelection._marquee.end_x);$("marquee").setStyle({width:b+"px",height:a+"px",top:d+"px",left:e+"px"});$("marquee").show();c=false;if(PhotosTimelineSelection._marquee.end_x>=PhotosTimelineSelection._marquee.x_max_boundary||PhotosTimelineSelection._marquee.end_x<=PhotosTimelineSelection._marquee.x_min_boundary){PhotosTimelineSelection._update_marquee_x_bounds(PhotosTimelineSelection._marquee.end_x);c=true}if(PhotosTimelineSelection._marquee.end_y>=PhotosTimelineSelection._marquee.y_max_boundary||PhotosTimelineSelection._marquee.end_y<=PhotosTimelineSelection._marquee.y_min_boundary){PhotosTimelineSelection._update_marquee_y_bounds(PhotosTimelineSelection._marquee.end_y);c=true}if(c){return PhotosTimelineSelection._update_marquee_highlight(d,e,b,a)}},_update_marquee_highlight:function(m,c,a,o){var k,l,h,b,g,f,n,j,e,d;PhotosTimelineSelection.clear_highlighted();b=[];l=PhotosTimeline._grid.photo_col_offsets.length;j=PhotosTimeline._grid.photo_col_offsets.slice(0,l-1);for(k=g=0,n=j.length;g<n;k=++g){h=j[k];if(h<=c+a&&PhotosTimeline._grid.photo_col_offsets[k+1]>=c){b.push(k)}}d=[];for(k=f=0,e=PhotosTimeline._photo_events.length();0<=e?f<e:f>e;k=0<=e?++f:--f){d.push(PhotosTimeline._photo_events.valueAtIndex(k).marquee_highlight(m,m+o,b))}return d},_update_marquee_x_bounds:function(a){var d,g,h,f,c,e,b;g=$(document.body).getWidth();if(a<PhotosTimeline._grid.photo_col_offsets.first()){PhotosTimelineSelection._marquee.x_min_boundary=-1;return PhotosTimelineSelection._marquee.x_max_boundary=PhotosTimeline._grid.photo_col_offsets.first()}else{if(a>PhotosTimeline._grid.photo_col_offsets.last()){PhotosTimelineSelection._marquee.x_min_boundary=PhotosTimeline._grid.photo_col_offsets.last();return PhotosTimelineSelection._marquee.x_max_boundary=g}else{e=PhotosTimeline._grid.photo_col_offsets;b=[];for(d=f=0,c=e.length;f<c;d=++f){h=e[d];if(h>a){PhotosTimelineSelection._marquee.x_min_boundary=PhotosTimeline._grid.photo_col_offsets[d-1];PhotosTimelineSelection._marquee.x_max_boundary=h;break}else{b.push(void 0)}}return b}}},_update_marquee_y_bounds:function(h){var a,e,d,g,c,f,b;d=$(document.body).getHeight();if(h<PhotosTimeline._grid.photo_row_offsets.first()){PhotosTimelineSelection._marquee.y_min_boundary=-1;return PhotosTimelineSelection._marquee.y_max_boundary=PhotosTimeline._grid.photo_row_offsets.first()}else{if(h>PhotosTimeline._grid.photo_row_offsets.last()){PhotosTimelineSelection._marquee.y_min_boundary=PhotosTimeline._grid.photo_row_offsets.last();return PhotosTimelineSelection._marquee.y_max_boundary=d}else{f=PhotosTimeline._grid.photo_row_offsets;b=[];for(e=g=0,c=f.length;g<c;e=++g){a=f[e];if(a>h){PhotosTimelineSelection._marquee.y_min_boundary=PhotosTimeline._grid.photo_row_offsets[e-1];PhotosTimelineSelection._marquee.y_max_boundary=a;break}else{b.push(void 0)}}return b}}},_build_drag_status:function(c){var a,b;a=PhotosTimeline._get_thumb_elm_for_photo(c);b=a.down("img.thumb-content").cloneNode(false);$("photos-drag-status").down(".thumb").__date(b);return $("photos-drag-status").down(".count").__date(PhotosTimelineSelection._selected.length)},_update_drag_status_position:function(a){return $("photos-drag-status").setStyle({left:(a.pointerX()-Util.scroll_offsets().left+PhotosTimelineSelection.DRAG_STATUS_OFFSET)+"px",top:(a.pointerY()-Util.scroll_offsets().top+PhotosTimelineSelection.DRAG_STATUS_OFFSET)+"px"})},_highlight_range:function(g,d){var f,e,c,b,a,h;PhotosTimelineSelection.clear_highlighted();e=PhotosTimeline._photos.indexOf(g);a=PhotosTimeline._photos.indexOf(d);b=void 0;f=PhotosTimelineSelection._contains(d)&&!PhotosTimelineSelection._contains(g);for(c=h=e;e<=a?h<=a:h>=a;c=e<=a?++h:--h){b=PhotosTimeline._photos[c];if(typeof b!=="object"){PhotosTimeline._photo_events.valueFromKey(b).render(PhotosTimelineSelection._highlight_range,g,d);return}if(PhotosTimelineSelection._contains(b)){if(f){PhotosTimelineSelection._dehighlight(b)}}else{if(!f){PhotosTimelineSelection._highlight(b)}}}},_highlight_list:function(d){var c,e,b,a;PhotosTimelineSelection.clear_highlighted();a=[];for(e=0,b=d.length;e<b;e++){c=d[e];if(!PhotosTimelineSelection._contains(c)){a.push(PhotosTimelineSelection._highlight(c))}else{a.push(void 0)}}return a},_select_highlighted:function(){var d,g,e,c,b,f,a;f=PhotosTimelineSelection._highlighted;for(g=0,c=f.length;g<c;g++){d=f[g];PhotosTimelineSelection._add(d)}a=PhotosTimelineSelection._dehighlighted;for(e=0,b=a.length;e<b;e++){d=a[e];PhotosTimelineSelection._remove(d)}return PhotosTimelineSelection.clear_highlighted()},_add_selected_to_collection:function(a){var b;b=PhotosTimelineSelection.get().collect(function(c){return c.path});return new Ajax.DBRequest("/sm/collection_add",{parameters:{collection_name:a,fq_paths:Util.to_json(b)},onSuccess:function(c){var d;PhotosTimelineSelection.clear();d=ungettext("Moved %(num_photos)s photos into %(collection_name)s","Moved %(num_photos)s photos into %(collection_name)s",b.length).format({num_photos:b.length,collection_name:a});return Notify.server_success(d)}})},_contains:function(a){return PhotosTimelineSelection._selected.indexOf(a)!==-1},_highlight:function(b){var a;a=PhotosTimeline._get_thumb_elm_for_photo(b);PhotosTimelineSelection._highlighted.push(b);return a.addClassName("highlighted")},_dehighlight:function(b){var a;a=PhotosTimeline._get_thumb_elm_for_photo(b);PhotosTimelineSelection._dehighlighted.push(b);return a.addClassName("dehighlighted")},_add:function(b){var a;a=PhotosTimeline._get_thumb_elm_for_photo(b);PhotosTimelineSelection._selected.push(b);a.addClassName("selected");PhotosTimelineSelection._last_selected=b;DomUtil.fillVal(PhotosTimelineSelection._selected.length,"num-selected");return $("selected-actions").show()},_remove:function(b){var a;a=PhotosTimeline._get_thumb_elm_for_photo(b);PhotosTimelineSelection._selected.splice(PhotosTimelineSelection._selected.indexOf(b),1);a.removeClassName("selected");PhotosTimelineSelection._last_selected=b;if(PhotosTimelineSelection._selected.length){return DomUtil.fillVal(PhotosTimelineSelection._selected.length,"num-selected")}else{return $("selected-actions").hide()}}};PhotoEvent=(function(){a.unique_id;a.name;a.num_photos;a.photos=[];a.header_html;a.placeholder_html;a.height;a.top_offset;a.has_rendered;a.photo_index_offset;function a(d,b,c,e){this.unique_id=d;this.name=b;this.num_photos=c;this.photo_index_offset=e;this.has_rendered=false;this._generate_header();this._generate_placeholder();this._create_global_array_placeholders()}a.prototype._generate_header=function(){this.header_html=new HTML('<h1 class="cu-month-header" id="h_'+this.unique_id+'">'+this.name+"</h1>")};a.prototype._generate_placeholder=function(){var b;b=(Math.ceil(this.num_photos/PhotosTimeline.THUMBS_PER_ROW))*PhotosTimeline.THUMB_SIZE;this.placeholder_html=new HTML('<div style="height:'+b+'px;" class="content-placeholder" id="p_'+this.unique_id+'"></div>');return this.height=PhotosTimeline.HEADER_HEIGHT+b};a.prototype._create_global_array_placeholders=function(){var c,e,d,b;b=[];for(c=e=0,d=this.num_photos;0<=d?e<d:e>d;c=0<=d?++e:--e){PhotosTimeline._preview_objs[this.photo_index_offset+c]=this.unique_id;b.push(PhotosTimeline._photos[this.photo_index_offset+c]=this.unique_id)}return b};a.prototype.create_global_row_heights=function(){var f,d,c,e,b;c=Math.ceil(this.num_photos/PhotosTimeline.THUMBS_PER_ROW);f=this.top_offset;PhotosTimeline._grid.photo_row_offsets.push(f);f+=PhotosTimeline.HEADER_HEIGHT;b=[];for(d=e=0;0<=c?e<c:e>c;d=0<=c?++e:--e){b.push(PhotosTimeline._grid.photo_row_offsets[this.photo_index_offset+d]=f+d*PhotosTimeline.THUMB_SIZE)}return b};a.prototype.render=function(){var h,f,c,k,b,e,j,g,d=this;h=arguments[0],f=2<=arguments.length?__slice.call(arguments,1):[];if(h==null){h=null}if(!this.has_rendered&&!this.is_rendering){this.is_rendering=true;g=parseInt(String(this.unique_id).substring(0,4),10);e=parseInt(String(this.unique_id).substring(4,10));c=new Date(Date.UTC(g,e-1,1,0,0,0,0));j=new Date(g,e,0).getDate();k=new Date(Date.UTC(g,e-1,j,23,59,59));b=Util.to_json({date_begin:c.getTime(),date_end:k.getTime(),filter_string:PhotosTimeline._current_filter});return new Ajax.DBRequest("/timeline_month_metadata",{parameters:{filter:b},onSuccess:function(l){return d._timeline_metadata_callback(Util.from_json(l.responseText),h,f)},onFailure:function(l){return d.is_rendering=false}})}};a.prototype._timeline_metadata_callback=function(c,n,h){var j,d,g,b,o,l,m,e,k,f;this.photos=c;d=[];f=this.photos;for(g=e=0,k=f.length;e<k;g=++e){b=f[g];j=new Date(0);l=j.getTimezoneOffset();o=b.time_taken+l*60000;j.setMilliseconds(o);d.push(PhotosTimeline._tmpl({photo:b,display_date:Util.niceDateWithMonthName(j,j.getFullYear()<new Date().getFullYear())}));PhotosTimeline._preview_objs[this.photo_index_offset+g]=PhotosTimeline._get_preview_obj(b);PhotosTimeline._photos[this.photo_index_offset+g]=b;PhotosTimeline._key_to_photo[b.uniqueness_key]=b}$("p_"+this.unique_id).__sert(d);$("p_"+this.unique_id).setStyle({backgroundImage:"none"});this.is_rendering=false;this.has_rendered=true;if(n){n.apply(null,h)}m=Util.get_viewport();return this.load_visible_thumbs(m.top,m.top+m.height)};a.prototype.add_html_elements_to=function(b){b.__sert(this.header_html);return b.__sert(this.placeholder_html)};a.prototype.load_visible_thumbs=function(c,h){var j,g,d,m,l,b,e,k,f;if(this.top_offset>h||this.top_offset+this.height<c||!this.has_rendered){return}c-=this.top_offset;h-=this.top_offset;l=Util.calc_thumb_prep_size();j=[];f=this.photos;for(g=e=0,k=f.length;e<k;g=++e){d=f[g];m=PhotosTimeline.HEADER_HEIGHT+Math.floor(g/PhotosTimeline.THUMBS_PER_ROW)*PhotosTimeline.THUMB_SIZE;if((m+PhotosTimeline.THUMB_SIZE>c&&m+PhotosTimeline.THUMB_SIZE<h)||(m<h&&m>c)){b=$(d.uniqueness_key);if(b.down("img").hasAttribute("data-src")){if(Prototype.BrowserFeatures.DB_CORS&&PhotosTimeline._batch_thumb_endpoints.length){j.push({elt:b.down("img")});if(j.length===PhotosTimeline.THUMBS_BATCH_SIZE){PhotosTimeline._batch_load_thumbs_queue.push(j);j=[]}}else{Util.thumb_load(b.down("img"),l,on_thumb_load(b))}}}}if(j.length){PhotosTimeline._batch_load_thumbs_queue.push(j)}if(PhotosTimeline._batch_load_thumbs_queue.length){PhotosTimeline._batch_load_thumbs()}};a.prototype.marquee_highlight=function(b,h,e){var c,j,k,m,d,g,f,l;if(this.top_offset>h||this.top_offset+this.height<b||!this.has_rendered){return}if(b<this.top_offset){h-=this.top_offset;if(h<=PhotosTimeline.HEADER_HEIGHT){return}d=0;m=Math.floor((h-PhotosTimeline.HEADER_HEIGHT)/PhotosTimeline.THUMB_SIZE)}else{if(h>this.top_offset+this.height){b-=this.top_offset;m=Math.ceil(this.num_photos/PhotosTimeline.THUMBS_PER_ROW);if(b<=PhotosTimeline.HEADER_HEIGHT){d=0}else{d=Math.floor((b-PhotosTimeline.HEADER_HEIGHT)/PhotosTimeline.THUMB_SIZE)}}else{b-=this.top_offset;h-=this.top_offset;if(b<=PhotosTimeline.HEADER_HEIGHT&&h<=PhotosTimeline.HEADER_HEIGHT){return}else{if(b<=PhotosTimeline.HEADER_HEIGHT){d=0;m=Math.floor((h-PhotosTimeline.HEADER_HEIGHT)/PhotosTimeline.THUMB_SIZE)}else{d=Math.floor((b-PhotosTimeline.HEADER_HEIGHT)/PhotosTimeline.THUMB_SIZE);m=Math.floor((h-PhotosTimeline.HEADER_HEIGHT)/PhotosTimeline.THUMB_SIZE)}}}}for(k=g=d;d<=m?g<=m:g>=m;k=d<=m?++g:--g){for(f=0,l=e.length;f<l;f++){c=e[f];j=PhotosTimeline.THUMBS_PER_ROW*k+c;if(j<this.num_photos){PhotosTimelineSelection._highlight(this.photos[j])}}}};a.prototype.remove_photo=function(d){var e,c,b,j,f,h,g;f=this.photos.indexOf(d);j=this.photo_index_offset+f;this.photos.splice(f,1);this.num_photos--;c=(Math.ceil(this.num_photos/PhotosTimeline.THUMBS_PER_ROW))*PhotosTimeline.THUMB_SIZE;$("p_"+this.unique_id).setStyle({height:c+"px"});$(PhotosTimeline._photos[j].uniqueness_key).remove();PhotosTimeline._photos.splice(j,1);for(e=h=0,g=PhotosTimeline._photo_events.length();0<=g?h<g:h>g;e=0<=g?++h:--h){b=PhotosTimeline._photo_events.valueAtIndex(e);if(b.photo_index_offset>this.photo_index_offset){b.photo_index_offset--}}};a.prototype.replace_photo=function(e,d){var c,b;b=this.photos.indexOf(e);c=b+this.photo_index_offset;this.photos[b]=d;PhotosTimeline._photos[c]=d;PhotosTimeline._preview_objs.splice(c,0,PhotosTimeline._get_preview_obj(d));$(e.uniqueness_key).down("img").setAttribute("src",d.thumbnail_url+PhotosTimeline.SIZE_Q);FilePreviewModal.jump_to(c)};return a})();var FilePreview;FilePreview={PARTIAL_TEXT_LENGTH_THRESHOLD:64*1024,init_doc:function(){var a;a=new DocViewer({id:"crocodoc-preview",zoom:"auto"});a.bind("fail",this._preview_failed);return jQuery(".doc").attr("tabindex",0).focus()},init_font:function(){var a=this;return document.observe("dom:loaded",function(){if(!$(document.documentElement).hasClassName("fontface")||$(document.body).hasClassName("gecko")){return $(document.body).removeClassName("file-preview-body")}})},init_photo:function(g,d){var a,f,c,e,b;$("preview-img").observe("error",this._preview_failed.bind(this));document.observe("dom:loaded",this.resize_preview_img.bind(this));setInterval(this.resize_preview_img,500);$("preview-img").src=g;e=$$("#preview-img, #full-img");b=[];for(f=0,c=e.length;f<c;f++){a=e[f];a.setAttribute("data-original-href",d);b.push(a.on("contextmenu","img",ContextMenu.show_shmodel.bind(ContextMenu)))}return b},init_text:function(d,b){var c,f,e,a,g=this;c=0;e=function(j){var h;if(!j.responseText){return}h=j.responseText.length;if(c===0&&h>g.PARTIAL_TEXT_LENGTH_THRESHOLD){a(j.responseText,true);return c=h}};f=function(h){return a(h.responseText)};window.got_text=function(h){if(h){h=Util.decode_b64(h)}return a(h)};a=function(h,j){var l,m,k;if(!h||!h.length){$("code-wrapper").remove();return}if((k=$("code-loading"))!=null){k.remove()}l=$("code").className;m=h.substring(c);$("code").appendChild(document.createTextNode(m));if(b&&!j){SyntaxHighlighter.defaults.toolbar=false;SyntaxHighlighter.defaults["quick-code"]=false;SyntaxHighlighter.highlight($("code"))}return window.filled_text=1};return document.observe("dom:loaded",function(){if(Prototype.BrowserFeatures.DB_CORS){new Ajax.DBRequest(d,{method:"GET",parameters:{},log_timing:true,withCredentials:true,onInteractive:e,onSuccess:f})}else{Util.add_script(Util.add_qstring(d,{js_callback:"got_text",b64:"1"}))}return setTimeout((function(){if(!window.filled_text){return g._preview_failed()}}),10000)})},init_video:function(c,d,a,b){var e=this;return document.observe("dom:loaded",function(){var f;f=e._preview_failed;if(b==="hls"){return Util.embed_video(a,"video",828,true,false)}else{if(c){$("video").__date();if(d){Util.embed_h264_video(a,"video",828,true,false,f)}else{f()}}else{if(FlashDetect.installed){$("video").__date();Util.embed_flash_video(a,"video",828,true)}else{f()}}return document.observe(JWPlayerError,f)}})},resize_preview_img:function(){var c,b,a;c=document.viewport.getDimensions();a=(c.width-56)+"px";b=(c.height-103)+"px";return $("preview-img").setStyle({maxHeight:b,maxWidth:a})},_preview_failed:function(){var a;a=$(document.body);if(a.hasClassName("shmodel-body")){return a.removeClassName("file-preview-body")}}};var parse_color_to_rgba;Effect.BlindFadeUp=function(d,c){var b,a;b=new Effect.BlindUp(d,c);a=new Effect.Fade(d,c);this.cancel=function(){b.cancel();return a.cancel()}};Effect.BlindFadeDown=function(d,c){var b,a;b=new Effect.BlindDown(d,c);a=new Effect.Appear(d,c);this.cancel=function(){b.cancel();return a.cancel()}};Effect.Flash=function(c,b,a){assert(b.startcolor&&b.endcolor,"Start and end colors must be specified");assert(b.cycles,"Fade cycles must be specified");a=a||0;return new Effect.Highlight(c,{duration:1,startcolor:b.startcolor,endcolor:b.endcolor,restorecolor:b.endcolor,afterFinish:function(){return new Effect.Highlight(c,{duration:1,startcolor:b.endcolor,endcolor:b.startcolor,restorecolor:b.startcolor,afterFinish:function(){if(a<b.cycles){return Effect.Flash(c,b,a+1)}}})}})};Effect.ScaleComprehensive=Class.create(Effect.Scale,{setup:function(){var s,q,y,m,r,t,n,o,h,e,c,b,z,E,C,A,x,w,v,u,a,F,D,B,p,l,j,g,d,f;this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};p=["top","left","width","height","fontSize"];for(h=0,z=p.length;h<z;h++){t=p[h];this.originalStyle[t]=this.element.style[t]}this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;m=this.element.getStyle("font-size")||"100%";l=["em","px","%","pt"];for(e=0,E=l.length;e<E;e++){r=l[e];if(m.indexOf(r)>0){this.fontSize=parseFloat(m);this.fontSizeType=r}}this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;if(this.options.scaleMode==="box"){this.dims={height:this.element.offsetHeight,width:this.element.offsetWidth}}if(/^content/.test(this.options.scaleMode)){this.dims={height:this.element.scrollHeight,width:this.element.scrollWidth}}if(!this.dims){this.dims={height:this.options.scaleMode.originalHeight,width:this.options.scaleMode.originalWidth}}this.full_height=this.dims.height;this.full_width=this.dims.width;q=["border%sWidth","margin%s","padding%s"];for(c=0,C=q.length;c<C;c++){n=q[c];j=["Top","Bottom","Left","Right"];for(b=0,A=j.length;b<A;b++){y=j[b];o=n.format(y);this.dims[o]=parseFloat(this.element.getStyle(o));if(y==="Top"||y==="Bottom"){this.full_height+=this.dims[o]}else{this.full_width+=this.dims[o]}}}this.attrs_vertical=[];this.attrs_horizontal=[];if(this.options.scaleX){for(a=0,x=q.length;a<x;a++){s=q[a];this.attrs_horizontal.push(s.format("Left"))}this.attrs_horizontal.push("width");g=q.reverse();for(F=0,w=g.length;F<w;F++){s=g[F];this.attrs_horizontal.push(s.format("Right"))}}if(this.options.scaleY){for(D=0,v=q.length;D<v;D++){s=q[D];this.attrs_vertical.push(s.format("Top"))}this.attrs_vertical.push("height");d=q.reverse();f=[];for(B=0,u=d.length;B<u;B++){s=d[B];f.push(this.attrs_vertical.push(s.format("Bottom")))}return f}},update:function(a){var b;b=(this.options.scaleFrom/100)+(this.factor*a);b=(-0.5+1/(1+Math.exp((0.5-b)*7)))*1.055+0.5;if(this.options.scaleContent&&this.fontSize){this.element.setStyle({fontSize:this.fontSize*b+this.fontSizeType})}return this.setDimensions(b)},setDimensions:function(f){var l,o,m,j,k,b,g,e,n,a,h,c;m={};h=[[this.full_width,this.attrs_horizontal],[this.full_height,this.attrs_vertical]];for(g=0,n=h.length;g<n;g++){c=h[g],j=c[0],o=c[1];k=j*f;for(e=0,a=o.length;e<a;e++){l=o[e];b=this.dims[l];if(b<k){m[l]=b+"px";k-=b}else{m[l]=k.round()+"px";k=0}}}return this.element.setStyle(m)}});Effect.BlindUpComprehensive=function(a){a=$(a);a.makeClipping();return new Effect.ScaleComprehensive(a,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(b){return b.element.hide().undoClipping()}},arguments[1]||{}))};Effect.BlindDownComprehensive=function(b){var a;b=$(b);a=b.getDimensions();return new Effect.ScaleComprehensive(b,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:a.height,originalWidth:a.width},restoreAfterFinish:true,afterSetup:function(c){return c.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(c){return c.element.undoClipping()}},arguments[1]||{}))};Effect.HighlightForcedWithAlpha=Class.create(Effect.Highlight,{setup:function(){var k,h,c,g,j,d,l,f,b,a;this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor){this.options.endcolor=this.element.getStyle("background-color")}if(!this.options.restorecolor){this.options.restorecolor=this.element.getStyle("background-color")}this._supports_alpha=false;try{h=new Element("div");j="rgba(1, 1, 1, 0)";h.setStyle({backgroundColor:j});this._supports_alpha=(h.getStyle("background-color"))===j}catch(m){}this._base=parse_color_to_rgba(this.options.startcolor);if((f=this.options.endcolor)==="transparent"||f==="rgba(0, 0, 0, 0)"){if(this._supports_alpha){c=this._base.slice(0);c[3]=0}else{c=[255,255,255,1]}}else{c=parse_color_to_rgba(this.options.endcolor)}this._delta=[];b=this._base;a=[];for(g=d=0,l=b.length;d<l;g=++d){k=b[g];a.push(this._delta.push(c[g]-k))}return a},update:function(a){var h,c,g,d,f,b,e;g=[];e=this._base;for(d=f=0,b=e.length;f<b;d=++f){h=e[d];c=h+this._delta[d]*a;if(!(d>2)){c=Math.round(c)}g.push(c)}if(this._supports_alpha){return this.element.setStyle({backgroundColor:"rgba("+(g.join(", "))+")"})}else{return this.element.setStyle({backgroundColor:"rgb("+(g.slice(0,3).join(", "))+")"})}}});parse_color_to_rgba=function(c){var d,g,f,e,a,b,h,k,j;b=/^rgb\((\d{1,3}), ?(\d{1,3}), ?(\d{1,3})\)$/;a=/^rgba\((\d{1,3}), ?(\d{1,3}), ?(\d{1,3}), ?(\d+?\.?\d*)\)$/;e=/^#([0-9A-F])([0-9A-F])([0-9A-F])$/i;g=/^#([0-9A-F])([0-9A-F])([0-9A-F])([0-9A-F])$/i;f=/^#([0-9A-F][0-9A-F])([0-9A-F][0-9A-F])([0-9A-F][0-9A-F])$/i;d=/^#([0-9A-F][0-9A-F])([0-9A-F][0-9A-F])([0-9A-F][0-9A-F])([0-9A-F][0-9A-F])$/i;if(k=c.match(b)){j=(function(){var o,m,n,l;n=k.slice(1);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c,10))}return l})()}else{if(k=c.match(a)){j=(function(){var o,m,n,l;n=k.slice(1,4);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c,10))}return l})();j[3]=parseFloat(k[4])}else{if(k=c.match(e)){j=(function(){var o,m,n,l;n=k.slice(1);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c+c,16))}return l})()}else{if(k=c.match(g)){j=(function(){var o,m,n,l;n=k.slice(1);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c+c,16))}return l})()}else{if(k=c.match(f)){j=(function(){var o,m,n,l;n=k.slice(1);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c,16))}return l})()}else{if(k=c.match(d)){j=(function(){var o,m,n,l;n=k.slice(1);l=[];for(o=0,m=n.length;o<m;o++){c=n[o];l.push(parseInt(c,16))}return l})()}}}}}}j=j||[255,255,255,1];h=j.length;if(h===3){j.push(1)}else{if(h===4&&j[h-1]>1){j[h-1]=j[h-1]/255}}return j};var ClientDownload;ClientDownload=(function(){function a(){}a.prototype.show_download_modal=function(){return new Ajax.DBRequest("/download_modal_view",{onSuccess:function(b){var c;c=new Element("div",{id:"modal-download-header"});c.__sert(_("Install Dropbox"));return Modal.show(c,$("client-download"),{},false,450)}})};return a})();var WebTimingLogger;WebTimingLogger={init:function(){if(!Constants.WEB_TIMING_ENABLED||!window.performance){return}if(document.readyState==="complete"){return WebTimingLogger._log_navigation.defer()}else{return Event.observe(window,"load",function(){return WebTimingLogger._log_navigation.defer()})}},_log_navigation:function(){var b,c,a;a=window.performance&&window.performance.timing;if(!a){return}c=a.navigationStart||a.fetchStart;if(!c){return}b={navigation_type:WebTimingLogger._get_navigation_type(),redirect_time:a.fetchStart-c,connect_time:a.requestStart-c,time_to_first_byte:a.responseStart-c,dom_load_time:a.domContentLoadedEventEnd-c,page_load_time:a.loadEventEnd-c};return WebTimingLogger._log(b)},log_ajax_transition:function(b){var a;a={navigation_type:"ajax",page_load_time:b};return WebTimingLogger._log(a)},_log:function(a){if(!Constants.WEB_TIMING_ENABLED){return}a.url=window.location.href;a.source_type="web";return new Ajax.DBRequest("/web_timing_log",{noAutonotify:true,parameters:a})},_get_navigation_type:function(){switch(window.performance.navigation.type){case 0:return"navigate";case 1:return"reload";case 2:return"back_forward"}}};var HiRes,_this=this;HiRes=(function(){var a;a=false;if("devicePixelRatio" in window&&window.devicePixelRatio>1){a=true}return{init:function(){var j,h,f,e,d,g,b,c;if(!a){return}g=$$("[data-hi-res]");for(h=0,e=g.length;h<e;h++){j=g[h];this._replace(j,j.readAttribute("data-hi-res"),this._replace_img)}b=$$("[data-hi-res-background]");c=[];for(f=0,d=b.length;f<d;f++){j=b[f];c.push(this._replace(j,j.readAttribute("data-hi-res-background"),this._replace_background))}return c},get_background:function(c,b){if(!a){return}return this._replace(c,b,this._replace_background)},_replace:function(e,c,d){var b;if(!c){return}b=new Image();b.src=c;return b.observe("load",function(){return d(e,c)})},_replace_img:function(c,b){return c.src=b},_replace_background:function(d,b){var c;c="url('%(src)s')".format({src:b});return d.setStyle({backgroundImage:c})}}})();document.observe("dom:loaded",function(){return HiRes.init()});var TwoFactorAuth;TwoFactorAuth={_checkpoint_tkey:null,_container_selector:null,_error_selector:null,login_init:function(){var a;this._container_selector="#twofactor-confirm";this._error_selector="#twofactor-confirm .error-message";this._checkpoint_tkey=(a=DBHistory.deconstruct_url().qargs)!=null?a.cpt:void 0;return this.login_listen()},login_listen:function(){return $("resend-link").observe("click",this.resend_phone_code.bind(this))},account_init:function(b){var e,d,a,c;this._container_selector=".twofactor-account-form";this._error_selector=".twofactor-account-form .error-message";c=$$(".email-placeholder");for(d=0,a=c.length;d<a;d++){e=c[d];e.__date(b)}return this.account_listen()},account_listen:function(){var d,c,a,b;b=$$("#enable-twofactor, #disable-twofactor");for(c=0,a=b.length;c<a;c++){d=b[c];d.observe("click",function(f){return f.preventDefault()})}$("enable-twofactor").observe("click",this.show_enable_start.bind(this));$("disable-twofactor").observe("click",this.disable_show_enter_password.bind(this));$("twofactor-start").observe("submit",this.show_enter_password.bind(this));$("twofactor-enter-password").observe("submit",this.submit_password.bind(this));$("twofactor-enter-phone").observe("submit",this.submit_phone_number.bind(this));$("twofactor-confirm-phone").observe("submit",this.submit_phone_code.bind(this));$("resend-link").observe("click",this.enable_resend_phone_code.bind(this));$("twofactor-done").observe("submit",this.submit_done.bind(this));$("twofactor-disable-enter-password").observe("submit",this.disable_submit_password.bind(this));$("twofactor-disable").observe("submit",this.disable_submit.bind(this));return $("cancel-button").observe("click",Modal.hide)},resend_phone_code:function(a){var b=this;Event.stop(a);if(this.is_resending()){return}this.show_resending();return new Ajax.DBRequest("/twofactor_resend",{parameters:{checkpoint_tkey:this._checkpoint_tkey},onSuccess:function(c){switch(c.responseText.strip()){case"OK":b.hide_error();return b.notify_resent();case"UNREACHABLE":return b.show_error_unreachable();case"EXPIRED":return $("twofactor-confirm").submit()}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_resending_with_delay.bind(this)})},DEFAULT_ENABLE_TITLE:_("Enable two-step verification"),DEFAULT_DISABLE_TITLE:_("Disable two-step verification"),show_enable_start:function(){var a;a=$("twofactor-start");return Modal.icon_show("folder_user_32",this.DEFAULT_ENABLE_TITLE,a)},show_enter_password:function(b){var a;Event.stop(b);a=$("twofactor-enter-password");Modal.icon_show("folder_user_32",this.DEFAULT_ENABLE_TITLE,a);return $("password").clear().focus()},submit_password:function(b){var a,c=this;Event.stop(b);a=$("password").getValue();if(!a){this.show_error(_("Please enter your password"));return}this.show_loading();return new Ajax.DBRequest("/account/twofactor/confirm_password",{parameters:{password:a},onSuccess:function(d){var e;e=Util.from_json(d.responseText);if(e){c.hide_error();c._checkpoint_tkey=e;return c.show_enter_phone_number()}else{return c.show_error(_("Invalid password"))}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},show_enter_phone_number:function(){var a;a=$("twofactor-enter-phone");Modal.icon_show("folder_user_32",this.DEFAULT_ENABLE_TITLE,a);return $("phone-number").clear().focus()},submit_phone_number:function(c){var b,a,d=this;Event.stop(c);b=$("country-code").getValue().strip();a=$("phone-number").getValue().strip();if(!a){this.show_error(_("Please enter your phone number"));return}a=a.replace(/\D/g,"");if(!(a.length>7)){this.show_error(_("Invalid phone number"));return}a=""+b+" "+a;this.show_loading();return new Ajax.DBRequest("/account/twofactor/add_phone",{parameters:{checkpoint_tkey:this._checkpoint_tkey,phone_number:a},onSuccess:function(e){switch(e.responseText.strip()){case"OK":d.hide_error();$("phone-number-placeholder").__date(a);return d.show_confirm_phone();case"EXPIRED":d.show_enter_password();return d.show_error_expired();case"UNREACHABLE":return d.show_error_unreachable()}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},show_confirm_phone:function(){var a;a=$("twofactor-confirm-phone");Modal.icon_show("folder_user_32",this.DEFAULT_ENABLE_TITLE,a);return $("phone-code").clear().focus()},submit_phone_code:function(b){var a,c=this;Event.stop(b);a=$("phone-code").getValue().strip();if(!a){this.show_error(_("Please enter the security code"));return}if(a.search(/^\d{6}$/)===-1){this.show_error(_("Invalid security code"));return}this.show_loading();return new Ajax.DBRequest("/account/twofactor/confirm_phone",{parameters:{checkpoint_tkey:this._checkpoint_tkey,twofactor_code:a},onSuccess:function(d){switch(d.responseText.strip()){case"OK":c.hide_error();c._checkpoint_tkey=null;$("twofactor-row").addClassName("twofactor-enabled");return c.show_done();case"EXPIRED":c.show_enter_password();return c.show_error_expired();case"INVALID":return c.show_error(_("Invalid security code"))}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},enable_resend_phone_code:function(a){var b=this;Event.stop(a);if(this.is_resending()){return}this.show_resending();return new Ajax.DBRequest("/twofactor_resend",{parameters:{checkpoint_tkey:this._checkpoint_tkey},onSuccess:function(c){switch(c.responseText.strip()){case"OK":b.hide_error();return b.notify_resent();case"UNREACHABLE":return b.show_error_unreachable();case"EXPIRED":b.show_enter_password();return b.show_error_expired()}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_resending_with_delay.bind(this)})},show_done:function(){var a,b;a=$("twofactor-done");b=_("Congrats! You've enabled two-step verification!");return Modal.icon_show("folder_user_32",b,a)},submit_done:function(a){Event.stop(a);return Modal.hide()},disable_show_enter_password:function(){var a;a=$("twofactor-disable-enter-password");Modal.icon_show("folder_user_32",this.DEFAULT_DISABLE_TITLE,a);return $("password").clear().focus()},disable_submit_password:function(b){var a,c=this;Event.stop(b);a=$("password").getValue();if(!a){this.show_error(_("Please enter your password"));return}this.show_loading();return new Ajax.DBRequest("/account/twofactor/disable_confirm_password",{parameters:{password:a},onSuccess:function(d){var e;e=Util.from_json(d.responseText);if(e){c.hide_error();c._checkpoint_tkey=e;return c.disable_show()}else{return c.show_error(_("Invalid password"))}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},disable_show:function(){var a;a=$("twofactor-disable");return Modal.icon_show("folder_user_32",this.DEFAULT_DISABLE_TITLE,a)},disable_submit:function(a){var b=this;Event.stop(a);this.show_loading();return new Ajax.DBRequest("/account/twofactor/disable",{parameters:{checkpoint_tkey:this._checkpoint_tkey},onSuccess:function(c){switch(c.responseText.strip()){case"OK":b._checkpoint_tkey=null;$("twofactor-row").removeClassName("twofactor-enabled");Notify.server_success(_("Two-step verification is now disabled."));return Modal.hide();case"EXPIRED":b.disable_show_enter_password();return b.show_error_expired()}},onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this)})},show_error:function(b){var a;a=$$(this._error_selector);a.invoke("__date",b);return a.invoke("show")},show_error500:function(){return this.show_error(_("Sorry, an error occured. Please try again later."))},show_error_unreachable:function(){return this.show_error(_("We couldn't reach your phone number. Are you sure it's correct?"))},show_error_expired:function(){return this.show_error(_("Since it's been a while, please enter your password again."))},hide_error:function(){return $$(this._error_selector).invoke("__date")},show_loading:function(){return $$(this._container_selector).invoke("addClassName","loading")},hide_loading:function(){return $$(this._container_selector).invoke("removeClassName","loading")},is_resending:function(){return $$(this._container_selector)[0].hasClassName("resending")},show_resending:function(){return $$(this._container_selector).invoke("addClassName","resending")},hide_resending:function(){return $$(this._container_selector).invoke("removeClassName","resending")},hide_resending_with_delay:function(){return setTimeout(this.hide_resending.bind(this),3000)},notify_resent:function(){return Notify.server_success(_("We sent you another code. Keep in mind that it might take a few minutes."))}};